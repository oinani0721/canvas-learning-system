# 2.1 åŠŸèƒ½æ€§éœ€æ±‚ (Functional Requirements)

## FR1: å®æ—¶Canvasæ–‡ä»¶ç›‘æ§

**éœ€æ±‚æè¿°**ï¼šç³»ç»Ÿåº”è‡ªåŠ¨æ£€æµ‹`ç¬”è®°åº“/`ç›®å½•ä¸‹æ‰€æœ‰`.canvas`æ–‡ä»¶çš„åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤äº‹ä»¶ã€‚

**è¯¦ç»†è§„æ ¼**ï¼š

- **ç›‘æ§èŒƒå›´**ï¼š
  - é€’å½’ç›‘æ§æ‰€æœ‰å­ç›®å½•
  - ä»…ç›‘æ§`.canvas`æ‰©å±•åæ–‡ä»¶
  - è‡ªåŠ¨å¤„ç†æ–‡ä»¶ç§»åŠ¨å’Œé‡å‘½åäº‹ä»¶

- **æ£€æµ‹å»¶è¿Ÿ**ï¼š
  - æ–‡ä»¶ç³»ç»Ÿäº‹ä»¶è§¦å‘ < 50msï¼ˆOSçº§åˆ«ï¼‰
  - é˜²æŠ–å»¶è¿Ÿï¼š500msï¼ˆå¯é…ç½®ï¼‰
  - æ€»æ£€æµ‹å»¶è¿Ÿ â‰¤ 600ms

- **äº‹ä»¶ç±»å‹**ï¼š
  - CREATEï¼šæ–°Canvasæ–‡ä»¶åˆ›å»º
  - UPDATEï¼šCanvasæ–‡ä»¶å†…å®¹ä¿®æ”¹
  - DELETEï¼šCanvasæ–‡ä»¶åˆ é™¤
  - MOVEï¼šCanvasæ–‡ä»¶ç§»åŠ¨æˆ–é‡å‘½å

**éªŒæ”¶æ ‡å‡†**ï¼š

- âœ… åœ¨Obsidianä¸­ä¿å­˜Canvaså600mså†…è§¦å‘å¤„ç†
- âœ… 500mså†…çš„é‡å¤ä¿®æ”¹ä»…è§¦å‘1æ¬¡å¤„ç†ï¼ˆé˜²æŠ–ç”Ÿæ•ˆï¼‰
- âœ… æ”¯æŒåŒæ—¶ç›‘æ§è‡³å°‘10ä¸ªCanvasæ–‡ä»¶
- âœ… ç›‘æ§è¿›ç¨‹å´©æºƒä¸å½±å“Canvasæ–‡ä»¶å®Œæ•´æ€§

---

## FR2: Canvaså†…å®¹è§£æä¸å˜æ›´æ£€æµ‹

**éœ€æ±‚æè¿°**ï¼šç³»ç»Ÿåº”è§£æCanvas JSONæ–‡ä»¶ç»“æ„ï¼Œæå–èŠ‚ç‚¹å’Œè¾¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶æ£€æµ‹ç»†ç²’åº¦å˜æ›´ã€‚

**è§£æå†…å®¹**ï¼š

- **èŠ‚ç‚¹ä¿¡æ¯**ï¼š
  - `id`ï¼šèŠ‚ç‚¹å”¯ä¸€æ ‡è¯†ç¬¦
  - `type`ï¼šèŠ‚ç‚¹ç±»å‹ï¼ˆtext/file/link/groupï¼‰
  - `text`ï¼šèŠ‚ç‚¹æ–‡æœ¬å†…å®¹
  - `color`ï¼šèŠ‚ç‚¹é¢œè‰²ä»£ç ï¼ˆ"1"=çº¢/"2"=ç»¿/"3"=ç´«/"5"=è“/"6"=é»„ï¼‰
  - `x`, `y`ï¼šèŠ‚ç‚¹ä½ç½®åæ ‡
  - `width`, `height`ï¼šèŠ‚ç‚¹å°ºå¯¸

- **è¾¹ä¿¡æ¯**ï¼š
  - `id`ï¼šè¾¹å”¯ä¸€æ ‡è¯†ç¬¦
  - `fromNode`, `toNode`ï¼šè¿æ¥çš„èŠ‚ç‚¹ID
  - `fromSide`, `toSide`ï¼šè¿æ¥ç‚¹ä½ç½®

**å˜æ›´æ£€æµ‹**ï¼š

| å˜æ›´ç±»å‹ | æ£€æµ‹å†…å®¹ | ç”¨é€” |
|---------|---------|------|
| èŠ‚ç‚¹æ–°å¢ | æ–°èŠ‚ç‚¹IDå‡ºç° | è¿½è¸ªçŸ¥è¯†ä½“ç³»æ‰©å±• |
| èŠ‚ç‚¹åˆ é™¤ | èŠ‚ç‚¹IDæ¶ˆå¤± | è¯†åˆ«çŸ¥è¯†ç‚¹ç§»é™¤ |
| é¢œè‰²å˜æ›´ | colorå­—æ®µå˜åŒ– | **æ ¸å¿ƒ**ï¼šå­¦ä¹ è¿›åº¦è¿½è¸ªï¼ˆçº¢â†’ç´«â†’ç»¿ï¼‰ |
| ä½ç½®å˜æ›´ | x/yåæ ‡å˜åŒ– | å¸ƒå±€è°ƒæ•´è¿½è¸ª |
| å†…å®¹æ›´æ–° | textå­—æ®µå˜åŒ– | ç†è§£æ·±åŒ–è¿½è¸ª |

**æ€§èƒ½è¦æ±‚**ï¼š

- Canvasè§£ææ—¶é—´ï¼š
  - 50èŠ‚ç‚¹ï¼š< 150ms
  - 100èŠ‚ç‚¹ï¼š< 300ms
  - 200èŠ‚ç‚¹ï¼š< 600ms

**éªŒæ”¶æ ‡å‡†**ï¼š

- âœ… æˆåŠŸè§£æç¬¦åˆObsidian Canvasæ ¼å¼çš„JSONæ–‡ä»¶
- âœ… æ­£ç¡®è¯†åˆ«æ‰€æœ‰5ç§é¢œè‰²ä»£ç 
- âœ… æ£€æµ‹åˆ°èŠ‚ç‚¹æ–°å¢ã€åˆ é™¤ã€é¢œè‰²å˜æ›´ã€ä½ç½®å˜æ›´
- âœ… è§£æå¤±è´¥æ—¶è®°å½•é”™è¯¯ä½†ä¸å´©æºƒç›‘æ§è¿›ç¨‹
- âœ… æ€§èƒ½è¾¾æ ‡ï¼ˆ50èŠ‚ç‚¹ < 150msï¼‰

---

## FR3: å­¦ä¹ è¿›åº¦åˆ†æ

**éœ€æ±‚æè¿°**ï¼šç³»ç»Ÿåº”åŸºäºé¢œè‰²æµè½¬è‡ªåŠ¨è¯†åˆ«å­¦ä¹ äº‹ä»¶ï¼Œå¹¶ç»Ÿè®¡å­¦ä¹ æŒ‡æ ‡ã€‚

**å­¦ä¹ äº‹ä»¶è¯†åˆ«**ï¼š

| äº‹ä»¶ç±»å‹ | é¢œè‰²æµè½¬ | å«ä¹‰ | ä¼˜å…ˆçº§ |
|---------|---------|------|-------|
| `understanding_improving` | çº¢(1) â†’ ç´«(3) | ä»å®Œå…¨ä¸æ‡‚åˆ°ä¼¼æ‡‚éæ‡‚ | ğŸŸ¡ æ­£å¸¸è¿›æ­¥ |
| `understanding_mastered` | ç´«(3) â†’ ç»¿(2) | ä»ä¼¼æ‡‚éæ‡‚åˆ°å®Œå…¨æŒæ¡ | ğŸŸ¢ æŒæ¡æˆåŠŸ |
| `breakthrough` | çº¢(1) â†’ ç»¿(2) | è·¨è¶Šå¼çªç ´ | ğŸŒŸ é‡å¤§è¿›æ­¥ |
| `understanding_regressed` | ç»¿(2) â†’ ç´«(3)<br>ç´«(3) â†’ çº¢(1) | ç†è§£é€€æ­¥ | ğŸ”´ éœ€è¦å¤ä¹  |
| `knowledge_node_added` | æ— é¢œè‰² â†’ çº¢(1) | æ–°å¢é—®é¢˜èŠ‚ç‚¹ | ğŸ“ çŸ¥è¯†æ‰©å±• |
| `personal_understanding_updated` | é»„(6)èŠ‚ç‚¹å†…å®¹å˜åŒ– | ä¸ªäººç†è§£å¡«å†™/ä¼˜åŒ– | ğŸ’­ è¾“å‡ºè®­ç»ƒ |

**å­¦ä¹ æŒ‡æ ‡ç»Ÿè®¡**ï¼š

1. **å­¦ä¹ æ—¶é•¿**ï¼š
   - è®¡ç®—æ–¹å¼ï¼šé¦–æ¬¡Canvasæ‰“å¼€åˆ°æœ€åä¿®æ”¹çš„æ—¶é—´è·¨åº¦
   - å•ä½ï¼šåˆ†é’Ÿ
   - èšåˆï¼šæ¯Canvasã€æ¯æ—¥ã€æ¯å‘¨

2. **é¢œè‰²åˆ†å¸ƒ**ï¼š
   - ç»Ÿè®¡çº¢/ç´«/ç»¿/è“/é»„èŠ‚ç‚¹çš„æ•°é‡å’Œå æ¯”
   - è¶‹åŠ¿ï¼šè¿½è¸ªé¢œè‰²åˆ†å¸ƒéšæ—¶é—´çš„å˜åŒ–

3. **ç†è§£æå‡ç‡**ï¼š
   - å…¬å¼ï¼š`(æ­£å‘æµè½¬æ¬¡æ•°) / (æ€»æµè½¬æ¬¡æ•°) Ã— 100%`
   - æ­£å‘æµè½¬ï¼šçº¢â†’ç´«ã€ç´«â†’ç»¿ã€çº¢â†’ç»¿
   - ç›®æ ‡å€¼ï¼š> 70%è¡¨ç¤ºå­¦ä¹ æ•ˆæœè‰¯å¥½

4. **Agentä½¿ç”¨é¢‘ç‡**ï¼š
   - æ£€æµ‹è“è‰²èŠ‚ç‚¹ï¼ˆAIç”Ÿæˆè§£é‡Šï¼‰çš„åˆ›å»º
   - ä»èŠ‚ç‚¹æ–‡æœ¬æ¨æ–­ä½¿ç”¨çš„Agentï¼ˆå¦‚ï¼šğŸ—£ï¸ = oral-explanationï¼‰
   - ç»Ÿè®¡Top 3æœ€å¸¸ç”¨Agent

**éªŒæ”¶æ ‡å‡†**ï¼š

- âœ… æ­£ç¡®è¯†åˆ«6ç§å­¦ä¹ äº‹ä»¶ç±»å‹
- âœ… å­¦ä¹ æ—¶é•¿ç»Ÿè®¡è¯¯å·® < 5åˆ†é’Ÿ
- âœ… é¢œè‰²åˆ†å¸ƒç»Ÿè®¡å‡†ç¡®ï¼ˆä¸æ‰‹åŠ¨è®¡æ•°ä¸€è‡´ï¼‰
- âœ… ç†è§£æå‡ç‡è®¡ç®—å…¬å¼æ­£ç¡®
- âœ… Agentè¯†åˆ«å‡†ç¡®ç‡ > 90%ï¼ˆåŸºäºemojiå’Œå…³é”®è¯ï¼‰

---

## FR4: åŒå±‚æ•°æ®æŒä¹…åŒ–

**éœ€æ±‚æè¿°**ï¼šç³»ç»Ÿåº”å®ç°çƒ­æ•°æ®ï¼ˆJSONï¼‰å’Œå†·æ•°æ®ï¼ˆSQLiteï¼‰çš„åŒå±‚å­˜å‚¨æ¶æ„ã€‚

### 4.1 çƒ­æ•°æ®å±‚ï¼ˆJSONæ–‡ä»¶ï¼‰

**ç›®çš„**ï¼šå®æ—¶è®°å½•æœ€è¿‘24å°æ—¶çš„å­¦ä¹ æ´»åŠ¨ï¼Œæä¾›å¿«é€Ÿå†™å…¥å’ŒæŸ¥è¯¢ã€‚

**æ–‡ä»¶ç»“æ„**ï¼š

```
.learning_sessions/
â”œâ”€â”€ session_2025-01-15.json      # å½“æ—¥ä¼šè¯
â”œâ”€â”€ session_2025-01-14.json      # æ˜¨æ—¥ä¼šè¯ï¼ˆå¾…åŒæ­¥ï¼‰
â”œâ”€â”€ hot_stats.json                # å®æ—¶ç»Ÿè®¡ç¼“å­˜
â””â”€â”€ metadata.json                 # ä¼šè¯å…ƒæ•°æ®
```

**JSON Schema**ï¼š

```json
{
  "session_id": "session_2025-01-15",
  "start_time": "2025-01-15T08:30:00",
  "last_update": "2025-01-15T23:45:00",
  "events": [
    {
      "event_id": "evt_1705300523000",
      "timestamp": "2025-01-15T10:15:23",
      "canvas_id": "ç¦»æ•£æ•°å­¦.canvas",
      "event_type": "color_changed",
      "node_id": "node_abc123",
      "details": {
        "old_color": "1",
        "new_color": "3",
        "analysis": {
          "progress_type": "understanding_improving",
          "score_change": "+20"
        }
      }
    }
  ],
  "stats": {
    "total_changes": 45,
    "learning_duration_seconds": 3600,
    "color_distribution": {
      "red": 5,
      "purple": 8,
      "green": 12,
      "blue": 3,
      "yellow": 7
    },
    "understanding_rate": 0.73
  }
}
```

**æ€§èƒ½è¦æ±‚**ï¼š

- JSONå†™å…¥å»¶è¿Ÿï¼š< 20msï¼ˆå•æ¬¡å†™å…¥ï¼ŒSSDç¯å¢ƒï¼‰
- å†™å…¥å¤±è´¥é‡è¯•ï¼šæœ€å¤š3æ¬¡ï¼Œé—´éš”100ms
- æ–‡ä»¶å¤§å°é™åˆ¶ï¼šå•æ–‡ä»¶ < 10MBï¼ˆçº¦10000æ¡äº‹ä»¶ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š

- âœ… æ¯å¤©è‡ªåŠ¨åˆ›å»ºæ–°sessionæ–‡ä»¶
- âœ… æ¯æ¬¡Canvaså˜æ›´åç«‹å³å†™å…¥JSON
- âœ… JSONæ ¼å¼ç¬¦åˆé¢„å®šä¹‰Schema
- âœ… å†™å…¥å¤±è´¥æ—¶é‡è¯•å¹¶è®°å½•é”™è¯¯æ—¥å¿—
- âœ… æ”¯æŒæŸ¥è¯¢å½“æ—¥ç»Ÿè®¡æ•°æ®ï¼ˆ< 100msï¼‰

### 4.2 å†·æ•°æ®å±‚ï¼ˆSQLiteæ•°æ®åº“ï¼‰

**ç›®çš„**ï¼šé•¿æœŸå­˜å‚¨å­¦ä¹ å†å²ï¼Œæä¾›å¼ºå¤§çš„æŸ¥è¯¢å’Œåˆ†æèƒ½åŠ›ã€‚

**æ•°æ®åº“Schema**ï¼š

```sql
-- è¡¨1: Canvaså˜æ›´è®°å½•ï¼ˆæ‰€æœ‰ç»†ç²’åº¦å˜æ›´ï¼‰
CREATE TABLE canvas_changes (
    change_id TEXT PRIMARY KEY,
    canvas_id TEXT NOT NULL,
    change_type TEXT NOT NULL,  -- CREATE/UPDATE/DELETE
    node_id TEXT,
    node_type TEXT,
    old_content TEXT,           -- JSONæ ¼å¼
    new_content TEXT,           -- JSONæ ¼å¼
    timestamp DATETIME NOT NULL,
    file_path TEXT,
    INDEX idx_canvas_timestamp (canvas_id, timestamp),
    INDEX idx_change_type (change_type)
);

-- è¡¨2: å­¦ä¹ äº‹ä»¶ï¼ˆé«˜çº§è¯­ä¹‰äº‹ä»¶ï¼‰
CREATE TABLE learning_events (
    event_id TEXT PRIMARY KEY,
    canvas_id TEXT NOT NULL,
    event_type TEXT NOT NULL,  -- understanding_improving/mastered/breakthrough
    node_id TEXT,
    details TEXT,              -- JSONæ ¼å¼è¯¦ç»†ä¿¡æ¯
    timestamp DATETIME NOT NULL,
    INDEX idx_canvas_event (canvas_id, timestamp)
);

-- è¡¨3: é¢œè‰²æµè½¬è®°å½•
CREATE TABLE color_transitions (
    transition_id INTEGER PRIMARY KEY AUTOINCREMENT,
    canvas_id TEXT NOT NULL,
    node_id TEXT NOT NULL,
    from_color TEXT,           -- "1"=çº¢/"3"=ç´«/"2"=ç»¿
    to_color TEXT,
    transition_type TEXT,      -- improving/mastered/regressed
    timestamp DATETIME NOT NULL,
    INDEX idx_node_transitions (node_id, timestamp)
);

-- è¡¨4: æ¯æ—¥ç»Ÿè®¡æ‘˜è¦
CREATE TABLE daily_stats (
    stat_date DATE PRIMARY KEY,
    total_canvas_files INTEGER,
    total_changes INTEGER,
    total_learning_seconds INTEGER,
    nodes_red INTEGER,
    nodes_purple INTEGER,
    nodes_green INTEGER,
    understanding_rate REAL,   -- ç†è§£æå‡ç‡
    created_at DATETIME NOT NULL
);
```

**æ€§èƒ½è¦æ±‚**ï¼š

- æ‰¹é‡æ’å…¥ï¼š1000æ¡è®°å½• < 500ms
- æŸ¥è¯¢æ€§èƒ½ï¼šæŒ‰æ—¥æœŸèŒƒå›´æŸ¥è¯¢ < 100ms
- æ•°æ®åº“å¤§å°ï¼š90å¤©æ•°æ® < 500MB

**æ•°æ®åŒæ­¥ç­–ç•¥**ï¼š

- åŒæ­¥é¢‘ç‡ï¼šæ¯å°æ—¶ä¸€æ¬¡ï¼ˆå¯é…ç½®ï¼‰
- åŒæ­¥æµç¨‹ï¼š
  1. è¯»å–æ˜¨å¤©çš„JSONæ–‡ä»¶
  2. æ‰¹é‡æ’å…¥åˆ°SQLite
  3. éªŒè¯æ’å…¥æˆåŠŸï¼ˆè®°å½•æ•°åŒ¹é…ï¼‰
  4. åˆ é™¤JSONæ–‡ä»¶
- æ•°æ®ä¿ç•™ï¼š
  - SQLiteä¿ç•™90å¤©
  - 90å¤©åå½’æ¡£åˆ°`.learning_data/archive/YYYY-MM.tar.gz`

**éªŒæ”¶æ ‡å‡†**ï¼š

- âœ… é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“å’Œè¡¨
- âœ… æ”¯æŒ4ç§æ•°æ®è¡¨çš„æ’å…¥å’ŒæŸ¥è¯¢
- âœ… æ‰¹é‡æ’å…¥æ€§èƒ½è¾¾æ ‡ï¼ˆ1000æ¡ < 500msï¼‰
- âœ… æŸ¥è¯¢æ€§èƒ½è¾¾æ ‡ï¼ˆæŒ‰æ—¥æœŸèŒƒå›´ < 100msï¼‰
- âœ… æ•°æ®å®Œæ•´æ€§çº¦æŸç”Ÿæ•ˆï¼ˆä¸»é”®ã€ç´¢å¼•ï¼‰
- âœ… æ¯å°æ—¶è‡ªåŠ¨åŒæ­¥çƒ­æ•°æ®åˆ°å†·æ•°æ®
- âœ… 90å¤©åè‡ªåŠ¨å½’æ¡£

---

## FR5: å­¦ä¹ æŠ¥å‘Šç”Ÿæˆ

**éœ€æ±‚æè¿°**ï¼šç³»ç»Ÿåº”æ”¯æŒç”Ÿæˆ3ç§ç±»å‹çš„å­¦ä¹ æŠ¥å‘Šï¼Œæ ¼å¼ä¸ºMarkdownæ–‡æœ¬ã€‚

### 5.1 æ¯æ—¥å­¦ä¹ æŠ¥å‘Š

**å†…å®¹ç»“æ„**ï¼š

```markdown