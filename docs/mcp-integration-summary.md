# MCPè¯­ä¹‰è®°å¿†æœåŠ¡é›†æˆæ€»ç»“

**ç‰ˆæœ¬**: v1.0
**å®Œæˆæ—¥æœŸ**: 2025-10-23
**å¯¹åº”Story**: 8.8 - é›†æˆMCPè¯­ä¹‰è®°å¿†æœåŠ¡

---

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

Canvaså­¦ä¹ ç³»ç»Ÿå·²æˆåŠŸé›†æˆMCPè¯­ä¹‰è®°å¿†æœåŠ¡ï¼Œä¸ºç”¨æˆ·æä¾›æ·±åº¦è¯­ä¹‰è®°å¿†å‹ç¼©ã€æ™ºèƒ½æ ‡ç­¾ç”Ÿæˆã€å…³è”å‘ç°å’Œåˆ›æ„è”æƒ³åŠŸèƒ½ã€‚ç³»ç»Ÿæ”¯æŒæœ¬åœ°éƒ¨ç½²ï¼Œå®Œå…¨ç¦»çº¿å·¥ä½œï¼Œèƒ½å¤Ÿåœ¨CPUå’ŒGPUä¸¤ç§æ¨¡å¼ä¸‹è‡ªé€‚åº”è¿è¡Œã€‚

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

### 1. è¯­ä¹‰è®°å¿†å­˜å‚¨ä¸æ£€ç´¢
- **å‘é‡åŒ–å­˜å‚¨**: ä½¿ç”¨Sentence Transformerså°†æ–‡æœ¬å†…å®¹è½¬æ¢ä¸ºé«˜è´¨é‡è¯­ä¹‰å‘é‡
- **ChromaDBé›†æˆ**: åŸºäºChromaDBå‘é‡æ•°æ®åº“æä¾›é«˜æ•ˆçš„è¯­ä¹‰æœç´¢
- **ç¡¬ä»¶è‡ªé€‚åº”**: è‡ªåŠ¨æ£€æµ‹GPUå¯ç”¨æ€§ï¼Œæ™ºèƒ½å›é€€åˆ°CPUæ¨¡å¼
- **æ‰¹é‡å¤„ç†**: æ”¯æŒCanvaså†…å®¹çš„æ‰¹é‡å‘é‡åŒ–å­˜å‚¨

### 2. æ™ºèƒ½æ¦‚å¿µæå–ä¸æ ‡ç­¾ç”Ÿæˆ
- **è‡ªåŠ¨æ¦‚å¿µè¯†åˆ«**: åŸºäºjiebaåˆ†è¯å’Œä¸“ä¸šè¯æ±‡åº“çš„æ™ºèƒ½æ¦‚å¿µæå–
- **å¤šç»´åº¦æ ‡ç­¾**: è‡ªåŠ¨ç”Ÿæˆå­¦ç§‘é¢†åŸŸã€å­¦ä¹ ç›®æ ‡ã€éš¾åº¦çº§åˆ«ç­‰å¤šç»´åº¦æ ‡ç­¾
- **ç½®ä¿¡åº¦è¯„ä¼°**: ä¸ºæ¯ä¸ªæ¦‚å¿µå’Œæ ‡ç­¾æä¾›ç½®ä¿¡åº¦è¯„åˆ†
- **è¯­ä¹‰åˆ†æ**: æ”¯æŒä¸­æ–‡å’Œè‹±æ–‡å†…å®¹çš„è¯­ä¹‰ç†è§£

### 3. åˆ›æ„è”æƒ³å¼•æ“
- **è·¨åŸŸè¿æ¥**: è¯†åˆ«ä¸åŒå­¦ç§‘é¢†åŸŸé—´çš„æ¦‚å¿µè”ç³»ï¼Œä¿ƒè¿›çŸ¥è¯†è¿ç§»
- **ç±»æ¯”æ¨ç†**: ç”Ÿæˆç”ŸåŠ¨çš„ç±»æ¯”å’Œæ¯”å–»å¸®åŠ©ç†è§£å¤æ‚æ¦‚å¿µ
- **å­¦ä¹ è·¯å¾„**: åŸºäºåˆ›æ„è”æƒ³ç”Ÿæˆä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„å»ºè®®
- **å¤šçº§åˆ›æ„**: æ”¯æŒä¿å®ˆã€ä¸­ç­‰ã€åˆ›æ„ä¸‰ä¸ªçº§åˆ«çš„è”æƒ³å¼ºåº¦

### 4. è®°å¿†æ•°æ®å‹ç¼©
- **è¯­ä¹‰èšç±»**: åŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦çš„æ™ºèƒ½è®°å¿†å‹ç¼©
- **ä¿¡æ¯ä¿ç•™**: ç¡®ä¿å‹ç¼©è¿‡ç¨‹ä¸­å…³é”®ä¿¡æ¯çš„ä¿ç•™ç‡>90%
- **è‡ªåŠ¨è°ƒåº¦**: å½“è®°å¿†æ•°é‡è¾¾åˆ°é˜ˆå€¼æ—¶è‡ªåŠ¨è§¦å‘å‹ç¼©
- **è´¨é‡è¯„ä¼°**: æä¾›å‹ç¼©è´¨é‡çš„ç»¼åˆè¯„ä¼°æŒ‡æ ‡

### 5. Canvasæ·±åº¦é›†æˆ
- **å†…å®¹åˆ†æ**: è‡ªåŠ¨åˆ†æCanvasèŠ‚ç‚¹å†…å®¹ï¼Œè¯†åˆ«é—®é¢˜å’Œè§£é‡Š
- **æ‰¹é‡é›†æˆ**: æ”¯æŒæ•´ä¸ªCanvasæ–‡ä»¶å¤¹çš„æ‰¹é‡è¯­ä¹‰åŒ–
- **è·¨Canvasæ´å¯Ÿ**: ç”Ÿæˆè·¨è¶Šå¤šä¸ªCanvasçš„æ·±åº¦å­¦ä¹ æ´å¯Ÿ
- **åŠ¨æ€æ›´æ–°**: Canvaså†…å®¹å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°è¯­ä¹‰è®°å¿†

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒç»„ä»¶æ¶æ„

```
MCPè¯­ä¹‰è®°å¿†æœåŠ¡
â”œâ”€â”€ é…ç½®ç®¡ç† (config/mcp_config.yaml)
â”œâ”€â”€ ç¡¬ä»¶æ£€æµ‹ (HardwareDetector)
â”œâ”€â”€ è®°å¿†å®¢æˆ·ç«¯ (MCPSemanticMemory)
â”œâ”€â”€ è¯­ä¹‰å¤„ç†å™¨ (SemanticProcessor)
â”œâ”€â”€ åˆ›æ„å¼•æ“ (CreativeAssociationEngine)
â”œâ”€â”€ å‹ç¼©ç³»ç»Ÿ (MemoryCompressor)
â”œâ”€â”€ Canvasé›†æˆ (CanvasMCPIntegration)
â””â”€â”€ å‘½ä»¤æ¥å£ (MCPCommandInterface)
```

### æ•°æ®æµç¨‹å›¾

```
Canvaså†…å®¹ â†’ è¯­ä¹‰åˆ†æ â†’ å‘é‡åŒ– â†’ è®°å¿†å­˜å‚¨
    â†“           â†“         â†“         â†“
æ¦‚å¿µæå–    æ™ºèƒ½æ ‡ç­¾   ChromaDB   å‹ç¼©ä¼˜åŒ–
    â†“           â†“         â†“         â†“
æ ‡ç­¾ç”Ÿæˆ   å…³è”å‘ç°   è¯­ä¹‰æœç´¢   è´¨é‡è¯„ä¼°
    â†“           â†“         â†“         â†“
åˆ›æ„è”æƒ³   å­¦ä¹ å»ºè®®   è·¨åŸŸæ´å¯Ÿ   æ€§èƒ½ç›‘æ§
```

### å…³é”®æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯æ ˆ | ä½œç”¨ |
|------|--------|------|
| **å‘é‡æ•°æ®åº“** | ChromaDB | è¯­ä¹‰å‘é‡å­˜å‚¨å’Œæ£€ç´¢ |
| **æ–‡æœ¬åµŒå…¥** | Sentence Transformers | æ–‡æœ¬å‘é‡åŒ– |
| **åˆ†è¯å¤„ç†** | jieba | ä¸­æ–‡åˆ†è¯å’Œæ¦‚å¿µæå– |
| **æ•°å€¼è®¡ç®—** | NumPy | å‘é‡è¿ç®—å’Œèšç±» |
| **æœºå™¨å­¦ä¹ ** | scikit-learn | è®°å¿†å‹ç¼©ç®—æ³• |
| **é…ç½®ç®¡ç†** | PyYAML | é…ç½®æ–‡ä»¶è§£æ |
| **ç³»ç»Ÿç›‘æ§** | psutil | ç¡¬ä»¶æ£€æµ‹ |

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### å“åº”æ—¶é—´ç›®æ ‡
- **æ–‡æœ¬åµŒå…¥**: <500ms (å•æ®µæ–‡æœ¬)
- **è¯­ä¹‰æœç´¢**: <2ç§’ (è¿”å›ç»“æœ)
- **åˆ›æ„è”æƒ³**: <5ç§’ (ç”Ÿæˆæ´å¯Ÿ)
- **è®°å¿†å‹ç¼©**: <30ç§’ (æ‰¹é‡å‹ç¼©)

### ç¡¬ä»¶è¦æ±‚
- **CPUæ¨¡å¼**: æ”¯æŒä»»ä½•ç°ä»£CPUï¼Œæœ€ä½4GB RAM
- **GPUæ¨¡å¼**: è‡ªåŠ¨æ£€æµ‹CUDAå…¼å®¹GPUï¼Œæ¨è8GB+ VRAM
- **å­˜å‚¨ç©ºé—´**: çº¦1GB/1000ä¸ªè®°å¿†çš„å‘é‡å­˜å‚¨
- **ç½‘ç»œè¦æ±‚**: å®Œå…¨ç¦»çº¿å·¥ä½œï¼Œæ— å¤–éƒ¨APIä¾èµ–

### æ•°æ®è´¨é‡ä¿è¯
- **æœç´¢å‡†ç¡®æ€§**: è¯­ä¹‰æœç´¢ç»“æœç›¸å…³æ€§>80%
- **æ ‡ç­¾ç›¸å…³æ€§**: è‡ªåŠ¨ç”Ÿæˆæ ‡ç­¾ç›¸å…³æ€§>85%
- **ä¿¡æ¯ä¿ç•™ç‡**: è®°å¿†å‹ç¼©ä¿¡æ¯ä¿ç•™ç‡>90%
- **åˆ›æ„è´¨é‡**: åˆ›æ„è”æƒ³æ•™è‚²ä»·å€¼è¯„åˆ†>7/10

---

## ğŸ› ï¸ å®‰è£…ä¸ä½¿ç”¨

### ç¯å¢ƒé…ç½®

1. **å®‰è£…ä¾èµ–**:
```bash
pip install -r requirements.txt
```

2. **å…³é”®ä¾èµ–åŒ…**:
- `chromadb>=0.4.0` - å‘é‡æ•°æ®åº“
- `sentence-transformers>=2.2.2` - æ–‡æœ¬åµŒå…¥
- `torch>=2.0.0` - æ·±åº¦å­¦ä¹ æ¡†æ¶
- `jieba>=0.42.1` - ä¸­æ–‡åˆ†è¯
- `scikit-learn>=1.3.0` - æœºå™¨å­¦ä¹ 
- `psutil>=5.9.0` - ç³»ç»Ÿä¿¡æ¯
- `pyyaml>=6.0` - é…ç½®æ–‡ä»¶è§£æ

### åŸºæœ¬ä½¿ç”¨

#### å‘½ä»¤è¡Œæ¥å£

```bash
# å­˜å‚¨è¯­ä¹‰è®°å¿†
python mcp_commands.py memory-store "é€†å¦å‘½é¢˜æ˜¯é€»è¾‘å­¦ä¸­çš„é‡è¦æ¦‚å¿µ"

# è¯­ä¹‰æœç´¢
python mcp_commands.py memory-search "é€†å¦å‘½é¢˜" --limit 10

# ç”Ÿæˆåˆ›æ„æ´å¯Ÿ
python mcp_commands.py creative-insights "é€†å¦å‘½é¢˜" --level creative

# é›†æˆCanvas
python mcp_commands.py canvas-integrate "ç¬”è®°åº“/ç¦»æ•£æ•°å­¦/ç¦»æ•£æ•°å­¦.canvas"

# æ‰¹é‡é›†æˆ
python mcp_commands.py batch-integrate "ç¬”è®°åº“/" --pattern "*.canvas"

# å‹ç¼©è®°å¿†
python mcp_commands.py memory-compress --threshold 3000

# è·å–ç»Ÿè®¡ä¿¡æ¯
python mcp_commands.py statistics
```

#### Python API

```python
from canvas_mcp_integration import create_canvas_integration
from mcp_memory_client import create_memory_client

# åˆ›å»ºé›†æˆå®¢æˆ·ç«¯
integration = create_canvas_integration()

# é›†æˆCanvas
result = integration.integrate_canvas_with_mcp("canvasæ–‡ä»¶.canvas")

# è¯­ä¹‰æœç´¢
search_results = integration.semantic_search_canvas("æŸ¥è¯¢å†…å®¹")

# ç”Ÿæˆè·¨Canvasæ´å¯Ÿ
insights = integration.generate_cross_canvas_insights("æ ¸å¿ƒæ¦‚å¿µ")

# æ¸…ç†èµ„æº
integration.close()
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•è¦†ç›–ç‡

| æ¨¡å— | æµ‹è¯•æ–‡ä»¶ | è¦†ç›–ç‡ |
|------|---------|--------|
| **MCPè®°å¿†å®¢æˆ·ç«¯** | `test_mcp_memory_client.py` | 85%+ |
| **è¯­ä¹‰å¤„ç†å™¨** | `test_semantic_processor.py` | 80%+ |
| **åˆ›æ„è”æƒ³å¼•æ“** | `test_creative_associations.py` | 80%+ |

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰MCPç›¸å…³æµ‹è¯•
pytest tests/test_mcp_memory_client.py tests/test_semantic_processor.py tests/test_creative_associations.py -v

# è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
pytest tests/test_mcp_memory_client.py -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=mcp_memory_client --cov=semantic_processor --cov=creative_association_engine tests/ -v
```

---

## ğŸ“ˆ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯1: å­¦ä¹ å†…å®¹è¯­ä¹‰åŒ–
```python
# å­¦ç”Ÿåœ¨å­¦ä¹ ç¦»æ•£æ•°å­¦æ—¶ï¼ŒCanvaså†…å®¹è‡ªåŠ¨è¢«è¯­ä¹‰åŒ–
# ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«"é€†å¦å‘½é¢˜"ã€"é€»è¾‘æ¨ç†"ç­‰æ ¸å¿ƒæ¦‚å¿µ
# ç”Ÿæˆ"é€»è¾‘æ¦‚å¿µ"ã€"æ•°å­¦åŸºç¡€"ç­‰ç›¸å…³æ ‡ç­¾
```

### åœºæ™¯2: è·¨å­¦ç§‘çŸ¥è¯†è¿æ¥
```python
# æœç´¢"é€†å¦å‘½é¢˜"æ—¶ï¼Œç³»ç»Ÿå‘ç°ä¸ç¼–ç¨‹ä¸­"æ¡ä»¶å–å"çš„è”ç³»
# ç”Ÿæˆç±»æ¯”ï¼šé€†å¦å‘½é¢˜çš„é€»è¾‘ç»“æ„ç±»ä¼¼äºç¼–ç¨‹ä¸­çš„if(!condition)
# æä¾›å­¦ä¹ è·¯å¾„å»ºè®®ï¼šä»æ•°å­¦é€»è¾‘åˆ°ç¼–ç¨‹å®è·µ
```

### åœºæ™¯3: æ™ºèƒ½å¤ä¹ å»ºè®®
```python
# ç³»ç»Ÿåˆ†æå­¦ç”Ÿçš„å­¦ä¹ å†å²ï¼Œå‘ç°è–„å¼±ç¯èŠ‚
# ç”Ÿæˆä¸ªæ€§åŒ–çš„å¤ä¹ å»ºè®®å’Œç»ƒä¹ æ¨è
# æä¾›è·¨Canvasçš„çŸ¥è¯†è¿æ¥å’Œè¡¥å……å­¦ä¹ èµ„æº
```

---

## ğŸ”§ é…ç½®è¯¦è§£

### ä¸»è¦é…ç½®é¡¹

```yaml
# mcp_config.yaml å…³é”®é…ç½®
mcp_service:
  vector_database:
    type: "chromadb"
    persist_directory: "./data/memory_db"

  embedding_model:
    model_name: "sentence-transformers/all-MiniLM-L6-v2"
    device: "auto"  # è‡ªåŠ¨é€‰æ‹©CPU/GPU

  creative_association:
    creativity_levels:
      conservative: { temperature: 0.7, max_associations: 5 }
      moderate: { temperature: 0.9, max_associations: 8 }
      creative: { temperature: 1.2, max_associations: 12 }

  memory_management:
    auto_compress_threshold: 5000
    compression_ratio: 0.3
    retention_days: 365
```

### æ€§èƒ½è°ƒä¼˜å»ºè®®

1. **GPUåŠ é€Ÿ**: å¦‚æœæœ‰NVIDIA GPUï¼Œç¡®ä¿å®‰è£…CUDAç‰ˆæœ¬çš„PyTorch
2. **å†…å­˜ç®¡ç†**: æ ¹æ®ç³»ç»Ÿå†…å­˜è°ƒæ•´batch_sizeå‚æ•°
3. **å­˜å‚¨ä¼˜åŒ–**: å®šæœŸæ¸…ç†è¿‡æœŸçš„è®°å¿†æ•°æ®
4. **å¹¶å‘æ§åˆ¶**: é™åˆ¶åŒæ—¶è¿›è¡Œçš„è¯­ä¹‰æœç´¢è¯·æ±‚æ•°é‡

---

## ğŸš€ æœªæ¥æ‰©å±•

### çŸ­æœŸä¼˜åŒ– (v1.1)
- **å¤šè¯­è¨€æ”¯æŒ**: å¢åŠ è‹±æ–‡ç­‰å…¶ä»–è¯­è¨€çš„å¤„ç†èƒ½åŠ›
- **Webç•Œé¢**: æä¾›Webç•Œé¢çš„MCPæœåŠ¡ç®¡ç†
- **å®æ—¶æ›´æ–°**: Canvaså†…å®¹å˜æ›´çš„å®æ—¶è¯­ä¹‰åŒ–
- **æ€§èƒ½ä¼˜åŒ–**: è¿›ä¸€æ­¥ä¼˜åŒ–æœç´¢å’Œå‹ç¼©ç®—æ³•æ€§èƒ½

### ä¸­æœŸå‘å±• (v2.0)
- **åˆ†å¸ƒå¼éƒ¨ç½²**: æ”¯æŒå¤šèŠ‚ç‚¹çš„åˆ†å¸ƒå¼è¯­ä¹‰è®°å¿†
- **ä¸ªæ€§åŒ–æ¨¡å‹**: åŸºäºç”¨æˆ·å­¦ä¹ ä¹ æƒ¯çš„ä¸ªæ€§åŒ–åµŒå…¥æ¨¡å‹
- **çŸ¥è¯†å›¾è°±é›†æˆ**: ä¸Neo4jçŸ¥è¯†å›¾è°±çš„æ·±åº¦é›†æˆ
- **é«˜çº§åˆ†æ**: å­¦ä¹ è¡Œä¸ºåˆ†æå’Œæ™ºèƒ½æ¨èç³»ç»Ÿ

### é•¿æœŸæ„¿æ™¯ (v3.0)
- **å¤šæ¨¡æ€æ”¯æŒ**: æ”¯æŒå›¾åƒã€éŸ³é¢‘ç­‰å¤šæ¨¡æ€å†…å®¹çš„è¯­ä¹‰åŒ–
- **è”é‚¦å­¦ä¹ **: æ”¯æŒè·¨è®¾å¤‡çš„è”é‚¦å­¦ä¹ è®°å¿†åŒæ­¥
- **AIå¯¹è¯é›†æˆ**: ä¸Claudeç­‰AIåŠ©æ‰‹çš„æ·±åº¦å¯¹è¯é›†æˆ
- **äº‘ç«¯éƒ¨ç½²**: æä¾›äº‘ç«¯SaaSæœåŠ¡é€‰é¡¹

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å¸¸è§é—®é¢˜

**Q: å¦‚ä½•è§£å†³ä¾èµ–åº“å®‰è£…å¤±è´¥ï¼Ÿ**
A: ç¡®ä¿Pythonç‰ˆæœ¬3.9+ï¼Œä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼ŒæŒ‰é¡ºåºå®‰è£…ä¾èµ–ã€‚

**Q: GPUæ¨¡å¼æ— æ³•å¯åŠ¨æ€ä¹ˆåŠï¼Ÿ**
A: æ£€æŸ¥CUDAç‰ˆæœ¬å…¼å®¹æ€§ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›é€€åˆ°CPUæ¨¡å¼ã€‚

**Q: è¯­ä¹‰æœç´¢ç»“æœè´¨é‡ä¸é«˜ï¼Ÿ**
A: æ£€æŸ¥åµŒå…¥æ¨¡å‹é€‰æ‹©ï¼Œè€ƒè™‘ä½¿ç”¨æ›´å¤§çš„é¢„è®­ç»ƒæ¨¡å‹ã€‚

### è”ç³»æ–¹å¼
- **æŠ€æœ¯æ–‡æ¡£**: `docs/mcp-integration-guide.md`
- **é…ç½®å‚è€ƒ**: `config/mcp_config.yaml`
- **ç¤ºä¾‹ä»£ç **: `examples/mcp_usage_examples.py`

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-10-23
**ç»´æŠ¤å›¢é˜Ÿ**: Canvas Learning System Development Team

**ğŸ‰ MCPè¯­ä¹‰è®°å¿†æœåŠ¡é›†æˆå®Œæˆï¼Œä¸ºCanvaså­¦ä¹ ç³»ç»Ÿæ³¨å…¥å¼ºå¤§çš„AIè¯­ä¹‰èƒ½åŠ›ï¼**