# Epic 31: æ£€éªŒç™½æ¿æ™ºèƒ½å¼•å¯¼ç³»ç»Ÿå®Œæ•´æ¿€æ´»

## Epic å…ƒæ•°æ®

| å±æ€§ | å€¼ |
|------|-----|
| **Epic ID** | EPIC-31 |
| **æ ‡é¢˜** | æ£€éªŒç™½æ¿æ™ºèƒ½å¼•å¯¼ç³»ç»Ÿå®Œæ•´æ¿€æ´» |
| **ç±»å‹** | Brownfield Enhancement |
| **ä¼˜å…ˆçº§** | P0 (Critical) |
| **çŠ¶æ€** | âš ï¸ Adversarial Review Remediated â€” 31.A.7-A.9 Complete, 31.A.10 Pending (2026-02-10) |
| **åˆ›å»ºæ—¥æœŸ** | 2026-01-17 |
| **é¢„è®¡å·¥æ—¶** | 13-16å¤© |
| **å…³è”Bug** | Bug 4 (æ£€éªŒç™½æ¿è´¨é‡å·®) |
| **å…³è”PRDéœ€æ±‚** | é—®é¢˜7 (Agentå†³ç­–), é—®é¢˜8 (å†å²å…³è”) |

---

## Epic Goal

**æ¿€æ´»æ£€éªŒç™½æ¿çš„å®Œæ•´æ™ºèƒ½å¼•å¯¼åŠŸèƒ½**ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿï¼š
1. ä¸€é”®ç”Ÿæˆä¸åŸå§‹Canvaså…³è”çš„æ£€éªŒç™½æ¿
2. é€šè¿‡Socraticå¼é—®ç­”éªŒè¯æ¦‚å¿µç†è§£
3. æ ¹æ®å›ç­”è´¨é‡è·å¾—æ™ºèƒ½å¼•å¯¼ï¼ˆæ‹†è§£/è§£é‡Š/ç»§ç»­ï¼‰
4. å®æ—¶è¿½è¸ªæ£€éªŒè¿›åº¦å’ŒæŒæ¡åº¦
5. åŸºäºå†å²è®°å½•å®ç°ä¸ªæ€§åŒ–éš¾åº¦è‡ªé€‚åº”

---

## Epic Description

### ç°æœ‰ç³»ç»ŸèƒŒæ™¯

**å½“å‰ç›¸å…³åŠŸèƒ½**:
- 11ä¸ªAgentç«¯ç‚¹å·²çœŸå®å®ç°ï¼ˆGemini APIè°ƒç”¨ï¼‰
- ScoringResultPanelå‰ç«¯å†³ç­–æŒ‰é’®å·²å®ç°
- VerificationHistoryServiceå†å²ç®¡ç†æœåŠ¡å®Œæ•´
- Graphitiæ—¶åºè®°å¿†å­˜å‚¨æ¡†æ¶å®Œæ•´
- è®°å¿†å†™å…¥è§¦å‘æœºåˆ¶ï¼ˆFire-and-Forgetï¼‰å·²å®ç°

**æŠ€æœ¯æ ˆ**:
- åç«¯: FastAPI + Python 3.11 + Gemini API
- å‰ç«¯: Obsidian Plugin (TypeScript)
- è®°å¿†: Graphiti + Neo4j + LanceDB
- å­˜å‚¨: Canvas JSONæ–‡ä»¶

**é›†æˆç‚¹**:
- `backend/app/services/verification_service.py` - æ£€éªŒæ ¸å¿ƒæœåŠ¡
- `backend/app/api/v1/endpoints/agents.py` - Agentç«¯ç‚¹
- `canvas-progress-tracker/obsidian-plugin/main.ts` - æ’ä»¶å…¥å£
- `backend/app/clients/graphiti_client.py` - è®°å¿†å®¢æˆ·ç«¯

### å¢å¼ºè¯¦æƒ…

**æ ¸å¿ƒé—®é¢˜è¯Šæ–­**:

ç»æ·±åº¦è°ƒç ”å‘ç°ï¼Œæ£€éªŒç™½æ¿"ä¸èƒ½æ­£å¼å¯ç”¨"çš„æ ¹æœ¬åŸå› æ˜¯ `verification_service.py` ä¸­çš„3ä¸ªå…³é”®æ–¹æ³•ä¸ºMockå®ç°ï¼š

| æ–¹æ³• | è¡Œå· | å½“å‰å®ç° | åº”æœ‰å®ç° |
|------|------|---------|---------|
| `start_session()` | L197 | è¿”å›ç¡¬ç¼–ç  `["æ¦‚å¿µ1", "æ¦‚å¿µ2"]` | ä»Canvasè¯»å–çº¢/ç´«èŠ‚ç‚¹ |
| `generate_question_with_rag()` | L751 | è¿”å› `f"è¯·è§£é‡Š{concept}ï¼Ÿ"` | è°ƒç”¨Gemini APIç”Ÿæˆé—®é¢˜ |
| `process_answer()` | L279 | åŸºäºå­—ç¬¦é•¿åº¦è¯„åˆ† | é›†æˆscoring-agentè¯„ä¼° |

**å¢å¼ºå†…å®¹**:
1. æ›¿æ¢VerificationServiceçš„Mockå®ç°ä¸ºçœŸå®Geminiè°ƒç”¨
2. å¯¹æ¥å‰ç«¯ç™½æ¿ç”ŸæˆåŠŸèƒ½ä¸åç«¯API
3. æ–°å¢ `/agents/recommend-action` æ™ºèƒ½å†³ç­–ç«¯ç‚¹
4. å®ç°æ£€éªŒé—®é¢˜å»é‡æœºåˆ¶
5. åŸºäºå†å²å¾—åˆ†çš„éš¾åº¦è‡ªé€‚åº”ç®—æ³•
6. å®æ—¶è¿›åº¦è¿½è¸ªUI
7. æ£€éªŒå†å²è§†å›¾

**é›†æˆæ–¹å¼**:
- éµå¾ªç°æœ‰AgentServiceçš„Geminiè°ƒç”¨æ¨¡å¼
- å¤ç”¨existing RAGä¸Šä¸‹æ–‡æ³¨å…¥æ¡†æ¶
- åˆ©ç”¨å·²å®ç°çš„è®°å¿†å†™å…¥è§¦å‘æœºåˆ¶
- æ‰©å±•ç°æœ‰ScoringResultPanelå†³ç­–æŒ‰é’®

**æˆåŠŸæ ‡å‡†**:
- [x] ç”¨æˆ·å¯ä¸€é”®ç”Ÿæˆæ£€éªŒç™½æ¿
- [x] æ£€éªŒé—®é¢˜ä¸åŸCanvaså†…å®¹é«˜åº¦ç›¸å…³
- [x] æ ¹æ®å›ç­”è´¨é‡è‡ªåŠ¨æ¨èä¸‹ä¸€æ­¥åŠ¨ä½œ
- [x] å®æ—¶æ˜¾ç¤ºæ£€éªŒè¿›åº¦ï¼ˆå·²éªŒè¯ X/Y ä¸ªæ¦‚å¿µï¼‰
- [x] å†å²è®°å½•å¯æŸ¥è¯¢å’Œå¤ç”¨

---

## Stories

### Story 31.1: VerificationServiceæ ¸å¿ƒé€»è¾‘æ¿€æ´» [P0 BLOCKER]

**æè¿°**: æ›¿æ¢verification_service.pyä¸­çš„3ä¸ªMockå®ç°ï¼Œæ¿€æ´»çœŸå®AIåŠŸèƒ½

**éªŒæ”¶æ ‡å‡†**:
- [ ] AC-31.1.1: `start_session()` ä»Canvasæ–‡ä»¶è¯»å–çº¢è‰²(color="4")+ç´«è‰²(color="3")èŠ‚ç‚¹å¹¶æå–æ¦‚å¿µ
- [ ] AC-31.1.2: `generate_question_with_rag()` è°ƒç”¨Gemini APIç”Ÿæˆä¸ªæ€§åŒ–éªŒè¯é—®é¢˜
- [ ] AC-31.1.3: `process_answer()` é›†æˆscoring-agentè¯„ä¼°å›ç­”ï¼ˆè¿”å›0-100åˆ†ï¼‰
- [ ] AC-31.1.4: æ‰€æœ‰æ–¹æ³•æ”¯æŒRAGä¸Šä¸‹æ–‡æ³¨å…¥ï¼ˆå­¦ä¹ å†å²ã€æ•™æã€ç›¸å…³æ¦‚å¿µï¼‰
- [ ] AC-31.1.5: 15sè¶…æ—¶ä¿æŠ¤å’Œä¼˜é›…é™çº§

**å…³é”®æ–‡ä»¶**:
- `backend/app/services/verification_service.py` (L197, L279, L751)
- `backend/app/services/agent_service.py` (score_nodeæ–¹æ³•)

**ä¾èµ–**: æ— 

---

### Story 31.2: æ£€éªŒç™½æ¿ç”Ÿæˆç«¯åˆ°ç«¯å¯¹æ¥ [P0 BLOCKER]

**æè¿°**: å‰ç«¯"ç”Ÿæˆæ£€éªŒç™½æ¿"åŠŸèƒ½å®Œæ•´æ¿€æ´»ï¼Œä»UIåˆ°åç«¯APIçš„å®Œæ•´é“¾è·¯

**éªŒæ”¶æ ‡å‡†**:
- [ ] AC-31.2.1: main.tså®ç°`generateVerificationCanvas`è°ƒç”¨ `POST /review/generate` API
- [ ] AC-31.2.2: åˆ›å»ºæ–°æ£€éªŒç™½æ¿Canvasæ–‡ä»¶ï¼ˆå‘½å: `{åŸå}_éªŒè¯_{timestamp}.canvas`ï¼‰
- [ ] AC-31.2.3: åœ¨VerificationHistoryServiceä¸­è®°å½•åŸCanvasä¸æ£€éªŒCanvasçš„å…³ç³»
- [ ] AC-31.2.4: ç”Ÿæˆå®Œæˆåè‡ªåŠ¨åœ¨Obsidianä¸­æ‰“å¼€æ–°Canvas
- [ ] AC-31.2.5: æ˜¾ç¤ºç”Ÿæˆè¿›åº¦æ¡ï¼ˆ"æ­£åœ¨ç”Ÿæˆæ£€éªŒç™½æ¿... é¢„è®¡30ç§’"ï¼‰

**å…³é”®æ–‡ä»¶**:
- `canvas-progress-tracker/obsidian-plugin/main.ts` (L751-753)
- `canvas-progress-tracker/obsidian-plugin/src/services/ApiClient.ts`
- `backend/app/api/v1/endpoints/review.py`

**ä¾èµ–**: Story 31.1

---

### Story 31.3: Agentå†³ç­–æ¨èç«¯ç‚¹ [P1]

**æè¿°**: æ–°å¢ `/agents/recommend-action` æ™ºèƒ½å†³ç­–ç«¯ç‚¹ï¼Œæ ¹æ®è¯„åˆ†æ¨èä¸‹ä¸€æ­¥åŠ¨ä½œ

**éªŒæ”¶æ ‡å‡†**:
- [ ] AC-31.3.1: æ–°å¢ `POST /agents/recommend-action` ç«¯ç‚¹
- [ ] AC-31.3.2: è¯·æ±‚å‚æ•°åŒ…å« `score`, `node_id`, `canvas_name`
- [ ] AC-31.3.3: æ ¹æ®è¯„åˆ†è¿”å›æ¨èåŠ¨ä½œ:
  - åˆ†æ•° < 60: `{"action": "decompose", "agent": "/agents/decompose/basic", "reason": "æ¦‚å¿µç†è§£ä¸è¶³"}`
  - åˆ†æ•° 60-79: `{"action": "explain", "agent": "/agents/explain/oral", "reason": "éœ€è¦è¡¥å……è§£é‡Š"}`
  - åˆ†æ•° >= 80: `{"action": "next", "agent": null, "reason": "æŒæ¡è‰¯å¥½"}`
- [ ] AC-31.3.4: è€ƒè™‘å†å²å¾—åˆ†è¶‹åŠ¿ï¼ˆå¦‚æŒç»­ä½åˆ†åˆ™æ¨èæ›´åŸºç¡€çš„æ‹†è§£ï¼‰
- [ ] AC-31.3.5: å‰ç«¯ScoringResultPanelå¯¹æ¥æ­¤ç«¯ç‚¹æ›¿ä»£ç¡¬ç¼–ç å†³ç­–

**å…³é”®æ–‡ä»¶**:
- `backend/app/api/v1/endpoints/agents.py` (æ–°å¢ç«¯ç‚¹)
- `canvas-progress-tracker/obsidian-plugin/src/views/ScoringResultPanel.ts`

**ä¾èµ–**: Story 31.1

---

### Story 31.4: æ£€éªŒé—®é¢˜å»é‡ä¸å†å²æŸ¥è¯¢ [P1]

**æè¿°**: é˜²æ­¢ç”Ÿæˆé‡å¤æ£€éªŒé—®é¢˜ï¼Œæ”¯æŒæŸ¥è¯¢æ¦‚å¿µçš„æ£€éªŒå†å²

**éªŒæ”¶æ ‡å‡†**:
- [ ] AC-31.4.1: é—®é¢˜ç”Ÿæˆå‰æŸ¥è¯¢Graphitiæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒæ¦‚å¿µçš„éªŒè¯é—®é¢˜
- [ ] AC-31.4.2: è‹¥å­˜åœ¨ï¼Œç”Ÿæˆæ–°è§’åº¦é—®é¢˜ï¼ˆåº”ç”¨ã€æ¯”è¾ƒã€åä¾‹ç­‰ï¼‰æˆ–è¿”å›å·²æœ‰é—®é¢˜
- [ ] AC-31.4.3: æ–°å¢ `GET /verification/history/{concept}` ç«¯ç‚¹æŸ¥è¯¢æ¦‚å¿µæ£€éªŒå†å²
- [ ] AC-31.4.4: å†å²æ•°æ®åŒ…å«ï¼šé—®é¢˜å†…å®¹ã€ç”¨æˆ·å›ç­”ã€å¾—åˆ†ã€æ—¶é—´æˆ³

**å…³é”®æ–‡ä»¶**:
- `backend/app/services/verification_service.py` (generate_question_with_rag)
- `backend/app/clients/graphiti_client.py` (æ–°å¢search_verification_questions)

**ä¾èµ–**: Story 31.1

---

### Story 31.5: éš¾åº¦è‡ªé€‚åº”ç®—æ³• [P2]

**æè¿°**: æ ¹æ®å†å²å¾—åˆ†è‡ªåŠ¨è°ƒæ•´é—®é¢˜éš¾åº¦ï¼Œå®ç°ä¸ªæ€§åŒ–å­¦ä¹ 

**éªŒæ”¶æ ‡å‡†**:
- [ ] AC-31.5.1: æŸ¥è¯¢æ¦‚å¿µçš„å†å²å¾—åˆ†ï¼ˆæœ€è¿‘5æ¬¡ï¼‰
- [ ] AC-31.5.2: è®¡ç®—éš¾åº¦ç­‰çº§:
  - å¹³å‡åˆ† >= 80 â†’ `hard` (åº”ç”¨å‹é—®é¢˜)
  - å¹³å‡åˆ† 60-79 â†’ `medium` (éªŒè¯å‹é—®é¢˜)
  - å¹³å‡åˆ† < 60 â†’ `easy` (çªç ´å‹é—®é¢˜)
- [ ] AC-31.5.3: æ ¹æ®éš¾åº¦é€‰æ‹©é—®é¢˜ç±»å‹ï¼ˆçªç ´/éªŒè¯/åº”ç”¨ï¼‰
- [ ] AC-31.5.4: æ”¯æŒè·³è¿‡å·²æŒæ¡æ¦‚å¿µï¼ˆè¿ç»­3æ¬¡å¾—åˆ†>=80ï¼‰
- [ ] AC-31.5.5: é—å¿˜æ£€æµ‹ï¼šè‹¥æœ€è¿‘å¾—åˆ†æ˜¾è‘—ä½äºå†å²å¹³å‡ï¼Œæ ‡è®°ä¸º"éœ€è¦å¤ä¹ "

**å…³é”®æ–‡ä»¶**:
- `backend/app/services/verification_service.py`
- `backend/app/services/memory_service.py` (get_learning_history)

**ä¾èµ–**: Story 31.4

---

### Story 31.6: å®æ—¶æ£€éªŒè¿›åº¦è¿½è¸ª [P2]

**æè¿°**: ç”¨æˆ·å¯å®æ—¶æŸ¥çœ‹æ£€éªŒè¿›åº¦å’ŒæŒæ¡åº¦

**éªŒæ”¶æ ‡å‡†**:
- [ ] AC-31.6.1: å‰ç«¯æ˜¾ç¤º"å·²éªŒè¯ X/Y ä¸ªæ¦‚å¿µ"è¿›åº¦æ¡
- [ ] AC-31.6.2: é¢œè‰²åˆ†å¸ƒå®æ—¶æ›´æ–°:
  - ç»¿è‰²(>=80): æŒæ¡
  - é»„è‰²(60-79): éƒ¨åˆ†æŒæ¡
  - çº¢è‰²(<60): æœªæŒæ¡
- [ ] AC-31.6.3: æŒæ¡åº¦ç™¾åˆ†æ¯”è®¡ç®— = ç»¿è‰²æ•° / æ€»æ•° * 100%
- [ ] AC-31.6.4: æ”¯æŒæš‚åœ/ç»§ç»­æ£€éªŒä¼šè¯
- [ ] AC-31.6.5: ä¼šè¯è®¡æ—¶å™¨æ˜¾ç¤ºå·²ç”¨æ—¶é—´

**å…³é”®æ–‡ä»¶**:
- `canvas-progress-tracker/obsidian-plugin/src/modals/VerificationProgressModal.ts`
- `backend/app/services/verification_service.py` (get_progress, pause_session, resume_session)
- `backend/app/api/v1/endpoints/review.py` (GET/POST session progress/pause/resume endpoints)

**ä¾èµ–**: Story 31.2

---

### Story 31.7: æ£€éªŒå†å²è§†å›¾UI [P2]

**æè¿°**: åœ¨ReviewDashboardViewä¸­å®ç°"éªŒè¯"æ ‡ç­¾é¡µï¼Œå±•ç¤ºæ£€éªŒå†å²

**éªŒæ”¶æ ‡å‡†**:
- [ ] AC-31.7.1: ReviewDashboardViewæ–°å¢"éªŒè¯"æ ‡ç­¾é¡µ
- [ ] AC-31.7.2: æ˜¾ç¤ºæ£€éªŒç™½æ¿åˆ—è¡¨ï¼ˆæŒ‰åˆ›å»ºæ—¶é—´æ’åºï¼‰
- [ ] AC-31.7.3: æ¯ä¸ªæ¡ç›®æ˜¾ç¤ºï¼šåŸCanvasåã€æ£€éªŒCanvasåã€ä¼šè¯æ¬¡æ•°ã€æœ€é«˜å¾—åˆ†ã€æœ€è¿‘æ£€éªŒæ—¶é—´
- [ ] AC-31.7.4: ç‚¹å‡»æ¡ç›®è·³è½¬åˆ°å¯¹åº”æ£€éªŒç™½æ¿
- [ ] AC-31.7.5: æ”¯æŒåˆ é™¤æ£€éªŒç™½æ¿è®°å½•

**å…³é”®æ–‡ä»¶**:
- `canvas-progress-tracker/obsidian-plugin/src/views/ReviewDashboardView.ts`
- `canvas-progress-tracker/obsidian-plugin/src/services/VerificationHistoryService.ts`

**ä¾èµ–**: Story 31.4 (VerificationHistoryServiceæ•°æ®)

---

### Story 31.8: æ£€éªŒä¼šè¯æ¢å¤ä¸æŒä¹…åŒ– [åˆå¹¶è‡³ 31.10]

**çŠ¶æ€**: Merged into Story 31.10

---

### Story 31.9: æ£€éªŒè¯„åˆ†å†å²å®Œæ•´è¿½è¸ª [P1]

**æè¿°**: å®ç°æ¯æ¬¡æ£€éªŒè¯„åˆ†çš„å®Œæ•´å†å²è®°å½•ä¸è¶‹åŠ¿åˆ†æ

**çŠ¶æ€**: Complete

**å…³é”®æ–‡ä»¶**:
- `backend/app/services/verification_service.py`
- `backend/app/models/schemas.py`

**ä¾èµ–**: Story 31.1

---

### Story 31.10: æ¨èé™çº§æ¨¡å¼ UI æŒ‡ç¤ºå™¨ [P1]

**æè¿°**: å½“ Agent æ¨è API å¤±è´¥æ—¶ï¼Œåœ¨å‰ç«¯ ScoringResultPanel æ˜¾ç¤ºæ˜ç¡®çš„é™çº§æ¨¡å¼æç¤ºï¼ˆ"ç¦»çº¿æ¨è"æ ‡ç­¾ + é‡è¯•æŒ‰é’®ï¼‰

> âš ï¸ **å¯¹æŠ—æ€§å®¡æ ¸ä¿®æ­£ (2026-02-10)**: åŸæè¿° "è·¨è¿›ç¨‹ä¼šè¯æŒä¹…åŒ–/Neo4j ç›´æ¥" ä¸ºå¹»è§‰ã€‚
> å®é™… Story å†…å®¹è§ `docs/stories/31.10.story.md`ã€‚ä¼šè¯å­˜å‚¨ä½¿ç”¨ TTLCacheï¼ˆå†…å­˜ï¼‰ï¼Œé Neo4jã€‚

**çŠ¶æ€**: Ready for Review (å‰ç«¯ 13 ä¸ªæµ‹è¯•é€šè¿‡; åç«¯é™çº§æµ‹è¯•å¾…è¡¥ â†’ Story 31.A.9)

**å…³é”®æ–‡ä»¶**:
- `canvas-progress-tracker/obsidian-plugin/src/views/ScoringResultPanel.ts` (å‰ç«¯é™çº§ UI)
- `canvas-progress-tracker/obsidian-plugin/styles.css` (é™çº§æ ·å¼)
- `backend/app/services/verification_service.py` (degraded æ ‡å¿—æºå¤´)

**ä¾èµ–**: Story 31.3 (recommend-action ç«¯ç‚¹)

---

### Story 31.A.1: MemoryService ç®¡é“ä¿®å¤ â€” record_episode æ–¹æ³•ä¸å­˜åœ¨ [P0 Critical]

**æè¿°**: ä¿®å¤ MemoryService è°ƒç”¨ä¸å­˜åœ¨çš„ `record_episode()` æ–¹æ³•å¯¼è‡´çš„ AttributeError

**çŠ¶æ€**: âœ… Implemented

**ä¾èµ–**: æ— 

---

### Story 31.A.2: Agent æ¨¡æ¿æ¢å¤ä¸ hint-generation ç«¯ç‚¹ [P0]

**æè¿°**: æ¢å¤è¢«è¯¯åˆ çš„ 17 ä¸ª Agent æ¨¡æ¿æ–‡ä»¶ï¼Œæ–°å¢ hint-generation Agent æšä¸¾å€¼

**çŠ¶æ€**: Draft

**ä¾èµ–**: æ— 

---

### Story 31.A.3: æ£€éªŒè¶…æ—¶å€¼ä¿®å¤ (500msâ†’15s) [P0]

**æè¿°**: VERIFICATION_AI_TIMEOUT ä» 0.5s æ”¹ä¸º 15sï¼Œé¿å…æ‰€æœ‰ Gemini API è°ƒç”¨è¶…æ—¶å¤±è´¥

**çŠ¶æ€**: Complete

**ä¾èµ–**: æ— 

---

### Story 31.A.4: dependencies.py ä¾èµ–æ³¨å…¥å®Œæ•´æ€§ä¿®å¤ [P0]

**æè¿°**: ä¿®å¤ VerificationService æ„é€ å‡½æ•°æ¥å—çš„ memory_serviceã€agent_service å‚æ•°åœ¨ dependencies.py ä¸­æœªä¼ å…¥çš„é—®é¢˜

**çŠ¶æ€**: Review

**ä¾èµ–**: Story 31.A.1

---

### Story 31.A.5: scoring-agent å‚æ•°åä¸åŒ¹é…ä¿®å¤ [P1]

**æè¿°**: ä¿®å¤ call_scoring() çš„å‚æ•°åä¸ AgentService ç­¾åä¸åŒ¹é…çš„é—®é¢˜

**çŠ¶æ€**: Pending

**ä¾èµ–**: Story 31.A.4

---

### Story 31.A.6: åˆ†åˆ¶ç»Ÿä¸€ 0-40â†’0-100 [P1]

**æè¿°**: ç»Ÿä¸€æ‰€æœ‰è¯„åˆ†é˜ˆå€¼ä» 0-40 åˆ†åˆ¶åˆ° 0-100 åˆ†åˆ¶ï¼Œå¯¹é½ scoring-response.schema.json

**çŠ¶æ€**: Review

**ä¾èµ–**: Story 31.A.5

---

### Story 31.A.7: TTLCache ä¼šè¯å­˜å‚¨é™çº§é€æ˜åŒ– [P1]

**æè¿°**: åœ¨ä¸æ”¹å˜å­˜å‚¨æ¶æ„çš„å‰æä¸‹ï¼Œä¸º TTLCache ä¼šè¯å­˜å‚¨æ·»åŠ å¯åŠ¨è­¦å‘Šæ—¥å¿—ã€è¿‡æœŸ/æ·˜æ±°äº‹ä»¶æ—¥å¿—ã€æ¶æ„é™åˆ¶æ³¨é‡Š

**æ¥æº**: å¯¹æŠ—æ€§å®¡æ ¸ 2026-02-10 å‘ç° #1 (ğŸ”´)

**çŠ¶æ€**: âœ… Complete (11/11 tests pass, 2026-02-10)

**ä¾èµ–**: æ— 

---

### Story 31.A.8: Mock é™çº§è·¯å¾„æ—¥å¿—é€æ˜åŒ– [P1]

**æè¿°**: å°† `_mock_evaluate_answer()` çš„ 4 ä¸ªè°ƒç”¨ç‚¹æ—¥å¿—ä» debug å‡çº§ä¸º WARNINGï¼ŒAPI å“åº”å¢åŠ  `degraded_reason` å­—æ®µï¼Œæ–¹æ³•ç­¾åæ‰©å±•ä¸º 4 å…ƒç»„

**æ¥æº**: å¯¹æŠ—æ€§å®¡æ ¸ 2026-02-10 å‘ç° #4/#5 (ğŸŸ¡)

**çŠ¶æ€**: âœ… Complete (16/16 tests pass, 2026-02-10)

**ä¾èµ–**: æ— 

---

### Story 31.A.9: Story 31.10 æ¨èé™çº§ UI æŒ‡ç¤ºå™¨åç«¯é›†æˆæµ‹è¯• [P1]

**æè¿°**: ä¸º Story 31.10 çš„å‰ç«¯é™çº§ UI è¡¥å…¨åç«¯é›†æˆæµ‹è¯•ï¼šéªŒè¯ `degraded` æ ‡å¿—ä¼ æ’­ã€é™çº§å“åº”æ ¼å¼ã€recommend-action ç«¯ç‚¹é™çº§è¡Œä¸º

**æ¥æº**: å¯¹æŠ—æ€§å®¡æ ¸ 2026-02-10 å‘ç° #2/#7 (ğŸ”´/ğŸŸ¡)

**çŠ¶æ€**: âœ… Complete (5/5 tests pass, 2026-02-10)

**ä¾èµ–**: Story 31.10, Story 31.3

---

### Story 31.A.10: æµ‹è¯•åŸºç¡€è®¾æ–½æ”¹è¿› â€” Fixture å»é‡ + E2E è¦†ç›– + è¦†ç›–ç‡æå‡ [P1]

**æè¿°**: æå– `mock_graphiti_client` (9å¤„é‡å¤) å’Œ `mock_agent_service` (14å¤„é‡å¤) åˆ° conftest.pyï¼›ä¸º Story 31.2 POST /review/generate è¡¥å…¨ E2E æµ‹è¯•ï¼›å°†æµ‹è¯•è¦†ç›–ç‡ä» 81% æå‡è‡³ >= 85%

**æ¥æº**: å¯¹æŠ—æ€§å®¡æ ¸ 2026-02-10 å‘ç° P1-H1 (fixture é‡å¤) + è¦†ç›–ç‡ç¼ºå£

**çŠ¶æ€**: Ready

**ä¾èµ–**: Story 31.A.7, Story 31.A.8, Story 31.A.9, Story 31.2

---

## Compatibility Requirements

- [x] ç°æœ‰Agent APIä¿æŒä¸å˜ï¼ˆä»…æ–°å¢ç«¯ç‚¹ï¼‰
- [x] Canvasæ–‡ä»¶æ ¼å¼éµå¾ªç°æœ‰schema
- [x] VerificationHistoryServiceæ•°æ®ç»“æ„å‘åå…¼å®¹
- [x] UIå˜æ›´éµå¾ªç°æœ‰Obsidianæ’ä»¶é£æ ¼
- [x] æ€§èƒ½å½±å“æœ€å°ï¼ˆè®°å¿†å†™å…¥ä½¿ç”¨Fire-and-Forgetæ¨¡å¼ï¼‰

---

## Risk Mitigation

**ä¸»è¦é£é™©**: VerificationServiceé‡æ„å¯èƒ½å½±å“ç°æœ‰reviewåŠŸèƒ½

**ç¼“è§£æªæ–½**:
1. ä¿ç•™åŸæœ‰Mockå®ç°ä½œä¸ºé™çº§è·¯å¾„ï¼ˆUSE_MOCK_VERIFICATIONç¯å¢ƒå˜é‡ï¼‰
2. åˆ†é˜¶æ®µå‘å¸ƒï¼šå…ˆæ¿€æ´»æ ¸å¿ƒåŠŸèƒ½(31.1-31.2)ï¼Œå†å¢å¼º(31.3-31.7)
3. å…¨é¢çš„å•å…ƒæµ‹è¯•è¦†ç›–ï¼ˆç›®æ ‡95%ï¼‰

**å›æ»šè®¡åˆ’**:
1. æ¢å¤verification_service.pyåˆ°Mockå®ç°
2. å‰ç«¯main.tsæ¢å¤"åŠŸèƒ½å¼€å‘ä¸­"æç¤º
3. ä¸å½±å“å…¶ä»–Agentå’ŒReviewåŠŸèƒ½

---

## Definition of Done

- [x] Story 31.1-31.2 å®Œæˆï¼ˆP0 BLOCKERï¼‰
- [x] Story 31.3-31.4 å®Œæˆï¼ˆP1ï¼‰
- [x] Story 31.5-31.7 å®Œæˆï¼ˆP2ï¼‰
- [x] Story 31.8-31.10 å®Œæˆï¼ˆè¡¥å…… Storyï¼‰
- [x] Story 31.A.1-31.A.6 å®Œæˆï¼ˆç®¡é“ä¿®å¤ï¼‰
- [x] Story 31.A.7-31.A.9 å®Œæˆï¼ˆå¯¹æŠ—æ€§å®¡æ ¸è¡¥å…… Story, 2026-02-10ï¼‰ âœ… 32/32 tests pass
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ >= 85% â€” âš ï¸ åç«¯è¦†ç›–ç‡çº¦ 81%ï¼Œè· 85% å®é™…ç›®æ ‡ä»æœ‰å·®è·ã€‚95% åŸç›®æ ‡è¿‡äºæ¿€è¿›ï¼Œè°ƒæ•´ä¸º 85%ã€‚â†’ Story 31.A.10 è®¡åˆ’è¡¥å…¨
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡ï¼ˆç”Ÿæˆ â†’ é—®ç­” â†’ å†³ç­– â†’ è¿›åº¦è¿½è¸ªï¼‰ â€” âš ï¸ Story 31.2 E2E API test ç¼ºå¤± â†’ Story 31.A.10 è®¡åˆ’è¡¥å…¨; mock é™çº§è·¯å¾„å·²é€æ˜åŒ–(31.A.8 âœ…)
- [x] æ— å›å½’ï¼ˆç°æœ‰Agentå’ŒReviewåŠŸèƒ½æ­£å¸¸ï¼‰
- [x] æ–‡æ¡£æ›´æ–° â€” å›é¡¾æ–‡æ¡£å¹»è§‰å·²ä¿®æ­£; å¯è¿½æº¯æ€§çŸ©é˜µå·²ä¿®æ­£; Story 31.10 å®šä¹‰å·²æ¾„æ¸…; å®Œæˆåº¦ç™¾åˆ†æ¯”å·²æ ¡å‡†; NFR è¯„ä¼°å·²åˆ›å»º (2026-02-10)

---

## Validation Checklist

### Scope Validation

- [x] Epicå…±20ä¸ªStoriesï¼ˆ31.1-31.10 + 31.A.1-31.A.10ï¼‰ [å®¡æ ¸ä¿®æ­£: åŸ 16 â†’ 19 â†’ 20]
- [x] éµå¾ªç°æœ‰AgentServiceå’ŒRAGæ¨¡å¼
- [x] é›†æˆå¤æ‚åº¦å¯æ§ï¼ˆä¸»è¦æ˜¯æ›¿æ¢Mockï¼‰
- [x] é£é™©å¯æ§ï¼ˆæœ‰é™çº§å’Œå›æ»šæ–¹æ¡ˆï¼‰

### Risk Assessment

- [x] å¯¹ç°æœ‰ç³»ç»Ÿé£é™©ä½ï¼ˆæ–°å¢åŠŸèƒ½ä¸ºä¸»ï¼‰
- [x] å›æ»šè®¡åˆ’å¯è¡Œ
- [x] æµ‹è¯•è¦†ç›–ç°æœ‰åŠŸèƒ½
- [x] å›¢é˜Ÿç†Ÿæ‚‰ç›¸å…³ä»£ç 

### Completeness Check

- [x] Epicç›®æ ‡æ¸…æ™°
- [x] StoriesèŒƒå›´åˆç†
- [x] æˆåŠŸæ ‡å‡†å¯æµ‹é‡
- [x] ä¾èµ–å…³ç³»æ˜ç¡®

---

## Story Manager Handoff

> **Story Managerè¯·å¼€å‘ä»¥ä¸‹Storiesçš„è¯¦ç»†ç”¨æˆ·æ•…äº‹**ã€‚å…³é”®æ³¨æ„äº‹é¡¹ï¼š
>
> - è¿™æ˜¯å¯¹ç°æœ‰Canvaså­¦ä¹ ç³»ç»Ÿçš„å¢å¼º
> - æŠ€æœ¯æ ˆ: FastAPI + TypeScript Obsidian Plugin + Gemini API
> - é›†æˆç‚¹: verification_service.py, agents.py, main.ts
> - ç°æœ‰æ¨¡å¼: Fire-and-Forgetè®°å¿†å†™å…¥, RAGä¸Šä¸‹æ–‡æ³¨å…¥, 15sè¶…æ—¶ä¿æŠ¤
> - å…³é”®å…¼å®¹æ€§è¦æ±‚: ç°æœ‰Agent APIä¸å˜ï¼ŒCanvasæ ¼å¼ä¸å˜
> - æ¯ä¸ªStoryå¿…é¡»åŒ…å«éªŒè¯ç°æœ‰åŠŸèƒ½å®Œæ•´æ€§çš„æµ‹è¯•
>
> Epicç›®æ ‡: **æ¿€æ´»æ£€éªŒç™½æ¿æ™ºèƒ½å¼•å¯¼ç³»ç»Ÿï¼Œå®ç°ä¸€é”®ç”Ÿæˆã€AIé—®ç­”ã€æ™ºèƒ½å†³ç­–ã€è¿›åº¦è¿½è¸ª**

---

## Appendix: è°ƒç ”æ•°æ®

### å½“å‰å®ç°å®Œæˆåº¦

| ç»„ä»¶ | å®Œæˆåº¦ | è¯´æ˜ |
|------|--------|------|
| åç«¯Agentç«¯ç‚¹ | 90% | 11ä¸ªç«¯ç‚¹çœŸå®å®ç°ï¼Œrecommend-action ç«¯ç‚¹å®Œæˆï¼›åç«¯æµ‹è¯•è¦†ç›–ç‡çº¦81% |
| VerificationService | 85% | æ ¸å¿ƒé€»è¾‘å·²æ¿€æ´»ï¼ˆMockå·²æ›¿æ¢ä¸ºGeminiè°ƒç”¨ï¼‰ï¼Œå»é‡/è‡ªé€‚åº”å·²å®ç°ï¼›_mock_evaluate_answer é™çº§è·¯å¾„éœ€é€æ˜åŒ–(31.A.8) |
| å‰ç«¯è¯„åˆ†é¢æ¿ | 90% | æŒ‰é’®å·²å®ç°ï¼Œåˆ†åˆ¶ç»Ÿä¸€ä¸º0-100ï¼Œé™çº§UIæŒ‡ç¤ºå™¨å·²å®ç°(31.10) |
| å‰ç«¯ç™½æ¿ç”Ÿæˆ | 80% | ç”Ÿæˆé“¾è·¯å·²å¯¹æ¥åç«¯APIï¼›E2E API test ç¼ºå¤± |
| è®°å¿†ç³»ç»Ÿé›†æˆ | 80% | æ¡†æ¶å®Œæ•´ï¼Œå»é‡+è‡ªé€‚åº”+è¿›åº¦è¿½è¸ª+DIå®Œæ•´æ€§å·²å®ç°ï¼›Graphiti ä¾èµ–å¯é€‰æ—¶é™çº§æ—¥å¿—éœ€å®Œå–„ |
| æš‚åœ/æ¢å¤æœºåˆ¶ | 75% | âš ï¸ TTLCache å†…å­˜å­˜å‚¨ï¼ˆéè·¨è¿›ç¨‹æŒä¹…åŒ–ï¼‰ï¼Œè¿›ç¨‹é‡å¯åä¼šè¯ä¸¢å¤±ä¸ºå·²çŸ¥é™åˆ¶(31.A.7) |
| å¾—åˆ†å†å²åˆ†æ | 85% | åˆ†æ•°è¶‹åŠ¿è¿½è¸ª+å¯¹æŠ—æ€§æµ‹è¯•é€šè¿‡ï¼Œtimestampæ’åºä¿®å¤å®Œæˆ |

### å…³é”®æ–‡ä»¶è·¯å¾„

```
backend/
â”œâ”€â”€ app/services/verification_service.py    # æ ¸å¿ƒæ£€éªŒé€»è¾‘ (2852è¡Œ)
â”œâ”€â”€ app/services/agent_service.py           # Agentæ‰§è¡Œ (3785è¡Œ)
â”œâ”€â”€ app/api/v1/endpoints/agents.py          # Agentç«¯ç‚¹ (1896è¡Œ)
â”œâ”€â”€ app/api/v1/endpoints/review.py          # Reviewç«¯ç‚¹ (1444è¡Œ)
â”œâ”€â”€ app/models/schemas.py                   # æ•°æ®æ¨¡å‹ (1107è¡Œ)
â”œâ”€â”€ app/dependencies.py                     # ä¾èµ–æ³¨å…¥ (886è¡Œ)
â””â”€â”€ app/clients/graphiti_client.py          # è®°å¿†å®¢æˆ·ç«¯ (923è¡Œ)

canvas-progress-tracker/obsidian-plugin/
â”œâ”€â”€ main.ts                                 # æ’ä»¶å…¥å£ (3541è¡Œ)
â”œâ”€â”€ src/views/ScoringResultPanel.ts         # è¯„åˆ†é¢æ¿ (716è¡Œ)
â”œâ”€â”€ src/modals/VerificationProgressModal.ts # è¿›åº¦Modal (765è¡Œ)
â””â”€â”€ src/services/VerificationHistoryService.ts # å†å²æœåŠ¡ (303è¡Œ)
```
