# Epic 34: è·¨Canvasä¸æ•™ææŒ‚è½½æ£€éªŒç™½æ¿å®Œæ•´æ¿€æ´»

<!-- Powered by BMAD Core -->

## Epic å…ƒæ•°æ®

| å±æ€§ | å€¼ |
|------|------|
| **Epic ID** | 34 |
| **Epic åç§°** | è·¨Canvasä¸æ•™ææŒ‚è½½æ£€éªŒç™½æ¿å®Œæ•´æ¿€æ´» |
| **ç±»å‹** | Brownfield Enhancement |
| **ä¼˜å…ˆçº§** | P0 (Blocker ä¿®å¤ + P1 åŠŸèƒ½å®Œå–„) |
| **é¢„ä¼° Stories** | **6 ä¸ª** (åŸ7ä¸ªï¼Œåˆ é™¤4ä¸ªé‡å¤ï¼Œè¿½åŠ 3ä¸ªå¯¹æŠ—æ€§ä¿®å¤) + **3 ä¸ªè¡¥æ•‘ Story** (34.11-34.13) |
| **ä¾èµ– Epic** | Epic 14 (å¤ä¹ ç³»ç»Ÿ), Epic 16 (è·¨Canvaså…³è”) |
| **åˆ›å»ºæ—¥æœŸ** | 2026-01-19 |
| **çŠ¶æ€** | **Done (Scoped)** â€” Goal 2,4 å·²äº¤ä»˜; Goal 1,3 Deferred to EPIC-31/36 |

---

## Epic Goal

**å®Œæ•´æ¿€æ´»è·¨Canvaså…³è”ã€æ•™ææŒ‚è½½å’Œæ£€éªŒç™½æ¿å†å²å…³è”åŠŸèƒ½**ï¼Œä¿®å¤å‰åç«¯é›†æˆæ–­è¿é—®é¢˜ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿï¼š
1. ~~åœ¨ä¹ é¢˜Canvaså’Œè®²åº§Canvasä¹‹é—´å»ºç«‹å…³è”~~ [â³ Deferred â†’ EPIC-36 Story 36.5]
2. æŒ‚è½½PDF/Markdown/Canvasæ•™æå¹¶åœ¨Agentåˆ†ææ—¶è‡ªåŠ¨æ³¨å…¥ä¸Šä¸‹æ–‡ âœ…
3. ~~ç”Ÿæˆæ£€éªŒç™½æ¿æ—¶åŸºäºå†å²è¡¨ç°è‡ªåŠ¨è°ƒæ•´éš¾åº¦~~ [â³ Deferred â†’ EPIC-31 Story 31.5]
4. æŸ¥çœ‹æœ€è¿‘5æ¬¡å¤ä¹ å†å²å¹¶æ”¯æŒæŸ¥è¯¢å…¨éƒ¨ âœ…

---

## ç°æœ‰ç³»ç»Ÿä¸Šä¸‹æ–‡

### Existing System Context

**å½“å‰ç›¸å…³åŠŸèƒ½:**
- Epic 14: è‰¾å®¾æµ©æ–¯å¤ä¹ ç³»ç»Ÿå·²è¿ç§»ï¼ŒåŒ…å«æ£€éªŒç™½æ¿ç”Ÿæˆã€æƒé‡è®¡ç®—
- Epic 16: è·¨Canvaså…³è”å­¦ä¹ ç³»ç»Ÿå·²å®Œæˆå‰ç«¯æœåŠ¡å®ç°
- Epic 25: è·¨Canvasä¸æ•™æä¸Šä¸‹æ–‡é›†æˆå·²è§„åˆ’ä½†æœªå®Œæ•´å®æ–½

**æŠ€æœ¯æ ˆ:**
- å‰ç«¯: TypeScript + Obsidian Plugin API
- åç«¯: FastAPI + Python 3.11
- å­˜å‚¨: Neo4j (Graphiti) + .canvas-links.json

**é›†æˆç‚¹:**
- `backend/app/api/v1/router.py` - APIè·¯ç”±èšåˆ
- `backend/app/services/review_service.py` - å¤ä¹ æœåŠ¡æ ¸å¿ƒ
- `canvas-progress-tracker/obsidian-plugin/src/views/ReviewDashboardView.ts` - å¤ä¹ é¢æ¿UI
- `canvas-progress-tracker/obsidian-plugin/main.ts` - æ’ä»¶å…¥å£

---

## é—®é¢˜åˆ†æ

### å·²éªŒè¯çš„æ ¸å¿ƒé—®é¢˜

| é—®é¢˜ | çŠ¶æ€ | å½±å“ | éªŒè¯æ–¹å¼ |
|------|------|------|---------|
| `cross_canvas_router` æœªæ³¨å†Œ | ç¡®è®¤ | API 404 | `router.py` ç¼ºå°‘è¯¥è·¯ç”± |
| éš¾åº¦è‡ªé€‚åº”è§¦å‘æœºåˆ¶ç¼ºå¤± | ç¡®è®¤ | æ— è‡ªåŠ¨è°ƒæ•´ | `review_service.py` æ— ç›¸å…³æ–¹æ³• |
| æ•™ææŒ‚è½½å‰åç«¯æ–­è¿ | ç¡®è®¤ | æŒ‚è½½æ— æ•ˆ | `TextbookMountService` ç¼ºå°‘ä¸Šä¸‹æ–‡ |
| å†å²æ˜¾ç¤ºæ— åˆ†é¡µ | ç¡®è®¤ | ä¿¡æ¯è¿‡è½½ | é»˜è®¤è¿”å›å…¨éƒ¨ |
| `based_on_sessions` å…ƒæ•°æ®ç¼ºå¤± | ç¡®è®¤ | æ— æ³•æº¯æº | æ£€éªŒç™½æ¿æœªè®°å½•å‚è€ƒä¼šè¯ |

---

## Stories

### ~~Story 34.1: è·¨Canvas APIè·¯ç”±æ³¨å†Œ~~ [âŒ å·²åˆ é™¤ - ä¸EPIC-36 Story 36.5é‡å¤]

> **âš ï¸ åˆ é™¤åŸå›  (2026-01-19)**:
>
> æ·±åº¦åˆ†æå‘ç°æ­¤Storyä¸ **EPIC-36 Story 36.5** åŠŸèƒ½é‡å¤ï¼š
> - 36.5 å·²è§„åˆ’: è·¨Canvasè®²åº§å…³è”æŒä¹…åŒ– (Neo4j `ASSOCIATED_WITH` å…³ç³»)
> - 36.5 å·²è§„åˆ’: å…³è”ç±»å‹ LECTURE_FOR, EXERCISE_OF, RELATED_TO
> - 36.5 æ›´å®Œæ•´: åŒ…å«Neo4jæŒä¹…åŒ–ï¼Œè€Œéä»…routeræ³¨å†Œ
>
> **å¤„ç†æ–¹å¼**: æ­¤StoryåŠŸèƒ½å°†ç”± EPIC-36 Story 36.5 ç»Ÿä¸€å®ç°
> **èŠ‚çœå·¥æ—¶**: ~4å°æ—¶

~~**ç›®æ ‡**: ä¿®å¤ `cross_canvas_router` æœªæ³¨å†Œé—®é¢˜~~

~~**ä¿®æ”¹æ–‡ä»¶**:~~
- ~~`backend/app/api/v1/router.py` - æ·»åŠ  cross_canvas_router æ³¨å†Œ~~
- ~~`backend/app/dependencies.py` - æ·»åŠ  CrossCanvasServiceDep ä¾èµ–~~

~~**éªŒæ”¶æ ‡å‡†**:~~
- ~~AC1: `GET /api/v1/cross-canvas/associations` è¿”å› 200~~
- ~~AC2: `POST /api/v1/cross-canvas/associations` åˆ›å»ºå…³è”æˆåŠŸ~~
- ~~AC3: å‰ç«¯ CrossCanvasService è°ƒç”¨åç«¯æ—  404~~

---

### ~~Story 34.2: æ£€éªŒç™½æ¿éš¾åº¦è‡ªé€‚åº”è§¦å‘æœºåˆ¶~~ [âŒ å·²åˆ é™¤ - ä¸EPIC-31 Story 31.5é‡å¤]

> **âš ï¸ åˆ é™¤åŸå›  (2026-01-19)**:
>
> æ·±åº¦åˆ†æå‘ç°æ­¤Storyä¸ **EPIC-31 Story 31.5** åŠŸèƒ½é‡å¤ï¼š
> - 31.5 å·²è§„åˆ’: éš¾åº¦è‡ªé€‚åº” (ä¾èµ–FSRSå†å²å¾—åˆ†)
> - 31.5 æ›´å®Œæ•´: åŸºäºFSRSç®—æ³•ï¼Œè€Œéç®€å•å‡†ç¡®ç‡è®¡ç®—
> - 31.5 ä¾èµ–: EPIC-32 Story 32.1-32.2 (py-fsrsæ¿€æ´»)
>
> **å¤„ç†æ–¹å¼**: æ­¤StoryåŠŸèƒ½å°†ç”± EPIC-31 Story 31.5 ç»Ÿä¸€å®ç°
> **èŠ‚çœå·¥æ—¶**: ~6å°æ—¶

~~**ç›®æ ‡**: å®ç°åŸºäºå†å²è¡¨ç°çš„éš¾åº¦è‡ªé€‚åº”ï¼Œå­˜å‚¨ `based_on_sessions` å…ƒæ•°æ®~~

~~**ä¿®æ”¹æ–‡ä»¶**:~~
- ~~`backend/app/services/review_service.py` - æ·»åŠ  `_calculate_adaptive_difficulty()` æ–¹æ³•~~
- ~~`backend/app/models/__init__.py` - æ·»åŠ  `DifficultyLevel` enum~~
- ~~`backend/app/api/v1/endpoints/review.py` - æ›´æ–°å“åº”åŒ…å« `based_on_sessions`~~

~~**éªŒæ”¶æ ‡å‡†**:~~
- ~~AC1: å†å²æ­£ç¡®ç‡>90%æ—¶ï¼Œå“åº”åŒ…å« `difficulty_level: "harder"`~~
- ~~AC2: å†å²é”™è¯¯ç‡>50%æ—¶ï¼Œå“åº”åŒ…å« `difficulty_level: "easier"`~~
- ~~AC3: å“åº”åŒ…å« `based_on_sessions` å…ƒæ•°æ®~~

---

### Story 34.3: æ•™ææŒ‚è½½å‰åç«¯å®Œæ•´åŒæ­¥ [P1]

**ç›®æ ‡**: ä¿®å¤æ•™ææŒ‚è½½æ—¶ç¼ºå°‘ Canvas ä¸Šä¸‹æ–‡å¯¼è‡´æ— æ³•åŒæ­¥çš„é—®é¢˜

**ä¿®æ”¹æ–‡ä»¶**:
- `canvas-progress-tracker/obsidian-plugin/src/services/TextbookMountService.ts`
- `canvas-progress-tracker/obsidian-plugin/src/views/ReviewDashboardView.ts`

**éªŒæ”¶æ ‡å‡†**:
- AC1: ä»è·¨Canvas TabæŒ‚è½½æ•™ææ—¶è‡ªåŠ¨å…³è”åˆ°é€‰ä¸­çš„Canvas
- AC2: åç«¯ `.canvas-links.json` æ­£ç¡®å†™å…¥æ•™æå…³è”
- AC3: Agentè°ƒç”¨æ—¶èƒ½è·å–æ•™æä¸Šä¸‹æ–‡
- AC4: PDF/Markdown/Canvas ä¸‰ç§æ ¼å¼å‡å¯æŒ‚è½½

---

### Story 34.4: å¤ä¹ å†å²åˆ†é¡µä¸é»˜è®¤é™åˆ¶ [P1]

**ç›®æ ‡**: å®ç°å†å²æ˜¾ç¤ºé»˜è®¤5æ¬¡ï¼Œæ”¯æŒæŸ¥è¯¢å…¨éƒ¨

**ä¿®æ”¹æ–‡ä»¶**:
- `backend/app/services/review_service.py`
- `backend/app/api/v1/endpoints/review.py`
- `canvas-progress-tracker/obsidian-plugin/src/views/ReviewDashboardView.ts`

**éªŒæ”¶æ ‡å‡†**:
- AC1: å†å²è®°å½•é»˜è®¤æ˜¾ç¤ºæœ€è¿‘5æ¡
- AC2: ç‚¹å‡»"æ˜¾ç¤ºå…¨éƒ¨"åŠ è½½å®Œæ•´å†å²
- AC3: APIæ”¯æŒ `limit` å’Œ `show_all` å‚æ•°

---

### ~~Story 34.5: æ£€éªŒç™½æ¿ç”ŸæˆæœåŠ¡æ¿€æ´»ä¸UIé›†æˆ~~ [âŒ å·²åˆ é™¤ - ä¸EPIC-31 Story 31.1-31.2é‡å¤]

> **âš ï¸ åˆ é™¤åŸå›  (2026-01-19)**:
>
> æ·±åº¦åˆ†æå‘ç°æ­¤Storyä¸ **EPIC-31 Story 31.1-31.2** åŠŸèƒ½é‡å¤ï¼š
> - 31.1 å·²è§„åˆ’: VerificationServiceåç«¯å®ç°
> - 31.2 å·²è§„åˆ’: ç”Ÿæˆç«¯åˆ°ç«¯æµç¨‹
> - EPIC-31 ä¸“æ³¨æ£€éªŒç™½æ¿ç³»ç»Ÿï¼ŒåŠŸèƒ½æ›´å®Œæ•´
>
> **å¤„ç†æ–¹å¼**: æ­¤StoryåŠŸèƒ½å°†ç”± EPIC-31 Story 31.1-31.2 ç»Ÿä¸€å®ç°
> **èŠ‚çœå·¥æ—¶**: ~8å°æ—¶

~~**ç›®æ ‡**: ç¡®ä¿ ReviewCanvasGeneratorService å®Œæ•´é›†æˆåˆ° Dashboard~~

~~**ä¿®æ”¹æ–‡ä»¶**:~~
- ~~`canvas-progress-tracker/obsidian-plugin/main.ts`~~
- ~~`canvas-progress-tracker/obsidian-plugin/src/views/ReviewDashboardView.ts`~~

~~**éªŒæ”¶æ ‡å‡†**:~~
- ~~AC1: "ç”Ÿæˆæ–°æ£€éªŒç™½æ¿"æŒ‰é’®è§¦å‘æ¨¡å¼é€‰æ‹©å¯¹è¯æ¡†~~
- ~~AC2: é€‰æ‹©æ¨¡å¼åæˆåŠŸè°ƒç”¨åç«¯ API~~
- ~~AC3: ç”ŸæˆæˆåŠŸåè‡ªåŠ¨åˆ·æ–°æ£€éªŒç™½æ¿åˆ—è¡¨~~

---

### ~~Story 34.6: è·¨Canvaså…³è”æ™ºèƒ½å»ºè®®ä¼˜åŒ–~~ [âŒ å·²åˆ é™¤ - ä¸EPIC-36 Story 36.6é‡å¤]

> **âš ï¸ åˆ é™¤åŸå›  (2026-01-19)**:
>
> æ·±åº¦åˆ†æå‘ç°æ­¤Storyä¸ **EPIC-36 Story 36.6** åŠŸèƒ½é‡å¤ï¼š
> - 36.6 å·²è§„åˆ’: è·¨Canvasè®²åº§è‡ªåŠ¨å‘ç°
> - 36.6 å·²è§„åˆ’: æ–‡ä»¶åæ¨¡å¼åŒ¹é…ï¼ˆä¹ é¢˜â†’è®²åº§ï¼‰
> - 36.6 å·²è§„åˆ’: å…±åŒæ¦‚å¿µæ•°>=3æ—¶å»ºè®®å…³è”
>
> **å¤„ç†æ–¹å¼**: æ­¤StoryåŠŸèƒ½å°†ç”± EPIC-36 Story 36.6 ç»Ÿä¸€å®ç°
> **èŠ‚çœå·¥æ—¶**: ~4å°æ—¶

~~**ç›®æ ‡**: ä¼˜åŒ–å…³è”å»ºè®®ç®—æ³•ï¼ŒåŸºäºæ¦‚å¿µç›¸ä¼¼åº¦æä¾›æ›´å‡†ç¡®çš„å»ºè®®~~

~~**ä¿®æ”¹æ–‡ä»¶**:~~
- ~~`backend/app/services/cross_canvas_service.py`~~
- ~~`canvas-progress-tracker/obsidian-plugin/src/views/ReviewDashboardView.ts`~~

~~**éªŒæ”¶æ ‡å‡†**:~~
- ~~AC1: å»ºè®®åˆ—è¡¨æŒ‰ç½®ä¿¡åº¦æ’åº~~
- ~~AC2: æ”¯æŒ `min_confidence` å‚æ•°è¿‡æ»¤~~
- ~~AC3: æ˜¾ç¤ºå»ºè®®åŸå›  (å…±äº«æ¦‚å¿µ)~~
- ~~AC4: ä¸€é”®é‡‡çº³å»ºè®®åˆ›å»ºå…³è”~~

---

### Story 34.7: ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•ä¸æ–‡æ¡£ [P1]

**ç›®æ ‡**: ç¡®ä¿æ‰€æœ‰åŠŸèƒ½ç«¯åˆ°ç«¯å¯ç”¨

**ä¿®æ”¹æ–‡ä»¶**:
- ~~`backend/tests/e2e/test_cross_canvas_flow.py` (æ–°å»º)~~ [âŒ ç§»è‡³EPIC-36 Story 36.5]
- `backend/tests/e2e/test_textbook_mount_flow.py` (æ–°å»º) âœ…
- ~~`backend/tests/integration/test_review_difficulty_adaptive.py` (æ–°å»º)~~ [âŒ ç§»è‡³EPIC-31 Story 31.5]
- `backend/tests/integration/test_review_history_pagination.py` (æ–°å»º) âœ…
- `docs/epics/EPIC-34-COMPLETE-ACTIVATION.md` (æœ¬æ–‡æ¡£) âœ…

**éªŒæ”¶æ ‡å‡†**:
- ~~AC1: è·¨Canvaså®Œæ•´æµç¨‹æµ‹è¯•é€šè¿‡~~ [âŒ å·²åˆ é™¤ - ç§»è‡³EPIC-36 Story 36.5]
- AC2: æ•™ææŒ‚è½½å®Œæ•´æµç¨‹æµ‹è¯•é€šè¿‡ âœ…
- ~~AC3: éš¾åº¦è‡ªé€‚åº”å•å…ƒæµ‹è¯•é€šè¿‡~~ [âŒ å·²åˆ é™¤ - ç§»è‡³EPIC-31 Story 31.5]
- AC4: æ–‡æ¡£æ›´æ–°å®Œæˆ âœ…
- AC5: å¤ä¹ å†å²åˆ†é¡µé›†æˆæµ‹è¯•é€šè¿‡ [NEW] âœ…

---

### Story 34.8: å¯¹æŠ—æ€§å®¡æŸ¥ä¿®æ­£ Round 1 [P0]

**ç›®æ ‡**: ä¿®å¤ç¬¬ä¸€è½®å¯¹æŠ—æ€§å®¡æŸ¥å‘ç°çš„ DI æ–­è£‚ã€ç¡¬ä¸Šé™ç¼ºå¤±ã€å‚æ•°éªŒè¯é—®é¢˜

**éªŒæ”¶æ ‡å‡†**:
- AC1: é›†æˆæµ‹è¯•å»mockåŒ– â€” ä½¿ç”¨çœŸå®ReviewServiceå®ä¾‹ âœ…
- AC2: ReviewService.graphiti_client ä¾èµ–æ³¨å…¥ä¿®å¤ (dependencies.py + review.py) âœ…
- AC3: show_all=True ç¡¬ä¸Šé™ä¿æŠ¤ (MAX_HISTORY_RECORDS=1000) âœ…
- AC4: days å‚æ•°éªŒè¯æ”¹è¿› Query(7, ge=1, le=365) âœ…

---

### Story 34.9: å¯¹æŠ—æ€§å®¡æŸ¥ P0 Hotfix Round 2 [P0]

**ç›®æ ‡**: ä¿®å¤ç¬¬äºŒè½®å¯¹æŠ—æ€§å®¡æŸ¥å‘ç°çš„ API éªŒè¯ã€DI å¯¹é½ã€æµ‹è¯•å¯ä¿¡åº¦é—®é¢˜

**éªŒæ”¶æ ‡å‡†**:
- AC1: limit å‚æ•°æ·»åŠ  Query(5, ge=1, le=100) éªŒè¯ âœ…
- AC2: show_all å‚æ•°æ·»åŠ  Query(False, description=...) åŒ…è£… âœ…
- AC3: review.py æ¨¡å—çº§å•ä¾‹æ³¨å…¥ memory_client åˆ° CanvasService âœ…
- AC4: ç§»é™¤æµ‹è¯•ä¸­æ¥å— HTTP 500 çš„æ–­è¨€ âœ…
- AC5: ç§»é™¤æ¡ä»¶æ–­è¨€ï¼ˆæ¶ˆé™¤å‡é˜´æ€§ï¼‰ âœ…
- AC6: æ›¿æ¢ date.today() ä¸ºå›ºå®šå¸¸é‡ âœ…

---

### Story 34.10: é›†æˆæµ‹è¯•å›å½’ä¿®å¤ + åˆ†é¡µè¯­ä¹‰æ–‡æ¡£åŒ– + DI è·¯å¾„æ•´ç† [P0/P1/P2]

**ç›®æ ‡**: ä¿®å¤ Story 38.9 DI é‡æ„å¯¼è‡´çš„ 48 ä¸ªé›†æˆæµ‹è¯•å›å½’ï¼Œæ–‡æ¡£åŒ–å‰åç«¯åˆ†é¡µè¯­ä¹‰å·®å¼‚ï¼Œæ•´ç† ReviewService DI è·¯å¾„

**éªŒæ”¶æ ‡å‡†**:
- AC1: [P0] é›†æˆæµ‹è¯• `_review_service_instance` â†’ `reset_review_service_singleton()` ä¿®å¤ï¼Œ48/48 PASS
- AC2: [P1] å‰åç«¯åŒå±‚åˆ†é¡µæ¶æ„ (API limit=è®°å½•æ•° vs å‰ç«¯ slice=æ—¥æœŸåˆ†ç»„æ•°) æ–‡æ¡£åŒ–
- AC3: [P2] ReviewService DI è·¯å¾„æ•´ç† â€” åˆ é™¤æœªä½¿ç”¨çš„ ReviewServiceDep æˆ–æ·»åŠ æ¶æ„è¯´æ˜

---

## æ‰§è¡Œé¡ºåºä¾èµ–å›¾ (ç²¾ç®€å)

```
åŸä¾èµ–å›¾ (å·²åºŸå¼ƒ):
Story 34.1 â”€â”€â”¬â”€â”€> Story 34.2 â”€â”€> Story 34.5
             â””â”€â”€> Story 34.3 â”€â”€> Story 34.6 â”€â”€> Story 34.7
Story 34.4 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç²¾ç®€åä¾èµ–å›¾:
Story 34.3 (æ•™ææŒ‚è½½) â”€â”€â”¬â”€â”€> Story 34.7 (E2Eæµ‹è¯•) â”€â”€> Story 34.8 (å¯¹æŠ—æ€§ä¿®å¤R1) â”€â”€> Story 34.9 (P0 Hotfix R2)
                        â”‚                                                              â”‚
Story 34.4 (å†å²åˆ†é¡µ) â”€â”€â”˜                                                              â””â”€â”€> Story 34.10 (æµ‹è¯•å›å½’ä¿®å¤+DIæ•´ç†)

å¤–éƒ¨ä¾èµ–:
â”œâ”€ 34.3 ä¾èµ– EPIC-30 Story 30.5 (Canvas CRUDäº‹ä»¶)
â”œâ”€ 34.10 ä¾èµ– Story 38.9 (ReviewService Canonical Singleton)
â”œâ”€ è·¨CanvasåŠŸèƒ½ â†’ EPIC-36 Story 36.5-36.6
â”œâ”€ éš¾åº¦è‡ªé€‚åº” â†’ EPIC-31 Story 31.5
â””â”€ æ£€éªŒç™½æ¿ç”Ÿæˆ â†’ EPIC-31 Story 31.1-31.2
```

---

## Compatibility Requirements

- [x] ç°æœ‰APIsä¿æŒä¸å˜ (ä»…æ·»åŠ æ–°è·¯ç”±)
- [x] æ•°æ®åº“Schemaæ— ç ´åæ€§å˜æ›´
- [x] UIå˜æ›´éµå¾ªç°æœ‰Obsidianæ’ä»¶æ¨¡å¼
- [x] æ€§èƒ½å½±å“æœ€å°åŒ– (æ•™æä¸Šä¸‹æ–‡è·å– < 1ç§’)

---

## Risk Mitigation

| é£é™© | ç¼“è§£æªæ–½ | å›æ»šè®¡åˆ’ |
|------|---------|---------|
| æ•™æåŒæ­¥å¤±è´¥ | é™é»˜é™çº§ï¼Œå‰ç«¯ Notice æç¤ºï¼Œæœ¬åœ°æ“ä½œä¸é˜»å¡ | å›é€€åˆ° localStorage |
| show_all å¤§æ•°æ®é‡ | MAX_HISTORY_RECORDS=1000 ç¡¬ä¸Šé™ï¼Œhas_more æ ‡è®°æˆªæ–­ | é™ä½ä¸Šé™æˆ–ç¦ç”¨ show_all |
| å‰åç«¯åˆ†é¡µè¯­ä¹‰å·®å¼‚ | API `limit` æ§åˆ¶è®°å½•æ•°ï¼Œå‰ç«¯ `slice` æ§åˆ¶æ—¥æœŸåˆ†ç»„æ•°ï¼Œä¸¤å±‚ç‹¬ç«‹ | ç»Ÿä¸€ä¸ºå•ä¸€åˆ†é¡µç»´åº¦ |
| é›†æˆæµ‹è¯•ä¸ DI é‡æ„ä¸åŒæ­¥ | Story 38.9 é‡æ„åæµ‹è¯•å¼•ç”¨æ—§å±æ€§å¯¼è‡´ 48 ä¸ª ERROR (Finding #1) | Story 34.10 ä¿®å¤æµ‹è¯• |

---

## Definition of Done (ç²¾ç®€å)

- [x] ~~Story 34.1~~ [âŒ å·²åˆ é™¤ - ç”±36.5å®ç°]
- [x] ~~Story 34.2~~ [âŒ å·²åˆ é™¤ - ç”±31.5å®ç°]
- [x] Story 34.3 æ•™ææŒ‚è½½å®Œæˆå¹¶é€šè¿‡éªŒæ”¶æ ‡å‡† âœ… Done (2026-01-20)
- [x] Story 34.4 å†å²åˆ†é¡µå®Œæˆå¹¶é€šè¿‡éªŒæ”¶æ ‡å‡† âœ… Done (2026-01-20)
- [x] ~~Story 34.5~~ [âŒ å·²åˆ é™¤ - ç”±31.1-31.2å®ç°]
- [x] ~~Story 34.6~~ [âŒ å·²åˆ é™¤ - ç”±36.6å®ç°]
- [x] Story 34.7 E2Eæµ‹è¯•é€šè¿‡ âœ… Done (2026-01-20)
- [x] Story 34.8 å¯¹æŠ—æ€§å®¡æŸ¥ä¿®æ­£ Round 1 âœ… Code Review Passed (2026-02-09)
- [x] Story 34.9 å¯¹æŠ—æ€§å®¡æŸ¥ P0 Hotfix Round 2 âœ… Done (2026-02-09)
- [x] Story 34.10 é›†æˆæµ‹è¯•å›å½’ä¿®å¤ + åˆ†é¡µæ–‡æ¡£åŒ– + DI è·¯å¾„æ•´ç† âœ… Done (2026-02-10)
- [x] ç°æœ‰åŠŸèƒ½æ— å›å½’ âœ… éªŒè¯é€šè¿‡ (165 tests passed)
- [x] æ•™ææŒ‚è½½åAgentåˆ†æåŒ…å«æ•™æä¸Šä¸‹æ–‡ âœ… éªŒè¯é€šè¿‡
- [x] æ–‡æ¡£æ›´æ–°å®Œæˆ âœ… æœ¬æ¬¡æ›´æ–°

> **ç²¾ç®€è¯´æ˜**: åŸ7ä¸ªStoriesç²¾ç®€ä¸º3ä¸ª+3ä¸ªå¯¹æŠ—æ€§ä¿®å¤(34.8-34.10)+3ä¸ªè¡¥æ•‘Story(34.11-34.13)
> **è¢«åˆ é™¤åŠŸèƒ½çš„å®ç°æ–¹**: EPIC-31 (æ£€éªŒç™½æ¿), EPIC-36 (è·¨Canvas)
> **åˆå§‹å®Œæˆæ—¥æœŸ**: 2026-01-20 | **å¯¹æŠ—æ€§ä¿®å¤å®Œæˆ**: 2026-02-10

---

## Deferred åŠŸèƒ½è·Ÿè¸ªè¡¨

> **ç›®çš„**: è·Ÿè¸ªè¢« Deferred åˆ°å…¶ä»– EPIC çš„åŠŸèƒ½äº¤ä»˜çŠ¶æ€ï¼Œæ¯æ¬¡ç›®æ ‡ EPIC å®¡æ ¸æ—¶æ›´æ–°ã€‚

| åŸ Story | åŠŸèƒ½ | è½¬ç§»è‡³ | ç›®æ ‡ EPIC çŠ¶æ€ | æœ€åæ£€æŸ¥ | é£é™© |
|----------|------|--------|---------------|---------|------|
| 34.1 | è·¨Canvas APIè·¯ç”±æ³¨å†Œ | EPIC-36 Story 36.5 | â³ EPIC-36 å¾…å®¡æ ¸ | 2026-02-10 | ğŸŸ¡ ä¸­ |
| 34.2 | æ£€éªŒç™½æ¿éš¾åº¦è‡ªé€‚åº” | EPIC-31 Story 31.5 | âš ï¸ 31.A.7 FAIL(0/11) | 2026-02-10 | ğŸ”´ é«˜ |
| 34.5 | æ£€éªŒç™½æ¿ç”ŸæˆæœåŠ¡æ¿€æ´» | EPIC-31 Story 31.1-31.2 | âš ï¸ 31.A.8 FAIL(0/16) | 2026-02-10 | ğŸ”´ é«˜ |
| 34.6 | è·¨Canvaså…³è”æ™ºèƒ½å»ºè®® | EPIC-36 Story 36.6 | â³ EPIC-36 å¾…å®¡æ ¸ | 2026-02-10 | ğŸŸ¡ ä¸­ |

> **ğŸ”´ è­¦å‘Š**: EPIC-31 çš„å®æµ‹çŠ¶æ€æ˜¾ç¤º 31.A.7/31.A.8 æµ‹è¯•å¤±è´¥ç‡ 100%ã€‚Deferred åˆ° EPIC-31 çš„åŠŸèƒ½å¯èƒ½é•¿æœŸæœªäº¤ä»˜ã€‚

---

## è¡¥æ•‘ Stories (R4 å¯¹æŠ—æ€§å®¡æŸ¥é©±åŠ¨)

### Story 34.11: æµ‹è¯•è´¨é‡æå‡è‡³ TEA â‰¥70 [P1]

**ç›®æ ‡**: æ‹†åˆ† 1226 è¡Œæµ‹è¯•æ–‡ä»¶ã€æå–å…±äº« fixtureã€æ¶ˆé™¤å°è£…ç ´å

**éªŒæ”¶æ ‡å‡†**:
- AC1: æ‹†åˆ† test_review_history_pagination.py ä¸º â‰¤300 è¡Œ/æ–‡ä»¶çš„ 3-4 ä¸ªæ¨¡å—
- AC2: æå– â‰¥10 ä¸ªé‡å¤ mock fixture ä¸ºå…±äº« conftest
- AC3: æ¶ˆé™¤ç›´æ¥ä¿®æ”¹ service._card_states â€” æ”¹ç”¨å…¬å¼€ API æˆ– test helper
- AC4: TEA é‡æ–°è¯„åˆ† â‰¥70/100

### Story 34.12: é™é»˜é™çº§ä¿®å¤ + æ­»ä»£ç æ¸…ç† [P1]

**ç›®æ ‡**: ç‰¹åŒ– 24 ä¸ª except Exceptionã€æ·»åŠ é™çº§æ—¥å¿—ã€æ¸…ç† retention_rate æ­»ä»£ç 

**éªŒæ”¶æ ‡å‡†**:
- AC1: 24 ä¸ª except Exception ç‰¹åŒ–ä¸ºå…·ä½“å¼‚å¸¸ç±»å‹ï¼ˆè‡³å°‘ Top 10 é«˜é¢‘è·¯å¾„ï¼‰
- AC2: æ‰€æœ‰é™çº§è·¯å¾„æ·»åŠ  logger.warning æ—¥å¿—
- AC3: retention_rate å­—æ®µå®ç°çœŸå®è®¡ç®—æˆ–ä»å“åº”æ¨¡å‹ä¸­åˆ é™¤
- AC4: grep -c "except Exception" review_service.py â‰¤ 5

### Story 34.13: æ•™ææŒ‚è½½çœŸå® E2E éªŒè¯ [P2]

**ç›®æ ‡**: åˆ›å»ºçœŸå® E2E æµ‹è¯•éªŒè¯å‰åç«¯æ•™ææŒ‚è½½åŒæ­¥è·¯å¾„

**éªŒæ”¶æ ‡å‡†**:
- AC1: åˆ›å»º tests/e2e/test_textbook_mount_e2e.pyï¼ˆHTTP è¯·æ±‚è€Œé TestClientï¼‰
- AC2: æµ‹è¯•è¦†ç›–å®Œæ•´åŒæ­¥è·¯å¾„ï¼šè¯·æ±‚â†’å¤„ç†â†’.canvas-links.json å†™å…¥â†’è¯»å›éªŒè¯
- AC3: PDF/Markdown/Canvas ä¸‰ç§æ ¼å¼å„ä¸€ä¸ª E2E case
- AC4: ç°æœ‰ tests/integration/ ä¸­çš„æ•™ææµ‹è¯•ä¿ç•™ä¸åŠ¨

---

## å…³é”®æ–‡ä»¶æ¸…å• (ç²¾ç®€å)

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹ç±»å‹ | Story | çŠ¶æ€ |
|---------|---------|-------|------|
| ~~`backend/app/api/v1/router.py`~~ | ~~æ·»åŠ è·¯ç”±~~ | ~~34.1~~ | âŒ ç§»è‡³36.5 |
| `backend/app/services/review_service.py` | æ·»åŠ æ–¹æ³• | 34.4 | âœ… ä¿ç•™ |
| ~~`backend/app/models/__init__.py`~~ | ~~æ·»åŠ æšä¸¾~~ | ~~34.2~~ | âŒ ç§»è‡³31.5 |
| ~~`canvas-progress-tracker/obsidian-plugin/main.ts`~~ | ~~æœåŠ¡åˆå§‹åŒ–~~ | ~~34.5~~ | âŒ ç§»è‡³31.1 |
| `canvas-progress-tracker/obsidian-plugin/src/services/TextbookMountService.ts` | è‡ªåŠ¨æ£€æµ‹ | 34.3 | âœ… ä¿ç•™ |
| `canvas-progress-tracker/obsidian-plugin/src/views/ReviewDashboardView.ts` | UIé›†æˆ | 34.3, 34.4 | âœ… ä¿ç•™ |
| ~~`backend/app/services/cross_canvas_service.py`~~ | ~~ç®—æ³•ä¼˜åŒ–~~ | ~~34.6~~ | âŒ ç§»è‡³36.6 |

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-19 | 0.1 | Initial draft | PM Agent (John) |
| 2026-01-19 | 0.2 | **åˆ é™¤4ä¸ªé‡å¤Stories**: 34.1â†’36.5, 34.2â†’31.5, 34.5â†’31.1-31.2, 34.6â†’36.6ï¼›ç²¾ç®€ä¸º3ä¸ªStoriesï¼›èŠ‚çœ~28å°æ—¶ | PM Agent (John) |
| 2026-01-20 | 1.0 | **Epic å®Œæˆ**: Story 34.3/34.4/34.7å…¨éƒ¨Done; E2Eæµ‹è¯•åˆ›å»ºå®Œæˆ; Definition of Doneå…¨éƒ¨å‹¾é€‰; çŠ¶æ€æ›´æ–°ä¸ºDone | Dev Agent (James) |
| 2026-02-09 | 1.1 | **å¯¹æŠ—æ€§å®¡æŸ¥ Round 1**: åˆ›å»ºStory 34.8; ä¿®å¤DIæ–­è£‚(graphiti_client)ã€show_allç¡¬ä¸Šé™ã€dayså‚æ•°éªŒè¯ã€çœŸå®æœåŠ¡é›†æˆæµ‹è¯• | Adversarial Review |
| 2026-02-09 | 1.2 | **å¯¹æŠ—æ€§å®¡æŸ¥ Round 2**: åˆ›å»ºStory 34.9; ä¿®å¤limit/show_all Query()éªŒè¯ã€CanvasService memory_clientæ³¨å…¥ã€æµ‹è¯•500å®¹å¿ã€æ¡ä»¶æ–­è¨€ã€date.today()ä¸ç¡®å®šæ€§ | Adversarial Review |
| 2026-02-10 | 1.3 | **EPIC æ–‡æ¡£åŒæ­¥**: Goal 1/3æ ‡æ³¨Deferred; Story 34.7 AC1/AC3æ ‡æ³¨å·²åˆ é™¤; è¿½åŠ 34.8/34.9æ‘˜è¦æ®µè½; Change Logè¡¥å…¨; 34.9çŠ¶æ€â†’Done | Adversarial Audit |
| 2026-02-10 | 1.4 | **å¯¹æŠ—æ€§å®¡æŸ¥ Wave 1 ä¿®å¤**: (1) Story 34.8 çŠ¶æ€â†’Done; (2) Risk Mitigationè¡¨æ›´æ–°ä¸ºå®é™…äº¤ä»˜åŠŸèƒ½çš„é£é™©; (3) Story 34.4 Dev Agent Record è¿½æº¯è¡¥å¡«; (4) æ¢å¤è¢«è¯¯åˆ çš„é›†æˆæµ‹è¯•æ–‡ä»¶(48ä¸ªERRORå¾…34.10ä¿®å¤); (5) å‘ç°é›†æˆæµ‹è¯•å›å½’æ ¹å› =Story 38.9 DIé‡æ„æœªåŒæ­¥æ›´æ–°æµ‹è¯• | Adversarial Review Wave 1 |
| 2026-02-10 | 1.5 | **R4 å¯¹æŠ—æ€§å®¡æŸ¥**: (1) Status "Done"â†’"Done (Scoped)"; (2) 34.10 è¡¥å…¥ DoD; (3) Deferred åŠŸèƒ½è·Ÿè¸ªè¡¨ â€” æ ‡è®° EPIC-31 æ¥æ”¶æ–¹ FAIL é£é™©; (4) åˆ›å»º 3 ä¸ªè¡¥æ•‘ Story: 34.11(æµ‹è¯•è´¨é‡â‰¥70), 34.12(é™é»˜é™çº§ä¿®å¤), 34.13(æ•™ææŒ‚è½½çœŸå®E2E); (5) ATDD æ‰§è¡Œå¼ºåˆ¶åŒ–æ¨¡æ¿ | R4 Adversarial Review |
