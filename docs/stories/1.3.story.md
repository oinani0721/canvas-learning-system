# Story 1.3: CanvasèŠ‚ç‚¹CRUDæ“ä½œ

## Status
Done

## Story

**As a** ç³»ç»Ÿæ ¸å¿ƒæ¨¡å—,
**I want** èƒ½å¤Ÿåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤CanvasèŠ‚ç‚¹,
**so that** æˆ‘å¯ä»¥åŠ¨æ€ä¿®æ”¹ç™½æ¿å†…å®¹ï¼Œä¸ºæ‰€æœ‰ä¸Šå±‚ä¸šåŠ¡é€»è¾‘æä¾›åŸºç¡€æ“ä½œèƒ½åŠ›ã€‚

## Acceptance Criteria

1. create_node()å‡½æ•°èƒ½åˆ›å»ºæœ‰æ•ˆçš„èŠ‚ç‚¹å¯¹è±¡
2. update_node_color()èƒ½æ­£ç¡®ä¿®æ”¹èŠ‚ç‚¹é¢œè‰²
3. delete_node()èƒ½åŒæ—¶åˆ é™¤ç›¸å…³çš„è¾¹
4. find_nodes_by_color()èƒ½å‡†ç¡®æŸ¥æ‰¾æŒ‡å®šé¢œè‰²çš„èŠ‚ç‚¹
5. èŠ‚ç‚¹IDç”Ÿæˆç­–ç•¥ï¼šä½¿ç”¨UUID v4æˆ–æ—¶é—´æˆ³+6ä½éšæœºå­—ç¬¦
6. ç¡®ä¿åœ¨å•ä¸ªCanvasæ–‡ä»¶ä¸­IDå…¨å±€å”¯ä¸€

## Tasks / Subtasks

- [x] Task 1: è®¾è®¡èŠ‚ç‚¹IDç”Ÿæˆç­–ç•¥ (AC: 5, 6)
  - [x] å®ç°generate_node_idé™æ€æ–¹æ³•ï¼Œä½¿ç”¨UUID v4ç”Ÿæˆ16ä½åå…­è¿›åˆ¶ID
  - [x] IDæ ¼å¼ï¼š`{node_type}-{uuid16}`ï¼ˆå¦‚`text-a1b2c3d4e5f67890`ï¼‰
  - [x] æ·»åŠ IDå”¯ä¸€æ€§éªŒè¯é€»è¾‘
  - [x] æ·»åŠ å®Œæ•´çš„ç±»å‹æ³¨è§£å’ŒGoogle Style Docstring

- [x] Task 2: å®ç°create_nodeé™æ€æ–¹æ³• (AC: 1)
  - [x] æ”¯æŒåˆ›å»ºtextã€fileã€groupä¸‰ç§èŠ‚ç‚¹ç±»å‹
  - [x] å¿…éœ€å‚æ•°ï¼šnode_type, x, y
  - [x] å¯é€‰å‚æ•°ï¼šwidth, height, color, text, file
  - [x] è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€çš„èŠ‚ç‚¹ID
  - [x] éªŒè¯èŠ‚ç‚¹ç±»å‹å’Œé¢œè‰²å€¼çš„æœ‰æ•ˆæ€§
  - [x] è¿”å›æ–°åˆ›å»ºçš„èŠ‚ç‚¹å¯¹è±¡ï¼ˆDictï¼‰

- [x] Task 3: å®ç°update_node_coloré™æ€æ–¹æ³• (AC: 2)
  - [x] æ¥å—å‚æ•°ï¼šcanvas_data, node_id, new_color
  - [x] æŸ¥æ‰¾æŒ‡å®šIDçš„èŠ‚ç‚¹
  - [x] éªŒè¯é¢œè‰²å€¼æœ‰æ•ˆæ€§ï¼ˆ"1"-"6"ï¼‰
  - [x] æ›´æ–°èŠ‚ç‚¹çš„colorå­—æ®µ
  - [x] å¦‚æœèŠ‚ç‚¹ä¸å­˜åœ¨ï¼ŒæŠ›å‡ºKeyError

- [x] Task 4: å®ç°delete_nodeé™æ€æ–¹æ³• (AC: 3)
  - [x] æ¥å—å‚æ•°ï¼šcanvas_data, node_id
  - [x] ä»nodesæ•°ç»„ä¸­åˆ é™¤æŒ‡å®šèŠ‚ç‚¹
  - [x] åŒæ—¶åˆ é™¤æ‰€æœ‰ä¸è¯¥èŠ‚ç‚¹ç›¸å…³çš„è¾¹ï¼ˆfromNodeæˆ–toNodeåŒ¹é…ï¼‰
  - [x] å¦‚æœèŠ‚ç‚¹ä¸å­˜åœ¨ï¼ŒæŠ›å‡ºKeyError
  - [x] è¿”å›åˆ é™¤çš„èŠ‚ç‚¹æ•°é‡å’Œè¾¹æ•°é‡

- [x] Task 5: å®ç°find_nodes_by_coloré™æ€æ–¹æ³• (AC: 4)
  - [x] æ¥å—å‚æ•°ï¼šcanvas_data, color
  - [x] éå†nodesæ•°ç»„ï¼Œç­›é€‰æŒ‡å®šé¢œè‰²çš„èŠ‚ç‚¹
  - [x] è¿”å›èŠ‚ç‚¹åˆ—è¡¨ï¼ˆList[Dict]ï¼‰
  - [x] å¦‚æœæ²¡æœ‰åŒ¹é…èŠ‚ç‚¹ï¼Œè¿”å›ç©ºåˆ—è¡¨

- [x] Task 6: å®ç°è¾…åŠ©æŸ¥è¯¢æ–¹æ³•
  - [x] find_node_by_id(canvas_data, node_id) - æ ¹æ®IDæŸ¥æ‰¾å•ä¸ªèŠ‚ç‚¹
  - [x] node_exists(canvas_data, node_id) - æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨
  - [x] get_all_node_ids(canvas_data) - è·å–æ‰€æœ‰èŠ‚ç‚¹IDåˆ—è¡¨

- [x] Task 7: å•å…ƒæµ‹è¯• (ALL AC)
  - [x] æµ‹è¯•generate_node_idçš„IDæ ¼å¼å’Œå”¯ä¸€æ€§
  - [x] æµ‹è¯•create_nodeåˆ›å»ºä¸‰ç§ç±»å‹èŠ‚ç‚¹
  - [x] æµ‹è¯•create_nodeçš„å‚æ•°éªŒè¯ï¼ˆæ— æ•ˆç±»å‹ã€æ— æ•ˆé¢œè‰²ï¼‰
  - [x] æµ‹è¯•update_node_coloræˆåŠŸæ›´æ–°å’Œé”™è¯¯å¤„ç†
  - [x] æµ‹è¯•delete_nodeåŒæ—¶åˆ é™¤èŠ‚ç‚¹å’Œç›¸å…³è¾¹
  - [x] æµ‹è¯•find_nodes_by_coloræŸ¥æ‰¾åŠŸèƒ½
  - [x] æµ‹è¯•è¾…åŠ©æŸ¥è¯¢æ–¹æ³•
  - [x] ç¡®ä¿æµ‹è¯•è¦†ç›–ç‡â‰¥90%

## Dev Notes

### Previous Story Insights

ä»Story 1.1ï¼ˆCanvas JSONæ–‡ä»¶è¯»å–ï¼‰å’ŒStory 1.2ï¼ˆèŠ‚ç‚¹å…³ç³»å›¾æ„å»ºï¼‰ä¸­å­¦åˆ°çš„ç»éªŒï¼š

- âœ… **é™æ€æ–¹æ³•è®¾è®¡**ï¼šLayer 1çš„æ‰€æœ‰æ–¹æ³•éƒ½åº”è¯¥æ˜¯é™æ€æ–¹æ³•ï¼Œæ— çŠ¶æ€è®¾è®¡ï¼Œä¾¿äºè°ƒç”¨å’Œæµ‹è¯•
- âœ… **ä¼˜é›…é™çº§**ï¼šå¯¹äºè¾¹ç•Œæƒ…å†µï¼Œåº”æä¾›æ˜ç¡®çš„é”™è¯¯æ¶ˆæ¯è€Œä¸æ˜¯é™é»˜å¤±è´¥
- âœ… **ç±»å‹æ³¨è§£**ï¼šå®Œæ•´çš„ç±»å‹æ³¨è§£ï¼ˆåŒ…æ‹¬Dict, List, Optionalç­‰ï¼‰æå¤§æå‡ä»£ç å¯è¯»æ€§
- âœ… **Google Style Docstring**ï¼šè¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²åŒ…æ‹¬Argsã€Returnsã€Raisesã€Example
- âœ… **æ€§èƒ½ä¼˜å¼‚**ï¼šå‰ä¸¤ä¸ªStoryçš„å®é™…æ€§èƒ½è¿œè¶…è¦æ±‚ï¼Œä¿æŒè¿™ç§æ ‡å‡†
- âœ… **é”™è¯¯å¤„ç†**ï¼šæ˜ç¡®çš„é”™è¯¯ç±»å‹å’Œæœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯
- âœ… **å­—å…¸æ“ä½œ**ï¼šä½¿ç”¨O(1)æ—¶é—´å¤æ‚åº¦çš„å­—å…¸æŸ¥æ‰¾ï¼Œé¿å…O(n)çš„åˆ—è¡¨éå†

### æ¶æ„ä¸Šä¸‹æ–‡

**3å±‚æ¶æ„è®¾è®¡** [Source: architecture/canvas-3-layer-architecture.md#æ¶æ„æ¦‚è¿°]

æœ¬Storyç»§ç»­å®ç°Layer 1ï¼ˆCanvasJSONOperatorï¼‰çš„CRUDåŠŸèƒ½ã€‚3å±‚æ¶æ„å¦‚ä¸‹ï¼š

```
Layer 3: CanvasOrchestrator (é«˜çº§æ¥å£) â† Sub-agentsè°ƒç”¨
Layer 2: CanvasBusinessLogic (ä¸šåŠ¡é€»è¾‘)
Layer 1: CanvasJSONOperator (åº•å±‚JSONæ“ä½œ) â† æœ¬Storyå®ç°æ­¤å±‚
```

**Layer 1èŒè´£ï¼š**
- Canvas JSONæ–‡ä»¶çš„è¯»å†™ï¼ˆStory 1.1å·²å®ç°ï¼‰
- èŠ‚ç‚¹å…³ç³»å›¾æ„å»ºï¼ˆStory 1.2å·²å®ç°ï¼‰
- èŠ‚ç‚¹å’Œè¾¹çš„CRUDæ“ä½œï¼ˆæœ¬Storyå®ç°ï¼‰
- ä¸åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘
- çº¯å‡½æ•°å¼ï¼Œæ— çŠ¶æ€ï¼ˆæ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ï¼‰

### æ•°æ®æ¨¡å‹

**Canvas JSONèŠ‚ç‚¹ç»“æ„** [Source: architecture/tech-stack.md#æ–‡ä»¶æ ¼å¼è§„èŒƒ]

```json
{
  "id": "string",
  "type": "text" | "file" | "group",
  "text": "string (for type=text)",
  "file": "string (for type=file)",
  "x": number,
  "y": number,
  "width": number,
  "height": number,
  "color": "1" | "2" | "3" | "4" | "5" | "6"
}
```

**èŠ‚ç‚¹ç±»å‹è¯´æ˜ï¼š**
- **textèŠ‚ç‚¹**ï¼šåŒ…å«textå­—æ®µï¼Œç”¨äºæ˜¾ç¤ºæ–‡æœ¬å†…å®¹
- **fileèŠ‚ç‚¹**ï¼šåŒ…å«fileå­—æ®µï¼Œå¼•ç”¨.mdæ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„
- **groupèŠ‚ç‚¹**ï¼šç”¨äºåˆ†ç»„ï¼Œé€šå¸¸ä¸åŒ…å«textæˆ–fileå­—æ®µ

**é¢œè‰²ç¼–ç ç³»ç»Ÿ** [Source: architecture/tech-stack.md#é¢œè‰²ç³»ç»Ÿ]

æœ¬ç³»ç»Ÿä½¿ç”¨çš„é¢œè‰²æ˜ å°„ï¼š
- `"1"` = çº¢è‰²ï¼ˆä¸ç†è§£/æœªé€šè¿‡ï¼‰
- `"2"` = ç»¿è‰²ï¼ˆå®Œå…¨ç†è§£/å·²é€šè¿‡ï¼‰
- `"3"` = ç´«è‰²ï¼ˆä¼¼æ‡‚éæ‡‚/å¾…æ£€éªŒï¼‰
- `"5"` = è“è‰²ï¼ˆAIç”Ÿæˆçš„è¯´æ˜èŠ‚ç‚¹ï¼‰
- `"6"` = é»„è‰²ï¼ˆä¸ªäººç†è§£è¾“å‡ºåŒºï¼‰

âš ï¸ é¢œè‰²å€¼å¿…é¡»æ˜¯**å­—ç¬¦ä¸²**ï¼Œä¸èƒ½æ˜¯æ•°å­—ã€‚

**å…³é”®çº¦æŸ** [Source: architecture/tech-stack.md#æ–‡ä»¶æ ¼å¼è§„èŒƒ]
- èŠ‚ç‚¹IDå¿…é¡»å”¯ä¸€ï¼ˆæ¨èä½¿ç”¨UUID v4ï¼‰
- é¢œè‰²å€¼å¿…é¡»æ˜¯å­—ç¬¦ä¸² `"1"`-`"6"`
- æ‰€æœ‰åæ ‡ä¸ºæ•´æ•°ï¼ˆåƒç´ å•ä½ï¼‰

### API Specifications

**èŠ‚ç‚¹IDç”Ÿæˆç­–ç•¥**

```python
import uuid

@staticmethod
def generate_node_id(node_type: str) -> str:
    """ç”Ÿæˆå”¯ä¸€çš„èŠ‚ç‚¹ID

    Args:
        node_type: èŠ‚ç‚¹ç±»å‹ï¼ˆtext/file/groupï¼‰

    Returns:
        str: æ ¼å¼ä¸º "{node_type}-{uuid16}" çš„èŠ‚ç‚¹ID

    Example:
        >>> CanvasJSONOperator.generate_node_id("text")
        "text-a1b2c3d4e5f67890"
    """
    uuid_hex = uuid.uuid4().hex[:16]
    return f"{node_type}-{uuid_hex}"
```

**create_nodeæ–¹æ³•ç­¾å**

```python
@staticmethod
def create_node(
    canvas_data: Dict[str, Any],
    node_type: str,
    x: int,
    y: int,
    width: int = 400,
    height: int = 300,
    color: Optional[str] = None,
    text: Optional[str] = None,
    file: Optional[str] = None
) -> str:
    """åˆ›å»ºæ–°èŠ‚ç‚¹å¹¶æ·»åŠ åˆ°canvas_data

    Args:
        canvas_data: Canvas JSONæ•°æ®
        node_type: èŠ‚ç‚¹ç±»å‹ï¼ˆ"text", "file", "group"ï¼‰
        x: Xåæ ‡ï¼ˆæ•´æ•°ï¼‰
        y: Yåæ ‡ï¼ˆæ•´æ•°ï¼‰
        width: èŠ‚ç‚¹å®½åº¦ï¼ˆé»˜è®¤400ï¼‰
        height: èŠ‚ç‚¹é«˜åº¦ï¼ˆé»˜è®¤300ï¼‰
        color: é¢œè‰²ç¼–ç ï¼ˆ"1"-"6"ï¼Œå¯é€‰ï¼‰
        text: æ–‡æœ¬å†…å®¹ï¼ˆtype=textæ—¶å¿…éœ€ï¼‰
        file: æ–‡ä»¶è·¯å¾„ï¼ˆtype=fileæ—¶å¿…éœ€ï¼‰

    Returns:
        str: æ–°åˆ›å»ºçš„èŠ‚ç‚¹ID

    Raises:
        ValueError: å¦‚æœnode_typeæ— æ•ˆæˆ–å¿…éœ€å­—æ®µç¼ºå¤±

    Example:
        >>> canvas_data = {"nodes": [], "edges": []}
        >>> node_id = CanvasJSONOperator.create_node(
        ...     canvas_data,
        ...     node_type="text",
        ...     x=100,
        ...     y=200,
        ...     color="1",
        ...     text="è¿™æ˜¯ä»€ä¹ˆæ¦‚å¿µï¼Ÿ"
        ... )
        >>> print(f"åˆ›å»ºäº†èŠ‚ç‚¹: {node_id}")
    """
    pass
```

**update_node_coloræ–¹æ³•ç­¾å**

```python
@staticmethod
def update_node_color(
    canvas_data: Dict[str, Any],
    node_id: str,
    new_color: str
) -> None:
    """æ›´æ–°èŠ‚ç‚¹é¢œè‰²

    Args:
        canvas_data: Canvas JSONæ•°æ®
        node_id: ç›®æ ‡èŠ‚ç‚¹ID
        new_color: æ–°é¢œè‰²ç¼–ç ï¼ˆ"1"-"6"ï¼‰

    Raises:
        KeyError: å¦‚æœèŠ‚ç‚¹IDä¸å­˜åœ¨
        ValueError: å¦‚æœé¢œè‰²ç¼–ç æ— æ•ˆ

    Example:
        >>> CanvasJSONOperator.update_node_color(
        ...     canvas_data,
        ...     "text-abc123",
        ...     "2"  # å˜ä¸ºç»¿è‰²
        ... )
    """
    pass
```

**delete_nodeæ–¹æ³•ç­¾å**

```python
@staticmethod
def delete_node(
    canvas_data: Dict[str, Any],
    node_id: str
) -> Tuple[int, int]:
    """åˆ é™¤èŠ‚ç‚¹åŠå…¶ç›¸å…³çš„è¾¹

    Args:
        canvas_data: Canvas JSONæ•°æ®
        node_id: è¦åˆ é™¤çš„èŠ‚ç‚¹ID

    Returns:
        Tuple[int, int]: (åˆ é™¤çš„èŠ‚ç‚¹æ•°, åˆ é™¤çš„è¾¹æ•°)

    Raises:
        KeyError: å¦‚æœèŠ‚ç‚¹IDä¸å­˜åœ¨

    Example:
        >>> nodes_deleted, edges_deleted = CanvasJSONOperator.delete_node(
        ...     canvas_data,
        ...     "text-abc123"
        ... )
        >>> print(f"åˆ é™¤äº†{nodes_deleted}ä¸ªèŠ‚ç‚¹å’Œ{edges_deleted}æ¡è¾¹")
    """
    pass
```

**find_nodes_by_coloræ–¹æ³•ç­¾å**

```python
@staticmethod
def find_nodes_by_color(
    canvas_data: Dict[str, Any],
    color: str
) -> List[Dict[str, Any]]:
    """æŸ¥æ‰¾æŒ‡å®šé¢œè‰²çš„æ‰€æœ‰èŠ‚ç‚¹

    Args:
        canvas_data: Canvas JSONæ•°æ®
        color: é¢œè‰²ç¼–ç ï¼ˆ"1"-"6"ï¼‰

    Returns:
        List[Dict[str, Any]]: åŒ¹é…çš„èŠ‚ç‚¹åˆ—è¡¨ï¼ˆå¯èƒ½ä¸ºç©ºï¼‰

    Example:
        >>> red_nodes = CanvasJSONOperator.find_nodes_by_color(
        ...     canvas_data,
        ...     "1"  # æŸ¥æ‰¾æ‰€æœ‰çº¢è‰²èŠ‚ç‚¹
        ... )
        >>> print(f"æ‰¾åˆ°{len(red_nodes)}ä¸ªçº¢è‰²èŠ‚ç‚¹")
    """
    pass
```

### æ–‡ä»¶ä½ç½®

**ä»£ç æ–‡ä»¶** [Source: architecture/unified-project-structure.md#å…³é”®æ–‡ä»¶è¯´æ˜]
- ä¿®æ”¹æ–‡ä»¶ï¼š`C:/Users/ROG/æ‰˜ç¦/canvas_utils.py`ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰
- åœ¨ç°æœ‰çš„CanvasJSONOperatorç±»ä¸­æ·»åŠ æ–°çš„é™æ€æ–¹æ³•
- Story 1.1å·²åˆ›å»ºæ­¤æ–‡ä»¶ï¼ŒStory 1.2å·²æ·»åŠ å…³ç³»å›¾æ–¹æ³•

**é¡¹ç›®ç»“æ„**
```
C:/Users/ROG/æ‰˜ç¦/
â”œâ”€â”€ canvas_utils.py        # â­ æœ¬Storyä¿®æ”¹æ­¤æ–‡ä»¶
â”‚                          #    åœ¨CanvasJSONOperatorç±»ä¸­æ·»åŠ CRUDæ–¹æ³•
â””â”€â”€ tests/
    â””â”€â”€ test_canvas_utils.py  # â­ æœ¬Storyæ·»åŠ æ–°æµ‹è¯•ç”¨ä¾‹
```

### ç¼–ç è§„èŒƒ

**PEP 8è§„èŒƒ** [Source: architecture/coding-standards.md#Pythonç¼–ç è§„èŒƒ]
- ä½¿ç”¨4ä¸ªç©ºæ ¼ç¼©è¿›
- æ¯è¡Œæœ€å¤š79å­—ç¬¦
- ä½¿ç”¨UTF-8ç¼–ç 
- ç±»åï¼šPascalCaseï¼ˆå¦‚ CanvasJSONOperatorï¼‰
- å‡½æ•°åï¼šsnake_caseï¼ˆå¦‚ create_node, delete_nodeï¼‰
- å¸¸é‡ï¼šUPPER_SNAKE_CASEï¼ˆå¦‚ DEFAULT_NODE_WIDTHï¼‰

**ç±»å‹æ³¨è§£ï¼ˆå¼ºåˆ¶ï¼‰** [Source: architecture/coding-standards.md#ç±»å‹æ³¨è§£]
```python
from typing import Dict, List, Tuple, Optional, Any

@staticmethod
def create_node(
    canvas_data: Dict[str, Any],
    node_type: str,
    x: int,
    y: int,
    ...
) -> str:
    """åˆ›å»ºèŠ‚ç‚¹"""
    pass
```

**æ–‡æ¡£å­—ç¬¦ä¸²ï¼ˆGoogle Styleï¼‰** [Source: architecture/coding-standards.md#æ–‡æ¡£å­—ç¬¦ä¸²]
- å¿…é¡»åŒ…å«ï¼šç®€çŸ­æè¿°ã€Argsã€Returns
- å¯é€‰åŒ…å«ï¼šRaisesã€Example
- ç¤ºä¾‹åº”æ¸…æ™°å±•ç¤ºç”¨æ³•

**é”™è¯¯å¤„ç†åŸåˆ™** [Source: architecture/coding-standards.md#é”™è¯¯å¤„ç†]
- æ˜ç¡®çš„é”™è¯¯ç±»å‹ï¼ˆValueErrorã€KeyErrorç­‰ï¼‰
- æœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯
- åŒ…å«ä¸Šä¸‹æ–‡ä¿¡æ¯

ç¤ºä¾‹ï¼š
```python
# éªŒè¯èŠ‚ç‚¹ç±»å‹
if node_type not in ["text", "file", "group"]:
    raise ValueError(
        f"æ— æ•ˆçš„èŠ‚ç‚¹ç±»å‹: {node_type}ã€‚"
        f"æ”¯æŒçš„ç±»å‹: text, file, group"
    )

# éªŒè¯é¢œè‰²å€¼
if color is not None and color not in ["1", "2", "3", "5", "6"]:
    raise ValueError(
        f"æ— æ•ˆçš„é¢œè‰²ç¼–ç : {color}ã€‚"
        f"æ”¯æŒçš„é¢œè‰²: 1, 2, 3, 5, 6ï¼ˆå­—ç¬¦ä¸²ï¼‰"
    )

# èŠ‚ç‚¹ä¸å­˜åœ¨
node = find_node_by_id(canvas_data, node_id)
if node is None:
    raise KeyError(
        f"èŠ‚ç‚¹ä¸å­˜åœ¨: {node_id}"
    )
```

**å¸¸é‡å®šä¹‰** [Source: architecture/coding-standards.md#å¸¸é‡å®šä¹‰]

åœ¨canvas_utils.pyé¡¶éƒ¨å®šä¹‰èŠ‚ç‚¹ç›¸å…³å¸¸é‡ï¼š
```python
# èŠ‚ç‚¹ç±»å‹
NODE_TYPE_TEXT = "text"
NODE_TYPE_FILE = "file"
NODE_TYPE_GROUP = "group"

# é¢œè‰²ä»£ç 
COLOR_RED = "1"      # ä¸ç†è§£/æœªé€šè¿‡
COLOR_GREEN = "2"    # å®Œå…¨ç†è§£/å·²é€šè¿‡
COLOR_PURPLE = "3"   # ä¼¼æ‡‚éæ‡‚/å¾…æ£€éªŒ
COLOR_BLUE = "5"     # AIç”Ÿæˆçš„è¯´æ˜èŠ‚ç‚¹
COLOR_YELLOW = "6"   # ä¸ªäººç†è§£è¾“å‡ºåŒº

# é»˜è®¤èŠ‚ç‚¹å°ºå¯¸
DEFAULT_NODE_WIDTH = 400
DEFAULT_NODE_HEIGHT = 300
```

### å®ç°æŒ‡å¯¼

**create_nodeå®ç°æ€è·¯**

```python
@staticmethod
def create_node(
    canvas_data: Dict[str, Any],
    node_type: str,
    x: int,
    y: int,
    width: int = 400,
    height: int = 300,
    color: Optional[str] = None,
    text: Optional[str] = None,
    file: Optional[str] = None
) -> str:
    """åˆ›å»ºæ–°èŠ‚ç‚¹å¹¶æ·»åŠ åˆ°canvas_data

    å®ç°æ€è·¯ï¼š
    1. éªŒè¯node_typeæœ‰æ•ˆæ€§
    2. éªŒè¯å¿…éœ€å­—æ®µï¼ˆtextèŠ‚ç‚¹éœ€è¦textï¼ŒfileèŠ‚ç‚¹éœ€è¦fileï¼‰
    3. éªŒè¯coloræœ‰æ•ˆæ€§ï¼ˆå¦‚æœæä¾›ï¼‰
    4. ç”Ÿæˆå”¯ä¸€çš„èŠ‚ç‚¹ID
    5. æ„å»ºèŠ‚ç‚¹å¯¹è±¡
    6. æ·»åŠ åˆ°canvas_data["nodes"]
    7. è¿”å›èŠ‚ç‚¹ID
    """
    # 1. éªŒè¯èŠ‚ç‚¹ç±»å‹
    if node_type not in ["text", "file", "group"]:
        raise ValueError(f"æ— æ•ˆçš„èŠ‚ç‚¹ç±»å‹: {node_type}")

    # 2. éªŒè¯å¿…éœ€å­—æ®µ
    if node_type == "text" and not text:
        raise ValueError("textç±»å‹èŠ‚ç‚¹å¿…é¡»æä¾›textå­—æ®µ")
    if node_type == "file" and not file:
        raise ValueError("fileç±»å‹èŠ‚ç‚¹å¿…é¡»æä¾›fileå­—æ®µ")

    # 3. éªŒè¯é¢œè‰²
    if color is not None and color not in ["1", "2", "3", "5", "6"]:
        raise ValueError(f"æ— æ•ˆçš„é¢œè‰²ç¼–ç : {color}")

    # 4. ç”ŸæˆèŠ‚ç‚¹ID
    node_id = generate_node_id(node_type)

    # 5. æ„å»ºèŠ‚ç‚¹å¯¹è±¡
    node = {
        "id": node_id,
        "type": node_type,
        "x": x,
        "y": y,
        "width": width,
        "height": height
    }

    # æ·»åŠ å¯é€‰å­—æ®µ
    if color is not None:
        node["color"] = color
    if text is not None:
        node["text"] = text
    if file is not None:
        node["file"] = file

    # 6. æ·»åŠ åˆ°Canvas
    canvas_data["nodes"].append(node)

    # 7. è¿”å›ID
    return node_id
```

**delete_nodeå®ç°æ€è·¯**

```python
@staticmethod
def delete_node(
    canvas_data: Dict[str, Any],
    node_id: str
) -> Tuple[int, int]:
    """åˆ é™¤èŠ‚ç‚¹åŠå…¶ç›¸å…³çš„è¾¹

    å®ç°æ€è·¯ï¼š
    1. æŸ¥æ‰¾èŠ‚ç‚¹ç´¢å¼•
    2. å¦‚æœèŠ‚ç‚¹ä¸å­˜åœ¨ï¼ŒæŠ›å‡ºKeyError
    3. åˆ é™¤èŠ‚ç‚¹
    4. åˆ é™¤æ‰€æœ‰ç›¸å…³çš„è¾¹ï¼ˆfromNodeæˆ–toNodeåŒ¹é…ï¼‰
    5. è¿”å›åˆ é™¤ç»Ÿè®¡
    """
    # 1. æŸ¥æ‰¾èŠ‚ç‚¹
    node_index = None
    for i, node in enumerate(canvas_data["nodes"]):
        if node["id"] == node_id:
            node_index = i
            break

    # 2. éªŒè¯å­˜åœ¨
    if node_index is None:
        raise KeyError(f"èŠ‚ç‚¹ä¸å­˜åœ¨: {node_id}")

    # 3. åˆ é™¤èŠ‚ç‚¹
    canvas_data["nodes"].pop(node_index)
    nodes_deleted = 1

    # 4. åˆ é™¤ç›¸å…³è¾¹
    edges_before = len(canvas_data["edges"])
    canvas_data["edges"] = [
        edge for edge in canvas_data["edges"]
        if edge.get("fromNode") != node_id and edge.get("toNode") != node_id
    ]
    edges_deleted = edges_before - len(canvas_data["edges"])

    # 5. è¿”å›ç»Ÿè®¡
    return (nodes_deleted, edges_deleted)
```

**è¾…åŠ©æ–¹æ³•å®ç°**

```python
@staticmethod
def find_node_by_id(
    canvas_data: Dict[str, Any],
    node_id: str
) -> Optional[Dict[str, Any]]:
    """æ ¹æ®IDæŸ¥æ‰¾èŠ‚ç‚¹

    Returns:
        Optional[Dict]: æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œå¦‚æœä¸å­˜åœ¨è¿”å›None
    """
    for node in canvas_data["nodes"]:
        if node["id"] == node_id:
            return node
    return None

@staticmethod
def node_exists(
    canvas_data: Dict[str, Any],
    node_id: str
) -> bool:
    """æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨"""
    return find_node_by_id(canvas_data, node_id) is not None

@staticmethod
def get_all_node_ids(
    canvas_data: Dict[str, Any]
) -> List[str]:
    """è·å–æ‰€æœ‰èŠ‚ç‚¹IDåˆ—è¡¨"""
    return [node["id"] for node in canvas_data["nodes"]]
```

### Testing

**æµ‹è¯•æ–‡ä»¶ä½ç½®** [Source: architecture/coding-standards.md#æµ‹è¯•è§„èŒƒ]
- æµ‹è¯•æ–‡ä»¶è·¯å¾„ï¼š`tests/test_canvas_utils.py`
- åœ¨ç°æœ‰æµ‹è¯•ç±»TestCanvasJSONOperatorä¸­æ·»åŠ æ–°æµ‹è¯•æ–¹æ³•

**æµ‹è¯•æ¡†æ¶å’Œå·¥å…·**
- ä¸»æµ‹è¯•æ¡†æ¶ï¼špytestï¼ˆStory 1.1å·²å®‰è£…ï¼‰
- è¦†ç›–ç‡å·¥å…·ï¼špytest-cov
- å®‰è£…å‘½ä»¤ï¼š`pip install pytest pytest-cov`ï¼ˆå·²å®‰è£…ï¼‰

**æµ‹è¯•æ ‡å‡†**
- Layer 1 (CanvasJSONOperator) è¦†ç›–ç‡ç›®æ ‡ï¼šâ‰¥ 90%
- æ‰€æœ‰å…¬å…±æ–¹æ³•å¿…é¡»æœ‰æµ‹è¯•ç”¨ä¾‹
- æ‰€æœ‰é”™è¯¯å¤„ç†è·¯å¾„å¿…é¡»æœ‰æµ‹è¯•è¦†ç›–

**è¿è¡Œå‘½ä»¤**
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/test_canvas_utils.py

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=canvas_utils tests/test_canvas_utils.py

# ç”ŸæˆHTMLæ ¼å¼çš„è¯¦ç»†è¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=canvas_utils --cov-report=html tests/test_canvas_utils.py
```

**æœ¬Storyçš„æµ‹è¯•è¦æ±‚**

å¿…é¡»æµ‹è¯•çš„åœºæ™¯ï¼š

1. **IDç”Ÿæˆæµ‹è¯•**
   - æµ‹è¯•IDæ ¼å¼æ­£ç¡®ï¼ˆ"{type}-{uuid16}"ï¼‰
   - æµ‹è¯•IDå”¯ä¸€æ€§ï¼ˆå¤šæ¬¡ç”Ÿæˆä¸é‡å¤ï¼‰

2. **create_nodeæµ‹è¯•**
   - æµ‹è¯•åˆ›å»ºtextèŠ‚ç‚¹ï¼ˆæä¾›textå­—æ®µï¼‰
   - æµ‹è¯•åˆ›å»ºfileèŠ‚ç‚¹ï¼ˆæä¾›fileå­—æ®µï¼‰
   - æµ‹è¯•åˆ›å»ºgroupèŠ‚ç‚¹
   - æµ‹è¯•é»˜è®¤å‚æ•°ï¼ˆwidth, heightï¼‰
   - æµ‹è¯•å¯é€‰é¢œè‰²å­—æ®µ
   - æµ‹è¯•æ— æ•ˆèŠ‚ç‚¹ç±»å‹æŠ›å‡ºValueError
   - æµ‹è¯•textèŠ‚ç‚¹ç¼ºå°‘textå­—æ®µæŠ›å‡ºValueError
   - æµ‹è¯•æ— æ•ˆé¢œè‰²ç¼–ç æŠ›å‡ºValueError

3. **update_node_coloræµ‹è¯•**
   - æµ‹è¯•æˆåŠŸæ›´æ–°é¢œè‰²
   - æµ‹è¯•èŠ‚ç‚¹ä¸å­˜åœ¨æŠ›å‡ºKeyError
   - æµ‹è¯•æ— æ•ˆé¢œè‰²ç¼–ç æŠ›å‡ºValueError

4. **delete_nodeæµ‹è¯•**
   - æµ‹è¯•åˆ é™¤èŠ‚ç‚¹æˆåŠŸ
   - æµ‹è¯•åŒæ—¶åˆ é™¤ç›¸å…³è¾¹ï¼ˆfromNodeå’ŒtoNodeï¼‰
   - æµ‹è¯•åˆ é™¤èŠ‚ç‚¹åè¿”å›æ­£ç¡®çš„ç»Ÿè®¡æ•°å­—
   - æµ‹è¯•èŠ‚ç‚¹ä¸å­˜åœ¨æŠ›å‡ºKeyError

5. **find_nodes_by_coloræµ‹è¯•**
   - æµ‹è¯•æŸ¥æ‰¾æŒ‡å®šé¢œè‰²çš„èŠ‚ç‚¹
   - æµ‹è¯•æ²¡æœ‰åŒ¹é…èŠ‚ç‚¹æ—¶è¿”å›ç©ºåˆ—è¡¨
   - æµ‹è¯•æŸ¥æ‰¾å¤šä¸ªç›¸åŒé¢œè‰²çš„èŠ‚ç‚¹

6. **è¾…åŠ©æ–¹æ³•æµ‹è¯•**
   - æµ‹è¯•find_node_by_idæ‰¾åˆ°èŠ‚ç‚¹
   - æµ‹è¯•find_node_by_idæœªæ‰¾åˆ°è¿”å›None
   - æµ‹è¯•node_existsæ£€æŸ¥
   - æµ‹è¯•get_all_node_idsè¿”å›æ‰€æœ‰ID

**æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹ï¼š**

```python
import pytest
from canvas_utils import CanvasJSONOperator

class TestCanvasJSONOperator:
    """æµ‹è¯•CanvasJSONOperatorç±»"""

    # ... å‰é¢çš„æµ‹è¯•ï¼ˆStory 1.1å’Œ1.2ï¼‰

    def test_generate_node_id_format(self):
        """æµ‹è¯•èŠ‚ç‚¹IDæ ¼å¼æ­£ç¡®"""
        node_id = CanvasJSONOperator.generate_node_id("text")

        assert node_id.startswith("text-")
        assert len(node_id) == len("text-") + 16

    def test_generate_node_id_unique(self):
        """æµ‹è¯•èŠ‚ç‚¹IDå”¯ä¸€æ€§"""
        id1 = CanvasJSONOperator.generate_node_id("text")
        id2 = CanvasJSONOperator.generate_node_id("text")

        assert id1 != id2

    def test_create_node_text_success(self):
        """æµ‹è¯•åˆ›å»ºtextèŠ‚ç‚¹æˆåŠŸ"""
        canvas_data = {"nodes": [], "edges": []}

        node_id = CanvasJSONOperator.create_node(
            canvas_data,
            node_type="text",
            x=100,
            y=200,
            color="1",
            text="æµ‹è¯•é—®é¢˜"
        )

        assert node_id.startswith("text-")
        assert len(canvas_data["nodes"]) == 1
        assert canvas_data["nodes"][0]["id"] == node_id
        assert canvas_data["nodes"][0]["type"] == "text"
        assert canvas_data["nodes"][0]["text"] == "æµ‹è¯•é—®é¢˜"
        assert canvas_data["nodes"][0]["color"] == "1"

    def test_create_node_invalid_type(self):
        """æµ‹è¯•åˆ›å»ºæ— æ•ˆç±»å‹èŠ‚ç‚¹æŠ›å‡ºå¼‚å¸¸"""
        canvas_data = {"nodes": [], "edges": []}

        with pytest.raises(ValueError) as exc_info:
            CanvasJSONOperator.create_node(
                canvas_data,
                node_type="invalid",
                x=100,
                y=200
            )

        assert "æ— æ•ˆçš„èŠ‚ç‚¹ç±»å‹" in str(exc_info.value)

    def test_create_node_text_missing_text_field(self):
        """æµ‹è¯•åˆ›å»ºtextèŠ‚ç‚¹ç¼ºå°‘textå­—æ®µæŠ›å‡ºå¼‚å¸¸"""
        canvas_data = {"nodes": [], "edges": []}

        with pytest.raises(ValueError) as exc_info:
            CanvasJSONOperator.create_node(
                canvas_data,
                node_type="text",
                x=100,
                y=200
            )

        assert "å¿…é¡»æä¾›textå­—æ®µ" in str(exc_info.value)

    def test_update_node_color_success(self):
        """æµ‹è¯•æ›´æ–°èŠ‚ç‚¹é¢œè‰²æˆåŠŸ"""
        canvas_data = {
            "nodes": [
                {"id": "text-abc123", "type": "text", "color": "1", "x": 0, "y": 0}
            ],
            "edges": []
        }

        CanvasJSONOperator.update_node_color(
            canvas_data,
            "text-abc123",
            "2"
        )

        assert canvas_data["nodes"][0]["color"] == "2"

    def test_update_node_color_node_not_found(self):
        """æµ‹è¯•æ›´æ–°ä¸å­˜åœ¨çš„èŠ‚ç‚¹æŠ›å‡ºå¼‚å¸¸"""
        canvas_data = {"nodes": [], "edges": []}

        with pytest.raises(KeyError):
            CanvasJSONOperator.update_node_color(
                canvas_data,
                "nonexistent",
                "2"
            )

    def test_delete_node_success(self):
        """æµ‹è¯•åˆ é™¤èŠ‚ç‚¹æˆåŠŸ"""
        canvas_data = {
            "nodes": [
                {"id": "text-abc123", "type": "text", "x": 0, "y": 0},
                {"id": "text-def456", "type": "text", "x": 100, "y": 100}
            ],
            "edges": [
                {"id": "edge1", "fromNode": "text-abc123", "toNode": "text-def456"}
            ]
        }

        nodes_deleted, edges_deleted = CanvasJSONOperator.delete_node(
            canvas_data,
            "text-abc123"
        )

        assert nodes_deleted == 1
        assert edges_deleted == 1
        assert len(canvas_data["nodes"]) == 1
        assert len(canvas_data["edges"]) == 0

    def test_delete_node_not_found(self):
        """æµ‹è¯•åˆ é™¤ä¸å­˜åœ¨çš„èŠ‚ç‚¹æŠ›å‡ºå¼‚å¸¸"""
        canvas_data = {"nodes": [], "edges": []}

        with pytest.raises(KeyError):
            CanvasJSONOperator.delete_node(canvas_data, "nonexistent")

    def test_find_nodes_by_color_found(self):
        """æµ‹è¯•æŸ¥æ‰¾æŒ‡å®šé¢œè‰²çš„èŠ‚ç‚¹"""
        canvas_data = {
            "nodes": [
                {"id": "node1", "type": "text", "color": "1", "x": 0, "y": 0},
                {"id": "node2", "type": "text", "color": "2", "x": 100, "y": 100},
                {"id": "node3", "type": "text", "color": "1", "x": 200, "y": 200}
            ],
            "edges": []
        }

        red_nodes = CanvasJSONOperator.find_nodes_by_color(canvas_data, "1")

        assert len(red_nodes) == 2
        assert red_nodes[0]["id"] == "node1"
        assert red_nodes[1]["id"] == "node3"

    def test_find_nodes_by_color_not_found(self):
        """æµ‹è¯•æŸ¥æ‰¾ä¸å­˜åœ¨çš„é¢œè‰²è¿”å›ç©ºåˆ—è¡¨"""
        canvas_data = {
            "nodes": [
                {"id": "node1", "type": "text", "color": "1", "x": 0, "y": 0}
            ],
            "edges": []
        }

        yellow_nodes = CanvasJSONOperator.find_nodes_by_color(canvas_data, "6")

        assert yellow_nodes == []
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | åˆå§‹Storyåˆ›å»º | SM Agent (Bob) |
| 2025-10-14 | 1.1 | å®ç°å®Œæˆï¼šæ·»åŠ èŠ‚ç‚¹CRUDæ“ä½œå’Œè¾…åŠ©æ–¹æ³•ï¼Œæ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆè¦†ç›–ç‡100%ï¼‰ï¼ŒçŠ¶æ€æ›´æ–°ä¸ºReady for Review | Dev Agent (James) |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4.5 (claude-sonnet-4-5-20250929)

### Debug Log References
æ— è°ƒè¯•é—®é¢˜ã€‚æ‰€æœ‰æµ‹è¯•ä¸€æ¬¡æ€§é€šè¿‡ã€‚

### Completion Notes
- âœ… æˆåŠŸæ·»åŠ å¸¸é‡å®šä¹‰ï¼ˆèŠ‚ç‚¹ç±»å‹ã€é¢œè‰²ä»£ç ã€é»˜è®¤å°ºå¯¸ï¼‰
- âœ… å®ç° generate_node_id æ–¹æ³•ï¼ˆUUID v4ç”Ÿæˆ16ä½åå…­è¿›åˆ¶IDï¼‰
- âœ… å®ç° create_node æ–¹æ³•ï¼ˆæ”¯æŒtext/file/groupä¸‰ç§ç±»å‹ï¼Œå®Œæ•´å‚æ•°éªŒè¯ï¼‰
- âœ… å®ç° update_node_color æ–¹æ³•ï¼ˆé¢œè‰²æ›´æ–°å’ŒéªŒè¯ï¼‰
- âœ… å®ç° delete_node æ–¹æ³•ï¼ˆåŒæ—¶åˆ é™¤èŠ‚ç‚¹å’Œç›¸å…³è¾¹ï¼‰
- âœ… å®ç° find_nodes_by_color æ–¹æ³•ï¼ˆæŒ‰é¢œè‰²æŸ¥æ‰¾èŠ‚ç‚¹ï¼‰
- âœ… å®ç°ä¸‰ä¸ªè¾…åŠ©æŸ¥è¯¢æ–¹æ³•ï¼šfind_node_by_idã€node_existsã€get_all_node_ids
- âœ… å®Œæ•´çš„ç±»å‹æ³¨è§£ï¼ˆDict, List, Optional, Tupleï¼‰å’ŒGoogle Style Docstring
- âœ… æ‰€æœ‰æ–¹æ³•éƒ½æœ‰æ¸…æ™°çš„é”™è¯¯å¤„ç†ï¼ˆValueErrorã€KeyErrorï¼‰
- âœ… æµ‹è¯•è¦†ç›–ç‡ï¼š100%ï¼ˆè¶…è¿‡90%ç›®æ ‡ï¼‰
- âœ… æ–°å¢28ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå…¨éƒ¨é€šè¿‡ï¼ˆæ€»è®¡55ä¸ªæµ‹è¯•ï¼‰
- âœ… æ‰€æœ‰6ä¸ªéªŒæ”¶æ ‡å‡† (AC1-AC6) å‡å·²æ»¡è¶³
- âœ… å®Œå…¨éµå¾ªPEP 8è§„èŒƒå’Œé¡¹ç›®ç¼–ç æ ‡å‡†

### File List
**ä¿®æ”¹çš„æ–‡ä»¶ï¼š**
- `canvas_utils.py` - åœ¨CanvasJSONOperatorç±»ä¸­æ·»åŠ 8ä¸ªæ–°æ–¹æ³•ï¼š
  - generate_node_id (ç”ŸæˆèŠ‚ç‚¹ID)
  - create_node (åˆ›å»ºèŠ‚ç‚¹)
  - update_node_color (æ›´æ–°é¢œè‰²)
  - delete_node (åˆ é™¤èŠ‚ç‚¹)
  - find_nodes_by_color (æŒ‰é¢œè‰²æŸ¥æ‰¾)
  - find_node_by_id (æŒ‰IDæŸ¥æ‰¾)
  - node_exists (æ£€æŸ¥å­˜åœ¨)
  - get_all_node_ids (è·å–æ‰€æœ‰ID)
- `canvas_utils.py` - æ·»åŠ å¸¸é‡å®šä¹‰ï¼ˆNODE_TYPE_*, COLOR_*, DEFAULT_*, VALID_*ï¼‰
- `tests/test_canvas_utils.py` - æ·»åŠ 28ä¸ªæ–°æµ‹è¯•ç”¨ä¾‹ï¼ˆStory 1.3ç›¸å…³ï¼‰

**æ–°åˆ›å»ºçš„æ–‡ä»¶ï¼š**
- æ— 

## QA Results

### Review Date: 2025-10-14

### Reviewed By: Quinn (Senior Developer QA)

### Code Quality Assessment

**Overall: Excellent** â­â­â­â­â­

è¿™æ˜¯ä¸€æ¬¡æ•™ç§‘ä¹¦çº§åˆ«çš„å®ç°ã€‚å¼€å‘è€… James å±•ç¤ºäº†å¯¹æ¶æ„è®¾è®¡ã€ä»£ç è´¨é‡å’Œæµ‹è¯•é©±åŠ¨å¼€å‘çš„æ·±åˆ»ç†è§£ã€‚ä»£ç æ¸…æ™°ã€ç®€æ´ã€å¯ç»´æŠ¤ï¼Œå®Œå…¨ç¬¦åˆ Layer 1 çš„è®¾è®¡åŸåˆ™ã€‚

**äº®ç‚¹ï¼š**
- âœ… **å®Œç¾çš„æ¶æ„éµå¾ª**ï¼šæ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œæ— çŠ¶æ€è®¾è®¡ï¼Œå®Œå…¨ç¬¦åˆ Layer 1 èŒè´£
- âœ… **å¸¸é‡åŒ–è®¾è®¡ä¼˜ç§€**ï¼šæ‰€æœ‰é­”æ³•å­—ç¬¦ä¸²å’Œæ•°å­—éƒ½å®šä¹‰ä¸ºæ¨¡å—çº§å¸¸é‡ï¼Œæé«˜å¯ç»´æŠ¤æ€§
- âœ… **ç±»å‹æ³¨è§£å®Œæ•´å‡†ç¡®**ï¼šä½¿ç”¨ Dict[str, Any], List, Optional, Tupleï¼Œç±»å‹ä¿¡æ¯æ¸…æ™°
- âœ… **Google Style Docstring è¯¦å°½**ï¼šæ¯ä¸ªæ–¹æ³•éƒ½æœ‰ Argsã€Returnsã€Raisesã€Example
- âœ… **é”™è¯¯å¤„ç†æ˜ç¡®**ï¼šä½¿ç”¨æ­£ç¡®çš„å¼‚å¸¸ç±»å‹ï¼ˆValueError, KeyErrorï¼‰ï¼Œé”™è¯¯æ¶ˆæ¯æ¸…æ™°æœ‰ç”¨
- âœ… **å‚æ•°éªŒè¯ä¸¥æ ¼**ï¼šèŠ‚ç‚¹ç±»å‹ã€é¢œè‰²ç¼–ç ã€å¿…éœ€å­—æ®µéƒ½æœ‰å®Œæ•´éªŒè¯
- âœ… **ä»£ç å¤ç”¨è‰¯å¥½**ï¼šnode_exists è°ƒç”¨ find_node_by_idï¼Œé¿å…é‡å¤
- âœ… **æµ‹è¯•è¦†ç›–ç‡100%**ï¼š28ä¸ªæ–°æµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–æ‰€æœ‰åŠŸèƒ½å’Œè¾¹ç•Œæƒ…å†µ

### Refactoring Performed

**æ— éœ€é‡æ„** - ä»£ç è´¨é‡å·²è¾¾åˆ°ç”Ÿäº§çº§åˆ«æ ‡å‡†ã€‚

ç»è¿‡ä»”ç»†å®¡æŸ¥ï¼Œæˆ‘æ²¡æœ‰å‘ç°éœ€è¦é‡æ„çš„é—®é¢˜ã€‚ä»£ç å±•ç°äº†é«˜æ°´å¹³çš„å·¥ç¨‹èƒ½åŠ›ï¼š
- ç»“æ„æ¸…æ™°ï¼ŒèŒè´£æ˜ç¡®
- æ²¡æœ‰ä»£ç é‡å¤æˆ–å†—ä½™
- æ²¡æœ‰æ€§èƒ½ç“¶é¢ˆï¼ˆå¯¹äºé¢„æœŸçš„ä½¿ç”¨è§„æ¨¡ï¼‰
- æ²¡æœ‰å®‰å…¨éšæ‚£
- å®Œå…¨ç¬¦åˆé¡¹ç›®è§„èŒƒ

**æŠ€æœ¯åˆ†æï¼š**
- `update_node_color` å’Œ `delete_node` ä½¿ç”¨ O(n) çº¿æ€§æŸ¥æ‰¾æ˜¯åˆç†çš„è®¾è®¡é€‰æ‹©ï¼Œå› ä¸ºï¼š
  - Layer 1 æ˜¯åº•å±‚æ“ä½œï¼Œä¿æŒç®€å•å’Œæ— çŠ¶æ€
  - Canvas æ–‡ä»¶é€šå¸¸èŠ‚ç‚¹æ•°é‡ < 200ï¼ˆæ ¹æ® tech-stack.md çš„æ€§èƒ½è¦æ±‚ï¼‰
  - å¦‚éœ€ä¼˜åŒ–ï¼Œåº”åœ¨ Layer 2 é€šè¿‡å…³ç³»å›¾æä¾› O(1) æŸ¥æ‰¾
  - å½“å‰å®ç°æ¸…æ™°æ˜“æ‡‚ï¼Œä¾¿äºç»´æŠ¤

### Compliance Check

- **Coding Standards**: âœ“ å®Œå…¨ç¬¦åˆ
  - PEP 8 è§„èŒƒï¼šâœ“ï¼ˆ4ç©ºæ ¼ç¼©è¿›ï¼Œ79å­—ç¬¦è¡Œé™åˆ¶ï¼Œå‘½åè§„èŒƒï¼‰
  - ç±»å‹æ³¨è§£ï¼šâœ“ï¼ˆå®Œæ•´ä¸”ç²¾ç¡®ï¼‰
  - Google Style Docstringsï¼šâœ“ï¼ˆåŒ…å« Argsã€Returnsã€Raisesã€Exampleï¼‰
  - å¸¸é‡å®šä¹‰ï¼šâœ“ï¼ˆæ‰€æœ‰é­”æ³•å€¼éƒ½å®šä¹‰ä¸ºå¸¸é‡ï¼‰
  - é”™è¯¯å¤„ç†ï¼šâœ“ï¼ˆæ˜ç¡®çš„å¼‚å¸¸ç±»å‹å’Œæœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯ï¼‰

- **Project Structure**: âœ“ å®Œå…¨ç¬¦åˆ
  - æ–‡ä»¶ä½ç½®æ­£ç¡®ï¼šâœ“ï¼ˆcanvas_utils.py åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼‰
  - æµ‹è¯•æ–‡ä»¶ç»“æ„åˆç†ï¼šâœ“ï¼ˆtests/test_canvas_utils.pyï¼‰
  - 3å±‚æ¶æ„éµå®ˆï¼šâœ“ï¼ˆLayer 1 èŒè´£æ˜ç¡®ï¼Œæ— ä¸šåŠ¡é€»è¾‘ï¼‰

- **Testing Strategy**: âœ“ è¶…å‡ºé¢„æœŸ
  - å•å…ƒæµ‹è¯•è¦†ç›–ç‡100%ï¼ˆç›®æ ‡â‰¥90%ï¼‰ï¼šâœ“
  - è¾¹ç•Œæƒ…å†µæµ‹è¯•ï¼šâœ“ï¼ˆç©ºæ•°æ®ã€æ— æ•ˆè¾“å…¥ã€ç¼ºå¤±å­—æ®µï¼‰
  - é”™è¯¯è·¯å¾„æµ‹è¯•ï¼šâœ“ï¼ˆValueErrorã€KeyError éªŒè¯ï¼‰
  - åŠŸèƒ½æµ‹è¯•ï¼šâœ“ï¼ˆä¸‰ç§èŠ‚ç‚¹ç±»å‹ã€CRUD æ“ä½œã€æŸ¥è¯¢æ–¹æ³•ï¼‰
  - æµ‹è¯•æ•°æ®è®¾è®¡ï¼šâœ“ï¼ˆè¦†ç›–å…¸å‹å’Œè¾¹ç¼˜åœºæ™¯ï¼‰

- **All ACs Met**: âœ“ å…¨éƒ¨æ»¡è¶³
  - AC1ï¼ˆcreate_node åˆ›å»ºæœ‰æ•ˆèŠ‚ç‚¹ï¼‰ï¼šâœ“
  - AC2ï¼ˆupdate_node_color ä¿®æ”¹é¢œè‰²ï¼‰ï¼šâœ“
  - AC3ï¼ˆdelete_node åŒæ—¶åˆ é™¤è¾¹ï¼‰ï¼šâœ“
  - AC4ï¼ˆfind_nodes_by_color æŸ¥æ‰¾èŠ‚ç‚¹ï¼‰ï¼šâœ“
  - AC5ï¼ˆUUID v4 IDç”Ÿæˆç­–ç•¥ï¼‰ï¼šâœ“
  - AC6ï¼ˆIDå…¨å±€å”¯ä¸€ï¼‰ï¼šâœ“

### Improvements Checklist

æ‰€æœ‰è´¨é‡æ ‡å‡†å·²ç”±å¼€å‘è€…å®Œæˆï¼Œæ— éœ€é¢å¤–æ”¹è¿›ï¼š

- [x] ä»£ç æ¶æ„ç¬¦åˆ Layer 1 è®¾è®¡åŸåˆ™
- [x] å¸¸é‡åŒ–è®¾è®¡å®Œæ•´ï¼ˆèŠ‚ç‚¹ç±»å‹ã€é¢œè‰²ã€å°ºå¯¸ï¼‰
- [x] ç±»å‹æ³¨è§£å®Œæ•´å‡†ç¡®
- [x] æ–‡æ¡£å­—ç¬¦ä¸²è¯¦å°½æ¸…æ™°ï¼ˆå«ç¤ºä¾‹ï¼‰
- [x] é”™è¯¯å¤„ç†é€‚å½“ä¸”æœ‰æ„ä¹‰
- [x] å‚æ•°éªŒè¯ä¸¥æ ¼å…¨é¢
- [x] è¾¹ç•Œæƒ…å†µå…¨é¢è¦†ç›–
- [x] æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°100%
- [x] ä»£ç ç¬¦åˆPEP 8è§„èŒƒ
- [x] è¾…åŠ©æ–¹æ³•å¤ç”¨è‰¯å¥½

**æ— éœ€å¼€å‘è€…è¿›ä¸€æ­¥æ“ä½œçš„é¡¹ç›®ï¼š** æ— 

### Security Review

âœ… **é€šè¿‡** - æ— å®‰å…¨é—®é¢˜

**å·²éªŒè¯çš„å®‰å…¨æªæ–½ï¼š**
- è¾“å…¥éªŒè¯ï¼šæ‰€æœ‰å…¬å…±æ–¹æ³•éƒ½éªŒè¯è¾“å…¥å‚æ•°ï¼ˆç±»å‹ã€é¢œè‰²ã€å¿…éœ€å­—æ®µï¼‰
- ç±»å‹å®‰å…¨ï¼šå®Œæ•´çš„ç±»å‹æ³¨è§£å’Œè¿è¡Œæ—¶éªŒè¯
- é”™è¯¯å¤„ç†å®‰å…¨ï¼šä¸æ³„éœ²å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œé”™è¯¯æ¶ˆæ¯æ¸…æ™°ä½†å®‰å…¨
- æ— æ³¨å…¥é£é™©ï¼šçº¯æ•°æ®æ“ä½œï¼Œæ—  SQLã€å‘½ä»¤æ‰§è¡Œæˆ–è·¯å¾„éå†
- æ— çŠ¶æ€è®¾è®¡ï¼šé™æ€æ–¹æ³•é¿å…çŠ¶æ€æ±¡æŸ“å’Œç«æ€æ¡ä»¶

**è®¾è®¡å®‰å…¨æ€§ï¼š**
- ä½¿ç”¨ UUID v4 ç”Ÿæˆ IDï¼Œé¿å…å¯é¢„æµ‹æ€§
- é¢œè‰²å’Œç±»å‹éªŒè¯ä½¿ç”¨ç™½åå•ï¼ˆVALID_COLORS, VALID_NODE_TYPESï¼‰
- åˆ é™¤æ“ä½œæ­£ç¡®å¤„ç†å…³è”æ•°æ®ï¼ˆåŒæ—¶åˆ é™¤è¾¹ï¼‰

### Performance Considerations

âœ… **ä¼˜ç§€** - æ€§èƒ½è®¾è®¡åˆç†

**ç®—æ³•åˆ†æï¼š**
- `generate_node_id`: O(1) - UUID ç”Ÿæˆ
- `create_node`: O(1) - åˆ—è¡¨è¿½åŠ æ“ä½œ
- `update_node_color`: O(n) - çº¿æ€§æŸ¥æ‰¾èŠ‚ç‚¹
- `delete_node`: O(n) - çº¿æ€§æŸ¥æ‰¾èŠ‚ç‚¹ + O(m) è¾¹è¿‡æ»¤
- `find_nodes_by_color`: O(n) - çº¿æ€§æ‰«æ
- `find_node_by_id`: O(n) - çº¿æ€§æŸ¥æ‰¾
- `node_exists`: O(n) - è°ƒç”¨ find_node_by_id
- `get_all_node_ids`: O(n) - åˆ—è¡¨æ¨å¯¼

**æ€§èƒ½è¯„ä¼°ï¼š**
- å¯¹äºé¢„æœŸçš„ Canvas è§„æ¨¡ï¼ˆ< 200 èŠ‚ç‚¹ï¼‰ï¼ŒO(n) æŸ¥æ‰¾å®Œå…¨å¯æ¥å—
- å¦‚éœ€ O(1) æŸ¥æ‰¾ï¼Œåº”åœ¨ Layer 2 ä½¿ç”¨å…³ç³»å›¾ï¼ˆå·²åœ¨ Story 1.2 å®ç°ï¼‰
- å½“å‰å®ç°ä¿æŒäº† Layer 1 çš„ç®€å•æ€§å’Œæ— çŠ¶æ€ç‰¹æ€§
- æ²¡æœ‰ä¸å¿…è¦çš„å¾ªç¯åµŒå¥—æˆ–é‡å¤è®¡ç®—

**æ— æ€§èƒ½é—®é¢˜æˆ–ä¼˜åŒ–éœ€æ±‚**

### Architecture & Design Review

âœ… **å®Œç¾ç¬¦åˆæ¶æ„è¦æ±‚**

**Layer 1 è®¾è®¡åŸåˆ™éªŒè¯ï¼š**
- é™æ€æ–¹æ³•è®¾è®¡ï¼šâœ“ï¼ˆæ‰€æœ‰8ä¸ªæ–°æ–¹æ³•éƒ½æ˜¯ @staticmethodï¼‰
- æ— çŠ¶æ€ï¼šâœ“ï¼ˆç±»ä¸ä¿å­˜ä»»ä½•çŠ¶æ€ï¼‰
- æ— ä¸šåŠ¡é€»è¾‘ï¼šâœ“ï¼ˆçº¯ç²¹çš„æ•°æ®æ“ä½œï¼Œæ— å¸ƒå±€ç®—æ³•æˆ–å¤æ‚é€»è¾‘ï¼‰
- å•ä¸€èŒè´£ï¼šâœ“ï¼ˆæ¯ä¸ªæ–¹æ³•èŒè´£æ˜ç¡®ï¼Œåªåšä¸€ä»¶äº‹ï¼‰

**å¸¸é‡è®¾è®¡ï¼š**
- èŠ‚ç‚¹ç±»å‹å¸¸é‡ï¼šâœ“ï¼ˆNODE_TYPE_TEXT, NODE_TYPE_FILE, NODE_TYPE_GROUPï¼‰
- é¢œè‰²ä»£ç å¸¸é‡ï¼šâœ“ï¼ˆCOLOR_RED, COLOR_GREEN, etc.ï¼‰
- é»˜è®¤å€¼å¸¸é‡ï¼šâœ“ï¼ˆDEFAULT_NODE_WIDTH, DEFAULT_NODE_HEIGHTï¼‰
- éªŒè¯é›†åˆï¼šâœ“ï¼ˆVALID_NODE_TYPES, VALID_COLORSï¼‰

**æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼š**
- CRUD æ“ä½œæ¸…æ™°ï¼šCreate (create_node), Update (update_node_color), Delete (delete_node)
- æŸ¥è¯¢æ–¹æ³•åˆ†ç¦»ï¼šæŒ‰é¢œè‰²æŸ¥æ‰¾ã€æŒ‰ ID æŸ¥æ‰¾ã€å­˜åœ¨æ€§æ£€æŸ¥ã€è·å–æ‰€æœ‰ ID
- ID ç”Ÿæˆç‹¬ç«‹ï¼šgenerate_node_id å¯è¢«å…¶ä»–æ–¹æ³•å¤ç”¨

### Test Quality Review

âœ… **æµ‹è¯•è´¨é‡ä¼˜ç§€**

**æµ‹è¯•è¦†ç›–åˆ†æï¼š**
- ID ç”Ÿæˆæµ‹è¯•ï¼šâœ“ï¼ˆæ ¼å¼éªŒè¯ã€å”¯ä¸€æ€§éªŒè¯ï¼‰
- create_node æµ‹è¯•ï¼šâœ“ï¼ˆä¸‰ç§ç±»å‹ã€é»˜è®¤å€¼ã€å¯é€‰å­—æ®µã€é”™è¯¯æƒ…å†µï¼‰
- update_node_color æµ‹è¯•ï¼šâœ“ï¼ˆæˆåŠŸæ›´æ–°ã€å¤šèŠ‚ç‚¹åœºæ™¯ã€é”™è¯¯å¤„ç†ï¼‰
- delete_node æµ‹è¯•ï¼šâœ“ï¼ˆæˆåŠŸåˆ é™¤ã€å¤šè¾¹åˆ é™¤ã€æ— è¾¹åœºæ™¯ã€é”™è¯¯å¤„ç†ï¼‰
- find_nodes_by_color æµ‹è¯•ï¼šâœ“ï¼ˆæ‰¾åˆ°ã€æœªæ‰¾åˆ°ã€ç¼ºå¤±å­—æ®µï¼‰
- è¾…åŠ©æ–¹æ³•æµ‹è¯•ï¼šâœ“ï¼ˆfind_node_by_id, node_exists, get_all_node_idsï¼‰

**æµ‹è¯•è®¾è®¡äº®ç‚¹ï¼š**
- ä½¿ç”¨ pytest çš„ `exc_info` éªŒè¯å¼‚å¸¸ç±»å‹å’Œæ¶ˆæ¯
- æµ‹è¯•å‘½åæ¸…æ™°ï¼ˆtest_<method>_<scenario>ï¼‰
- æ–­è¨€æœ‰æ„ä¹‰ä¸”å…¨é¢ï¼ˆéªŒè¯ç»“æ„ã€å†…å®¹ã€æ•°é‡ï¼‰
- è¾¹ç•Œæƒ…å†µè¦†ç›–å®Œæ•´ï¼ˆç©ºæ•°æ®ã€æ— æ•ˆè¾“å…¥ã€ç¼ºå¤±å­—æ®µï¼‰
- æµ‹è¯•æ•°æ®è®¾è®¡åˆç†ï¼ˆè¦†ç›–å…¸å‹å’Œè¾¹ç¼˜åœºæ™¯ï¼‰

**æµ‹è¯•è¦†ç›–ç»Ÿè®¡ï¼š**
- æ€»è®¡55ä¸ªæµ‹è¯•ï¼ˆ9ä¸ª Story 1.1 + 18ä¸ª Story 1.2 + 28ä¸ª Story 1.3ï¼‰
- å…¨éƒ¨é€šè¿‡ï¼ˆ55/55ï¼‰
- ä»£ç è¦†ç›–ç‡ï¼š100%ï¼ˆ132è¡Œä»£ç ï¼Œ0è¡Œé—æ¼ï¼‰
- åˆ†æ”¯è¦†ç›–ï¼šå®Œæ•´ï¼ˆæ‰€æœ‰ if åˆ†æ”¯éƒ½æœ‰æµ‹è¯•ï¼‰

### Dev Notes Compliance

âœ… **å®Œå…¨éµå¾ª Dev Notes æŒ‡å¯¼**

**æ¶æ„æŒ‡å¯¼éµå¾ªï¼š**
- âœ“ éµå¾ª 3å±‚æ¶æ„ï¼Œåªå®ç° Layer 1 åŠŸèƒ½
- âœ“ æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ï¼ˆæ— çŠ¶æ€è®¾è®¡ï¼‰
- âœ“ ä½¿ç”¨å¸¸é‡è€Œéé­”æ³•æ•°å­—å’Œå­—ç¬¦ä¸²
- âœ“ å®Œæ•´çš„ç±»å‹æ³¨è§£å’Œæ–‡æ¡£å­—ç¬¦ä¸²

**Previous Story Insights åº”ç”¨ï¼š**
- âœ“ é™æ€æ–¹æ³•è®¾è®¡ï¼ˆä¸ Story 1.1ã€1.2 ä¿æŒä¸€è‡´ï¼‰
- âœ“ ä¼˜é›…é™çº§ï¼ˆé”™è¯¯æ¶ˆæ¯æ˜ç¡®è€Œä¸æ˜¯é™é»˜å¤±è´¥ï¼‰
- âœ“ ç±»å‹æ³¨è§£ï¼ˆDict, List, Optional, Tupleï¼‰
- âœ“ Google Style Docstringï¼ˆArgsã€Returnsã€Raisesã€Exampleï¼‰
- âœ“ æ€§èƒ½ä¼˜å¼‚ï¼ˆæµ‹è¯•è¿è¡Œ < 0.13sï¼‰
- âœ“ é”™è¯¯å¤„ç†ï¼ˆæ˜ç¡®çš„ ValueError å’Œ KeyErrorï¼‰

**æ–‡ä»¶ä½ç½®éµå¾ªï¼š**
- âœ“ canvas_utils.py ä½äºé¡¹ç›®æ ¹ç›®å½•
- âœ“ tests/test_canvas_utils.py æµ‹è¯•æ–‡ä»¶ä½ç½®æ­£ç¡®

### Final Status

âœ… **Approved - Ready for Done**

**æ€»ç»“ï¼š**
è¿™æ˜¯ä¸€ä¸ªå“è¶Šçš„å®ç°ï¼Œå±•ç°äº†é«˜æ°´å¹³çš„è½¯ä»¶å·¥ç¨‹èƒ½åŠ›ã€‚å¼€å‘è€… James å®Œå…¨ç†è§£äº†éœ€æ±‚å’Œæ¶æ„ï¼Œä»£ç è´¨é‡è¾¾åˆ°ç”Ÿäº§çº§åˆ«æ ‡å‡†ã€‚

**å…³é”®æˆå°±ï¼š**
1. âœ… å®Œç¾å®ç°äº†æ‰€æœ‰6ä¸ªéªŒæ”¶æ ‡å‡†
2. âœ… æµ‹è¯•è¦†ç›–ç‡100%ï¼Œè¿œè¶…90%ç›®æ ‡
3. âœ… ä»£ç è´¨é‡ä¼˜ç§€ï¼Œæ— éœ€ä»»ä½•é‡æ„
4. âœ… å®Œå…¨ç¬¦åˆé¡¹ç›®æ¶æ„å’Œç¼–ç è§„èŒƒ
5. âœ… æ–‡æ¡£è¯¦å°½ï¼Œä¾¿äºæœªæ¥ç»´æŠ¤
6. âœ… å®‰å…¨æ€§å’Œæ€§èƒ½è®¾è®¡åˆç†

**æ— å‘ç°ä»»ä½•é—®é¢˜æˆ–æ”¹è¿›ç‚¹ã€‚æ‰¹å‡†è¿›å…¥ Done çŠ¶æ€ã€‚**

**ç»™å¼€å‘è€… James çš„åé¦ˆï¼š**
å“è¶Šçš„å·¥ä½œï¼ä½ å±•ç°äº†å¯¹è½¯ä»¶å·¥ç¨‹æœ€ä½³å®è·µçš„æ·±åˆ»ç†è§£ã€‚ç‰¹åˆ«èµèµä½ ï¼š
- **å¸¸é‡åŒ–è®¾è®¡**ï¼šå°†æ‰€æœ‰é­”æ³•å€¼å®šä¹‰ä¸ºå¸¸é‡ï¼Œæé«˜å¯ç»´æŠ¤æ€§
- **ä¸¥æ ¼çš„å‚æ•°éªŒè¯**ï¼šé˜²å¾¡æ€§ç¼–ç¨‹ï¼Œæ¯ä¸ªå…¬å…±æ–¹æ³•éƒ½éªŒè¯è¾“å…¥
- **è¯¦å°½çš„æ–‡æ¡£å­—ç¬¦ä¸²**ï¼šåŒ…å« Example è®© API ä½¿ç”¨ä¸€ç›®äº†ç„¶
- **å…¨é¢çš„æµ‹è¯•è¦†ç›–**ï¼š28ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–æ‰€æœ‰åŠŸèƒ½å’Œè¾¹ç•Œæƒ…å†µ
- **ä»£ç å¤ç”¨**ï¼šnode_exists è°ƒç”¨ find_node_by_idï¼Œé¿å…é‡å¤

è¿™æ˜¯æˆ‘å®¡æŸ¥è¿‡çš„æœ€é«˜è´¨é‡çš„å®ç°ä¹‹ä¸€ã€‚ç»§ç»­ä¿æŒè¿™ç§å“è¶Šçš„å·¥ç¨‹æ ‡å‡†ï¼ğŸ‰

---

**å®¡æŸ¥å®Œæˆæ—¶é—´ï¼š** 2025-10-14
**å®¡æŸ¥è€…ï¼š** Quinn (Senior Developer QA)
**å®¡æŸ¥ç»“è®ºï¼š** âœ… Approved - Ready for Done
