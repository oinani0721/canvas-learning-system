# Story 15.1: FastAPIåº”ç”¨åˆå§‹åŒ–å’ŒåŸºç¡€é…ç½®

## Status
Draft

## Story

**As a** Canvas Learning Systemå¼€å‘è€…,
**I want** åˆ›å»ºFastAPIåº”ç”¨çš„åŸºç¡€æ¡†æ¶å’Œé…ç½®ç³»ç»Ÿ,
**so that** åç»­çš„APIå¼€å‘æœ‰ç»Ÿä¸€çš„é¡¹ç›®ç»“æ„å’Œé…ç½®ç®¡ç†åŸºç¡€ã€‚

## Acceptance Criteria

1. FastAPIåº”ç”¨å…¥å£æ–‡ä»¶(`backend/app/main.py`)å·²åˆ›å»ºï¼ŒåŒ…å«åº”ç”¨å®ä¾‹å’ŒåŸºç¡€é…ç½®
2. é…ç½®ç®¡ç†ç±»(`backend/app/config.py`)ä½¿ç”¨Pydantic Settingsï¼Œæ”¯æŒç¯å¢ƒå˜é‡åŠ è½½
3. å¥åº·æ£€æŸ¥ç«¯ç‚¹(`GET /api/v1/health`)è¿”å›åº”ç”¨çŠ¶æ€ä¿¡æ¯
4. CORSä¸­é—´ä»¶å·²é…ç½®ï¼Œå…è®¸Obsidianæ’ä»¶è®¿é—®
5. åŸºç¡€æ—¥å¿—ç³»ç»Ÿå·²é…ç½®
6. é¡¹ç›®ç›®å½•ç»“æ„ç¬¦åˆEpic 15æ¶æ„è®¾è®¡
7. `.env.example`å’Œ`requirements.txt`å·²åˆ›å»º
8. åº”ç”¨å¯é€šè¿‡`uvicorn app.main:app --reload`å¯åŠ¨
9. æ‰€æœ‰ä»£ç åŒ…å«æ–‡æ¡£æ¥æºæ ‡æ³¨

## Tasks / Subtasks

- [ ] Task 1: åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„ (AC: 6)
  - [ ] åˆ›å»º `backend/app/` ç›®å½•åŠæ‰€æœ‰å­ç›®å½•
  - [ ] åˆ›å»ºæ‰€æœ‰ `__init__.py` æ–‡ä»¶
  - [ ] åˆ›å»º `.env.example` ç¯å¢ƒå˜é‡æ¨¡æ¿

- [ ] Task 2: å®ç°é…ç½®ç®¡ç† (AC: 2, 7)
  - [ ] åˆ›å»º `backend/app/config.py`
  - [ ] ä½¿ç”¨ `pydantic_settings.BaseSettings` å®šä¹‰é…ç½®ç±»
  - [ ] é…ç½®é¡¹: PROJECT_NAME, VERSION, DEBUG, LOG_LEVEL, CORS_ORIGINS, CANVAS_BASE_PATH
  - [ ] å®ç° `@lru_cache` çš„ `get_settings()` å‡½æ•°
  - [ ] åˆ›å»º `requirements.txt`

- [ ] Task 3: åˆ›å»ºFastAPIåº”ç”¨å…¥å£ (AC: 1, 4, 5)
  - [ ] åˆ›å»º `backend/app/main.py`
  - [ ] åˆ›å»ºFastAPIå®ä¾‹ï¼Œé…ç½®æ ‡é¢˜ã€æè¿°ã€ç‰ˆæœ¬
  - [ ] é…ç½®CORSä¸­é—´ä»¶
  - [ ] é…ç½®åŸºç¡€æ—¥å¿—

- [ ] Task 4: å®ç°å¥åº·æ£€æŸ¥ç«¯ç‚¹ (AC: 3)
  - [ ] åˆ›å»º `backend/app/api/v1/endpoints/health.py`
  - [ ] å®ç° `GET /api/v1/health` ç«¯ç‚¹
  - [ ] è¿”å›åº”ç”¨åç§°ã€ç‰ˆæœ¬ã€çŠ¶æ€

- [ ] Task 5: é…ç½®è·¯ç”±ç³»ç»Ÿ (AC: 1)
  - [ ] åˆ›å»º `backend/app/api/v1/router.py`
  - [ ] æ³¨å†Œå¥åº·æ£€æŸ¥è·¯ç”±
  - [ ] åœ¨main.pyä¸­æ³¨å†Œv1è·¯ç”±

- [ ] Task 6: éªŒè¯å’Œæµ‹è¯• (AC: 8, 9)
  - [ ] å¯åŠ¨åº”ç”¨éªŒè¯æ— é”™è¯¯
  - [ ] æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹
  - [ ] éªŒè¯Swaggeræ–‡æ¡£å¯è®¿é—® (`/docs`)
  - [ ] ç¡®è®¤æ‰€æœ‰ä»£ç æœ‰æ–‡æ¡£æ¥æºæ ‡æ³¨

## Dev Notes

### ğŸ“‹ æŠ€æœ¯éªŒè¯æŠ¥å‘Š (Step 3.6)

**éªŒè¯å®Œæˆæ—¶é—´**: 2025-11-24
**éªŒè¯æ‰§è¡Œäºº**: SM Agent
**Quality GateçŠ¶æ€**: âœ… PASSED

#### æŠ€æœ¯æ ˆæ¸…å•

| æŠ€æœ¯æ ˆ | æŸ¥è¯¢æ–¹å¼ | éªŒè¯çŠ¶æ€ | æ–‡æ¡£ä½ç½® |
|--------|---------|---------|----------|
| FastAPI | Context7 | âœ… å·²éªŒè¯ | /websites/fastapi_tiangolo |
| Pydantic Settings | Context7 | âœ… å·²éªŒè¯ | /websites/fastapi_tiangolo (topic: settings) |
| Uvicorn | æ¶æ„æ–‡æ¡£ | âœ… å·²éªŒè¯ | EPIC-11-BACKEND-ARCHITECTURE.md |

#### æ ¸å¿ƒAPIéªŒè¯ç»“æœ

**FastAPI Application**:
- âœ… `FastAPI()` â†’ Verified from Context7:/websites/fastapi_tiangolo
  - å‚æ•°: `title`, `description`, `version`, `docs_url`, `redoc_url`, `openapi_url`
  - è¿”å›: FastAPI application instance

**Pydantic Settings**:
- âœ… `BaseSettings` â†’ Verified from Context7:/websites/fastapi_tiangolo (topic: settings)
  - æ¥æº: `from pydantic_settings import BaseSettings` (Pydantic v2)
  - è‡ªåŠ¨åŠ è½½ç¯å¢ƒå˜é‡
  - æ”¯æŒ`.env`æ–‡ä»¶

**ä¾èµ–æ³¨å…¥**:
- âœ… `@lru_cache` + `Depends` â†’ Verified from Context7:/websites/fastapi_tiangolo
  - æ¨¡å¼: ä½¿ç”¨`@lru_cache`è£…é¥°å™¨ç¡®ä¿Settingså•ä¾‹
  - ç¤ºä¾‹: `def get_settings(): return Settings()`

**CORSä¸­é—´ä»¶**:
- âœ… `CORSMiddleware` â†’ Verified from Context7:/websites/fastapi_tiangolo
  - æ¥æº: `from fastapi.middleware.cors import CORSMiddleware`
  - å‚æ•°: `allow_origins`, `allow_credentials`, `allow_methods`, `allow_headers`

### SDDè§„èŒƒå‚è€ƒ (å¿…å¡«)

**APIç«¯ç‚¹è§„èŒƒ**:
- `GET /api/v1/health` - å¥åº·æ£€æŸ¥ç«¯ç‚¹
  - [Source: specs/api/fastapi-backend-api.openapi.yml#/paths/~1api~1v1~1health]
  - å“åº”çŠ¶æ€: 200 (healthy), 500 (unhealthy)

**æ•°æ®Schemaè§„èŒƒ**:
- HealthCheckResponse:
  - [Source: specs/data/health-check-response.schema.json]
  - å­—æ®µ: `status`, `app_name`, `version`, `timestamp`
- ErrorResponse:
  - [Source: specs/data/error-response.schema.json]
  - å­—æ®µ: `code`, `message`, `details`

### æŠ€æœ¯çº¦æŸ (æ¶æ„æ–‡æ¡£å¼•ç”¨)

**æ¶æ„è®¾è®¡å‚è€ƒ**:
- ç›®å½•ç»“æ„: [Source: docs/architecture/EPIC-11-BACKEND-ARCHITECTURE.md#ç›®å½•ç»“æ„è¯¦è§£]
- APIè·¯ç”±è®¾è®¡: [Source: docs/architecture/EPIC-11-BACKEND-ARCHITECTURE.md#APIè·¯ç”±è®¾è®¡]
- æ•°æ®æ¨¡å‹: [Source: docs/architecture/EPIC-11-DATA-MODELS.md]

### ADRå†³ç­–å…³è” (å¿…å¡«)

| ADRç¼–å· | å†³ç­–æ ‡é¢˜ | å¯¹Storyçš„å½±å“ |
|---------|----------|---------------|
| ADR-008 | Testing Framework - pytest | æµ‹è¯•ä½¿ç”¨pytestæ¡†æ¶ |
| ADR-009 | Error Handlingç­–ç•¥ | é”™è¯¯å¤„ç†éµå¾ªç»Ÿä¸€æ¨¡å¼ |
| ADR-010 | Loggingèšåˆ - structlog | æ—¥å¿—ä½¿ç”¨ç»“æ„åŒ–æ ¼å¼ |

**å…³é”®çº¦æŸ**:
- å¿…é¡»ä½¿ç”¨Pydantic v2çš„`pydantic_settings`æ¨¡å—
- CORSå¿…é¡»å…è®¸Obsidianæ’ä»¶æ¥æº
- æ‰€æœ‰APIä½¿ç”¨`/api/v1/`å‰ç¼€

### ä»£ç ç¤ºä¾‹åº“

**FastAPIåº”ç”¨åˆå§‹åŒ–**:
```python
# âœ… Verified from Context7:/websites/fastapi_tiangolo (topic: settings)
from fastapi import FastAPI
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    app_name: str = "Awesome API"
    admin_email: str
    items_per_user: int = 50

settings = Settings()
app = FastAPI()
```

**Settingsä¾èµ–æ³¨å…¥**:
```python
# âœ… Verified from Context7:/websites/fastapi_tiangolo (topic: settings)
from functools import lru_cache
from fastapi import Depends, FastAPI
from .config import Settings

app = FastAPI()

@lru_cache
def get_settings():
    return Settings()

@app.get("/info")
async def info(settings: Settings = Depends(get_settings)):
    return {
        "app_name": settings.app_name,
        "admin_email": settings.admin_email,
    }
```

**æ¡ä»¶åŒ–OpenAPI**:
```python
# âœ… Verified from Context7:/websites/fastapi_tiangolo (topic: conditional-openapi)
from fastapi import FastAPI
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    openapi_url: str = "/openapi.json"

settings = Settings()
app = FastAPI(openapi_url=settings.openapi_url)
```

### é¡¹ç›®ç»“æ„å‚è€ƒ

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                 # FastAPIåº”ç”¨å…¥å£ â­
â”‚   â”œâ”€â”€ config.py               # é…ç½®ç®¡ç† â­
â”‚   â”œâ”€â”€ dependencies.py         # å…¨å±€ä¾èµ–é¡¹ (Story 15.3)
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ router.py       # è·¯ç”±æ±‡æ€» â­
â”‚   â”‚       â””â”€â”€ endpoints/
â”‚   â”‚           â”œâ”€â”€ __init__.py
â”‚   â”‚           â””â”€â”€ health.py   # å¥åº·æ£€æŸ¥ â­
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ common.py           # é€šç”¨æ¨¡å‹
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ logging.py          # æ—¥å¿—é…ç½® â­
â”‚   â””â”€â”€ middleware/
â”‚       â””â”€â”€ __init__.py
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡ç¤ºä¾‹ â­
â”œâ”€â”€ requirements.txt            # ä¾èµ– â­
â””â”€â”€ README.md
```

[Source: docs/architecture/EPIC-11-BACKEND-ARCHITECTURE.md#ç›®å½•ç»“æ„è¯¦è§£]

### Testing

**æµ‹è¯•æ–‡ä»¶ä½ç½®**: `backend/tests/`

**æµ‹è¯•æ ‡å‡†**:
- ä½¿ç”¨pytestæ¡†æ¶
- æµ‹è¯•æ–‡ä»¶å‘½å: `test_{module_name}.py`
- æµ‹è¯•å‡½æ•°å‘½å: `test_{function_name}_{scenario}`

**æœ¬Storyæµ‹è¯•è¦æ±‚**:
- æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹è¿”å›æ­£ç¡®æ•°æ®
- æµ‹è¯•é…ç½®åŠ è½½æ­£ç¡®
- æµ‹è¯•CORSé…ç½®ç”Ÿæ•ˆ

[Source: docs/architecture/coding-standards.md#æµ‹è¯•è§„èŒƒ]

### æŠ€æœ¯çº¦æŸå’Œæ³¨æ„äº‹é¡¹

**ç‰ˆæœ¬çº¦æŸ**:
- FastAPI: â‰¥0.104.0
- Pydantic: â‰¥2.5.0
- pydantic-settings: â‰¥2.0.0
- Uvicorn: â‰¥0.24.0
- Python: â‰¥3.9

**å·²çŸ¥é™åˆ¶**:
- CANVAS_BASE_PATHå¿…é¡»æŒ‡å‘æœ‰æ•ˆçš„Canvasæ–‡ä»¶ç›®å½•

**å®‰å…¨è€ƒè™‘**:
- ç”Ÿäº§ç¯å¢ƒç¦ç”¨Swaggeræ–‡æ¡£ (DEBUG=False)
- CORS_ORIGINSä½¿ç”¨ç™½åå•æ¨¡å¼

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-24 | 1.0 | Initial story draft | SM Agent |

## Dev Agent Record

### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes List
_To be filled by Dev Agent_

### File List
_To be filled by Dev Agent_

## QA Results
_To be filled by QA Agent_
