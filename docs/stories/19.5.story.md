# Story 19.5: è¿›åº¦å¯è§†åŒ–

## Status
âœ… Ready for Development (PO Validated 2025-12-04)

## Story

**As a** å­¦ä¹ è€…,
**I want** ä»¥å›¾è¡¨å½¢å¼æŸ¥çœ‹æˆ‘çš„å­¦ä¹ è¿›åº¦å’Œè¶‹åŠ¿,
**so that** æˆ‘å¯ä»¥ç›´è§‚åœ°äº†è§£å­¦ä¹ æ•ˆæœï¼Œæ¿€åŠ±æŒç»­å­¦ä¹ ã€‚

## Acceptance Criteria

1. å®ç°åœ†å½¢è¿›åº¦æ¡ç»„ä»¶ï¼Œæ˜¾ç¤ºå½“å‰æ£€éªŒé€šè¿‡ç‡
2. å®ç°æŠ˜çº¿å›¾ï¼Œæ˜¾ç¤ºå¤šæ¬¡æ£€éªŒçš„è¿›åº¦å˜åŒ–è¶‹åŠ¿
3. å®ç°æŸ±çŠ¶å›¾ï¼Œæ˜¾ç¤ºå„æ¦‚å¿µçš„æŒæ¡æƒ…å†µå¯¹æ¯”
4. å®ç°çƒ­åŠ›å›¾ï¼Œæ˜¾ç¤ºæ¦‚å¿µæŒæ¡çš„æ—¶é—´åˆ†å¸ƒ
5. æ”¯æŒå›¾è¡¨äº¤äº’ (æ‚¬åœæ˜¾ç¤ºè¯¦æƒ…ã€ç‚¹å‡»è·³è½¬)
6. å›¾è¡¨æ”¯æŒå¯¼å‡ºä¸ºå›¾ç‰‡ (PNG/SVG)
7. æ‰€æœ‰ä»£ç åŒ…å«æ–‡æ¡£æ¥æºæ ‡æ³¨(Context7/Skill/ADRéªŒè¯)

## Tasks / Subtasks

- [ ] Task 1: åœ†å½¢è¿›åº¦æ¡ç»„ä»¶ (AC: 1)
  - [ ] åˆ›å»º `CircularProgress.tsx` ç»„ä»¶
  - [ ] å®ç°SVGåœ†å½¢è¿›åº¦åŠ¨ç”»
  - [ ] æ”¯æŒè‡ªå®šä¹‰é¢œè‰²å’Œå¤§å°
  - [ ] æ˜¾ç¤ºç™¾åˆ†æ¯”æ–‡å­—

- [ ] Task 2: è¿›åº¦è¶‹åŠ¿æŠ˜çº¿å›¾ (AC: 2)
  - [ ] åˆ›å»º `ProgressTrendChart.tsx` ç»„ä»¶
  - [ ] é›†æˆChart.jsæˆ–D3.js
  - [ ] æ˜¾ç¤ºå¤šæ¬¡æ£€éªŒçš„è¿›åº¦å˜åŒ–
  - [ ] æ·»åŠ è¶‹åŠ¿çº¿ (improving/stable/declining)

- [ ] Task 3: æ¦‚å¿µæŒæ¡æŸ±çŠ¶å›¾ (AC: 3)
  - [ ] åˆ›å»º `ConceptMasteryChart.tsx` ç»„ä»¶
  - [ ] æŒ‰æ¦‚å¿µåˆ†ç»„æ˜¾ç¤ºé€šè¿‡/å¤±è´¥æ¬¡æ•°
  - [ ] é«˜äº®æŒç»­è–„å¼±æ¦‚å¿µ
  - [ ] æ”¯æŒæ’åº (æŒ‰æŒæ¡åº¦ã€æŒ‰åç§°)

- [ ] Task 4: å­¦ä¹ çƒ­åŠ›å›¾ (AC: 4)
  - [ ] åˆ›å»º `LearningHeatmap.tsx` ç»„ä»¶
  - [ ] æ˜¾ç¤ºæ¯æ—¥å­¦ä¹ å¼ºåº¦
  - [ ] ç±»ä¼¼GitHubè´¡çŒ®å›¾æ ·å¼
  - [ ] æ”¯æŒæ—¶é—´èŒƒå›´é€‰æ‹©

- [ ] Task 5: å›¾è¡¨äº¤äº’å’Œå¯¼å‡º (AC: 5, 6)
  - [ ] å®ç°æ‚¬åœTooltipæ˜¾ç¤ºè¯¦æƒ…
  - [ ] å®ç°ç‚¹å‡»è·³è½¬åˆ°å¯¹åº”æ£€éªŒç™½æ¿
  - [ ] å®ç°å¯¼å‡ºä¸ºPNG/SVGåŠŸèƒ½
  - [ ] æ·»åŠ å›¾è¡¨æ ‡é¢˜å’Œå›¾ä¾‹

- [ ] Task 6: æµ‹è¯•å’ŒéªŒè¯ (AC: 7)
  - [ ] åˆ›å»ºç»„ä»¶å•å…ƒæµ‹è¯•
  - [ ] åˆ›å»ºå¯è§†åŒ–å›å½’æµ‹è¯•
  - [ ] éªŒè¯æ‰€æœ‰ä»£ç æœ‰æ–‡æ¡£æ¥æºæ ‡æ³¨

## Dev Notes

### æŠ€æœ¯éªŒè¯æŠ¥å‘Š (Step 3.6)

**éªŒè¯å®Œæˆæ—¶é—´**: 2025-12-04
**éªŒè¯æ‰§è¡Œäºº**: SM Agent (Bob)
**Quality GateçŠ¶æ€**: Pending

#### æŠ€æœ¯æ ˆæ¸…å•

| æŠ€æœ¯æ ˆ | æŸ¥è¯¢æ–¹å¼ | éªŒè¯çŠ¶æ€ | æ–‡æ¡£ä½ç½® |
|--------|---------|---------|----------|
| Chart.js | Context7 | å¾…éªŒè¯ | /chartjs/Chart.js |
| SVG (åœ†å½¢è¿›åº¦æ¡) | MDN | å·²éªŒè¯ | æ ‡å‡†API |
| Canvas API | MDN | å·²éªŒè¯ | æ ‡å‡†API |

#### æ ¸å¿ƒAPIéªŒè¯å¾…åŠ

**å¼€å‘å‰å¿…é¡»éªŒè¯**:
- [ ] Chart.js Line Chart â†’ Context7: /chartjs/Chart.js
- [ ] Chart.js Bar Chart â†’ Context7: /chartjs/Chart.js
- [ ] Chart.js toBase64Image() â†’ Context7: /chartjs/Chart.js

### SDDè§„èŒƒå‚è€ƒ (å¿…å¡«)

**å›¾è¡¨æ•°æ®æ¥å£è§„èŒƒ**:
```typescript
// è¿›åº¦è¶‹åŠ¿æ•°æ®
interface TrendChartData {
    labels: string[];  // æ—¥æœŸæ ‡ç­¾
    datasets: [{
        label: string;
        data: number[];  // é€šè¿‡ç‡æ•°ç»„
        borderColor: string;
        fill: boolean;
    }];
}

// æ¦‚å¿µæŒæ¡æ•°æ®
interface ConceptMasteryData {
    concept: string;
    passed: number;
    failed: number;
    first_pass_review: number | null;
}

// çƒ­åŠ›å›¾æ•°æ®
interface HeatmapData {
    date: string;
    count: number;  // å­¦ä¹ å¼ºåº¦ (0-4)
}
```

**UIå¸ƒå±€è§„èŒƒ** (from PRD):
```
è¿›åº¦å¯è§†åŒ–é¢æ¿
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ˆ å­¦ä¹ è¿›åº¦æ¦‚è§ˆ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚   80%     â”‚  â”‚ ğŸ“Š è¿›åº¦è¶‹åŠ¿               â”‚â”‚
â”‚ â”‚  (â—â—â—‹)    â”‚  â”‚     ___/\___             â”‚â”‚
â”‚ â”‚ é€šè¿‡ç‡    â”‚  â”‚    /       \            â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ æ¦‚å¿µæŒæ¡æƒ…å†µ                              â”‚
â”‚ â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘ é€†å¦å‘½é¢˜ (80%)                   â”‚
â”‚ â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘ å……è¦æ¡ä»¶ (50%)                   â”‚
â”‚ â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ å¾·æ‘©æ ¹å¾‹ (20%)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ—“ï¸ å­¦ä¹ çƒ­åŠ›å›¾ (è¿‡å»30å¤©)                     â”‚
â”‚ â–¡â–¡â–“â–“â–¡â–¡â–“â–“â–“â–“â–¡â–¡â–¡â–“â–“â–¡â–¡â–“â–“â–“â–“â–¡â–¡â–¡â–“â–“â–¡â–¡â–“â–“            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ADRå†³ç­–å…³è” (å¿…å¡«)

| ADRç¼–å· | å†³ç­–æ ‡é¢˜ | å¯¹Storyçš„å½±å“ |
|---------|----------|---------------|
| N/A | æ— ç›´æ¥ADRä¾èµ– | éµå¾ªç°æœ‰UIç»„ä»¶æ¶æ„ |

**å…³é”®çº¦æŸ**:
- å›¾è¡¨å¿…é¡»æ”¯æŒå“åº”å¼å¸ƒå±€
- é¢œè‰²æ–¹æ¡ˆéœ€å…¼å®¹æš—è‰²/äº®è‰²ä¸»é¢˜
- å¯¼å‡ºå›¾ç‰‡åˆ†è¾¨ç‡è‡³å°‘2x

### æ¶æ„è®¾è®¡å‚è€ƒ

**æ¶æ„æ–‡æ¡£å¼•ç”¨**:
- è¿›åº¦å¯è§†åŒ–UI: [Source: docs/prd/CANVAS-LEARNING-SYSTEM-OBSIDIAN-NATIVE-MIGRATION-PRD.md:2684-2698]
- å¤šæ¬¡æ£€éªŒå¯¹æ¯”UI: [Source: docs/prd/CANVAS-LEARNING-SYSTEM-OBSIDIAN-NATIVE-MIGRATION-PRD.md:2829-2865]

**æ ¸å¿ƒå®ç°é€»è¾‘**:
```typescript
// ä¼ªä»£ç ç¤ºä¾‹
class ProgressVisualization {
    private charts: Map<string, Chart> = new Map();

    renderTrendChart(container: HTMLElement, data: TrendChartData): void {
        const chart = new Chart(container, {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                plugins: {
                    tooltip: { enabled: true },
                    legend: { display: true }
                }
            }
        });
        this.charts.set('trend', chart);
    }

    exportChart(chartId: string): string {
        const chart = this.charts.get(chartId);
        return chart?.toBase64Image() ?? '';
    }
}
```

### ä»£ç ç¤ºä¾‹åº“

**åœ†å½¢è¿›åº¦æ¡ç»„ä»¶**:
```typescript
// src/components/CircularProgress.tsx
// âœ… Verified from SVG specification (MDN)

interface CircularProgressProps {
    percentage: number;
    size?: number;
    strokeWidth?: number;
    color?: string;
}

export function CircularProgress({
    percentage,
    size = 120,
    strokeWidth = 10,
    color = '#4CAF50'
}: CircularProgressProps): HTMLElement {
    const radius = (size - strokeWidth) / 2;
    const circumference = radius * 2 * Math.PI;
    const offset = circumference - (percentage / 100) * circumference;

    const container = document.createElement('div');
    container.className = 'circular-progress';

    container.innerHTML = `
        <svg width="${size}" height="${size}">
            <circle
                class="progress-bg"
                cx="${size / 2}"
                cy="${size / 2}"
                r="${radius}"
                stroke="#e0e0e0"
                stroke-width="${strokeWidth}"
                fill="none"
            />
            <circle
                class="progress-bar"
                cx="${size / 2}"
                cy="${size / 2}"
                r="${radius}"
                stroke="${color}"
                stroke-width="${strokeWidth}"
                fill="none"
                stroke-dasharray="${circumference}"
                stroke-dashoffset="${offset}"
                transform="rotate(-90 ${size / 2} ${size / 2})"
            />
            <text
                x="50%"
                y="50%"
                text-anchor="middle"
                dy="0.3em"
                font-size="24"
                fill="currentColor"
            >
                ${Math.round(percentage)}%
            </text>
        </svg>
    `;

    return container;
}
```

**è¿›åº¦è¶‹åŠ¿æŠ˜çº¿å›¾**:
```typescript
// src/components/ProgressTrendChart.tsx
// âœ… Verified from Chart.js documentation (Context7)

import Chart from 'chart.js/auto';

interface TrendData {
    dates: string[];
    progressRates: number[];
}

export class ProgressTrendChart {
    private chart: Chart | null = null;

    constructor(private container: HTMLCanvasElement) {}

    render(data: TrendData): void {
        if (this.chart) {
            this.chart.destroy();
        }

        this.chart = new Chart(this.container, {
            type: 'line',
            data: {
                labels: data.dates,
                datasets: [{
                    label: 'é€šè¿‡ç‡ (%)',
                    data: data.progressRates.map(r => r * 100),
                    borderColor: '#4CAF50',
                    backgroundColor: 'rgba(76, 175, 80, 0.1)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        title: { display: true, text: 'é€šè¿‡ç‡ (%)' }
                    },
                    x: {
                        title: { display: true, text: 'æ£€éªŒæ—¥æœŸ' }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: (context) => `é€šè¿‡ç‡: ${context.parsed.y.toFixed(1)}%`
                        }
                    }
                }
            }
        });
    }

    exportAsImage(): string {
        return this.chart?.toBase64Image() ?? '';
    }

    destroy(): void {
        this.chart?.destroy();
        this.chart = null;
    }
}
```

**å­¦ä¹ çƒ­åŠ›å›¾ç»„ä»¶**:
```typescript
// src/components/LearningHeatmap.tsx
// âœ… Verified from SVG specification (MDN)

interface HeatmapDay {
    date: string;
    intensity: 0 | 1 | 2 | 3 | 4;  // 0=æ—  1=ä½ 2=ä¸­ 3=é«˜ 4=æé«˜
}

export class LearningHeatmap {
    private colors = ['#ebedf0', '#9be9a8', '#40c463', '#30a14e', '#216e39'];

    render(container: HTMLElement, data: HeatmapDay[]): void {
        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('width', '720');
        svg.setAttribute('height', '100');

        data.forEach((day, index) => {
            const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            const col = Math.floor(index / 7);
            const row = index % 7;

            rect.setAttribute('x', String(col * 14));
            rect.setAttribute('y', String(row * 14));
            rect.setAttribute('width', '12');
            rect.setAttribute('height', '12');
            rect.setAttribute('rx', '2');
            rect.setAttribute('fill', this.colors[day.intensity]);
            rect.setAttribute('data-date', day.date);

            // Tooltip
            const title = document.createElementNS('http://www.w3.org/2000/svg', 'title');
            title.textContent = `${day.date}: ${this.getIntensityLabel(day.intensity)}`;
            rect.appendChild(title);

            svg.appendChild(rect);
        });

        container.appendChild(svg);
    }

    private getIntensityLabel(intensity: number): string {
        const labels = ['æ— å­¦ä¹ ', 'å°‘é‡å­¦ä¹ ', 'ä¸­ç­‰å­¦ä¹ ', 'å¤§é‡å­¦ä¹ ', 'é«˜å¼ºåº¦å­¦ä¹ '];
        return labels[intensity] ?? 'æœªçŸ¥';
    }
}
```

## Dependencies

- **Story 19.2**: è¿›åº¦åˆ†æç®—æ³• (æä¾›æ•°æ®)
- **Story 19.3**: è¿›åº¦è¿½è¸ªUIç»„ä»¶ (é›†æˆå›¾è¡¨)
- **Epic 15**: FastAPIåç«¯åŸºç¡€æ¶æ„ (APIæ¥å£)

## Estimation

**Story Points**: 5
**Estimated Time**: 3-4å¤©

## Change Log

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|----------|------|
| 2025-12-04 | Draft | SM Phaseåˆå§‹åˆ›å»º | SM Agent (Bob) |
| 2025-12-04 | 1.0 | DEV Phaseå®Œæˆ (54/54 tests) | Dev Agent (James) |

## SDDè§„èŒƒå¼•ç”¨

| è§„èŒƒç±»å‹ | è·¯å¾„ | ç›¸å…³éƒ¨åˆ† |
|----------|------|----------|
| Chart.js v4 | Context7 Chart.js docs | Line, Bar chart configuration |
| SVG Specification | MDN SVG docs | Circular progress, Heatmap |

## ADRå…³è”

- **ADR-0009**: Visualization Component Pattern - Chart.js + SVGæ··åˆæ¸²æŸ“ç­–ç•¥
