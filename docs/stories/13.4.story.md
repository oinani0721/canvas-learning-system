# Story 13.4 - æ ¸å¿ƒå‘½ä»¤å®ç° (Core Commands)

**Epic**: Epic 13 - Obsidian Pluginæ ¸å¿ƒåŠŸèƒ½
**Story ID**: Story 13.4
**åˆ›å»ºæ—¥æœŸ**: 2025-11-30
**Storyç‚¹æ•°**: 8 Points
**é¢„ä¼°æ—¶é—´**: 5-7å¤©
**ä¼˜å…ˆçº§**: P0 (Must Have)
**ä¾èµ–**: Story 13.1 (Pluginåˆå§‹åŒ–), Story 13.2 (Canvas API), Story 13.3 (APIå®¢æˆ·ç«¯)

---

## ğŸ“‹ Storyæè¿°

å®ç°Canvas Learning System Obsidianæ’ä»¶çš„æ ¸å¿ƒå‘½ä»¤ç³»ç»Ÿï¼ŒåŒ…æ‹¬å‘½ä»¤æ³¨å†Œæ¡†æ¶å’Œæ‰€æœ‰å­¦ä¹ å‹Agentå‘½ä»¤çš„é›†æˆã€‚è¿™æ˜¯ç”¨æˆ·ä¸ç³»ç»Ÿäº¤äº’çš„ä¸»è¦å…¥å£ç‚¹ï¼Œæ¶µç›–æ‹†è§£ã€è¯„åˆ†å’Œ6ç§è§£é‡Šç±»å‘½ä»¤ã€‚

**æ ¸å¿ƒç›®æ ‡**:
- å®ç°å‘½ä»¤æ³¨å†Œç³»ç»Ÿï¼Œæ”¯æŒ14ä¸ªAgentsçš„å‘½ä»¤è°ƒç”¨
- å®ç°åŸºç¡€æ‹†è§£å‘½ä»¤ (`basic-decomposition`)
- å®ç°æ·±åº¦æ‹†è§£å‘½ä»¤ (`deep-decomposition`)
- å®ç°è¯„åˆ†å‘½ä»¤ (`scoring-agent`)
- å®ç°6ç§è§£é‡Šå‘½ä»¤ (`oral-explanation`, `clarification-path`, `comparison-table`, `memory-anchor`, `four-level-explanation`, `example-teaching`)
- æ‰€æœ‰å‘½ä»¤æ”¯æŒå¼‚æ­¥æ‰§è¡Œå’Œç»“æœå±•ç¤º

---

## ğŸ¯ ç”¨æˆ·æ•…äº‹ (User Story)

```
ä½œä¸ºObsidian Canvasç”¨æˆ·
å½“æˆ‘é€‰æ‹©ä¸€ä¸ªCanvasèŠ‚ç‚¹å
æˆ‘å¸Œæœ›é€šè¿‡å‘½ä»¤é¢æ¿æˆ–å¿«æ·é”®è°ƒç”¨AIå­¦ä¹ åŠ©æ‰‹å‘½ä»¤
ç³»ç»Ÿä¼šè°ƒç”¨ç›¸åº”çš„Agentå¤„ç†è¯¥èŠ‚ç‚¹
ç„¶åå°†ç»“æœï¼ˆæ–°èŠ‚ç‚¹ã€é¢œè‰²å˜æ›´ã€ç”Ÿæˆæ–‡æ¡£ï¼‰è‡ªåŠ¨æ›´æ–°åˆ°Canvas
è¿™æ ·æˆ‘å°±èƒ½é«˜æ•ˆåœ°è¿›è¡Œè´¹æ›¼å­¦ä¹ æ³•çš„å®è·µï¼Œç†è§£å¤æ‚æ¦‚å¿µ
```

---

## ğŸ›  æŠ€æœ¯èƒŒæ™¯

### 14ä¸ªAgentsæ¦‚è§ˆ

**å­¦ä¹ å‹Agents (12ä¸ª)**:
| Agent | åç§° | æè¿° | å‘½ä»¤ID |
|-------|------|------|--------|
| basic-decomposition | åŸºç¡€æ‹†è§£ | å°†å¤æ‚æ¦‚å¿µæ‹†è§£ä¸ºåŸºç¡€é—®é¢˜ | `canvas:basic-decompose` |
| deep-decomposition | æ·±åº¦æ‹†è§£ | æ­ç¤ºç†è§£ç›²ç‚¹ | `canvas:deep-decompose` |
| question-decomposition | é—®é¢˜æ‹†è§£ | ç”Ÿæˆçªç ´æ€§é—®é¢˜ | `canvas:question-decompose` |
| oral-explanation | å£è¯­åŒ–è§£é‡Š | æ•™æˆé£æ ¼çš„å£è¯­è§£é‡Š | `canvas:oral-explain` |
| clarification-path | æ¾„æ¸…è·¯å¾„ | ç³»ç»Ÿæ€§æ¾„æ¸…æ–‡æ¡£ | `canvas:clarify` |
| comparison-table | å¯¹æ¯”è¡¨ | ç»“æ„åŒ–æ¦‚å¿µå¯¹æ¯” | `canvas:compare` |
| memory-anchor | è®°å¿†é”šç‚¹ | ç”ŸåŠ¨ç±»æ¯”å’ŒåŠ©è®° | `canvas:memory-anchor` |
| four-level-explanation | å››å±‚æ¬¡è§£é‡Š | ä»å…¥é—¨åˆ°åˆ›æ–°çš„é€’è¿›è§£é‡Š | `canvas:four-level` |
| example-teaching | ä¾‹é¢˜æ•™å­¦ | å®Œæ•´ä¾‹é¢˜è§£ç­” | `canvas:example` |
| scoring-agent | è¯„åˆ†Agent | å››ç»´è¯„åˆ†ç³»ç»Ÿ | `canvas:score` |
| verification-question-agent | æ£€éªŒé—®é¢˜ | ç”Ÿæˆæ·±åº¦æ£€éªŒé—®é¢˜ | `canvas:verify-question` |
| canvas-orchestrator | ä¸»æ§Agent | ç¼–æ’å¤šAgentåä½œ | `canvas:orchestrate` |

**ç³»ç»Ÿçº§Agents (2ä¸ª)** (æœ¬Storyä¸ç›´æ¥æš´éœ²å‘½ä»¤):
- review-board-agent-selector - æ™ºèƒ½Agentè°ƒåº¦å™¨
- graphiti-memory-agent - çŸ¥è¯†å›¾è°±è®°å¿†æœåŠ¡

### å‘½ä»¤æ‰§è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·è§¦å‘å‘½ä»¤  â”‚     â”‚ 2. è·å–é€‰ä¸­èŠ‚ç‚¹  â”‚     â”‚ 3. æ„å»ºè¯·æ±‚     â”‚
â”‚ (å‘½ä»¤é¢æ¿/å¿«æ·é”®)â”‚ â”€â”€â–º â”‚ (Canvas API)    â”‚ â”€â”€â–º â”‚ (RequestBuilder)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æ›´æ–°Canvas   â”‚     â”‚ 5. è§£æå“åº”     â”‚     â”‚ 4. è°ƒç”¨åç«¯API  â”‚
â”‚ (æ·»åŠ èŠ‚ç‚¹/é¢œè‰²)  â”‚ â—„â”€â”€ â”‚ (ResponseParser)â”‚ â—„â”€â”€ â”‚ (ApiClient)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… éªŒæ”¶æ ‡å‡† (Acceptance Criteria)

### åŠŸèƒ½éªŒæ”¶

**AC1**: å‘½ä»¤æ³¨å†Œç³»ç»Ÿ
- [ ] æ‰€æœ‰12ä¸ªå­¦ä¹ å‹Agentå‘½ä»¤æˆåŠŸæ³¨å†Œåˆ°Obsidianå‘½ä»¤é¢æ¿
- [ ] å‘½ä»¤åç§°æ ¼å¼: `Canvas Learning: [Agentåç§°]`
- [ ] å‘½ä»¤IDæ ¼å¼: `canvas-learning:[command-id]`
- [ ] å‘½ä»¤å›¾æ ‡ä½¿ç”¨Lucide Icons

**AC2**: èŠ‚ç‚¹é€‰æ‹©æ£€æµ‹
- [ ] å‘½ä»¤æ‰§è¡Œå‰æ£€æµ‹å½“å‰æ˜¯å¦æœ‰é€‰ä¸­çš„CanvasèŠ‚ç‚¹
- [ ] æ— é€‰ä¸­èŠ‚ç‚¹æ—¶æ˜¾ç¤ºå‹å¥½æç¤º: "è¯·å…ˆåœ¨Canvasä¸­é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹"
- [ ] æ”¯æŒå•èŠ‚ç‚¹é€‰æ‹©ï¼ˆè¯„åˆ†å‘½ä»¤æ”¯æŒå¤šèŠ‚ç‚¹ï¼‰

**AC3**: åŸºç¡€æ‹†è§£å‘½ä»¤ (`canvas:basic-decompose`)
- [ ] è°ƒç”¨ `POST /agents/basic-decomposition/invoke` API
- [ ] ä¼ é€’æ­£ç¡®çš„è¯·æ±‚å‚æ•°: `{canvas_name, node_id}`
- [ ] åœ¨ç›®æ ‡èŠ‚ç‚¹ä¸‹æ–¹æ·»åŠ æ‹†è§£ç»“æœå­èŠ‚ç‚¹
- [ ] å­èŠ‚ç‚¹é¢œè‰²ä¸ºçº¢è‰²("1")ï¼Œè¡¨ç¤ºå¾…ç†è§£

**AC4**: æ·±åº¦æ‹†è§£å‘½ä»¤ (`canvas:deep-decompose`)
- [ ] è°ƒç”¨ `POST /agents/deep-decomposition/invoke` API
- [ ] åœ¨ç›®æ ‡èŠ‚ç‚¹ä¸‹æ–¹æ·»åŠ æ·±åº¦åˆ†æç»“æœèŠ‚ç‚¹
- [ ] å­èŠ‚ç‚¹é¢œè‰²ä¸ºç´«è‰²("6")ï¼Œè¡¨ç¤ºéœ€æ·±å…¥ç†è§£

**AC5**: è¯„åˆ†å‘½ä»¤ (`canvas:score`)
- [ ] è°ƒç”¨ `POST /agents/scoring-agent/invoke` API
- [ ] ä¼ é€’æ­£ç¡®çš„è¯·æ±‚å‚æ•°: `{canvas_name, node_ids, batch_mode}`
- [ ] æ”¯æŒå•èŠ‚ç‚¹å’Œæ‰¹é‡è¯„åˆ†æ¨¡å¼
- [ ] æ˜¾ç¤ºå››ç»´è¯„åˆ†ç»“æœæ¨¡æ€æ¡†ï¼ˆå‡†ç¡®æ€§ã€å½¢è±¡æ€§ã€å®Œæ•´æ€§ã€åŸåˆ›æ€§ï¼‰
- [ ] æ ¹æ®æ€»åˆ†è‡ªåŠ¨æ›´æ–°èŠ‚ç‚¹é¢œè‰²:
  - æ€»åˆ†â‰¥80: ç»¿è‰²("4") - å·²æŒæ¡
  - 60â‰¤æ€»åˆ†<80: é»„è‰²("3") - éƒ¨åˆ†ç†è§£
  - æ€»åˆ†<60: çº¢è‰²("1") - éœ€åŠ å¼º

**AC6**: è§£é‡Šç±»å‘½ä»¤ (6ä¸ª)
- [ ] å£è¯­åŒ–è§£é‡Š (`canvas:oral-explain`): è°ƒç”¨ `oral-explanation` agent
- [ ] æ¾„æ¸…è·¯å¾„ (`canvas:clarify`): è°ƒç”¨ `clarification-path` agent
- [ ] å¯¹æ¯”è¡¨ (`canvas:compare`): è°ƒç”¨ `comparison-table` agent
- [ ] è®°å¿†é”šç‚¹ (`canvas:memory-anchor`): è°ƒç”¨ `memory-anchor` agent
- [ ] å››å±‚æ¬¡è§£é‡Š (`canvas:four-level`): è°ƒç”¨ `four-level-explanation` agent
- [ ] ä¾‹é¢˜æ•™å­¦ (`canvas:example`): è°ƒç”¨ `example-teaching` agent
- [ ] æ‰€æœ‰è§£é‡Šå‘½ä»¤ç”Ÿæˆ.mdæ–‡æ¡£å¹¶åœ¨Canvasæ·»åŠ fileèŠ‚ç‚¹é“¾æ¥

**AC7**: å¼‚æ­¥æ‰§è¡Œå’Œè¿›åº¦æç¤º
- [ ] å‘½ä»¤æ‰§è¡Œæ—¶æ˜¾ç¤ºLoadingçŠ¶æ€: "æ­£åœ¨åˆ†æ..."
- [ ] ä½¿ç”¨Noticeæ˜¾ç¤ºæ‰§è¡Œè¿›åº¦
- [ ] ä»»åŠ¡å®Œæˆåæ˜¾ç¤ºæˆåŠŸæç¤º
- [ ] ä»»åŠ¡å¤±è´¥åæ˜¾ç¤ºå‹å¥½é”™è¯¯ä¿¡æ¯

**AC8**: Canvasæ›´æ–°
- [ ] æ–°èŠ‚ç‚¹ä½ç½®æ­£ç¡®ï¼ˆç›®æ ‡èŠ‚ç‚¹ä¸‹æ–¹30pxï¼‰
- [ ] æ–°èŠ‚ç‚¹ä¸ç›®æ ‡èŠ‚ç‚¹è‡ªåŠ¨è¿çº¿
- [ ] Canvasæ–‡ä»¶æ­£ç¡®ä¿å­˜

### éåŠŸèƒ½éªŒæ”¶

**AC9**: æ€§èƒ½è¦æ±‚
- [ ] å‘½ä»¤å“åº”æ—¶é—´<100msï¼ˆå‘èµ·è¯·æ±‚ï¼‰
- [ ] APIè°ƒç”¨è¶…æ—¶è®¾ç½®ä¸º60ç§’
- [ ] æ”¯æŒå–æ¶ˆæ­£åœ¨æ‰§è¡Œçš„å‘½ä»¤ï¼ˆTODO: v2ï¼‰

**AC10**: é”™è¯¯å¤„ç†
- [ ] ç½‘ç»œé”™è¯¯æ˜¾ç¤ºå‹å¥½æç¤º
- [ ] APIè¶…æ—¶æ˜¾ç¤ºé‡è¯•é€‰é¡¹
- [ ] æ‰€æœ‰é”™è¯¯è®°å½•åˆ°console.error

---

## ğŸ“ ä»»åŠ¡æ¸…å• (Task Checklist)

### Task 1: å‘½ä»¤æ³¨å†Œæ¡†æ¶ â±ï¸ 1å¤©

**æè¿°**: å®ç°åŸºç¡€å‘½ä»¤æ³¨å†Œç³»ç»Ÿ

**æŠ€æœ¯ç»†èŠ‚**:
```typescript
// âœ… Verified from Obsidian Canvas Skill (SKILL.md - Section: Commands)
// src/commands/CommandRegistry.ts

import { Plugin, Command } from 'obsidian';

interface AgentCommand {
  id: string;
  name: string;
  agentName: string;
  icon: string;
  checkCallback: (checking: boolean) => boolean | void;
}

class CommandRegistry {
  private plugin: Plugin;
  private commands: Map<string, AgentCommand> = new Map();

  constructor(plugin: Plugin) {
    this.plugin = plugin;
  }

  registerAgentCommand(cmd: AgentCommand): void {
    this.commands.set(cmd.id, cmd);
    this.plugin.addCommand({
      id: `canvas-learning:${cmd.id}`,
      name: `Canvas Learning: ${cmd.name}`,
      icon: cmd.icon,
      checkCallback: cmd.checkCallback
    });
  }

  registerAllCommands(): void {
    // æ‹†è§£ç³»åˆ—
    this.registerAgentCommand({
      id: 'basic-decompose',
      name: 'åŸºç¡€æ‹†è§£',
      agentName: 'basic-decomposition',
      icon: 'scissors',
      checkCallback: (checking) => this.handleDecomposeCommand(checking, 'basic')
    });
    // ... å…¶ä»–å‘½ä»¤
  }
}
```

**å®ç°æ­¥éª¤**:
1. [ ] åˆ›å»º `src/commands/CommandRegistry.ts`
2. [ ] åˆ›å»º `src/commands/types.ts` å®šä¹‰å‘½ä»¤ç±»å‹
3. [ ] åœ¨ `main.ts` çš„ `onload()` ä¸­åˆå§‹åŒ– CommandRegistry
4. [ ] å®ç° `getSelectedNode()` è¾…åŠ©å‡½æ•°
5. [ ] æµ‹è¯•å‘½ä»¤æ³¨å†Œï¼ˆè‡³å°‘1ä¸ªå‘½ä»¤å¯è§äºå‘½ä»¤é¢æ¿ï¼‰

**éªŒæ”¶**:
- [ ] CommandRegistryç±»æ­£å¸¸å·¥ä½œ
- [ ] å‘½ä»¤å‡ºç°åœ¨Obsidianå‘½ä»¤é¢æ¿

---

### Task 2: åŸºç¡€æ‹†è§£å’Œæ·±åº¦æ‹†è§£å‘½ä»¤ â±ï¸ 1å¤©

**æè¿°**: å®ç° basic-decomposition å’Œ deep-decomposition å‘½ä»¤

**SDDè§„èŒƒå¼•ç”¨**:
- APIç«¯ç‚¹: `POST /agents/{agentName}/invoke` (agent-api.openapi.yml:123-168)
- è¯·æ±‚Schema: specs/data/decompose-request.schema.json
- å“åº”Schema: specs/data/decompose-response.schema.json

**æŠ€æœ¯ç»†èŠ‚**:
```typescript
// âœ… Verified from agent-api.openapi.yml (AgentInvokeRequest schema)
// src/commands/DecomposeCommand.ts

interface DecomposeRequest {
  input: {
    canvas_name: string;  // Canvasæ–‡ä»¶å(ä¸å«.canvasåç¼€)
    node_id: string;      // ç›®æ ‡èŠ‚ç‚¹ID (pattern: ^[a-f0-9]+$)
  };
  timeout?: number;       // è¶…æ—¶æ—¶é—´(ç§’), é»˜è®¤60, æœ€å¤§300
}

async function executeDecompose(
  type: 'basic' | 'deep',
  canvasPath: string,
  nodeId: string
): Promise<DecomposeResult> {
  const agentName = type === 'basic' ? 'basic-decomposition' : 'deep-decomposition';

  // âœ… Verified from agent-api.openapi.yml (invokeAgent operationId)
  const response = await apiClient.post(`/agents/${agentName}/invoke`, {
    input: {
      canvas_name: canvasPath.replace('.canvas', ''),
      node_id: nodeId
    },
    timeout: 60
  });

  // å¼‚æ­¥ä»»åŠ¡ï¼Œè½®è¯¢ç»“æœ
  const taskId = response.task_id;
  return await pollTaskResult(taskId);
}
```

**å®ç°æ­¥éª¤**:
1. [ ] åˆ›å»º `src/commands/DecomposeCommand.ts`
2. [ ] å®ç° `executeBasicDecompose()` å‡½æ•°
3. [ ] å®ç° `executeDeepDecompose()` å‡½æ•°
4. [ ] å®ç°ç»“æœèŠ‚ç‚¹æ·»åŠ é€»è¾‘ï¼ˆä½¿ç”¨Story 13.2çš„Canvas APIï¼‰
5. [ ] æ·»åŠ å•å…ƒæµ‹è¯•

**Canvasæ›´æ–°é€»è¾‘**:
```typescript
// âœ… Verified from Obsidian Canvas Skill (SKILL.md - Section: Canvas JSON Operations)
// æ·»åŠ æ‹†è§£ç»“æœèŠ‚ç‚¹
async function addDecomposeResultNodes(
  canvas: CanvasData,
  targetNode: CanvasNode,
  results: DecomposeResult[]
): Promise<void> {
  const startY = targetNode.y + targetNode.height + 30;

  results.forEach((result, index) => {
    const newNode: CanvasNode = {
      id: generateNodeId(),
      type: 'text',
      text: result.question,
      x: targetNode.x,
      y: startY + index * 80,
      width: targetNode.width,
      height: 60,
      color: '1'  // çº¢è‰² - å¾…ç†è§£
    };

    canvas.nodes.push(newNode);

    // æ·»åŠ è¾¹è¿æ¥
    canvas.edges.push({
      id: generateEdgeId(),
      fromNode: targetNode.id,
      toNode: newNode.id,
      fromSide: 'bottom',
      toSide: 'top'
    });
  });
}
```

**éªŒæ”¶**:
- [ ] åŸºç¡€æ‹†è§£å‘½ä»¤æ­£å¸¸å·¥ä½œ
- [ ] æ·±åº¦æ‹†è§£å‘½ä»¤æ­£å¸¸å·¥ä½œ
- [ ] æ–°èŠ‚ç‚¹æ­£ç¡®æ·»åŠ åˆ°Canvas

---

### Task 3: è¯„åˆ†å‘½ä»¤ â±ï¸ 1.5å¤©

**æè¿°**: å®ç° scoring-agent å‘½ä»¤ï¼Œæ”¯æŒå››ç»´è¯„åˆ†å’Œé¢œè‰²æ›´æ–°

**SDDè§„èŒƒå¼•ç”¨**:
- APIç«¯ç‚¹: `POST /agents/scoring-agent/invoke` (agent-api.openapi.yml:123-168)
- è¯·æ±‚Schema: specs/data/score-request.schema.json
- å“åº”Schema: specs/data/score-response.schema.json, specs/data/scoring-response.schema.json

**æŠ€æœ¯ç»†èŠ‚**:
```typescript
// âœ… Verified from specs/data/score-request.schema.json
interface ScoreRequest {
  input: {
    canvas_name: string;
    node_ids: string[];     // æ”¯æŒæ‰¹é‡è¯„åˆ†
    batch_mode?: boolean;   // é»˜è®¤false
  };
}

// âœ… Verified from specs/data/score-response.schema.json
interface ScoreResponse {
  accuracy: number;      // 0-25 å‡†ç¡®æ€§
  imagery: number;       // 0-25 å½¢è±¡æ€§
  completeness: number;  // 0-25 å®Œæ•´æ€§
  originality: number;   // 0-25 åŸåˆ›æ€§
  total_score: number;   // 0-100 æ€»åˆ†
  color: string;         // æ¨èé¢œè‰² "1"|"3"|"4"
  recommendations: string[];  // æ¨èçš„Agentåˆ—è¡¨
}

// âœ… Verified from ADR-0001 (é¢œè‰²ç³»ç»Ÿ)
function getColorFromScore(score: number): string {
  if (score >= 80) return '4';  // ç»¿è‰² - å·²æŒæ¡
  if (score >= 60) return '3';  // é»„è‰² - éƒ¨åˆ†ç†è§£
  return '1';                    // çº¢è‰² - éœ€åŠ å¼º
}
```

**è¯„åˆ†ç»“æœæ¨¡æ€æ¡†**:
```typescript
// âœ… Verified from Obsidian Canvas Skill (SKILL.md - Section: Modals)
// src/modals/ScoreResultModal.ts

class ScoreResultModal extends Modal {
  private result: ScoreResponse;

  onOpen() {
    const { contentEl } = this;
    contentEl.addClass('score-result-modal');

    contentEl.createEl('h2', { text: 'è¯„åˆ†ç»“æœ' });

    // æ€»åˆ†æ˜¾ç¤º
    const scoreEl = contentEl.createDiv('total-score');
    scoreEl.createEl('span', {
      text: `${this.result.total_score}/100`,
      cls: this.getScoreClass(this.result.total_score)
    });

    // å››ç»´é›·è¾¾å›¾
    this.renderDimensions(contentEl);

    // æ¨èAgent
    if (this.result.recommendations.length > 0) {
      this.renderRecommendations(contentEl);
    }

    // å…³é—­æŒ‰é’®
    const closeBtn = contentEl.createEl('button', { text: 'å…³é—­' });
    closeBtn.onclick = () => this.close();
  }

  private renderDimensions(container: Element): void {
    const dims = [
      { name: 'å‡†ç¡®æ€§', value: this.result.accuracy, max: 25 },
      { name: 'å½¢è±¡æ€§', value: this.result.imagery, max: 25 },
      { name: 'å®Œæ•´æ€§', value: this.result.completeness, max: 25 },
      { name: 'åŸåˆ›æ€§', value: this.result.originality, max: 25 }
    ];

    const section = container.createDiv('dimensions');
    dims.forEach(dim => {
      const row = section.createDiv('dimension-row');
      row.createSpan({ text: dim.name });
      const bar = row.createDiv('progress-bar');
      bar.createDiv('progress-fill').style.width = `${(dim.value/dim.max)*100}%`;
      row.createSpan({ text: `${dim.value}/${dim.max}` });
    });
  }
}
```

**å®ç°æ­¥éª¤**:
1. [ ] åˆ›å»º `src/commands/ScoreCommand.ts`
2. [ ] åˆ›å»º `src/modals/ScoreResultModal.ts`
3. [ ] å®ç°å•èŠ‚ç‚¹è¯„åˆ†é€»è¾‘
4. [ ] å®ç°æ‰¹é‡è¯„åˆ†é€»è¾‘ï¼ˆå¤šèŠ‚ç‚¹é€‰æ‹©ï¼‰
5. [ ] å®ç°èŠ‚ç‚¹é¢œè‰²è‡ªåŠ¨æ›´æ–°
6. [ ] æ·»åŠ å•å…ƒæµ‹è¯•

**éªŒæ”¶**:
- [ ] è¯„åˆ†å‘½ä»¤æ­£å¸¸å·¥ä½œ
- [ ] è¯„åˆ†ç»“æœæ¨¡æ€æ¡†æ­£ç¡®æ˜¾ç¤º
- [ ] èŠ‚ç‚¹é¢œè‰²æ ¹æ®åˆ†æ•°æ­£ç¡®æ›´æ–°

---

### Task 4: è§£é‡Šç±»å‘½ä»¤ (6ä¸ª) â±ï¸ 2å¤©

**æè¿°**: å®ç°6ç§è§£é‡Šç±»Agentå‘½ä»¤

**SDDè§„èŒƒå¼•ç”¨**:
- APIç«¯ç‚¹: `POST /agents/{agentName}/invoke` (agent-api.openapi.yml:123-168)
- è¯·æ±‚Schema: specs/data/explain-request.schema.json
- å“åº”Schema: specs/data/explain-response.schema.json

**æŠ€æœ¯ç»†èŠ‚**:
```typescript
// âœ… Verified from specs/data/explain-request.schema.json
interface ExplainRequest {
  input: {
    canvas_name: string;
    node_id: string;
    explain_type: 'oral' | 'clarification' | 'comparison' | 'memory' | 'four-level' | 'example';
    context?: string;  // é¢å¤–ä¸Šä¸‹æ–‡(å¯é€‰)
  };
}

// Agentåˆ°explain_typeçš„æ˜ å°„
const EXPLAIN_TYPE_MAP: Record<string, string> = {
  'oral-explanation': 'oral',
  'clarification-path': 'clarification',
  'comparison-table': 'comparison',
  'memory-anchor': 'memory',
  'four-level-explanation': 'four-level',
  'example-teaching': 'example'
};

async function executeExplain(
  agentName: string,
  canvasPath: string,
  nodeId: string
): Promise<ExplainResult> {
  const explainType = EXPLAIN_TYPE_MAP[agentName];

  // âœ… Verified from agent-api.openapi.yml
  const response = await apiClient.post(`/agents/${agentName}/invoke`, {
    input: {
      canvas_name: canvasPath.replace('.canvas', ''),
      node_id: nodeId,
      explain_type: explainType
    },
    timeout: 120  // è§£é‡Šç±»å‘½ä»¤å¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´
  });

  const taskId = response.task_id;
  return await pollTaskResult(taskId);
}
```

**è§£é‡Šç»“æœå¤„ç†**:
```typescript
// âœ… Verified from Obsidian Canvas Skill (SKILL.md - Section: File Nodes)
// è§£é‡Šå‘½ä»¤ç”Ÿæˆ.mdæ–‡æ¡£å¹¶æ·»åŠ fileèŠ‚ç‚¹
async function handleExplainResult(
  canvas: CanvasData,
  targetNode: CanvasNode,
  result: ExplainResult,
  agentName: string
): Promise<void> {
  // 1. ç”Ÿæˆ.mdæ–‡æ¡£
  const fileName = `${targetNode.text?.slice(0, 20)}_${agentName}_${Date.now()}.md`;
  const filePath = `Canvasè§£é‡Šæ–‡æ¡£/${fileName}`;
  await createFile(filePath, result.content);

  // 2. æ·»åŠ è“è‰²è¯´æ˜èŠ‚ç‚¹
  const blueNode: CanvasNode = {
    id: generateNodeId(),
    type: 'text',
    text: `[${getAgentDisplayName(agentName)}] ${new Date().toLocaleString()}`,
    x: targetNode.x + targetNode.width + 30,
    y: targetNode.y,
    width: 200,
    height: 40,
    color: '5'  // é’è‰²/è“è‰² - AIè§£é‡Š
  };

  // 3. æ·»åŠ fileèŠ‚ç‚¹
  const fileNode: CanvasNode = {
    id: generateNodeId(),
    type: 'file',
    file: filePath,
    x: blueNode.x,
    y: blueNode.y + 50,
    width: 200,
    height: 100
  };

  canvas.nodes.push(blueNode, fileNode);

  // 4. æ·»åŠ è¿æ¥è¾¹
  canvas.edges.push(
    { id: generateEdgeId(), fromNode: targetNode.id, toNode: blueNode.id, fromSide: 'right', toSide: 'left' },
    { id: generateEdgeId(), fromNode: blueNode.id, toNode: fileNode.id, fromSide: 'bottom', toSide: 'top' }
  );
}
```

**å®ç°æ­¥éª¤**:
1. [ ] åˆ›å»º `src/commands/ExplainCommand.ts`
2. [ ] å®ç°é€šç”¨ `executeExplain()` å‡½æ•°
3. [ ] ä¸º6ç§è§£é‡Šç±»å‹æ³¨å†Œå‘½ä»¤
4. [ ] å®ç°.mdæ–‡æ¡£ç”Ÿæˆé€»è¾‘
5. [ ] å®ç°fileèŠ‚ç‚¹æ·»åŠ é€»è¾‘
6. [ ] æ·»åŠ å•å…ƒæµ‹è¯•

**6ä¸ªè§£é‡Šå‘½ä»¤è¯¦æƒ…**:

| å‘½ä»¤ID | Agent | å›¾æ ‡ | è¾“å‡ºæ ¼å¼ |
|--------|-------|------|----------|
| oral-explain | oral-explanation | message-circle | å£è¯­åŒ–æ–‡æ¡£ (800-1200å­—) |
| clarify | clarification-path | map | 4æ­¥æ¾„æ¸…æ–‡æ¡£ (1500+å­—) |
| compare | comparison-table | table | Markdownè¡¨æ ¼ |
| memory-anchor | memory-anchor | anchor | ç±»æ¯”/æ•…äº‹/å£è¯€ |
| four-level | four-level-explanation | layers | 4çº§é€’è¿›è§£é‡Š |
| example | example-teaching | book-open | ä¾‹é¢˜+è¯¦è§£ |

**éªŒæ”¶**:
- [ ] æ‰€æœ‰6ä¸ªè§£é‡Šå‘½ä»¤æ­£å¸¸å·¥ä½œ
- [ ] .mdæ–‡æ¡£æ­£ç¡®ç”Ÿæˆ
- [ ] fileèŠ‚ç‚¹æ­£ç¡®æ·»åŠ åˆ°Canvas

---

### Task 5: å¼‚æ­¥ä»»åŠ¡ç®¡ç† â±ï¸ 1å¤©

**æè¿°**: å®ç°ä»»åŠ¡è½®è¯¢å’Œè¿›åº¦å±•ç¤º

**SDDè§„èŒƒå¼•ç”¨**:
- ä»»åŠ¡çŠ¶æ€API: `GET /agents/tasks/{taskId}` (agent-api.openapi.yml:169-199)
- ä»»åŠ¡çŠ¶æ€æšä¸¾: `pending | running | completed | failed | timeout`

**æŠ€æœ¯ç»†èŠ‚**:
```typescript
// âœ… Verified from agent-api.openapi.yml (TaskStatus schema)
interface TaskStatus {
  task_id: string;
  status: 'pending' | 'running' | 'completed' | 'failed' | 'timeout';
  agent_name: string;
  created_at: string;
  started_at?: string;
  completed_at?: string;
  result?: any;
  error?: {
    type: string;
    message: string;
    details?: any;
  };
  progress?: number;  // 0-100
}

// ä»»åŠ¡è½®è¯¢å™¨
async function pollTaskResult(
  taskId: string,
  maxAttempts: number = 60,
  intervalMs: number = 1000
): Promise<any> {
  let attempts = 0;

  while (attempts < maxAttempts) {
    // âœ… Verified from agent-api.openapi.yml (getTaskStatus operationId)
    const status = await apiClient.get<TaskStatus>(`/agents/tasks/${taskId}`);

    switch (status.status) {
      case 'completed':
        return status.result;
      case 'failed':
        throw new Error(`Agentæ‰§è¡Œå¤±è´¥: ${status.error?.message}`);
      case 'timeout':
        throw new Error('Agentæ‰§è¡Œè¶…æ—¶ï¼Œè¯·é‡è¯•');
      case 'pending':
      case 'running':
        // æ›´æ–°è¿›åº¦æç¤º
        if (status.progress) {
          updateProgressNotice(`å¤„ç†ä¸­... ${status.progress}%`);
        }
        await sleep(intervalMs);
        attempts++;
        break;
    }
  }

  throw new Error('ä»»åŠ¡è½®è¯¢è¶…æ—¶');
}
```

**è¿›åº¦æç¤º**:
```typescript
// âœ… Verified from Obsidian Canvas Skill (SKILL.md - Section: Notice)
import { Notice } from 'obsidian';

let currentNotice: Notice | null = null;

function showProgressNotice(message: string): void {
  if (currentNotice) {
    // @ts-ignore - Obsidianå†…éƒ¨API
    currentNotice.setMessage(message);
  } else {
    currentNotice = new Notice(message, 0);  // 0 = ä¸è‡ªåŠ¨æ¶ˆå¤±
  }
}

function hideProgressNotice(): void {
  if (currentNotice) {
    currentNotice.hide();
    currentNotice = null;
  }
}

function showSuccessNotice(message: string): void {
  hideProgressNotice();
  new Notice(message, 5000);
}

function showErrorNotice(message: string): void {
  hideProgressNotice();
  new Notice(`âŒ ${message}`, 10000);
}
```

**å®ç°æ­¥éª¤**:
1. [ ] åˆ›å»º `src/services/TaskPoller.ts`
2. [ ] å®ç° `pollTaskResult()` å‡½æ•°
3. [ ] å®ç°è¿›åº¦Noticeç®¡ç†
4. [ ] é›†æˆåˆ°æ‰€æœ‰å‘½ä»¤ä¸­
5. [ ] æ·»åŠ å•å…ƒæµ‹è¯•

**éªŒæ”¶**:
- [ ] ä»»åŠ¡è½®è¯¢æ­£å¸¸å·¥ä½œ
- [ ] è¿›åº¦æç¤ºæ­£ç¡®æ˜¾ç¤º
- [ ] è¶…æ—¶å’Œé”™è¯¯æ­£ç¡®å¤„ç†

---

### Task 6: é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ â±ï¸ 0.5å¤©

**æè¿°**: å®Œå–„é”™è¯¯å¤„ç†

**SDDè§„èŒƒå¼•ç”¨**:
- é”™è¯¯å“åº”Schema: specs/data/error-response.schema.json
- ADR-009: é”™è¯¯å¤„ç†å’Œé‡è¯•ç­–ç•¥

**æŠ€æœ¯ç»†èŠ‚**:
```typescript
// âœ… Verified from specs/data/error-response.schema.json
interface ErrorResponse {
  error: string;    // é”™è¯¯ç±»å‹
  message: string;  // é”™è¯¯è¯¦æƒ…
  details?: any;    // é¢å¤–ä¿¡æ¯
}

// é”™è¯¯å¤„ç†åŒ…è£…å™¨
async function executeWithErrorHandling<T>(
  operation: () => Promise<T>,
  context: string
): Promise<T | null> {
  try {
    showProgressNotice(`æ­£åœ¨${context}...`);
    const result = await operation();
    showSuccessNotice(`${context}å®Œæˆï¼`);
    return result;
  } catch (error) {
    if (error instanceof NetworkError) {
      showErrorNotice('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡');
    } else if (error instanceof TimeoutError) {
      showErrorNotice('æ“ä½œè¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•');
    } else if (error instanceof ApiError) {
      showErrorNotice(`APIé”™è¯¯: ${error.message}`);
    } else {
      showErrorNotice(`æœªçŸ¥é”™è¯¯: ${error.message}`);
      console.error(`[Canvas Learning] ${context}å¤±è´¥:`, error);
    }
    return null;
  }
}
```

**è¾¹ç•Œæƒ…å†µ**:
- [ ] æ— é€‰ä¸­èŠ‚ç‚¹ â†’ "è¯·å…ˆåœ¨Canvasä¸­é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹"
- [ ] é€‰ä¸­èŠ‚ç‚¹ä¸æ˜¯æ–‡æœ¬èŠ‚ç‚¹ â†’ "è¯·é€‰æ‹©æ–‡æœ¬èŠ‚ç‚¹è¿›è¡Œåˆ†æ"
- [ ] ç½‘ç»œæ–­å¼€ â†’ "ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡"
- [ ] APIè¶…æ—¶ â†’ "æ“ä½œè¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•"
- [ ] Agentæ‰§è¡Œå¤±è´¥ â†’ æ˜¾ç¤ºå…·ä½“é”™è¯¯ä¿¡æ¯

**éªŒæ”¶**:
- [ ] æ‰€æœ‰è¾¹ç•Œæƒ…å†µæœ‰å‹å¥½æç¤º
- [ ] é”™è¯¯ä¸ä¼šå¯¼è‡´Pluginå´©æºƒ

---

## ğŸ”— ä¾èµ–å…³ç³»

### ä¾èµ–çš„Story

| Story | ä¾èµ–å†…å®¹ | çŠ¶æ€ |
|-------|----------|------|
| Story 13.1 | Pluginæ¡†æ¶ã€TypeScripté…ç½® | â³ å¾…å®Œæˆ |
| Story 13.2 | Canvas API (readCanvas, writeCanvas, addNodes) | â³ å¾…å®Œæˆ |
| Story 13.3 | ApiClient (HTTPè¯·æ±‚å°è£…) | â³ å¾…å®Œæˆ |

### è¢«ä¾èµ–çš„Story

| Story | ä½¿ç”¨å†…å®¹ |
|-------|----------|
| Story 13.5 | å³é”®èœå•å¤ç”¨å‘½ä»¤å¤„ç†é€»è¾‘ |
| Story 13.8 | æ™ºèƒ½å¹¶è¡Œå¤„ç†å¤ç”¨æ‰¹é‡å‘½ä»¤é€»è¾‘ |

---

## ğŸ“š SDDè§„èŒƒå¼•ç”¨ (Dev Notes)

### OpenAPIè§„èŒƒ

| è§„èŒƒæ–‡ä»¶ | ç›¸å…³ç«¯ç‚¹ | ç”¨é€” |
|----------|----------|------|
| `specs/api/agent-api.openapi.yml:71-99` | `GET /agents` | è·å–æ‰€æœ‰Agentå…ƒæ•°æ® |
| `specs/api/agent-api.openapi.yml:101-122` | `GET /agents/{agentName}` | è·å–æŒ‡å®šAgentå…ƒæ•°æ® |
| `specs/api/agent-api.openapi.yml:123-168` | `POST /agents/{agentName}/invoke` | è°ƒç”¨Agent (å¼‚æ­¥) |
| `specs/api/agent-api.openapi.yml:169-199` | `GET /agents/tasks/{taskId}` | æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ |
| `specs/api/canvas-api.openapi.yml:247-266` | `POST /agents/invoke` | åŒæ­¥Agentè°ƒç”¨ (å¤‡é€‰) |

### JSON Schemaè§„èŒƒ

| Schemaæ–‡ä»¶ | ç”¨é€” |
|------------|------|
| `specs/data/decompose-request.schema.json` | æ‹†è§£è¯·æ±‚éªŒè¯ |
| `specs/data/decompose-response.schema.json` | æ‹†è§£å“åº”è§£æ |
| `specs/data/score-request.schema.json` | è¯„åˆ†è¯·æ±‚éªŒè¯ |
| `specs/data/score-response.schema.json` | è¯„åˆ†å“åº”è§£æ |
| `specs/data/explain-request.schema.json` | è§£é‡Šè¯·æ±‚éªŒè¯ |
| `specs/data/explain-response.schema.json` | è§£é‡Šå“åº”è§£æ |
| `specs/data/agent-response.schema.json` | é€šç”¨Agentå“åº” |
| `specs/data/error-response.schema.json` | é”™è¯¯å“åº”å¤„ç† |

### ADRå¼•ç”¨

| ADR | ç›¸å…³å†³ç­– |
|-----|----------|
| `docs/architecture/decisions/0001-use-obsidian-canvas.md` | Canvasé¢œè‰²ç³»ç»Ÿ: "1"=çº¢, "2"=æ©™, "3"=é»„, "4"=ç»¿, "5"=é’, "6"=ç´« |
| `docs/architecture/decisions/0002-langgraph-agents.md` | 14ä¸ªAgentæ¶æ„è®¾è®¡ |
| `docs/architecture/decisions/ADR-009-ERROR-HANDLING-RETRY-STRATEGY.md` | é”™è¯¯å¤„ç†å’Œé‡è¯•ç­–ç•¥ |

### æ¶æ„æ–‡æ¡£å¼•ç”¨

| æ–‡æ¡£ | ç›¸å…³Section |
|------|-------------|
| `docs/architecture/obsidian-plugin-architecture.md:406-445` | å‘½ä»¤æ³¨å†Œæ¨¡å¼ |
| `docs/architecture/obsidian-plugin-architecture.md:260-295` | Canvasäº‹ä»¶ç³»ç»Ÿ |
| `docs/architecture/ui-component-architecture.md:594-688` | Agenté€‰æ‹©å™¨ç»„ä»¶ |

---

## ğŸ“Š æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•

| æµ‹è¯•ID | æµ‹è¯•å†…å®¹ | è¦†ç›–æ–‡ä»¶ |
|--------|----------|----------|
| UT-13.4-01 | CommandRegistryæ³¨å†Œæµ‹è¯• | CommandRegistry.ts |
| UT-13.4-02 | èŠ‚ç‚¹é€‰æ‹©æ£€æµ‹æµ‹è¯• | utils.ts |
| UT-13.4-03 | æ‹†è§£è¯·æ±‚æ„å»ºæµ‹è¯• | DecomposeCommand.ts |
| UT-13.4-04 | è¯„åˆ†è¯·æ±‚æ„å»ºæµ‹è¯• | ScoreCommand.ts |
| UT-13.4-05 | è§£é‡Šè¯·æ±‚æ„å»ºæµ‹è¯• | ExplainCommand.ts |
| UT-13.4-06 | ä»»åŠ¡è½®è¯¢æµ‹è¯• | TaskPoller.ts |
| UT-13.4-07 | é¢œè‰²æ˜ å°„æµ‹è¯• | utils.ts |
| UT-13.4-08 | é”™è¯¯å¤„ç†æµ‹è¯• | errorHandler.ts |

### é›†æˆæµ‹è¯•

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ |
|--------|----------|
| IT-13.4-01 | å®Œæ•´æ‹†è§£å‘½ä»¤æµç¨‹ (é€‰æ‹©èŠ‚ç‚¹â†’è°ƒç”¨APIâ†’æ›´æ–°Canvas) |
| IT-13.4-02 | å®Œæ•´è¯„åˆ†å‘½ä»¤æµç¨‹ (é€‰æ‹©èŠ‚ç‚¹â†’è°ƒç”¨APIâ†’æ˜¾ç¤ºæ¨¡æ€æ¡†â†’æ›´æ–°é¢œè‰²) |
| IT-13.4-03 | å®Œæ•´è§£é‡Šå‘½ä»¤æµç¨‹ (é€‰æ‹©èŠ‚ç‚¹â†’è°ƒç”¨APIâ†’ç”Ÿæˆæ–‡æ¡£â†’æ·»åŠ fileèŠ‚ç‚¹) |
| IT-13.4-04 | æ‰¹é‡è¯„åˆ†æµç¨‹ (å¤šèŠ‚ç‚¹é€‰æ‹©â†’æ‰¹é‡è°ƒç”¨â†’æ‰¹é‡æ›´æ–°) |
| IT-13.4-05 | é”™è¯¯æ¢å¤æµç¨‹ (ç½‘ç»œæ–­å¼€â†’æ˜¾ç¤ºé”™è¯¯â†’é‡è¯•æˆåŠŸ) |

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ–°å»ºæ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | æè¿° | é¢„è®¡è¡Œæ•° |
|----------|------|----------|
| `src/commands/CommandRegistry.ts` | å‘½ä»¤æ³¨å†Œä¸­å¿ƒ | ~150è¡Œ |
| `src/commands/types.ts` | å‘½ä»¤ç±»å‹å®šä¹‰ | ~50è¡Œ |
| `src/commands/DecomposeCommand.ts` | æ‹†è§£å‘½ä»¤å®ç° | ~120è¡Œ |
| `src/commands/ScoreCommand.ts` | è¯„åˆ†å‘½ä»¤å®ç° | ~180è¡Œ |
| `src/commands/ExplainCommand.ts` | è§£é‡Šå‘½ä»¤å®ç° | ~200è¡Œ |
| `src/modals/ScoreResultModal.ts` | è¯„åˆ†ç»“æœæ¨¡æ€æ¡† | ~150è¡Œ |
| `src/services/TaskPoller.ts` | ä»»åŠ¡è½®è¯¢æœåŠ¡ | ~100è¡Œ |
| `src/utils/noticeManager.ts` | Noticeç®¡ç†å™¨ | ~50è¡Œ |

### ä¿®æ”¹æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹å†…å®¹ |
|----------|----------|
| `src/main.ts` | æ·»åŠ CommandRegistryåˆå§‹åŒ– |
| `src/services/ApiClient.ts` | æ·»åŠ Agentè°ƒç”¨æ–¹æ³• (ä¾èµ–Story 13.3) |

---

## âš ï¸ é£é™©å’Œç¼“è§£ç­–ç•¥

### é£é™©1: Agentå“åº”æ—¶é—´ä¸ç¡®å®š âš ï¸ ä¸­é£é™©

**æè¿°**: ä¸åŒAgentçš„æ‰§è¡Œæ—¶é—´å·®å¼‚è¾ƒå¤§ï¼ˆè¯„åˆ†<30sï¼Œè§£é‡Šå¯èƒ½>60sï¼‰

**ç¼“è§£ç­–ç•¥**:
- ä¸ºä¸åŒAgentç±»å‹è®¾ç½®ä¸åŒçš„timeoutå€¼
- å®ç°è¿›åº¦æç¤ºï¼Œè®©ç”¨æˆ·çŸ¥é“ç³»ç»Ÿåœ¨å·¥ä½œ
- æ”¯æŒå–æ¶ˆåŠŸèƒ½ï¼ˆv2ï¼‰

### é£é™©2: Canvasæ–‡ä»¶å¹¶å‘ä¿®æ”¹ âš ï¸ ä¸­é£é™©

**æè¿°**: ç”¨æˆ·å¯èƒ½åœ¨å‘½ä»¤æ‰§è¡ŒæœŸé—´æ‰‹åŠ¨ä¿®æ”¹Canvas

**ç¼“è§£ç­–ç•¥**:
- åœ¨ä¿®æ”¹å‰é‡æ–°è¯»å–Canvasæ–‡ä»¶
- ä½¿ç”¨ä¹è§‚é”æˆ–ç‰ˆæœ¬å·æœºåˆ¶ï¼ˆv2ï¼‰
- å†²çªæ—¶æç¤ºç”¨æˆ·

### é£é™©3: ç½‘ç»œä¸ç¨³å®š âš ï¸ ä½é£é™©

**æè¿°**: ç½‘ç»œæ–­å¼€å¯¼è‡´ä»»åŠ¡çŠ¶æ€ä¸¢å¤±

**ç¼“è§£ç­–ç•¥**:
- å®ç°è‡ªåŠ¨é‡è¿
- ä¿å­˜task_idåˆ°æœ¬åœ°ï¼Œæ”¯æŒæ¢å¤æŸ¥è¯¢
- å‹å¥½çš„é”™è¯¯æç¤º

---

## ğŸ“ Storyå®Œæˆå®šä¹‰ (Definition of Done)

- [ ] æ‰€æœ‰6ä¸ªTaskå®Œæˆå¹¶é€šè¿‡Code Review
- [ ] æ‰€æœ‰10ä¸ªéªŒæ”¶æ ‡å‡†(AC1-AC10)é€šè¿‡
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡â‰¥80%
- [ ] é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] æ‰€æœ‰SDDè§„èŒƒå¼•ç”¨å·²éªŒè¯ï¼ˆOpenAPIã€JSON Schemaï¼‰
- [ ] ä»£ç åŒ…å«Skill/Context7æ¥æºæ³¨é‡Š
- [ ] æ— P0/P1çº§åˆ«çš„bug
- [ ] æŠ€æœ¯æ–‡æ¡£æ›´æ–°ï¼ˆREADMEä¸­æ·»åŠ å‘½ä»¤åˆ—è¡¨ï¼‰

---

## ğŸ‰ Storyä»·å€¼

**ç”¨æˆ·ä»·å€¼**:
- é€šè¿‡å‘½ä»¤é¢æ¿å¿«é€Ÿè°ƒç”¨14ä¸ªAIå­¦ä¹ åŠ©æ‰‹
- ä¸€é”®æ‹†è§£å¤æ‚æ¦‚å¿µï¼Œé™ä½å­¦ä¹ é—¨æ§›
- å››ç»´è¯„åˆ†ç³»ç»Ÿæä¾›å®¢è§‚çš„ç†è§£è¯„ä¼°
- å¤šç§è§£é‡Šæ–¹å¼æ»¡è¶³ä¸åŒå­¦ä¹ é£æ ¼

**æŠ€æœ¯ä»·å€¼**:
- å»ºç«‹å‘½ä»¤æ³¨å†Œæ¡†æ¶ï¼Œåç»­å‘½ä»¤å¯å¤ç”¨
- å¼‚æ­¥ä»»åŠ¡ç®¡ç†æœºåˆ¶å¯å¤ç”¨åˆ°å…¶ä»–åŠŸèƒ½
- é”™è¯¯å¤„ç†æ¨¡å¼ç»Ÿä¸€ï¼Œæå‡ä»£ç è´¨é‡

---

**Storyåˆ›å»ºæ—¥æœŸ**: 2025-11-30
**Storyä½œè€…**: SM Agent (Bob)
**å®¡æ‰¹çŠ¶æ€**: â³ å¾…å®¡æ ¸
