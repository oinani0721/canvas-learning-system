# Story 1.6: CanvasåŸå­å†™å…¥ä¸å¤‡ä»½

## Status
Done

## Story

**As a** ç³»ç»Ÿæ ¸å¿ƒæ¨¡å—,
**I want** å®‰å…¨åœ°å†™å…¥Canvasæ–‡ä»¶å¹¶è‡ªåŠ¨å¤‡ä»½,
**so that** åœ¨å‡ºé”™æ—¶æ¢å¤æ•°æ®ï¼Œç¡®ä¿ç”¨æˆ·æ•°æ®æ°¸ä¸ä¸¢å¤±ã€‚

## Acceptance Criteria

1. æ¯æ¬¡ä¿®æ”¹å‰è‡ªåŠ¨åˆ›å»ºå¤‡ä»½æ–‡ä»¶
2. å¤‡ä»½æ–‡ä»¶å‘½åæ ¼å¼ï¼š`[åŸæ–‡ä»¶å].backup.[æ—¶é—´æˆ³].canvas`
3. è‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½ï¼ˆä»…ä¿ç•™æœ€è¿‘3ä¸ªï¼‰
4. ä½¿ç”¨åŸå­å†™å…¥ï¼ˆä¸´æ—¶æ–‡ä»¶â†’é‡å‘½åï¼‰
5. å†™å…¥æ“ä½œè€—æ—¶<1s

## Tasks / Subtasks

- [x] Task 1: å®ç°å¤‡ä»½æ–‡ä»¶ç®¡ç†åŠŸèƒ½ (AC: 1, 2, 3)
  - [x] å®ç° `create_backup(canvas_path: str) -> str` å‡½æ•°
  - [x] ç”Ÿæˆå¤‡ä»½æ–‡ä»¶åæ ¼å¼ï¼š`{basename}.backup.{timestamp}.canvas`
  - [x] å®ç° `cleanup_old_backups(canvas_path: str, keep_count: int = 3)` å‡½æ•°
  - [x] ä½¿ç”¨globæŸ¥æ‰¾æ‰€æœ‰å¤‡ä»½æ–‡ä»¶å¹¶æŒ‰æ—¶é—´æ’åº
  - [x] åˆ é™¤è¶…è¿‡keep_countçš„æ—§å¤‡ä»½æ–‡ä»¶
  - [x] æ·»åŠ å®Œæ•´çš„ç±»å‹æ³¨è§£å’ŒGoogle Style Docstring

- [x] Task 2: å®ç°åŸå­å†™å…¥åŠŸèƒ½ (AC: 4)
  - [x] å®ç° `write_canvas_atomic(canvas_path: str, canvas_data: Dict) -> None` å‡½æ•°
  - [x] å…ˆå†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼š`{canvas_path}.tmp`
  - [x] éªŒè¯JSONæ ¼å¼æ­£ç¡®æ€§
  - [x] ä½¿ç”¨ `os.replace()` åŸå­é‡å‘½åï¼ˆWindows/Unixå…¼å®¹ï¼‰
  - [x] å¤„ç†æ‰€æœ‰å¯èƒ½çš„å¼‚å¸¸æƒ…å†µ
  - [x] æ·»åŠ å®Œæ•´çš„ç±»å‹æ³¨è§£å’ŒGoogle Style Docstring

- [x] Task 3: å¢å¼º CanvasJSONOperator.write_canvas æ–¹æ³• (AC: 1-5)
  - [x] åœ¨ CanvasJSONOperator ç±»ä¸­æ·»åŠ é™æ€æ–¹æ³• `write_canvas(canvas_path: str, canvas_data: Dict) -> None`
  - [x] è°ƒç”¨ `create_backup()` åœ¨å†™å…¥å‰è‡ªåŠ¨å¤‡ä»½
  - [x] è°ƒç”¨ `write_canvas_atomic()` è¿›è¡ŒåŸå­å†™å…¥
  - [x] è°ƒç”¨ `cleanup_old_backups()` æ¸…ç†æ—§å¤‡ä»½
  - [x] ç¡®ä¿æ•´ä¸ªæµç¨‹ç¬¦åˆæ€§èƒ½è¦æ±‚ï¼ˆ<1sï¼‰
  - [x] æ·»åŠ é”™è¯¯å¤„ç†å’Œæ—¥å¿—

- [x] Task 4: æ·»åŠ å¤‡ä»½æ¢å¤åŠŸèƒ½ï¼ˆå¯é€‰ä½†æ¨èï¼‰
  - [x] å®ç° `list_backups(canvas_path: str) -> List[Tuple[str, datetime]]` å‡½æ•°
  - [x] å®ç° `restore_from_backup(canvas_path: str, backup_path: str) -> None` å‡½æ•°
  - [x] æ·»åŠ æ–‡æ¡£å­—ç¬¦ä¸²è¯´æ˜æ¢å¤æµç¨‹

- [x] Task 5: å•å…ƒæµ‹è¯• (ALL AC)
  - [x] æµ‹è¯• `create_backup()` åˆ›å»ºæ­£ç¡®æ ¼å¼çš„å¤‡ä»½æ–‡ä»¶
  - [x] æµ‹è¯• `cleanup_old_backups()` ä¿ç•™æœ€è¿‘3ä¸ªå¤‡ä»½
  - [x] æµ‹è¯• `cleanup_old_backups()` åˆ é™¤è¶…è¿‡3ä¸ªçš„æ—§å¤‡ä»½
  - [x] æµ‹è¯• `write_canvas_atomic()` åˆ›å»ºä¸´æ—¶æ–‡ä»¶
  - [x] æµ‹è¯• `write_canvas_atomic()` åŸå­é‡å‘½åæˆåŠŸ
  - [x] æµ‹è¯• `write_canvas_atomic()` JSONéªŒè¯å¤±è´¥æ—¶çš„é”™è¯¯å¤„ç†
  - [x] æµ‹è¯• `write_canvas()` å®Œæ•´æµç¨‹ï¼šå¤‡ä»½â†’å†™å…¥â†’æ¸…ç†
  - [x] æµ‹è¯•å†™å…¥æ“ä½œæ€§èƒ½ï¼ˆç¡®ä¿<1sï¼‰
  - [x] æµ‹è¯•å¤‡ä»½æ–‡ä»¶å‘½åæ ¼å¼æ­£ç¡®æ€§
  - [x] æµ‹è¯•å¹¶å‘å†™å…¥çš„å®‰å…¨æ€§ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
  - [x] ç¡®ä¿æµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%

## Dev Notes

### Previous Story Insights

ä» Story 1.1-1.5 ä¸­å­¦åˆ°çš„ç»éªŒï¼š

- âœ… **é™æ€æ–¹æ³•è®¾è®¡**ï¼šLayer 1 çš„æ‰€æœ‰æ–¹æ³•éƒ½åº”è¯¥æ˜¯é™æ€æ–¹æ³•æˆ–æ¨¡å—çº§å‡½æ•°ï¼Œæ— çŠ¶æ€è®¾è®¡
- âœ… **å¸¸é‡åŒ–è®¾è®¡**ï¼šå°†æ‰€æœ‰é­”æ³•å€¼å®šä¹‰ä¸ºå¸¸é‡ï¼Œæé«˜å¯ç»´æŠ¤æ€§
- âœ… **ç±»å‹æ³¨è§£**ï¼šå®Œæ•´çš„ç±»å‹æ³¨è§£ï¼ˆåŒ…æ‹¬ Dict, List, Optional, Tuple ç­‰ï¼‰æå¤§æå‡ä»£ç å¯è¯»æ€§
- âœ… **Google Style Docstring**ï¼šè¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²åŒ…æ‹¬ Argsã€Returnsã€Raisesã€Example
- âœ… **é”™è¯¯å¤„ç†**ï¼šæ˜ç¡®çš„é”™è¯¯ç±»å‹å’Œæœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯
- âœ… **ä¼˜é›…é™çº§**ï¼šå¯¹äºæŸ¥è¯¢ç±»å‡½æ•°ï¼Œè¿”å› None è€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸
- âœ… **æ€§èƒ½ä¼˜å…ˆ**ï¼šå…³é”®æ“ä½œéœ€è¦æ€§èƒ½æµ‹è¯•éªŒè¯

### æ¶æ„èƒŒæ™¯

**Layer 1 èŒè´£** [Source: architecture/canvas-3-layer-architecture.md#Layer 1]

Layer 1 (CanvasJSONOperator) è´Ÿè´£ï¼š
- Canvas JSONæ–‡ä»¶çš„è¯»å†™
- èŠ‚ç‚¹å’Œè¾¹çš„CRUDæ“ä½œ
- **ä¸åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘**
- **çº¯å‡½æ•°å¼ï¼Œæ— çŠ¶æ€ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•**

å½“å‰ CanvasJSONOperator å·²å®ç°ï¼š
- `read_canvas()` - è¯»å–Canvasæ–‡ä»¶ï¼ˆStory 1.1å®Œæˆï¼‰
- èŠ‚ç‚¹CRUDæ“ä½œï¼ˆStory 1.3å®Œæˆï¼‰
- è¾¹æ“ä½œï¼ˆStory 1.4å®Œæˆï¼‰

æœ¬Storyå°†æ·»åŠ ï¼š
- `write_canvas()` - å®‰å…¨å†™å…¥Canvasæ–‡ä»¶ï¼ˆ**åŸå­å†™å…¥ + è‡ªåŠ¨å¤‡ä»½**ï¼‰

### åŸå­å†™å…¥æŠ€æœ¯ç»†èŠ‚

**ä¸ºä»€ä¹ˆéœ€è¦åŸå­å†™å…¥ï¼Ÿ** [Source: architecture/tech-stack.md#æ–‡ä»¶å®‰å…¨]

é—®é¢˜åœºæ™¯ï¼š
- å¦‚æœç›´æ¥å†™å…¥Canvasæ–‡ä»¶ï¼Œå†™å…¥è¿‡ç¨‹ä¸­ç¨‹åºå´©æºƒæˆ–æ–­ç”µï¼Œä¼šå¯¼è‡´æ–‡ä»¶æŸå
- JSONæ–‡ä»¶å¯èƒ½å†™å…¥ä¸€åŠï¼Œå˜æˆæ— æ•ˆJSON
- ç”¨æˆ·å¯èƒ½å¤±å»æ‰€æœ‰å­¦ä¹ æ•°æ®

è§£å†³æ–¹æ¡ˆï¼š**å…ˆå†™ä¸´æ—¶æ–‡ä»¶ï¼ŒéªŒè¯ååŸå­é‡å‘½å**

```python
# åŸå­å†™å…¥æµç¨‹
1. å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼š{canvas_path}.tmp
2. éªŒè¯JSONæ ¼å¼æ­£ç¡®
3. ä½¿ç”¨ os.replace() åŸå­é‡å‘½åï¼š
   - åœ¨åŒä¸€æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œè¿™æ˜¯åŸå­æ“ä½œ
   - å³ä½¿ä¸­é€”ä¸­æ–­ï¼Œè¦ä¹ˆæ˜¯æ—§æ–‡ä»¶ï¼Œè¦ä¹ˆæ˜¯æ–°æ–‡ä»¶
   - ä¸ä¼šå‡ºç°åŠå†™å…¥çŠ¶æ€
```

**å…³é”®API**: `os.replace(src, dst)`
- Python 3.3+ å¯ç”¨
- Windowså’ŒUnixéƒ½æ”¯æŒ
- åŸå­æ€§ä¿è¯ï¼šç›®æ ‡æ–‡ä»¶è¦ä¹ˆæ˜¯æ—§å†…å®¹ï¼Œè¦ä¹ˆæ˜¯æ–°å†…å®¹ï¼Œä¸ä¼šæŸå

### å¤‡ä»½ç­–ç•¥

**å¤‡ä»½æ–‡ä»¶å‘½å** [Source: PRD Epic 1 Story 1.6]

æ ¼å¼ï¼š`{basename}.backup.{timestamp}.canvas`

ç¤ºä¾‹ï¼š
```
ç¦»æ•£æ•°å­¦.canvas  â†’  ç¦»æ•£æ•°å­¦.backup.20250114153025.canvas
```

æ—¶é—´æˆ³æ ¼å¼ï¼š`YYYYMMDDHHmmss`ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰

**å¤‡ä»½æ¸…ç†ç­–ç•¥**

- æ¯æ¬¡å†™å…¥åï¼Œä¿ç•™æœ€è¿‘3ä¸ªå¤‡ä»½
- ä½¿ç”¨ `glob.glob()` æŸ¥æ‰¾æ‰€æœ‰å¤‡ä»½æ–‡ä»¶
- æŒ‰æ–‡ä»¶ä¿®æ”¹æ—¶é—´æ’åºï¼ˆ`os.path.getmtime()`ï¼‰
- åˆ é™¤è¶…è¿‡3ä¸ªçš„æœ€æ—§å¤‡ä»½

**ä¸ºä»€ä¹ˆæ˜¯3ä¸ªï¼Ÿ**
- å¤ªå°‘ï¼šæ— æ³•åº”å¯¹å¤šæ¬¡é”™è¯¯æ“ä½œ
- å¤ªå¤šï¼šå ç”¨ç£ç›˜ç©ºé—´ï¼ŒCanvasæ–‡ä»¶å¯èƒ½10-50KB
- 3ä¸ªæ˜¯åˆç†å¹³è¡¡ç‚¹ï¼ˆå¯ä»¥å›é€€åˆ°3ä¸ªç‰ˆæœ¬ä¹‹å‰ï¼‰

### æ–‡ä»¶ä½ç½®

**ä»£ç æ–‡ä»¶** [Source: architecture/unified-project-structure.md#canvas_utils.py]

ä¿®æ”¹æ–‡ä»¶ï¼š`C:/Users/ROG/æ‰˜ç¦/canvas_utils.py`ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰

åœ¨ `CanvasJSONOperator` ç±»ä¸­æ·»åŠ ï¼š
- é™æ€æ–¹æ³• `write_canvas(canvas_path: str, canvas_data: Dict) -> None`

è¾…åŠ©å‡½æ•°ï¼ˆæ¨¡å—çº§æˆ–ä½œä¸ºç§æœ‰é™æ€æ–¹æ³•ï¼‰ï¼š
- `create_backup(canvas_path: str) -> str`
- `cleanup_old_backups(canvas_path: str, keep_count: int) -> None`
- `write_canvas_atomic(canvas_path: str, canvas_data: Dict) -> None`
- `list_backups(canvas_path: str) -> List[Tuple[str, datetime]]` (å¯é€‰)
- `restore_from_backup(canvas_path: str, backup_path: str) -> None` (å¯é€‰)

**é¡¹ç›®ç»“æ„**
```
C:/Users/ROG/æ‰˜ç¦/
â”œâ”€â”€ canvas_utils.py        # â­ æœ¬ Story ä¿®æ”¹æ­¤æ–‡ä»¶
â”‚                          #    åœ¨ CanvasJSONOperator ç±»æ·»åŠ  write_canvas
â””â”€â”€ tests/
    â””â”€â”€ test_canvas_utils.py  # â­ æœ¬ Story æ·»åŠ æ–°æµ‹è¯•ç”¨ä¾‹
```

### ä»£ç è®¾è®¡è§„èŒƒ

**å¸¸é‡å®šä¹‰** [Source: architecture/coding-standards.md#å¸¸é‡å®šä¹‰]

åœ¨ `canvas_utils.py` é¡¶éƒ¨æ·»åŠ å¤‡ä»½ç›¸å…³å¸¸é‡ï¼š

```python
# ========== æ–‡ä»¶å¤‡ä»½å¸¸é‡ ==========
BACKUP_SUFFIX = ".backup"        # å¤‡ä»½æ–‡ä»¶åç¼€
BACKUP_KEEP_COUNT = 3            # ä¿ç•™çš„å¤‡ä»½æ•°é‡
TEMP_FILE_SUFFIX = ".tmp"        # ä¸´æ—¶æ–‡ä»¶åç¼€
BACKUP_TIMESTAMP_FORMAT = "%Y%m%d%H%M%S"  # æ—¶é—´æˆ³æ ¼å¼
```

**å‡½æ•°ç­¾åç¤ºä¾‹** [Source: architecture/coding-standards.md#ç±»å‹æ³¨è§£]

```python
import glob
import shutil
from datetime import datetime
from pathlib import Path

def create_backup(canvas_path: str) -> str:
    """åˆ›å»ºCanvasæ–‡ä»¶çš„å¤‡ä»½å‰¯æœ¬

    Args:
        canvas_path: Canvasæ–‡ä»¶è·¯å¾„

    Returns:
        str: å¤‡ä»½æ–‡ä»¶è·¯å¾„

    Raises:
        FileNotFoundError: å¦‚æœæºæ–‡ä»¶ä¸å­˜åœ¨

    Example:
        >>> backup_path = create_backup("test.canvas")
        >>> print(backup_path)
        'test.backup.20250114153025.canvas'
    """
    pass

def cleanup_old_backups(canvas_path: str, keep_count: int = BACKUP_KEEP_COUNT) -> None:
    """æ¸…ç†æ—§çš„å¤‡ä»½æ–‡ä»¶ï¼Œåªä¿ç•™æœ€è¿‘çš„Nä¸ª

    Args:
        canvas_path: Canvasæ–‡ä»¶è·¯å¾„
        keep_count: è¦ä¿ç•™çš„å¤‡ä»½æ•°é‡ï¼ˆé»˜è®¤3ä¸ªï¼‰

    Example:
        >>> cleanup_old_backups("test.canvas", keep_count=3)
        # åˆ é™¤è¶…è¿‡3ä¸ªçš„æ—§å¤‡ä»½
    """
    pass

def write_canvas_atomic(canvas_path: str, canvas_data: Dict[str, Any]) -> None:
    """åŸå­å†™å…¥Canvasæ–‡ä»¶ï¼ˆä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ï¼‰

    Args:
        canvas_path: Canvasæ–‡ä»¶è·¯å¾„
        canvas_data: Canvas JSONæ•°æ®

    Raises:
        ValueError: å¦‚æœcanvas_dataæ ¼å¼ä¸æ­£ç¡®
        IOError: å¦‚æœæ–‡ä»¶å†™å…¥å¤±è´¥

    Example:
        >>> canvas_data = {"nodes": [], "edges": []}
        >>> write_canvas_atomic("test.canvas", canvas_data)
    """
    pass
```

**CanvasJSONOperator.write_canvas å®ç°**

```python
class CanvasJSONOperator:
    # ... ç°æœ‰æ–¹æ³• ...

    @staticmethod
    def write_canvas(canvas_path: str, canvas_data: Dict[str, Any]) -> None:
        """å°†Canvasæ•°æ®å®‰å…¨å†™å…¥æ–‡ä»¶ï¼ˆè‡ªåŠ¨å¤‡ä»½ + åŸå­å†™å…¥ï¼‰

        å®Œæ•´æµç¨‹ï¼š
        1. åˆ›å»ºå¤‡ä»½æ–‡ä»¶ï¼ˆå¦‚æœåŸæ–‡ä»¶å­˜åœ¨ï¼‰
        2. åŸå­å†™å…¥Canvasæ–‡ä»¶
        3. æ¸…ç†æ—§å¤‡ä»½ï¼ˆåªä¿ç•™æœ€è¿‘3ä¸ªï¼‰

        Args:
            canvas_path: Canvasæ–‡ä»¶è·¯å¾„
            canvas_data: Canvas JSONæ•°æ®ï¼Œå¿…é¡»åŒ…å« 'nodes' å’Œ 'edges' å­—æ®µ

        Raises:
            ValueError: å¦‚æœcanvas_dataæ ¼å¼ä¸æ­£ç¡®
            IOError: å¦‚æœæ–‡ä»¶å†™å…¥å¤±è´¥

        Example:
            >>> canvas_data = {"nodes": [], "edges": []}
            >>> CanvasJSONOperator.write_canvas("test.canvas", canvas_data)
            # è‡ªåŠ¨å®Œæˆï¼šå¤‡ä»½ â†’ åŸå­å†™å…¥ â†’ æ¸…ç†æ—§å¤‡ä»½
        """
        # 1. åˆ›å»ºå¤‡ä»½ï¼ˆå¦‚æœæ–‡ä»¶å­˜åœ¨ï¼‰
        if os.path.exists(canvas_path):
            create_backup(canvas_path)

        # 2. åŸå­å†™å…¥
        write_canvas_atomic(canvas_path, canvas_data)

        # 3. æ¸…ç†æ—§å¤‡ä»½
        cleanup_old_backups(canvas_path)
```

### é”™è¯¯å¤„ç†è¦æ±‚

**å¿…é¡»å¤„ç†çš„å¼‚å¸¸æƒ…å†µ** [Source: architecture/coding-standards.md#é”™è¯¯å¤„ç†]

1. **æ–‡ä»¶ä¸å­˜åœ¨** (`FileNotFoundError`)
   - å¤‡ä»½æ—¶ï¼Œæºæ–‡ä»¶ä¸å­˜åœ¨ â†’ è·³è¿‡å¤‡ä»½ï¼Œç›´æ¥å†™å…¥
   - æ¢å¤æ—¶ï¼Œå¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨ â†’ æŠ›å‡º FileNotFoundError

2. **JSONæ ¼å¼é”™è¯¯** (`json.JSONDecodeError`)
   - å†™å…¥å‰éªŒè¯ canvas_data æ ¼å¼
   - ç¼ºå°‘ 'nodes' æˆ– 'edges' å­—æ®µ â†’ ValueError

3. **ç£ç›˜ç©ºé—´ä¸è¶³** (`IOError`)
   - å†™å…¥ä¸´æ—¶æ–‡ä»¶å¤±è´¥ â†’ IOError with message
   - ä¿ç•™åŸæ–‡ä»¶ï¼Œä¸è¿›è¡Œé‡å‘½å

4. **æƒé™é”™è¯¯** (`PermissionError`)
   - æ— æ³•åˆ›å»ºä¸´æ—¶æ–‡ä»¶ â†’ PermissionError
   - æ— æ³•é‡å‘½åæ–‡ä»¶ â†’ PermissionError

5. **åŸå­é‡å‘½åå¤±è´¥** (`OSError`)
   - os.replace() å¤±è´¥ â†’ æ¸…ç†ä¸´æ—¶æ–‡ä»¶
   - ç¡®ä¿ä¸ç•™ä¸‹åƒåœ¾æ–‡ä»¶

### æ€§èƒ½è¦æ±‚

**ç›®æ ‡æ€§èƒ½** [Source: PRD Epic 1 Story 1.6]

- å†™å…¥æ“ä½œæ€»è€—æ—¶ï¼š**< 1ç§’**
- åŒ…æ‹¬ï¼šå¤‡ä»½ + åŸå­å†™å…¥ + æ¸…ç†æ—§å¤‡ä»½

**æ€§èƒ½ä¼˜åŒ–å»ºè®®**

1. **å‡å°‘æ–‡ä»¶I/Oæ¬¡æ•°**
   - å¤‡ä»½ä½¿ç”¨ `shutil.copy2()` è€Œéé€å­—èŠ‚å¤åˆ¶
   - ä¸€æ¬¡æ€§å†™å…¥JSONï¼Œä½¿ç”¨ `json.dump()` è€Œéå¤šæ¬¡å†™å…¥

2. **JSONæ ¼å¼åŒ–æ§åˆ¶**
   - ä½¿ç”¨ `indent=2` ä¾¿äºé˜…è¯»
   - ä½¿ç”¨ `ensure_ascii=False` æ”¯æŒä¸­æ–‡
   - ä¸ä½¿ç”¨ `sort_keys`ï¼ˆæ— å¿…è¦ï¼Œä¸”å¢åŠ å¼€é”€ï¼‰

3. **å¤‡ä»½æ¸…ç†ä¼˜åŒ–**
   - åªåœ¨å†™å…¥æˆåŠŸåæ¸…ç†
   - ä½¿ç”¨ `os.path.getmtime()` è€Œéæ‰“å¼€æ–‡ä»¶
   - globæŸ¥æ‰¾é™å®šåœ¨å¤‡ä»½æ–‡ä»¶ï¼ˆä½¿ç”¨æ­£ç¡®çš„patternï¼‰

**æ€§èƒ½æµ‹è¯•è¦æ±‚**
```python
def test_write_canvas_performance(self):
    """æµ‹è¯•å†™å…¥æ“ä½œæ€§èƒ½ï¼ˆå¿…é¡»<1ç§’ï¼‰"""
    canvas_data = {"nodes": [...], "edges": [...]}  # æ¨¡æ‹Ÿä¸­ç­‰è§„æ¨¡Canvas

    start_time = time.time()
    CanvasJSONOperator.write_canvas("test.canvas", canvas_data)
    elapsed = time.time() - start_time

    assert elapsed < 1.0, f"å†™å…¥è€—æ—¶ {elapsed:.2f}sï¼Œè¶…è¿‡1ç§’è¦æ±‚"
```

### ç¼–ç è§„èŒƒ

**PEP 8è§„èŒƒ** [Source: architecture/coding-standards.md#Pythonç¼–ç è§„èŒƒ]

- ä½¿ç”¨4ä¸ªç©ºæ ¼ç¼©è¿›
- æ¯è¡Œæœ€å¤š79å­—ç¬¦
- ä½¿ç”¨UTF-8ç¼–ç 
- å‡½æ•°åï¼šsnake_caseï¼ˆå¦‚ `create_backup`, `write_canvas_atomic`ï¼‰
- å¸¸é‡ï¼šUPPER_SNAKE_CASEï¼ˆå¦‚ `BACKUP_SUFFIX`, `BACKUP_KEEP_COUNT`ï¼‰

**å¯¼å…¥è¯­å¥é¡ºåº**
```python
# æ ‡å‡†åº“
import glob
import json
import os
import shutil
import time
from datetime import datetime
from pathlib import Path
from typing import Any, Dict, List, Optional, Tuple

# ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚æœæœ‰ï¼‰

# æœ¬åœ°æ¨¡å—ï¼ˆå¦‚æœæœ‰ï¼‰
```

### Testing

**æµ‹è¯•æ–‡ä»¶ä½ç½®** [Source: architecture/coding-standards.md#æµ‹è¯•è§„èŒƒ]

- æµ‹è¯•æ–‡ä»¶è·¯å¾„ï¼š`tests/test_canvas_utils.py`
- åœ¨ç°æœ‰æ–‡ä»¶ä¸­æ·»åŠ æ–°çš„æµ‹è¯•ç±»

**æµ‹è¯•æ¡†æ¶å’Œå·¥å…·**

- ä¸»æµ‹è¯•æ¡†æ¶ï¼špytestï¼ˆStory 1.1 å·²å®‰è£…ï¼‰
- è¦†ç›–ç‡å·¥å…·ï¼špytest-cov
- å®‰è£…å‘½ä»¤ï¼š`pip install pytest pytest-cov`ï¼ˆå·²å®‰è£…ï¼‰

**æµ‹è¯•æ ‡å‡†**

- æ–‡ä»¶I/Oæ¨¡å—è¦†ç›–ç‡ç›®æ ‡ï¼šâ‰¥ 90%
- æ‰€æœ‰å…¬å…±å‡½æ•°å¿…é¡»æœ‰æµ‹è¯•ç”¨ä¾‹
- æµ‹è¯•è¾¹ç•Œæƒ…å†µå’Œé”™è¯¯è¾“å…¥
- å¿…é¡»åŒ…å«æ€§èƒ½æµ‹è¯•

**è¿è¡Œå‘½ä»¤**
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/test_canvas_utils.py

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=canvas_utils tests/test_canvas_utils.py

# ç”ŸæˆHTMLæ ¼å¼çš„è¯¦ç»†è¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=canvas_utils --cov-report=html tests/test_canvas_utils.py
```

**æœ¬ Story çš„æµ‹è¯•è¦æ±‚**

åˆ›å»ºæ–°çš„æµ‹è¯•ç±»ï¼ˆæˆ–æ‰©å±•ç°æœ‰æµ‹è¯•ç±»ï¼‰ï¼š

```python
class TestCanvasFileIO:
    """æµ‹è¯•Canvasæ–‡ä»¶I/Oå’Œå¤‡ä»½ç³»ç»Ÿ"""

    def setup_method(self):
        """æ¯ä¸ªæµ‹è¯•å‰çš„è®¾ç½®"""
        self.test_canvas_path = "tests/fixtures/test-write.canvas"
        self.test_canvas_data = {
            "nodes": [
                {"id": "node-1", "type": "text", "text": "Test", "x": 0, "y": 0, "width": 400, "height": 300}
            ],
            "edges": []
        }

    def teardown_method(self):
        """æ¯ä¸ªæµ‹è¯•åçš„æ¸…ç†"""
        # æ¸…ç†æµ‹è¯•æ–‡ä»¶å’Œå¤‡ä»½
        cleanup_test_files(self.test_canvas_path)

    def test_create_backup_success(self):
        """æµ‹è¯•æˆåŠŸåˆ›å»ºå¤‡ä»½æ–‡ä»¶"""
        # å…ˆåˆ›å»ºåŸå§‹æ–‡ä»¶
        CanvasJSONOperator.write_canvas(self.test_canvas_path, self.test_canvas_data)

        # åˆ›å»ºå¤‡ä»½
        backup_path = create_backup(self.test_canvas_path)

        # éªŒè¯å¤‡ä»½æ–‡ä»¶å­˜åœ¨
        assert os.path.exists(backup_path)
        # éªŒè¯å¤‡ä»½æ–‡ä»¶åæ ¼å¼
        assert ".backup." in backup_path
        assert backup_path.endswith(".canvas")

    def test_backup_file_naming_format(self):
        """æµ‹è¯•å¤‡ä»½æ–‡ä»¶å‘½åæ ¼å¼æ­£ç¡®æ€§"""
        backup_path = create_backup(self.test_canvas_path)
        # æå–æ—¶é—´æˆ³éƒ¨åˆ†å¹¶éªŒè¯æ ¼å¼
        # æ ¼å¼ï¼š{basename}.backup.YYYYMMDDHHmmss.canvas
        import re
        pattern = r'\.backup\.(\d{14})\.canvas$'
        match = re.search(pattern, backup_path)
        assert match is not None, "å¤‡ä»½æ–‡ä»¶åæ ¼å¼ä¸æ­£ç¡®"

    def test_cleanup_old_backups_keep_3(self):
        """æµ‹è¯•æ¸…ç†æ—§å¤‡ä»½åªä¿ç•™æœ€è¿‘3ä¸ª"""
        # åˆ›å»º5ä¸ªå¤‡ä»½æ–‡ä»¶
        for i in range(5):
            create_backup(self.test_canvas_path)
            time.sleep(0.1)  # ç¡®ä¿æ—¶é—´æˆ³ä¸åŒ

        # æ¸…ç†
        cleanup_old_backups(self.test_canvas_path, keep_count=3)

        # éªŒè¯åªå‰©3ä¸ªå¤‡ä»½
        backups = list_backups(self.test_canvas_path)
        assert len(backups) == 3

    def test_atomic_write_creates_temp_file(self):
        """æµ‹è¯•åŸå­å†™å…¥åˆ›å»ºä¸´æ—¶æ–‡ä»¶"""
        # ç›‘æ§ä¸´æ—¶æ–‡ä»¶åˆ›å»º
        temp_path = self.test_canvas_path + TEMP_FILE_SUFFIX

        write_canvas_atomic(self.test_canvas_path, self.test_canvas_data)

        # éªŒè¯ä¸´æ—¶æ–‡ä»¶å·²è¢«æ¸…ç†ï¼ˆé‡å‘½åä¸ºæ­£å¼æ–‡ä»¶ï¼‰
        assert not os.path.exists(temp_path)
        assert os.path.exists(self.test_canvas_path)

    def test_atomic_write_json_validation(self):
        """æµ‹è¯•åŸå­å†™å…¥çš„JSONéªŒè¯"""
        invalid_data = {"nodes": "not a list"}  # é”™è¯¯çš„æ ¼å¼

        with pytest.raises(ValueError):
            write_canvas_atomic(self.test_canvas_path, invalid_data)

    def test_write_canvas_complete_flow(self):
        """æµ‹è¯•write_canvaså®Œæ•´æµç¨‹ï¼šå¤‡ä»½â†’å†™å…¥â†’æ¸…ç†"""
        # ç¬¬ä¸€æ¬¡å†™å…¥
        CanvasJSONOperator.write_canvas(self.test_canvas_path, self.test_canvas_data)
        assert os.path.exists(self.test_canvas_path)

        # ç¬¬äºŒæ¬¡å†™å…¥ï¼ˆåº”è¯¥åˆ›å»ºå¤‡ä»½ï¼‰
        self.test_canvas_data["nodes"].append(
            {"id": "node-2", "type": "text", "text": "Test 2", "x": 100, "y": 100, "width": 400, "height": 300}
        )
        CanvasJSONOperator.write_canvas(self.test_canvas_path, self.test_canvas_data)

        # éªŒè¯å¤‡ä»½å­˜åœ¨
        backups = list_backups(self.test_canvas_path)
        assert len(backups) >= 1

    def test_write_canvas_performance(self):
        """æµ‹è¯•å†™å…¥æ“ä½œæ€§èƒ½ï¼ˆå¿…é¡»<1ç§’ï¼‰"""
        # åˆ›å»ºä¸­ç­‰è§„æ¨¡çš„Canvasæ•°æ®ï¼ˆ50ä¸ªèŠ‚ç‚¹ï¼‰
        large_canvas_data = {
            "nodes": [
                {
                    "id": f"node-{i}",
                    "type": "text",
                    "text": f"Test Node {i}",
                    "x": i * 100,
                    "y": i * 50,
                    "width": 400,
                    "height": 300
                }
                for i in range(50)
            ],
            "edges": []
        }

        start_time = time.time()
        CanvasJSONOperator.write_canvas(self.test_canvas_path, large_canvas_data)
        elapsed = time.time() - start_time

        assert elapsed < 1.0, f"å†™å…¥è€—æ—¶ {elapsed:.2f}sï¼Œè¶…è¿‡1ç§’è¦æ±‚"

    def test_list_backups_returns_sorted_list(self):
        """æµ‹è¯•list_backupsè¿”å›æŒ‰æ—¶é—´æ’åºçš„å¤‡ä»½åˆ—è¡¨"""
        # åˆ›å»ºå¤šä¸ªå¤‡ä»½
        for i in range(3):
            create_backup(self.test_canvas_path)
            time.sleep(0.1)

        backups = list_backups(self.test_canvas_path)

        # éªŒè¯è¿”å›åˆ—è¡¨æŒ‰æ—¶é—´é™åºæ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
        timestamps = [dt for _, dt in backups]
        assert timestamps == sorted(timestamps, reverse=True)

    def test_restore_from_backup(self):
        """æµ‹è¯•ä»å¤‡ä»½æ¢å¤æ–‡ä»¶"""
        # åˆ›å»ºåŸå§‹æ–‡ä»¶
        original_data = {"nodes": [{"id": "original"}], "edges": []}
        CanvasJSONOperator.write_canvas(self.test_canvas_path, original_data)

        # åˆ›å»ºå¤‡ä»½
        backup_path = create_backup(self.test_canvas_path)

        # ä¿®æ”¹åŸæ–‡ä»¶
        modified_data = {"nodes": [{"id": "modified"}], "edges": []}
        CanvasJSONOperator.write_canvas(self.test_canvas_path, modified_data)

        # ä»å¤‡ä»½æ¢å¤
        restore_from_backup(self.test_canvas_path, backup_path)

        # éªŒè¯æ¢å¤åçš„å†…å®¹
        restored_data = CanvasJSONOperator.read_canvas(self.test_canvas_path)
        assert restored_data["nodes"][0]["id"] == "original"
```

**æµ‹è¯•è¦†ç›–ç‡è¦æ±‚**

- æ‰€æœ‰æ–‡ä»¶I/Oå‡½æ•°å¿…é¡»æµ‹è¯•
- æµ‹è¯•æœ‰æ•ˆè¾“å…¥å’Œæ— æ•ˆè¾“å…¥
- æµ‹è¯•è¾¹ç•Œæƒ…å†µï¼ˆ0ä¸ªå¤‡ä»½ã€1ä¸ªå¤‡ä»½ã€å¤§é‡å¤‡ä»½ï¼‰
- æµ‹è¯•é”™è¯¯å¤„ç†ï¼ˆæ–‡ä»¶ä¸å­˜åœ¨ã€æƒé™é”™è¯¯ã€ç£ç›˜ç©ºé—´ä¸è¶³ï¼‰
- æµ‹è¯•æ€§èƒ½ï¼ˆ<1sè¦æ±‚ï¼‰
- ç¡®ä¿æµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%

## Dev Agent Record

### Agent Model Used
- Primary Model: claude-sonnet-4-5-20250929
- Development Date: 2025-10-14

### Debug Log References
æ— é‡å¤§Bugæˆ–é˜»å¡é—®é¢˜ã€‚æ‰€æœ‰æµ‹è¯•é€šè¿‡ã€‚

### Completion Notes
1. **å®ç°çš„åŠŸèƒ½**ï¼š
   - å¤‡ä»½æ–‡ä»¶ç®¡ç†ï¼šcreate_backup(), list_backups(), cleanup_old_backups()
   - åŸå­å†™å…¥ï¼šwrite_canvas_atomic()
   - å¤‡ä»½æ¢å¤ï¼šrestore_from_backup()
   - CanvasJSONOperator.write_canvas() é™æ€æ–¹æ³•

2. **å…³é”®è®¾è®¡å†³ç­–**ï¼š
   - æ—¶é—´æˆ³æ ¼å¼ä½¿ç”¨å¾®ç§’ç²¾åº¦ï¼ˆ%Y%m%d%H%M%S%fï¼‰ä»¥é¿å…å¿«é€Ÿè¿ç»­å¤‡ä»½æ—¶çš„æ–‡ä»¶åå†²çª
   - ä½¿ç”¨shutil.copy()è€Œécopy2()ä»¥ç¡®ä¿å¤‡ä»½æ–‡ä»¶æœ‰æ–°çš„ä¿®æ”¹æ—¶é—´æˆ³ï¼Œä¾¿äºæŒ‰æ—¶é—´æ’åº
   - å¤‡ä»½å’Œæ¸…ç†æ“ä½œä¸­çš„å¼‚å¸¸è¢«æ•è·ä½†ä¸é˜»æ­¢å†™å…¥æ“ä½œ

3. **æµ‹è¯•è¦†ç›–**ï¼š
   - æ–°å¢24ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ˆTestCanvasFileIOç±»ï¼‰
   - æ•´ä½“æµ‹è¯•è¦†ç›–ç‡ï¼š95%ï¼ˆè¶…è¿‡90%è¦æ±‚ï¼‰
   - æ‰€æœ‰130ä¸ªæµ‹è¯•é€šè¿‡

4. **æ€§èƒ½éªŒè¯**ï¼š
   - å†™å…¥50ä¸ªèŠ‚ç‚¹çš„Canvasæ–‡ä»¶è€—æ—¶<1ç§’ï¼ˆé€šè¿‡æµ‹è¯•éªŒè¯ï¼‰

### File List
**Modified Files**:
- `canvas_utils.py` - æ·»åŠ å¤‡ä»½å’ŒåŸå­å†™å…¥åŠŸèƒ½
  - æ–°å¢å¸¸é‡ï¼šBACKUP_SUFFIX, BACKUP_KEEP_COUNT, TEMP_FILE_SUFFIX, BACKUP_TIMESTAMP_FORMAT
  - æ–°å¢å‡½æ•°ï¼šcreate_backup(), list_backups(), cleanup_old_backups(), write_canvas_atomic(), restore_from_backup()
  - CanvasJSONOperatorç±»æ–°å¢æ–¹æ³•ï¼šwrite_canvas()

- `tests/test_canvas_utils.py` - æ·»åŠ å®Œæ•´æµ‹è¯•å¥—ä»¶
  - æ–°å¢æµ‹è¯•ç±»ï¼šTestCanvasFileIOï¼ˆ24ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰

**No New Files Created**

### Status
Ready for Review

## QA Results

### Review Date: 2025-10-14

### Reviewed By: Quinn (Senior Developer QA / Claude Sonnet 4.5)

### Code Quality Assessment

**æ•´ä½“è¯„ä»·ï¼šä¼˜ç§€ â­â­â­â­â­**

æœ¬Storyçš„å®ç°å±•ç°äº†é«˜è´¨é‡çš„å·¥ç¨‹å®è·µï¼š

1. **æ¶æ„è®¾è®¡ä¼˜ç§€**
   - ä¸¥æ ¼éµå¾ªLayer 1çš„æ— çŠ¶æ€ã€é™æ€æ–¹æ³•è®¾è®¡åŸåˆ™
   - æ¸…æ™°çš„èŒè´£åˆ†ç¦»ï¼šå¤‡ä»½ç®¡ç†ã€åŸå­å†™å…¥ã€æ¢å¤åŠŸèƒ½ç‹¬ç«‹å®ç°
   - æ¨¡å—çº§å‡½æ•°è®¾è®¡åˆç†ï¼Œæ˜“äºæµ‹è¯•å’Œç»´æŠ¤

2. **ä»£ç è´¨é‡ä¼˜ç§€**
   - å®Œæ•´çš„ç±»å‹æ³¨è§£ï¼ˆ`Dict[str, Any]`, `List[Tuple[str, datetime]]`ç­‰ï¼‰
   - è¯¦ç»†çš„Google Style Docstringsï¼ŒåŒ…å«Argsã€Returnsã€Raisesã€Example
   - å¸¸é‡åŒ–è®¾è®¡ï¼ˆ`BACKUP_SUFFIX`, `BACKUP_KEEP_COUNT`, `TEMP_FILE_SUFFIX`ï¼‰
   - ç¬¦åˆPEP 8ç¼–ç è§„èŒƒ

3. **é”™è¯¯å¤„ç†å®Œå–„**
   - æ˜ç¡®çš„å¼‚å¸¸ç±»å‹ï¼ˆ`FileNotFoundError`, `ValueError`, `IOError`ï¼‰
   - åˆç†çš„å®¹é”™è®¾è®¡ï¼ˆå¤‡ä»½/æ¸…ç†å¤±è´¥ä¸é˜»æ­¢ä¸»å†™å…¥æ“ä½œï¼‰
   - åŸå­å†™å…¥ä¿è¯æ•°æ®å®Œæ•´æ€§

4. **æ€§èƒ½ä¼˜åŒ–åˆ°ä½**
   - ä½¿ç”¨`shutil.copy()`é«˜æ•ˆå¤åˆ¶
   - `os.replace()`å®ç°çœŸæ­£çš„åŸå­æ“ä½œ
   - æ€§èƒ½æµ‹è¯•éªŒè¯<1ç§’è¦æ±‚

5. **è®¾è®¡å†³ç­–ä¼˜ç§€**
   - **å¾®ç§’æ—¶é—´æˆ³**ï¼šé¿å…å¿«é€Ÿè¿ç»­å¤‡ä»½æ—¶çš„æ–‡ä»¶åå†²çªï¼ˆä¼˜äºDev Notesä¸­å»ºè®®çš„ç§’çº§ç²¾åº¦ï¼‰
   - **shutil.copy() vs copy2()**ï¼šæ­£ç¡®é€‰æ‹©copy()ä»¥ç¡®ä¿æ–°å¤‡ä»½æœ‰æ–°æ—¶é—´æˆ³ï¼Œä¾¿äºæŒ‰æ—¶é—´æ’åº

### Refactoring Performed

- **File**: `canvas_utils.py` (line 585-600)
  - **Change**: å°†å®½æ³›çš„`Exception`æ•è·æ”¹ä¸ºå…·ä½“çš„`(OSError, IOError, PermissionError)`
  - **Why**: æ•è·é€šç”¨Exceptionè¿åPythonæœ€ä½³å®è·µï¼Œå¯èƒ½æ©ç›–éé¢„æœŸçš„é”™è¯¯ï¼ˆå¦‚KeyErrorã€TypeErrorç­‰ï¼‰
  - **How**:
    - æ˜ç¡®æ•è·æ–‡ä»¶I/Oç›¸å…³å¼‚å¸¸ç±»å‹
    - æ·»åŠ æ¸…æ™°çš„æ³¨é‡Šè¯´æ˜æ•è·çš„å¼‚å¸¸åœºæ™¯
    - æé«˜ä»£ç å¯ç»´æŠ¤æ€§å’Œè°ƒè¯•å‹å¥½æ€§
  - **Impact**: æ‰€æœ‰130ä¸ªæµ‹è¯•ä»ç„¶é€šè¿‡ï¼Œé‡æ„å®‰å…¨

### Compliance Check

- **Coding Standards**: âœ… **å®Œå…¨ç¬¦åˆ**
  - PEP 8è§„èŒƒï¼š4ç©ºæ ¼ç¼©è¿›ã€snake_caseå‘½åã€UPPER_SNAKE_CASEå¸¸é‡
  - å®Œæ•´ç±»å‹æ³¨è§£
  - Google Style Docstrings
  - å¯¼å…¥è¯­å¥é¡ºåºæ­£ç¡®

- **Project Structure**: âœ… **å®Œå…¨ç¬¦åˆ**
  - ä»£ç ä½ç½®æ­£ç¡®ï¼š`canvas_utils.py`ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰
  - æµ‹è¯•ä½ç½®æ­£ç¡®ï¼š`tests/test_canvas_utils.py`
  - éµå¾ªLayer 1æ¶æ„ï¼šé™æ€æ–¹æ³•ã€æ— çŠ¶æ€è®¾è®¡

- **Testing Strategy**: âœ… **å®Œå…¨ç¬¦åˆ**
  - æµ‹è¯•è¦†ç›–ç‡ï¼š**95%**ï¼ˆè¶…è¿‡90%ç›®æ ‡ ğŸ¯ï¼‰
  - 130ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡
  - å®Œæ•´çš„è¾¹ç•Œæµ‹è¯•ã€é”™è¯¯æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•
  - æµ‹è¯•ç±»è®¾è®¡è‰¯å¥½ï¼ˆsetup/teardownæ¸…ç†æœºåˆ¶ï¼‰

- **All ACs Met**: âœ… **å…¨éƒ¨æ»¡è¶³**
  - AC1 âœ…: æ¯æ¬¡ä¿®æ”¹å‰è‡ªåŠ¨åˆ›å»ºå¤‡ä»½ - `write_canvas`ä¸­`create_backup()`è°ƒç”¨
  - AC2 âœ…: å¤‡ä»½æ–‡ä»¶å‘½åæ ¼å¼æ­£ç¡® - `{basename}.backup.{timestamp}.canvas`ï¼ˆå«å¾®ç§’ï¼‰
  - AC3 âœ…: è‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™3ä¸ªï¼‰- `cleanup_old_backups()`æŒ‰æ—¶é—´æ’åºå¹¶åˆ é™¤æ—§å¤‡ä»½
  - AC4 âœ…: ä½¿ç”¨åŸå­å†™å…¥ - `write_canvas_atomic()`ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶+`os.replace()`
  - AC5 âœ…: å†™å…¥æ“ä½œ<1ç§’ - æ€§èƒ½æµ‹è¯•éªŒè¯é€šè¿‡ï¼ˆ`test_write_canvas_performance`ï¼‰

### Improvements Checklist

- [x] **é‡æ„å¼‚å¸¸å¤„ç†**ï¼ˆcanvas_utils.py:585-600ï¼‰
  - ä»`Exception`æ”¹ä¸ºå…·ä½“å¼‚å¸¸ç±»å‹`(OSError, IOError, PermissionError)`
  - æ·»åŠ è¯¦ç»†æ³¨é‡Šè¯´æ˜å¼‚å¸¸åœºæ™¯
- [x] **éªŒè¯æ‰€æœ‰æµ‹è¯•é€šè¿‡**ï¼ˆ130/130 âœ…ï¼‰
- [x] **éªŒè¯ä»£ç è¦†ç›–ç‡è¾¾æ ‡**ï¼ˆ95% > 90% âœ…ï¼‰
- [x] **éªŒè¯æ€§èƒ½è¦æ±‚**ï¼ˆ<1ç§’ âœ…ï¼‰
- [x] **éªŒè¯æ‰€æœ‰ACæ»¡è¶³**ï¼ˆ5/5 âœ…ï¼‰

**æ— éœ€å¼€å‘è€…å¤„ç†çš„æ”¹è¿›é¡¹** - æ‰€æœ‰æ”¹è¿›å·²åœ¨QAå®¡æŸ¥ä¸­å®Œæˆã€‚

### Security Review

âœ… **æ— å®‰å…¨é—®é¢˜**

- æ–‡ä»¶è·¯å¾„å¤„ç†ï¼šä½¿ç”¨`pathlib.Path`å®‰å…¨å¤„ç†è·¯å¾„
- è¾“å…¥éªŒè¯ï¼š`write_canvas_atomic`éªŒè¯`canvas_data`æ ¼å¼
- ä¸´æ—¶æ–‡ä»¶æ¸…ç†ï¼šå¼‚å¸¸æ—¶è‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶
- åŸå­æ“ä½œï¼š`os.replace()`ä¿è¯æ–‡ä»¶ä¸€è‡´æ€§
- æ— ç¡¬ç¼–ç å‡­æ®æˆ–æ•æ„Ÿä¿¡æ¯

### Performance Considerations

âœ… **æ€§èƒ½ä¼˜ç§€**

- **å†™å…¥æ€§èƒ½**ï¼š50èŠ‚ç‚¹Canvas < 1ç§’ï¼ˆæµ‹è¯•éªŒè¯ï¼‰
- **å¤‡ä»½ç­–ç•¥**ï¼šä¿ç•™3ä¸ªå¤‡ä»½ï¼Œç£ç›˜å ç”¨å¯æ§
- **I/Oä¼˜åŒ–**ï¼š
  - ä½¿ç”¨`shutil.copy()`è€Œéé€å­—èŠ‚å¤åˆ¶
  - `json.dump()`ä¸€æ¬¡æ€§å†™å…¥
  - `glob.glob()`é«˜æ•ˆæŸ¥æ‰¾å¤‡ä»½æ–‡ä»¶

**æ€§èƒ½æµ‹è¯•ç»“æœ**ï¼š
```python
# æµ‹è¯•å†™å…¥50ä¸ªèŠ‚ç‚¹çš„Canvas
elapsed_time < 1.0 second  âœ… PASS
```

### Final Status

âœ… **Approved - Ready for Done**

**è¯„å®¡æ€»ç»“**ï¼š

æœ¬Storyçš„å®ç°è´¨é‡ä¼˜ç§€ï¼Œå±•ç°äº†ä¸“ä¸šçš„è½¯ä»¶å·¥ç¨‹å®è·µï¼š
- æ¶æ„è®¾è®¡æ¸…æ™°ï¼ŒèŒè´£åˆ†ç¦»æ˜ç¡®
- ä»£ç è´¨é‡é«˜ï¼Œç±»å‹æ³¨è§£å®Œæ•´ï¼Œæ–‡æ¡£è¯¦å°½
- é”™è¯¯å¤„ç†å®Œå–„ï¼Œå¼‚å¸¸ç±»å‹æ˜ç¡®
- æµ‹è¯•è¦†ç›–å…¨é¢ï¼ˆ95%ï¼‰ï¼Œè¾¹ç•Œæƒ…å†µå……åˆ†è€ƒè™‘
- æ€§èƒ½ä¼˜åŒ–åˆ°ä½ï¼Œæ»¡è¶³æ‰€æœ‰è¦æ±‚

**å…³é”®äº®ç‚¹**ï¼š
1. å¾®ç§’çº§æ—¶é—´æˆ³è®¾è®¡é¿å…æ–‡ä»¶åå†²çªï¼ˆä¼˜äºåŸå§‹è®¾è®¡ï¼‰
2. åŸå­å†™å…¥+è‡ªåŠ¨å¤‡ä»½åŒé‡ä¿æŠ¤æ•°æ®å®‰å…¨
3. å®¹é”™è®¾è®¡åˆç†ï¼ˆå¤‡ä»½å¤±è´¥ä¸é˜»æ­¢ä¸»æ“ä½œï¼‰
4. æµ‹è¯•è®¾è®¡ä¼˜ç§€ï¼ˆ24ä¸ªæ–°æµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–ç‡95%ï¼‰

**QAæ‰§è¡Œçš„é‡æ„**ï¼š
- æ”¹è¿›å¼‚å¸¸å¤„ç†ï¼Œæé«˜ä»£ç å¥å£®æ€§å’Œå¯ç»´æŠ¤æ€§

**æ¨èçŠ¶æ€å˜æ›´**ï¼š
- Story 1.6: Ready for Review â†’ **Done** âœ…

---

**QAç­¾å­—**: Quinn (Senior Developer QA)
**å®¡æŸ¥æ—¥æœŸ**: 2025-10-14
**å®¡æŸ¥è€—æ—¶**: å®Œæ•´å®¡æŸ¥ + ä»£ç é‡æ„

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | åˆå§‹ Story åˆ›å»º | SM Agent (Bob) |
| 2025-10-14 | 2.0 | Storyå®Œæˆå¼€å‘å¹¶é€šè¿‡æµ‹è¯• | Dev Agent (James/Claude Sonnet 4.5) |
| 2025-10-14 | 3.0 | QAå®¡æŸ¥å®Œæˆï¼Œä»£ç é‡æ„ï¼Œæ‰¹å‡†ä¸Šçº¿ | QA Agent (Quinn/Claude Sonnet 4.5) |
