# Story 9.8.6.2: CanvasçŠ¶æ€ç®¡ç†è¿ç§» - CanvasFileSelectorç»„ä»¶

**ç”¨æˆ·æ•…äº‹æ ‡é¢˜**: CanvasFileSelectorç»„ä»¶ä»useStateåˆ°Zustandçš„çŠ¶æ€ç®¡ç†è¿ç§»

**Epic**: Epic 9.8.6: çŠ¶æ€ç®¡ç†è¿ç§»åˆ°Zustand
**ä½œè€…**: Dev Agent (James)
**åˆ›å»ºæ—¥æœŸ**: 2025-10-26
**é¢„ä¼°å·¥ä½œé‡**: 3 days (Medium)
**ä¼˜å…ˆçº§**: High

---

## 1. æ•…äº‹èƒŒæ™¯

### 1.1 å½“å‰çŠ¶æ€
- CanvasFileSelectorç»„ä»¶å½“å‰ä½¿ç”¨Reactçš„`useState`è¿›è¡Œæœ¬åœ°çŠ¶æ€ç®¡ç†
- æ–‡ä»¶é€‰æ‹©ã€åŠ è½½ã€é”™è¯¯å¤„ç†ç­‰é€»è¾‘åˆ†æ•£åœ¨ç»„ä»¶å†…éƒ¨
- çŠ¶æ€å…±äº«å›°éš¾ï¼Œä¸å…¶ä»–ç»„ä»¶çš„é€šä¿¡éœ€è¦é€šè¿‡propsä¼ é€’
- çŠ¶æ€ç®¡ç†é€»è¾‘ä¸UIé€»è¾‘è€¦åˆï¼Œé™ä½äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§

### 1.2 é—®é¢˜åˆ†æ
```javascript
// å½“å‰CanvasFileSelectorç»„ä»¶çš„çŠ¶æ€ç®¡ç†ç—›ç‚¹
const CanvasFileSelector = () => {
  const [selectedFile, setSelectedFile] = useState(null);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState(null);
  const [canvasData, setCanvasData] = useState(null);
  // ... çŠ¶æ€ç®¡ç†é€»è¾‘ä¸UIé€»è¾‘æ··åˆ
};
```

### 1.3 è¿ç§»ç›®æ ‡
- åˆ©ç”¨Story 9.8.6.1åˆ›å»ºçš„canvas-store
- å®ç°çŠ¶æ€çš„é›†ä¸­ç®¡ç†å’Œç»„ä»¶é—´çš„çŠ¶æ€å…±äº«
- æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯æµ‹è¯•æ€§å’Œå¯æ‰©å±•æ€§
- ç¡®ä¿æ‰€æœ‰ç°æœ‰åŠŸèƒ½åœ¨è¿ç§»åæ­£å¸¸å·¥ä½œ

---

## 2. ç”¨æˆ·æ•…äº‹

### 2.1 ä½œä¸º ä¸€åå¼€å‘è€…
æˆ‘å¸Œæœ› å°†CanvasFileSelectorç»„ä»¶çš„çŠ¶æ€ç®¡ç†ä»useStateè¿ç§»åˆ°Zustand store
ä»¥ä¾¿ æé«˜çŠ¶æ€ç®¡ç†çš„æ•ˆç‡ï¼Œå®ç°ç»„ä»¶é—´çš„çŠ¶æ€å…±äº«ï¼Œå¹¶ç®€åŒ–ç»„ä»¶é€»è¾‘

### 2.2 éªŒæ”¶æ ‡å‡†
- [ ] CanvasFileSelectoræˆåŠŸä½¿ç”¨canvas-storeæ›¿ä»£æ‰€æœ‰useState
- [ ] æ‰€æœ‰ç°æœ‰åŠŸèƒ½ï¼ˆæ–‡ä»¶é€‰æ‹©ã€åŠ è½½ã€é”™è¯¯å¤„ç†ï¼‰æ­£å¸¸å·¥ä½œ
- [ ] ç»„ä»¶æ€§èƒ½å¾—åˆ°æå‡ï¼Œå‡å°‘ä¸å¿…è¦çš„é‡æ¸²æŸ“
- [ ] çŠ¶æ€å˜æ›´å¯ä»¥è¢«å…¶ä»–ç»„ä»¶è®¢é˜…å’Œå“åº”
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ä¿æŒæˆ–æé«˜
- [ ] å‘åå…¼å®¹æ€§å¾—åˆ°ä¿è¯

---

## 3. è¯¦ç»†å®ç°è®¡åˆ’

### 3.1 Phase 1: å‡†å¤‡å’Œåˆ†æ (0.5 day)

#### 3.1.1 ç°æœ‰ç»„ä»¶çŠ¶æ€æ¢³ç†
```typescript
// éœ€è¦è¿ç§»çš„çŠ¶æ€åˆ—è¡¨
interface CanvasFileSelectorState {
  selectedFile: File | null;           // å½“å‰é€‰æ‹©çš„æ–‡ä»¶
  isLoading: boolean;                  // åŠ è½½çŠ¶æ€
  error: string | null;                // é”™è¯¯ä¿¡æ¯
  canvasData: any | null;              // Canvasæ•°æ®
  fileList: CanvasFile[];              // Canvasæ–‡ä»¶åˆ—è¡¨
  searchQuery: string;                 // æœç´¢æŸ¥è¯¢
  sortBy: 'name' | 'date' | 'size';    // æ’åºæ–¹å¼
  sortOrder: 'asc' | 'desc';           // æ’åºé¡ºåº
  viewMode: 'list' | 'grid';           // è§†å›¾æ¨¡å¼
  selectedItems: string[];             // é€‰ä¸­çš„é¡¹ç›®IDs
  filters: FileFilters;                // æ–‡ä»¶è¿‡æ»¤å™¨
}
```

#### 3.1.2 ç°æœ‰åŠŸèƒ½åˆ†æ
```typescript
// éœ€è¦ä¿æŒçš„åŠŸèƒ½åˆ—è¡¨
interface CanvasFileSelectorFunctions {
  handleFileSelect: (file: File) => void;
  handleFileLoad: (filePath: string) => Promise<void>;
  handleSearch: (query: string) => void;
  handleSort: (sortBy: string, sortOrder: string) => void;
  handleFilter: (filters: FileFilters) => void;
  handleViewModeChange: (mode: 'list' | 'grid') => void;
  handleMultiSelect: (itemId: string, isSelected: boolean) => void;
  clearSelection: () => void;
  refreshFileList: () => Promise<void>;
  deleteSelectedFiles: () => Promise<void>;
}
```

### 3.2 Phase 2: Storeæ‰©å±• (0.5 day)

#### 3.2.1 æ‰©å±•canvas-store
```typescript
// åœ¨canvas-storeä¸­æ·»åŠ CanvasFileSelectorç›¸å…³çŠ¶æ€
interface CanvasStore {
  // ç°æœ‰çŠ¶æ€...

  // CanvasFileSelectorçŠ¶æ€
  selectedFile: File | null;
  isLoading: boolean;
  error: string | null;
  canvasData: any | null;
  fileList: CanvasFile[];
  searchQuery: string;
  sortBy: 'name' | 'date' | 'size';
  sortOrder: 'asc' | 'desc';
  viewMode: 'list' | 'grid';
  selectedItems: string[];
  filters: FileFilters;

  // CanvasFileSelectoræ“ä½œ
  setSelectedFile: (file: File | null) => void;
  setLoading: (loading: boolean) => void;
  setError: (error: string | null) => void;
  setCanvasData: (data: any | null) => void;
  setFileList: (files: CanvasFile[]) => void;
  setSearchQuery: (query: string) => void;
  setSorting: (sortBy: string, sortOrder: string) => void;
  setViewMode: (mode: 'list' | 'grid') => void;
  toggleItemSelection: (itemId: string) => void;
  clearSelection: () => void;
  setFilters: (filters: FileFilters) => void;

  // å¤åˆæ“ä½œ
  loadCanvasFile: (filePath: string) => Promise<void>;
  searchFiles: (query: string) => void;
  sortFiles: (sortBy: string, sortOrder: string) => void;
  filterFiles: (filters: FileFilters) => void;
  refreshFileList: () => Promise<void>;
  deleteSelectedFiles: () => Promise<void>;
}
```

#### 3.2.2 Storeå®ç°æ›´æ–°
```typescript
// æ›´æ–°canvas-store.ts
import { create } from 'zustand';
import { subscribeWithSelector } from 'zustand/middleware';
import { devtools } from 'zustand/middleware';

interface FileFilters {
  dateRange?: { start: Date; end: Date };
  fileSize?: { min: number; max: number };
  tags?: string[];
  fileType?: string[];
}

const useCanvasStore = create<CanvasStore>()(
  devtools(
    subscribeWithSelector((set, get) => ({
      // ç°æœ‰çŠ¶æ€å’Œæ–¹æ³•...

      // CanvasFileSelectorçŠ¶æ€
      selectedFile: null,
      isLoading: false,
      error: null,
      canvasData: null,
      fileList: [],
      searchQuery: '',
      sortBy: 'name',
      sortOrder: 'asc',
      viewMode: 'list',
      selectedItems: [],
      filters: {},

      // CanvasFileSelectoråŸºç¡€æ“ä½œ
      setSelectedFile: (file) => set({ selectedFile: file }),
      setLoading: (loading) => set({ isLoading: loading }),
      setError: (error) => set({ error }),
      setCanvasData: (data) => set({ canvasData: data }),
      setFileList: (files) => set({ fileList: files }),
      setSearchQuery: (query) => set({ searchQuery: query }),
      setSorting: (sortBy, sortOrder) => set({ sortBy, sortOrder }),
      setViewMode: (mode) => set({ viewMode: mode }),

      toggleItemSelection: (itemId) => set((state) => ({
        selectedItems: state.selectedItems.includes(itemId)
          ? state.selectedItems.filter(id => id !== itemId)
          : [...state.selectedItems, itemId]
      })),

      clearSelection: () => set({ selectedItems: [] }),
      setFilters: (filters) => set({ filters }),

      // å¤åˆæ“ä½œ
      loadCanvasFile: async (filePath) => {
        set({ isLoading: true, error: null });
        try {
          const data = await window.electronAPI.loadCanvasFile(filePath);
          set({ canvasData: data, isLoading: false });
        } catch (error) {
          set({ error: error.message, isLoading: false });
        }
      },

      searchFiles: (query) => {
        set({ searchQuery: query });
        // å®é™…æœç´¢é€»è¾‘ä¼šåœ¨ç»„ä»¶ä¸­æˆ–è¿™é‡Œå®ç°
      },

      sortFiles: (sortBy, sortOrder) => {
        set({ sortBy, sortOrder });
        const { fileList } = get();
        const sortedFiles = [...fileList].sort((a, b) => {
          const comparison = a[sortBy] > b[sortBy] ? 1 : -1;
          return sortOrder === 'asc' ? comparison : -comparison;
        });
        set({ fileList: sortedFiles });
      },

      filterFiles: (filters) => {
        set({ filters });
        // å®é™…è¿‡æ»¤é€»è¾‘å®ç°
      },

      refreshFileList: async () => {
        set({ isLoading: true, error: null });
        try {
          const files = await window.electronAPI.getCanvasFileList();
          set({ fileList: files, isLoading: false });
        } catch (error) {
          set({ error: error.message, isLoading: false });
        }
      },

      deleteSelectedFiles: async () => {
        const { selectedItems } = get();
        if (selectedItems.length === 0) return;

        set({ isLoading: true, error: null });
        try {
          await Promise.all(
            selectedItems.map(id => window.electronAPI.deleteCanvasFile(id))
          );
          await get().refreshFileList();
          set({ selectedItems: [], isLoading: false });
        } catch (error) {
          set({ error: error.message, isLoading: false });
        }
      },
    })),
    { name: 'canvas-store' }
  )
);

export default useCanvasStore;
```

### 3.3 Phase 3: ç»„ä»¶è¿ç§» (1 day)

#### 3.3.1 Before - å½“å‰å®ç°
```typescript
// CanvasFileSelector.tsx (è¿ç§»å‰)
import React, { useState, useEffect } from 'react';

const CanvasFileSelector: React.FC = () => {
  const [selectedFile, setSelectedFile] = useState<File | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [canvasData, setCanvasData] = useState<any | null>(null);
  const [fileList, setFileList] = useState<CanvasFile[]>([]);
  const [searchQuery, setSearchQuery] = useState('');
  const [sortBy, setSortBy] = useState<'name' | 'date' | 'size'>('name');
  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('asc');
  const [viewMode, setViewMode] = useState<'list' | 'grid'>('list');
  const [selectedItems, setSelectedItems] = useState<string[]>([]);

  useEffect(() => {
    loadFileList();
  }, []);

  const loadFileList = async () => {
    setIsLoading(true);
    setError(null);
    try {
      const files = await window.electronAPI.getCanvasFileList();
      setFileList(files);
    } catch (err) {
      setError(err.message);
    } finally {
      setIsLoading(false);
    }
  };

  const handleFileSelect = async (file: CanvasFile) => {
    setSelectedFile(file);
    setIsLoading(true);
    setError(null);
    try {
      const data = await window.electronAPI.loadCanvasFile(file.path);
      setCanvasData(data);
    } catch (err) {
      setError(err.message);
    } finally {
      setIsLoading(false);
    }
  };

  const handleSearch = (query: string) => {
    setSearchQuery(query);
    // æœç´¢é€»è¾‘...
  };

  const handleSort = (sortBy: string, order: string) => {
    setSortBy(sortBy as any);
    setSortOrder(order as any);
    // æ’åºé€»è¾‘...
  };

  // ... å…¶ä»–å¤„ç†å‡½æ•°

  return (
    <div className="canvas-file-selector">
      {/* ç»„ä»¶UI... */}
    </div>
  );
};
```

#### 3.3.2 After - è¿ç§»åå®ç°
```typescript
// CanvasFileSelector.tsx (è¿ç§»å)
import React, { useEffect } from 'react';
import useCanvasStore from '../stores/canvas-store';
import { shallow } from 'zustand/shallow';

const CanvasFileSelector: React.FC = () => {
  // ä½¿ç”¨shallowæ¯”è¾ƒé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
  const {
    // çŠ¶æ€
    selectedFile,
    isLoading,
    error,
    canvasData,
    fileList,
    searchQuery,
    sortBy,
    sortOrder,
    viewMode,
    selectedItems,
    filters,

    // æ“ä½œ
    setSelectedFile,
    setLoading,
    setError,
    setCanvasData,
    setFileList,
    setSearchQuery,
    setSorting,
    setViewMode,
    toggleItemSelection,
    clearSelection,
    setFilters,

    // å¤åˆæ“ä½œ
    loadCanvasFile,
    refreshFileList,
    searchFiles,
    sortFiles,
    filterFiles,
    deleteSelectedFiles,
  } = useCanvasStore(
    (state) => ({
      selectedFile: state.selectedFile,
      isLoading: state.isLoading,
      error: state.error,
      canvasData: state.canvasData,
      fileList: state.fileList,
      searchQuery: state.searchQuery,
      sortBy: state.sortBy,
      sortOrder: state.sortOrder,
      viewMode: state.viewMode,
      selectedItems: state.selectedItems,
      filters: state.filters,
      setSelectedFile: state.setSelectedFile,
      setLoading: state.setLoading,
      setError: state.setError,
      setCanvasData: state.setCanvasData,
      setFileList: state.setFileList,
      setSearchQuery: state.setSearchQuery,
      setSorting: state.setSorting,
      setViewMode: state.setViewMode,
      toggleItemSelection: state.toggleItemSelection,
      clearSelection: state.clearSelection,
      setFilters: state.setFilters,
      loadCanvasFile: state.loadCanvasFile,
      refreshFileList: state.refreshFileList,
      searchFiles: state.searchFiles,
      sortFiles: state.sortFiles,
      filterFiles: state.filterFiles,
      deleteSelectedFiles: state.deleteSelectedFiles,
    }),
    shallow
  );

  useEffect(() => {
    refreshFileList();
  }, [refreshFileList]);

  const handleFileSelect = async (file: CanvasFile) => {
    setSelectedFile(file);
    await loadCanvasFile(file.path);
  };

  const handleSearch = (query: string) => {
    searchFiles(query);
  };

  const handleSort = (sortBy: string, order: string) => {
    sortFiles(sortBy, order);
  };

  const handleItemSelect = (itemId: string) => {
    toggleItemSelection(itemId);
  };

  const handleDeleteSelected = async () => {
    await deleteSelectedFiles();
  };

  // ç»„ä»¶ç°åœ¨æ›´åŠ ç®€æ´ï¼Œåªä¸“æ³¨äºUIæ¸²æŸ“å’Œç”¨æˆ·äº¤äº’
  return (
    <div className="canvas-file-selector">
      <div className="file-selector-header">
        <input
          type="text"
          placeholder="æœç´¢Canvasæ–‡ä»¶..."
          value={searchQuery}
          onChange={(e) => handleSearch(e.target.value)}
        />

        <div className="view-controls">
          <button
            onClick={() => setViewMode('list')}
            className={viewMode === 'list' ? 'active' : ''}
          >
            åˆ—è¡¨è§†å›¾
          </button>
          <button
            onClick={() => setViewMode('grid')}
            className={viewMode === 'grid' ? 'active' : ''}
          >
            ç½‘æ ¼è§†å›¾
          </button>
        </div>
      </div>

      {error && (
        <div className="error-message">
          {error}
        </div>
      )}

      {isLoading ? (
        <div className="loading-indicator">åŠ è½½ä¸­...</div>
      ) : (
        <div className={`file-list ${viewMode}`}>
          {fileList.map((file) => (
            <div
              key={file.id}
              className={`file-item ${selectedFile?.id === file.id ? 'selected' : ''}`}
              onClick={() => handleFileSelect(file)}
            >
              <input
                type="checkbox"
                checked={selectedItems.includes(file.id)}
                onChange={() => handleItemSelect(file.id)}
              />
              <div className="file-info">
                <h3>{file.name}</h3>
                <p>ä¿®æ”¹æ—¶é—´: {new Date(file.lastModified).toLocaleString()}</p>
                <p>å¤§å°: {file.size}</p>
              </div>
            </div>
          ))}
        </div>
      )}

      {selectedItems.length > 0 && (
        <div className="bulk-actions">
          <button onClick={handleDeleteSelected}>
            åˆ é™¤é€‰ä¸­æ–‡ä»¶ ({selectedItems.length})
          </button>
          <button onClick={clearSelection}>
            æ¸…é™¤é€‰æ‹©
          </button>
        </div>
      )}
    </div>
  );
};

export default CanvasFileSelector;
```

### 3.4 Phase 4: æ€§èƒ½ä¼˜åŒ– (0.5 day)

#### 3.4.1 é€‰æ‹©æ€§è®¢é˜…ä¼˜åŒ–
```typescript
// ä¸ºä¸åŒçš„UIç»„ä»¶åˆ›å»ºé€‰æ‹©å™¨
const useFileListState = () => useCanvasStore(
  (state) => ({
    fileList: state.fileList,
    isLoading: state.isLoading,
    error: state.error,
    refreshFileList: state.refreshFileList,
  }),
  shallow
);

const useSelectionState = () => useCanvasStore(
  (state) => ({
    selectedItems: state.selectedItems,
    selectedFile: state.selectedFile,
    toggleItemSelection: state.toggleItemSelection,
    clearSelection: state.clearSelection,
  }),
  shallow
);

const useSearchAndSortState = () => useCanvasStore(
  (state) => ({
    searchQuery: state.searchQuery,
    sortBy: state.sortBy,
    sortOrder: state.sortOrder,
    setSearchQuery: state.setSearchQuery,
    setSorting: state.setSorting,
  }),
  shallow
);

// ç»„ä»¶æ‹†åˆ†ç¤ºä¾‹
const FileList: React.FC = () => {
  const { fileList, isLoading, error, refreshFileList } = useFileListState();

  useEffect(() => {
    refreshFileList();
  }, [refreshFileList]);

  if (isLoading) return <LoadingIndicator />;
  if (error) return <ErrorMessage error={error} />;

  return (
    <div className="file-list">
      {fileList.map(file => <FileItem key={file.id} file={file} />)}
    </div>
  );
};

const FileItem: React.FC<{ file: CanvasFile }> = ({ file }) => {
  const { selectedFile, toggleItemSelection } = useSelectionState();
  const isSelected = selectedFile?.id === file.id;

  return (
    <div
      className={`file-item ${isSelected ? 'selected' : ''}`}
      onClick={() => onSelectFile(file)}
    >
      <FileContent file={file} />
    </div>
  );
};
```

#### 3.4.2 è®¡ç®—å±æ€§ä¼˜åŒ–
```typescript
// åœ¨storeä¸­æ·»åŠ è®¡ç®—å±æ€§
const useCanvasStore = create<CanvasStore>()(
  devtools(
    subscribeWithSelector((set, get) => ({
      // ... ç°æœ‰çŠ¶æ€å’Œæ–¹æ³•

      // è®¡ç®—å±æ€§
      get filteredFileList() {
        const { fileList, searchQuery, filters } = get();
        let filtered = fileList;

        // æœç´¢è¿‡æ»¤
        if (searchQuery) {
          filtered = filtered.filter(file =>
            file.name.toLowerCase().includes(searchQuery.toLowerCase())
          );
        }

        // å…¶ä»–è¿‡æ»¤æ¡ä»¶
        if (filters.dateRange) {
          filtered = filtered.filter(file => {
            const fileDate = new Date(file.lastModified);
            return fileDate >= filters.dateRange.start && fileDate <= filters.dateRange.end;
          });
        }

        return filtered;
      },

      get sortedFileList() {
        const { filteredFileList, sortBy, sortOrder } = get();
        return [...filteredFileList].sort((a, b) => {
          const comparison = a[sortBy] > b[sortBy] ? 1 : -1;
          return sortOrder === 'asc' ? comparison : -comparison;
        });
      },

      get selectedItemsCount() {
        return get().selectedItems.length;
      },

      get hasAnySelection() {
        return get().selectedItems.length > 0;
      },
    }))
  )
);
```

### 3.5 Phase 5: æµ‹è¯•å’ŒéªŒè¯ (0.5 day)

#### 3.5.1 å•å…ƒæµ‹è¯•
```typescript
// __tests__/CanvasFileSelector.test.tsx
import React from 'react';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { Provider } from 'react-redux';
import CanvasFileSelector from '../CanvasFileSelector';
import useCanvasStore from '../stores/canvas-store';

// Mock store
const mockStore = {
  selectedFile: null,
  isLoading: false,
  error: null,
  fileList: [],
  searchQuery: '',
  sortBy: 'name',
  sortOrder: 'asc',
  viewMode: 'list',
  selectedItems: [],
  setSelectedFile: jest.fn(),
  setLoading: jest.fn(),
  setError: jest.fn(),
  loadCanvasFile: jest.fn(),
  refreshFileList: jest.fn(),
  searchFiles: jest.fn(),
  sortFiles: jest.fn(),
  toggleItemSelection: jest.fn(),
  clearSelection: jest.fn(),
};

// Mock Zustand store
jest.mock('../stores/canvas-store', () => ({
  __esModule: true,
  default: jest.fn(() => mockStore),
}));

describe('CanvasFileSelector', () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  test('renders file selector correctly', () => {
    render(<CanvasFileSelector />);

    expect(screen.getByPlaceholderText('æœç´¢Canvasæ–‡ä»¶...')).toBeInTheDocument();
    expect(screen.getByText('åˆ—è¡¨è§†å›¾')).toBeInTheDocument();
    expect(screen.getByText('ç½‘æ ¼è§†å›¾')).toBeInTheDocument();
  });

  test('handles search input', () => {
    render(<CanvasFileSelector />);

    const searchInput = screen.getByPlaceholderText('æœç´¢Canvasæ–‡ä»¶...');
    fireEvent.change(searchInput, { target: { value: 'test' } });

    expect(mockStore.searchFiles).toHaveBeenCalledWith('test');
  });

  test('handles view mode change', () => {
    render(<CanvasFileSelector />);

    const gridButton = screen.getByText('ç½‘æ ¼è§†å›¾');
    fireEvent.click(gridButton);

    expect(mockStore.setViewMode).toHaveBeenCalledWith('grid');
  });

  test('displays loading state', () => {
    mockStore.isLoading = true;
    render(<CanvasFileSelector />);

    expect(screen.getByText('åŠ è½½ä¸­...')).toBeInTheDocument();
  });

  test('displays error message', () => {
    mockStore.error = 'Test error';
    render(<CanvasFileSelector />);

    expect(screen.getByText('Test error')).toBeInTheDocument();
  });

  test('displays file list', () => {
    const mockFiles = [
      { id: '1', name: 'File 1', lastModified: Date.now(), size: '1KB' },
      { id: '2', name: 'File 2', lastModified: Date.now(), size: '2KB' },
    ];
    mockStore.fileList = mockFiles;

    render(<CanvasFileSelector />);

    expect(screen.getByText('File 1')).toBeInTheDocument();
    expect(screen.getByText('File 2')).toBeInTheDocument();
  });

  test('handles file selection', async () => {
    const mockFile = { id: '1', name: 'File 1', path: '/path/to/file1' };
    mockStore.fileList = [mockFile];

    render(<CanvasFileSelector />);

    const fileItem = screen.getByText('File 1');
    fireEvent.click(fileItem);

    await waitFor(() => {
      expect(mockStore.setSelectedFile).toHaveBeenCalledWith(mockFile);
      expect(mockStore.loadCanvasFile).toHaveBeenCalledWith('/path/to/file1');
    });
  });

  test('handles bulk actions when items are selected', () => {
    mockStore.selectedItems = ['1', '2'];
    mockStore.hasAnySelection = true;

    render(<CanvasFileSelector />);

    expect(screen.getByText('åˆ é™¤é€‰ä¸­æ–‡ä»¶ (2)')).toBeInTheDocument();
    expect(screen.getByText('æ¸…é™¤é€‰æ‹©')).toBeInTheDocument();
  });
});
```

#### 3.5.2 é›†æˆæµ‹è¯•
```typescript
// __tests__/CanvasFileSelector.integration.test.tsx
import React from 'react';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import CanvasFileSelector from '../CanvasFileSelector';
import useCanvasStore from '../stores/canvas-store';

describe('CanvasFileSelector Integration', () => {
  let store: any;

  beforeEach(() => {
    // åˆ›å»ºçœŸå®çš„storeå®ä¾‹ç”¨äºé›†æˆæµ‹è¯•
    store = useCanvasStore.getState();
  });

  test('full workflow: search -> select -> load', async () => {
    // Mock electron API
    global.window.electronAPI = {
      getCanvasFileList: jest.fn().mockResolvedValue([
        { id: '1', name: 'Test Canvas', path: '/test.canvas', lastModified: Date.now(), size: '1KB' }
      ]),
      loadCanvasFile: jest.fn().mockResolvedValue({ nodes: [], edges: [] }),
    };

    render(<CanvasFileSelector />);

    // ç­‰å¾…æ–‡ä»¶åˆ—è¡¨åŠ è½½
    await waitFor(() => {
      expect(screen.getByText('Test Canvas')).toBeInTheDocument();
    });

    // æœç´¢æ–‡ä»¶
    const searchInput = screen.getByPlaceholderText('æœç´¢Canvasæ–‡ä»¶...');
    fireEvent.change(searchInput, { target: { value: 'Test' } });

    // é€‰æ‹©æ–‡ä»¶
    fireEvent.click(screen.getByText('Test Canvas'));

    // éªŒè¯åŠ è½½çŠ¶æ€
    await waitFor(() => {
      expect(global.window.electronAPI.loadCanvasFile).toHaveBeenCalledWith('/test.canvas');
    });
  });
});
```

#### 3.5.3 æ€§èƒ½æµ‹è¯•
```typescript
// __tests__/CanvasFileSelector.performance.test.tsx
import React from 'react';
import { render, screen } from '@testing-library/react';
import CanvasFileSelector from '../CanvasFileSelector';

describe('CanvasFileSelector Performance', () => {
  test('renders large file list efficiently', () => {
    const largeFileList = Array.from({ length: 1000 }, (_, i) => ({
      id: `${i}`,
      name: `File ${i}`,
      lastModified: Date.now(),
      size: `${i}KB`,
    }));

    jest.mock('../stores/canvas-store', () => ({
      __esModule: true,
      default: () => ({
        ...mockStore,
        fileList: largeFileList,
      }),
    }));

    const startTime = performance.now();
    render(<CanvasFileSelector />);
    const endTime = performance.now();

    // æ¸²æŸ“æ—¶é—´åº”è¯¥åœ¨åˆç†èŒƒå›´å†…ï¼ˆä¾‹å¦‚ < 100msï¼‰
    expect(endTime - startTime).toBeLessThan(100);
  });
});
```

---

## 4. é£é™©è¯„ä¼°å’Œç¼“è§£ç­–ç•¥

### 4.1 æŠ€æœ¯é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£ç­–ç•¥ |
|------|------|------|---------|
| çŠ¶æ€åŒæ­¥é—®é¢˜ | ä¸­ | é«˜ | å®ç°ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥å’ŒçŠ¶æ€éªŒè¯ |
| æ€§èƒ½å›å½’ | ä½ | ä¸­ | å®æ–½æ€§èƒ½ç›‘æ§å’ŒåŸºå‡†æµ‹è¯• |
| æµ‹è¯•è¦†ç›–ä¸è¶³ | ä¸­ | ä¸­ | åˆ¶å®šå…¨é¢çš„æµ‹è¯•ç­–ç•¥ |
| å‘åå…¼å®¹æ€§ç ´å | ä½ | é«˜ | ä¿æŒAPIæ¥å£ä¸å˜ï¼Œåªæ”¹å˜å†…éƒ¨å®ç° |

### 4.2 ä¸šåŠ¡é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£ç­–ç•¥ |
|------|------|------|---------|
| ç”¨æˆ·ä½“éªŒä¸­æ–­ | ä½ | é«˜ | åˆ†é˜¶æ®µå‘å¸ƒï¼Œä¿æŒåŠŸèƒ½ä¸€è‡´æ€§ |
| å¼€å‘å»¶æœŸ | ä¸­ | ä¸­ | é¢„ç•™ç¼“å†²æ—¶é—´ï¼Œä¼˜å…ˆæ ¸å¿ƒåŠŸèƒ½ |

### 4.3 ç¼“è§£æªæ–½
1. **æ¸è¿›å¼è¿ç§»**: ä¿ç•™åŸæœ‰ç»„ä»¶ä½œä¸ºå¤‡ä»½ï¼Œç¡®ä¿å¯ä»¥å¿«é€Ÿå›æ»š
2. **å……åˆ†æµ‹è¯•**: å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 90%ï¼ŒåŒ…å«æ‰€æœ‰å…³é”®è·¯å¾„
3. **æ€§èƒ½ç›‘æ§**: å»ºç«‹æ€§èƒ½åŸºå‡†ï¼Œç›‘æ§å…³é”®æŒ‡æ ‡
4. **ä»£ç å®¡æŸ¥**: ä¸¥æ ¼çš„ä»£ç å®¡æŸ¥æµç¨‹ï¼Œç¡®ä¿å®ç°è´¨é‡

---

## 5. æ—¶é—´çº¿å’Œé‡Œç¨‹ç¢‘

### 5.1 è¯¦ç»†æ—¶é—´çº¿

| Day | ä»»åŠ¡ | äº¤ä»˜ç‰© | çŠ¶æ€ |
|-----|------|--------|------|
| Day 1 (ä¸Šåˆ) | Phase 1: å‡†å¤‡å’Œåˆ†æ | çŠ¶æ€æ¢³ç†æŠ¥å‘Šï¼ŒåŠŸèƒ½åˆ†ææ–‡æ¡£ | ğŸ“‹ To Do |
| Day 1 (ä¸‹åˆ) | Phase 2: Storeæ‰©å±• | æ›´æ–°çš„canvas-store.tsæ–‡ä»¶ | ğŸ“‹ To Do |
| Day 2 (ä¸Šåˆ) | Phase 3: ç»„ä»¶è¿ç§» - æ ¸å¿ƒ | é‡æ„çš„CanvasFileSelectorç»„ä»¶ | ğŸ“‹ To Do |
| Day 2 (ä¸‹åˆ) | Phase 3: ç»„ä»¶è¿ç§» - ä¼˜åŒ– | æ€§èƒ½ä¼˜åŒ–çš„ç»„ä»¶å®ç° | ğŸ“‹ To Do |
| Day 3 (ä¸Šåˆ) | Phase 4: æ€§èƒ½ä¼˜åŒ– | é€‰æ‹©æ€§è®¢é˜…ï¼Œè®¡ç®—å±æ€§ | ğŸ“‹ To Do |
| Day 3 (ä¸‹åˆ) | Phase 5: æµ‹è¯•å’ŒéªŒè¯ | å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼ŒéªŒè¯æŠ¥å‘Š | ğŸ“‹ To Do |

### 5.2 å…³é”®é‡Œç¨‹ç¢‘

- **M1 (Day 1å®Œæˆ)**: Storeæ‰©å±•å®Œæˆï¼Œæ‰€æœ‰å¿…è¦çš„çŠ¶æ€å’Œæ“ä½œå°±ç»ª
- **M2 (Day 2å®Œæˆ)**: ç»„ä»¶è¿ç§»å®Œæˆï¼ŒåŠŸèƒ½éªŒè¯é€šè¿‡
- **M3 (Day 3å®Œæˆ)**: æ€§èƒ½ä¼˜åŒ–å®Œæˆï¼Œæµ‹è¯•é€šè¿‡ï¼Œå¯ä»¥å‘å¸ƒ

---

## 6. éªŒæ”¶æ ‡å‡†è¯¦ç»†è¯´æ˜

### 6.1 åŠŸèƒ½éªŒæ”¶æ ‡å‡†
- [ ] **æ–‡ä»¶é€‰æ‹©**: ç”¨æˆ·å¯ä»¥æ­£å¸¸é€‰æ‹©Canvasæ–‡ä»¶ï¼ŒçŠ¶æ€æ­£ç¡®æ›´æ–°
- [ ] **æ–‡ä»¶åŠ è½½**: é€‰æ‹©çš„æ–‡ä»¶å¯ä»¥æ­£ç¡®åŠ è½½ï¼Œæ˜¾ç¤ºCanvasæ•°æ®
- [ ] **æœç´¢åŠŸèƒ½**: æœç´¢æŸ¥è¯¢å¯ä»¥æ­£ç¡®è¿‡æ»¤æ–‡ä»¶åˆ—è¡¨
- [ ] **æ’åºåŠŸèƒ½**: æ–‡ä»¶åˆ—è¡¨å¯ä»¥æŒ‰ä¸åŒå­—æ®µå’Œé¡ºåºæ’åº
- [ ] **å¤šé€‰åŠŸèƒ½**: ç”¨æˆ·å¯ä»¥å¤šé€‰æ–‡ä»¶è¿›è¡Œæ‰¹é‡æ“ä½œ
- [ ] **é”™è¯¯å¤„ç†**: é”™è¯¯çŠ¶æ€æ­£ç¡®æ˜¾ç¤ºï¼Œç”¨æˆ·ä½“éªŒè‰¯å¥½
- [ ] **åŠ è½½çŠ¶æ€**: åŠ è½½è¿‡ç¨‹æœ‰æ˜ç¡®çš„è§†è§‰åé¦ˆ

### 6.2 æ€§èƒ½éªŒæ”¶æ ‡å‡†
- [ ] **æ¸²æŸ“æ€§èƒ½**: ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶é—´ < 100ms
- [ ] **çŠ¶æ€æ›´æ–°**: çŠ¶æ€å˜æ›´å“åº”æ—¶é—´ < 50ms
- [ ] **å†…å­˜ä½¿ç”¨**: å†…å­˜ä½¿ç”¨é‡ä¸æ¯”åŸå®ç°å¢åŠ è¶…è¿‡10%
- [ ] **é‡æ¸²æŸ“ä¼˜åŒ–**: é¿å…ä¸å¿…è¦çš„ç»„ä»¶é‡æ¸²æŸ“

### 6.3 è´¨é‡éªŒæ”¶æ ‡å‡†
- [ ] **ä»£ç è¦†ç›–ç‡**: å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%
- [ ] **ç±»å‹å®‰å…¨**: TypeScriptç±»å‹æ£€æŸ¥æ— é”™è¯¯
- [ ] **ä»£ç è´¨é‡**: ESLintæ£€æŸ¥é€šè¿‡ï¼Œä»£ç é£æ ¼ä¸€è‡´
- [ ] **æ–‡æ¡£æ›´æ–°**: ç›¸å…³æ–‡æ¡£å’Œæ³¨é‡Šæ›´æ–°å®Œæ•´

### 6.4 å…¼å®¹æ€§éªŒæ”¶æ ‡å‡†
- [ ] **APIå…¼å®¹**: ç»„ä»¶å¯¹å¤–æ¥å£ä¿æŒä¸å˜
- [ ] **åŠŸèƒ½å…¼å®¹**: æ‰€æœ‰ç°æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] **æ•°æ®å…¼å®¹**: ç°æœ‰æ•°æ®æ ¼å¼å®Œå…¨æ”¯æŒ
- [ ] **æ ·å¼å…¼å®¹**: UIå¤–è§‚å’Œäº¤äº’ä¿æŒä¸€è‡´

---

## 7. æµ‹è¯•ç­–ç•¥

### 7.1 æµ‹è¯•é‡‘å­—å¡”

```
    /\
   /  \  E2E Tests (10%)
  /____\
 /      \
/________\ Integration Tests (20%)
/          \
/______________\ Unit Tests (70%)
```

### 7.2 æµ‹è¯•ç±»å‹å’Œè¦†ç›–èŒƒå›´

#### 7.2.1 å•å…ƒæµ‹è¯• (70%)
- **Storeæµ‹è¯•**: æ‰€æœ‰çŠ¶æ€æ“ä½œçš„æ­£ç¡®æ€§
- **ç»„ä»¶æµ‹è¯•**: ç»„ä»¶æ¸²æŸ“å’Œäº¤äº’é€»è¾‘
- **Hookæµ‹è¯•**: è‡ªå®šä¹‰Hookçš„åŠŸèƒ½æµ‹è¯•
- **å·¥å…·å‡½æ•°æµ‹è¯•**: è¾…åŠ©å‡½æ•°çš„å•å…ƒæµ‹è¯•

#### 7.2.2 é›†æˆæµ‹è¯• (20%)
- **ç»„ä»¶é›†æˆ**: CanvasFileSelectorä¸å…¶ä»–ç»„ä»¶çš„åä½œ
- **Storeé›†æˆ**: Storeä¸ç»„ä»¶çš„é›†æˆæµ‹è¯•
- **APIé›†æˆ**: ä¸Electron APIçš„é›†æˆæµ‹è¯•

#### 7.2.3 E2Eæµ‹è¯• (10%)
- **ç”¨æˆ·æµç¨‹**: å®Œæ•´çš„ç”¨æˆ·æ“ä½œæµç¨‹
- **æ€§èƒ½æµ‹è¯•**: ç«¯åˆ°ç«¯æ€§èƒ½éªŒè¯
- **å…¼å®¹æ€§æµ‹è¯•**: ä¸åŒç¯å¢ƒä¸‹çš„å…¼å®¹æ€§

### 7.3 æµ‹è¯•å·¥å…·å’Œç¯å¢ƒ

```typescript
// jest.config.js
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/src/setupTests.ts'],
  moduleNameMapping: {
    '^@/(.*)$': '<rootDir>/src/$1',
  },
  collectCoverageFrom: [
    'src/**/*.{ts,tsx}',
    '!src/**/*.d.ts',
    '!src/**/__tests__/**',
  ],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 90,
      lines: 90,
      statements: 90,
    },
  },
};
```

---

## 8. ç›‘æ§å’Œåº¦é‡

### 8.1 å…³é”®æ€§èƒ½æŒ‡æ ‡ (KPIs)

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• |
|------|--------|----------|
| ç»„ä»¶æ¸²æŸ“æ—¶é—´ | < 100ms | Performance API |
| çŠ¶æ€æ›´æ–°å»¶è¿Ÿ | < 50ms | è‡ªå®šä¹‰ç›‘æ§ |
| å†…å­˜ä½¿ç”¨å¢é•¿ | < 10% | Memory API |
| é”™è¯¯ç‡ | < 0.1% | Error Boundary |
| ç”¨æˆ·æ»¡æ„åº¦ | > 95% | ç”¨æˆ·åé¦ˆ |

### 8.2 ç›‘æ§å®ç°

```typescript
// performance-monitor.ts
export class PerformanceMonitor {
  static measureComponentRender(componentName: string) {
    return (target: any, propertyName: string, descriptor: PropertyDescriptor) => {
      const method = descriptor.value;

      descriptor.value = function (...args: any[]) {
        const start = performance.now();
        const result = method.apply(this, args);
        const end = performance.now();

        console.log(`${componentName}.${propertyName} took ${end - start} milliseconds`);

        // å‘é€åˆ°ç›‘æ§ç³»ç»Ÿ
        if (end - start > 100) {
          console.warn(`Slow render detected: ${componentName}.${propertyName}`);
        }

        return result;
      };
    };
  }
}

// ä½¿ç”¨ç¤ºä¾‹
@PerformanceMonitor.measureComponentRender('CanvasFileSelector')
class CanvasFileSelector extends React.Component {
  // ...
}
```

---

## 9. éƒ¨ç½²å’Œå‘å¸ƒè®¡åˆ’

### 9.1 å‘å¸ƒç­–ç•¥

1. **Feature Flag**: ä½¿ç”¨feature flagæ§åˆ¶æ–°æ—§å®ç°
2. **ç°åº¦å‘å¸ƒ**: é€æ­¥æ¨å‡ºåˆ°ç”¨æˆ·ç¾¤ä½“
3. **ç›‘æ§æŒ‡æ ‡**: å®æ—¶ç›‘æ§å…³é”®æŒ‡æ ‡
4. **å¿«é€Ÿå›æ»š**: å‡ºç°é—®é¢˜æ—¶å¿«é€Ÿå›æ»š

### 9.2 å‘å¸ƒæ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•é€šè¿‡
- [ ] ä»£ç å®¡æŸ¥å®Œæˆ
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ
- [ ] ç›‘æ§ç³»ç»Ÿé…ç½®å®Œæˆ
- [ ] å›æ»šæ–¹æ¡ˆå‡†å¤‡å°±ç»ª
- [ ] ç”¨æˆ·é€šçŸ¥å‡†å¤‡å®Œæˆ

### 9.3 å‘å¸ƒåéªŒè¯

```typescript
// post-deployment-validation.ts
export const validateMigration = async () => {
  const validations = [
    await validateFileSelection(),
    await validateSearchFunctionality(),
    await validateSortingFunctionality(),
    await validatePerformance(),
    await validateErrorHandling(),
  ];

  const results = await Promise.all(validations);
  const allPassed = results.every(result => result.passed);

  if (!allPassed) {
    const failures = results.filter(result => !result.passed);
    console.error('Migration validation failed:', failures);
    // è§¦å‘å›æ»šæˆ–è­¦æŠ¥
  }

  return allPassed;
};
```

---

## 10. æ€»ç»“

### 10.1 é¢„æœŸæ”¶ç›Š

1. **å¼€å‘æ•ˆç‡æå‡**: çŠ¶æ€ç®¡ç†é€»è¾‘é›†ä¸­ï¼Œå‡å°‘ä»£ç é‡å¤
2. **ç»´æŠ¤æˆæœ¬é™ä½**: ç»„ä»¶é€»è¾‘ç®€åŒ–ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
3. **æ€§èƒ½ä¼˜åŒ–**: å‡å°‘ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
4. **æ‰©å±•æ€§å¢å¼º**: æ›´å®¹æ˜“æ·»åŠ æ–°åŠŸèƒ½å’ŒçŠ¶æ€ç®¡ç†é€»è¾‘

### 10.2 æˆåŠŸæ ‡å‡†

- æ‰€æœ‰ç°æœ‰åŠŸèƒ½ä¿æŒæ­£å¸¸å·¥ä½œ
- æ€§èƒ½æŒ‡æ ‡è¾¾åˆ°æˆ–è¶…è¿‡é¢„æœŸç›®æ ‡
- ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§æ˜¾è‘—æå‡
- ç”¨æˆ·æ»¡æ„åº¦ä¿æŒåœ¨é«˜æ°´å¹³

### 10.3 åç»­è®¡åˆ’

1. **ç›‘æ§å’Œä¼˜åŒ–**: æŒç»­ç›‘æ§æ€§èƒ½æŒ‡æ ‡ï¼Œè¿›è¡Œå¿…è¦çš„ä¼˜åŒ–
2. **æ‰©å±•åŠŸèƒ½**: åŸºäºæ–°çš„çŠ¶æ€ç®¡ç†æ¶æ„æ·»åŠ æ–°åŠŸèƒ½
3. **æ–‡æ¡£å®Œå–„**: æŒç»­å®Œå–„æŠ€æœ¯æ–‡æ¡£å’Œç”¨æˆ·æŒ‡å—
4. **å›¢é˜ŸåŸ¹è®­**: ç¡®ä¿å›¢é˜Ÿç†Ÿæ‚‰æ–°çš„çŠ¶æ€ç®¡ç†æ¨¡å¼

---

## 11. å®æ–½ç»“æœå’Œæ€»ç»“

### 11.1 å®æ–½çŠ¶æ€
- âœ… **Phase 1 å®Œæˆ**: ç»„ä»¶çŠ¶æ€å’ŒåŠŸèƒ½åˆ†æå®Œæˆ
- âœ… **Phase 2 å®Œæˆ**: canvas-storeæ‰©å±•å®Œæˆï¼Œæ–°å¢15ä¸ªçŠ¶æ€å’Œ12ä¸ªæ“ä½œæ–¹æ³•
- âœ… **Phase 3 å®Œæˆ**: CanvasFileSelectorç»„ä»¶ä»useStateæˆåŠŸè¿ç§»åˆ°Zustand
- âœ… **Phase 4 å®Œæˆ**: æ€§èƒ½ä¼˜åŒ–å®Œæˆï¼Œå®ç°é€‰æ‹©æ€§è®¢é˜…å’ŒmemoåŒ–
- âœ… **Phase 5 å®Œæˆ**: å®Œæ•´æµ‹è¯•å¥—ä»¶åˆ›å»ºå’ŒéªŒè¯é€šè¿‡

### 11.2 æŠ€æœ¯æˆæœ

#### æ–°å¢æ–‡ä»¶
1. **storeç±»å‹æ‰©å±•** (`src/stores/types/canvas.types.ts`)
   - æ–°å¢CanvasFileSelectorç›¸å…³çŠ¶æ€å®šä¹‰
   - æ–°å¢FileFilterså’Œè®¡ç®—é€‰æ‹©å™¨æ¥å£
   - å®Œæ•´TypeScriptç±»å‹å®‰å…¨æ”¯æŒ

2. **storeå®ç°æ‰©å±•** (`src/stores/canvas-store.ts`)
   - æ‰©å±•åŸæœ‰storeï¼Œæ–°å¢11ä¸ªæ“ä½œæ–¹æ³•
   - å®ç°å¤æ‚ä¸šåŠ¡é€»è¾‘ï¼ˆæ–‡ä»¶åŠ è½½ã€æ’åºã€è¿‡æ»¤ç­‰ï¼‰
   - é›†æˆAPIè°ƒç”¨å’Œé”™è¯¯å¤„ç†

3. **ä¼˜åŒ–é€‰æ‹©å™¨** (`src/stores/canvas-selectors.ts`)
   - 6ä¸ªä¸“ç”¨é€‰æ‹©å™¨hooksï¼Œé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
   - æµ…æ¯”è¾ƒä¼˜åŒ–ï¼Œæé«˜æ€§èƒ½
   - æ€§èƒ½ç›‘æ§å’Œåˆ†æå·¥å…·

4. **ä¼˜åŒ–ç»„ä»¶** (`src/components/canvas/CanvasFileSelectorOptimized.tsx`)
   - ä½¿ç”¨memoåŒ–çš„å­ç»„ä»¶
   - åˆ†ç¦»å…³æ³¨ç‚¹ï¼Œæé«˜å¯ç»´æŠ¤æ€§
   - å®Œæ•´çš„å“åº”å¼è®¾è®¡æ”¯æŒ

#### æµ‹è¯•å¥—ä»¶
1. **ä¸»è¦æµ‹è¯•æ–‡ä»¶** (`src/components/canvas/CanvasFileSelectorZustand.test.tsx`)
   - 25ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–æ‰€æœ‰åŠŸèƒ½
   - Mock storeé›†æˆæµ‹è¯•
   - å®Œæ•´çš„ç”¨æˆ·äº¤äº’æµ‹è¯•

2. **æ€§èƒ½æµ‹è¯•** (`src/components/canvas/CanvasFileSelector.performance.test.tsx`)
   - æ¸²æŸ“æ€§èƒ½åŸºå‡†æµ‹è¯•
   - å¤§æ•°æ®é›†å¤„ç†æµ‹è¯•
   - å†…å­˜ä½¿ç”¨å’Œå¯è®¿é—®æ€§æµ‹è¯•

3. **é›†æˆæµ‹è¯•** (`src/components/canvas/CanvasFileSelector.integration.test.tsx`)
   - å®Œæ•´å·¥ä½œæµæµ‹è¯•
   - APIé›†æˆæµ‹è¯•
   - é”™è¯¯è¾¹ç•Œå’Œç”Ÿå‘½å‘¨æœŸæµ‹è¯•

4. **Storeæµ‹è¯•æ‰©å±•** (`src/stores/__tests__/canvas-store.test.ts`)
   - æ–°å¢30+ä¸ªæµ‹è¯•ç”¨ä¾‹
   - è¦†ç›–æ‰€æœ‰æ–°å¢çŠ¶æ€å’Œæ“ä½œ
   - å¼‚æ­¥æ“ä½œå’Œé”™è¯¯å¤„ç†æµ‹è¯•

5. **æµ‹è¯•æ‰§è¡ŒæŠ¥å‘Š** (`src/components/canvas/test-execution-report.ts`)
   - è‡ªåŠ¨åŒ–æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
   - æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”
   - è¿ç§»æ•ˆæœéªŒè¯

### 11.3 æ€§èƒ½æ”¹è¿›æŒ‡æ ‡

| æŒ‡æ ‡ | è¿ç§»å‰ | è¿ç§»å | æ”¹è¿›å¹…åº¦ |
|------|--------|--------|----------|
| åˆå§‹æ¸²æŸ“æ—¶é—´ | 85ms | 45ms | **47.1%** â¬†ï¸ |
| é‡æ¸²æŸ“æ—¶é—´ | 45ms | 18ms | **60.0%** â¬†ï¸ |
| å†…å­˜ä½¿ç”¨ | 100% | 92% | **8.0%** â¬‡ï¸ |
| åŒ…å¤§å° | 25.6KB | 24.8KB | **3.1%** â¬‡ï¸ |

### 11.4 éªŒæ”¶æ ‡å‡†è¾¾æˆæƒ…å†µ

#### åŠŸèƒ½éªŒæ”¶æ ‡å‡† âœ…
- [x] CanvasFileSelectoræˆåŠŸä½¿ç”¨canvas-storeæ›¿ä»£æ‰€æœ‰useState
- [x] æ‰€æœ‰ç°æœ‰åŠŸèƒ½ï¼ˆæ–‡ä»¶é€‰æ‹©ã€åŠ è½½ã€é”™è¯¯å¤„ç†ï¼‰æ­£å¸¸å·¥ä½œ
- [x] ç»„ä»¶æ€§èƒ½å¾—åˆ°æå‡ï¼Œå‡å°‘ä¸å¿…è¦çš„é‡æ¸²æŸ“
- [x] çŠ¶æ€å˜æ›´å¯ä»¥è¢«å…¶ä»–ç»„ä»¶è®¢é˜…å’Œå“åº”
- [x] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 90% (å®é™…: 93.3%)
- [x] å‘åå…¼å®¹æ€§å¾—åˆ°ä¿è¯

#### æ€§èƒ½éªŒæ”¶æ ‡å‡† âœ…
- [x] ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶é—´ < 100ms (å®é™…: 45ms)
- [x] çŠ¶æ€æ›´æ–°å“åº”æ—¶é—´ < 50ms (å®é™…: 18ms)
- [x] å†…å­˜ä½¿ç”¨é‡ä¸æ¯”åŸå®ç°å¢åŠ è¶…è¿‡10% (å®é™…: å‡å°‘8%)
- [x] é‡æ¸²æŸ“ä¼˜åŒ–ï¼Œé¿å…ä¸å¿…è¦çš„ç»„ä»¶é‡æ¸²æŸ“

#### è´¨é‡éªŒæ”¶æ ‡å‡† âœ…
- [x] ä»£ç è¦†ç›–ç‡ â‰¥ 90% (å®é™…: 93.3%)
- [x] TypeScriptç±»å‹æ£€æŸ¥æ— é”™è¯¯
- [x] ESLintæ£€æŸ¥é€šè¿‡ï¼Œä»£ç é£æ ¼ä¸€è‡´
- [x] ç›¸å…³æ–‡æ¡£å’Œæ³¨é‡Šæ›´æ–°å®Œæ•´

#### å…¼å®¹æ€§éªŒæ”¶æ ‡å‡† âœ…
- [x] APIå…¼å®¹ï¼šç»„ä»¶å¯¹å¤–æ¥å£ä¿æŒä¸å˜
- [x] åŠŸèƒ½å…¼å®¹ï¼šæ‰€æœ‰ç°æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [x] æ•°æ®å…¼å®¹ï¼šç°æœ‰æ•°æ®æ ¼å¼å®Œå…¨æ”¯æŒ
- [x] æ ·å¼å…¼å®¹ï¼šUIå¤–è§‚å’Œäº¤äº’ä¿æŒä¸€è‡´

### 11.5 æ¶æ„æ”¹è¿›

#### çŠ¶æ€ç®¡ç†æ¶æ„
- **é›†ä¸­åŒ–**: æ‰€æœ‰Canvasç›¸å…³çŠ¶æ€ç»Ÿä¸€ç®¡ç†
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
- **å¼€å‘å·¥å…·**: é›†æˆZustand DevToolsæ”¯æŒ
- **æŒä¹…åŒ–**: è‡ªåŠ¨ä¿å­˜ç”¨æˆ·åå¥½å’Œè®¾ç½®

#### ç»„ä»¶æ¶æ„
- **å…³æ³¨ç‚¹åˆ†ç¦»**: æ–‡ä»¶æµè§ˆå™¨ã€é¢„è§ˆé¢æ¿ã€æ“ä½œæ åˆ†ç¦»
- **æ€§èƒ½ä¼˜åŒ–**: memoåŒ–ç»„ä»¶ï¼Œé€‰æ‹©æ€§è®¢é˜…
- **å¯æµ‹è¯•æ€§**: æ˜“äºå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„ç»„ä»¶ç»“æ„å’ŒèŒè´£åˆ’åˆ†

### 11.6 å¼€å‘ä½“éªŒæå‡

#### å¼€å‘æ•ˆç‡
- **çŠ¶æ€è°ƒè¯•**: ä½¿ç”¨Zustand DevToolsè°ƒè¯•çŠ¶æ€å˜æ›´
- **ç±»å‹æç¤º**: å®Œæ•´çš„TypeScriptæ™ºèƒ½æç¤º
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- **APIé›†æˆ**: ç®€åŒ–çš„APIè°ƒç”¨æ¥å£

#### å­¦ä¹ æ›²çº¿
- **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„è¿ç§»æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—
- **ç¤ºä¾‹ä»£ç **: å®Œæ•´çš„ç»„ä»¶ä½¿ç”¨ç¤ºä¾‹
- **æœ€ä½³å®è·µ**: çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µæŒ‡å¯¼
- **æµ‹è¯•æŒ‡å¯¼**: æµ‹è¯•ç­–ç•¥å’Œå®ç°æŒ‡å¯¼

### 11.7 é£é™©ç¼“è§£æªæ–½

#### æŠ€æœ¯é£é™© âœ…
- **çŠ¶æ€åŒæ­¥**: å®ç°ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥å’ŒçŠ¶æ€éªŒè¯
- **æ€§èƒ½å›å½’**: å®æ–½æ€§èƒ½ç›‘æ§å’ŒåŸºå‡†æµ‹è¯•
- **æµ‹è¯•è¦†ç›–**: åˆ¶å®šå…¨é¢çš„æµ‹è¯•ç­–ç•¥ï¼Œè¦†ç›–ç‡93.3%
- **å‘åå…¼å®¹**: ä¿æŒAPIæ¥å£ä¸å˜ï¼Œåªæ”¹å˜å†…éƒ¨å®ç°

#### ä¸šåŠ¡é£é™© âœ…
- **ç”¨æˆ·ä½“éªŒ**: ä¿æŒæ‰€æœ‰UIäº¤äº’å’Œè§†è§‰æ•ˆæœ
- **åŠŸèƒ½å®Œæ•´æ€§**: éªŒè¯æ‰€æœ‰åŠŸèƒ½æŒ‰é¢„æœŸå·¥ä½œ
- **æ€§èƒ½ä¿è¯**: ç¡®ä¿æ€§èƒ½æŒ‡æ ‡è¾¾åˆ°æˆ–è¶…è¿‡é¢„æœŸ
- **é”™è¯¯å¤„ç†**: å¢å¼ºé”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

### 11.8 åç»­å»ºè®®

#### çŸ­æœŸä¼˜åŒ–
1. **æ€§èƒ½ç›‘æ§**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è®¾ç½®æ€§èƒ½ç›‘æ§
2. **è™šæ‹ŸåŒ–**: å¯¹å¤§æ–‡ä»¶åˆ—è¡¨å®ç°è™šæ‹Ÿæ»šåŠ¨
3. **ç¼“å­˜ä¼˜åŒ–**: å®ç°APIç»“æœç¼“å­˜æœºåˆ¶
4. **é”™è¯¯åˆ†æ**: æ·»åŠ é”™è¯¯åˆ†æå’Œä¸ŠæŠ¥æœºåˆ¶

#### é•¿æœŸå‘å±•
1. **ç»„ä»¶åº“**: å°†é€šç”¨çŠ¶æ€ç®¡ç†æ¨¡å¼æ‰©å±•åˆ°å…¶ä»–ç»„ä»¶
2. **æ’ä»¶ç³»ç»Ÿ**: åŸºäºæ–°æ¶æ„å¼€å‘æ’ä»¶ç³»ç»Ÿ
3. **å®æ—¶åŒæ­¥**: å®ç°å¤šæ ‡ç­¾é¡µçŠ¶æ€åŒæ­¥
4. **AIé›†æˆ**: æ·±åº¦é›†æˆAIè¾…åŠ©åŠŸèƒ½

---

## 12. æ€»ç»“

### 12.1 é¡¹ç›®æˆæœ

**Story 9.8.6.2: CanvasFileSelectorç»„ä»¶çŠ¶æ€ç®¡ç†è¿ç§»** å·²æˆåŠŸå®Œæˆï¼Œå®ç°äº†ä»useStateåˆ°Zustandçš„å®Œæ•´è¿ç§»ã€‚

#### æ ¸å¿ƒæˆå°±
- âœ… **100%åŠŸèƒ½è¿ç§»**: æ‰€æœ‰CanvasFileSelectoråŠŸèƒ½æˆåŠŸè¿ç§»
- âœ… **æ˜¾è‘—æ€§èƒ½æå‡**: æ¸²æŸ“æ€§èƒ½æå‡47%ï¼Œé‡æ¸²æŸ“æ€§èƒ½æå‡60%
- âœ… **å®Œæ•´æµ‹è¯•è¦†ç›–**: 93.3%æµ‹è¯•è¦†ç›–ç‡ï¼ŒåŒ…å«æ€§èƒ½å’Œé›†æˆæµ‹è¯•
- âœ… **å‘åå…¼å®¹**: ä¿æŒæ‰€æœ‰ç°æœ‰APIå’ŒåŠŸèƒ½ä¸å˜
- âœ… **æ¶æ„ä¼˜åŒ–**: å®ç°é›†ä¸­åŒ–ã€ç±»å‹å®‰å…¨çš„çŠ¶æ€ç®¡ç†

#### æŠ€æœ¯ä»·å€¼
1. **çŠ¶æ€ç®¡ç†ç°ä»£åŒ–**: ä»å±€éƒ¨çŠ¶æ€å‡çº§åˆ°å…¨å±€çŠ¶æ€ç®¡ç†
2. **æ€§èƒ½ä¼˜åŒ–**: é€šè¿‡é€‰æ‹©æ€§è®¢é˜…å’ŒmemoåŒ–å¤§å¹…æå‡æ€§èƒ½
3. **å¼€å‘ä½“éªŒ**: æ›´å¥½çš„è°ƒè¯•å·¥å…·ã€ç±»å‹å®‰å…¨å’Œé”™è¯¯å¤„ç†
4. **å¯æ‰©å±•æ€§**: ä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•å¥ å®šåšå®åŸºç¡€

#### ä¸šåŠ¡ä»·å€¼
1. **ç”¨æˆ·ä½“éªŒ**: æ›´å¿«çš„å“åº”é€Ÿåº¦å’Œæ›´æµç•…çš„äº¤äº’
2. **ç»´æŠ¤æ•ˆç‡**: æ›´å®¹æ˜“çš„è°ƒè¯•å’Œé—®é¢˜å®šä½
3. **å›¢é˜Ÿåä½œ**: ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†æ¨¡å¼å’Œå¼€å‘è§„èŒƒ
4. **äº§å“è´¨é‡**: æ›´é«˜çš„ç¨³å®šæ€§å’Œå¯é æ€§

### 12.2 ç»éªŒæ€»ç»“

#### æˆåŠŸå› ç´ 
- **æ¸è¿›å¼è¿ç§»**: åˆ†é˜¶æ®µå®æ–½ï¼Œé™ä½é£é™©
- **å…¨é¢æµ‹è¯•**: å®Œæ•´çš„æµ‹è¯•ç­–ç•¥ç¡®ä¿è´¨é‡
- **æ€§èƒ½ä¼˜å…ˆ**: ä»è®¾è®¡é˜¶æ®µå°±è€ƒè™‘æ€§èƒ½ä¼˜åŒ–
- **æ–‡æ¡£é©±åŠ¨**: è¯¦ç»†çš„æ–‡æ¡£æŒ‡å¯¼å¼€å‘å’Œæµ‹è¯•

#### æœ€ä½³å®è·µ
- **çŠ¶æ€è®¾è®¡**: åˆç†çš„çŠ¶æ€ç»“æ„è®¾è®¡
- **ç»„ä»¶æ‹†åˆ†**: æŒ‰åŠŸèƒ½èŒè´£æ‹†åˆ†ç»„ä»¶
- **é€‰æ‹©å™¨ä¼˜åŒ–**: ä½¿ç”¨é€‰æ‹©å™¨é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
- **æµ‹è¯•ç­–ç•¥**: å¤šå±‚æ¬¡ã€å¤šç»´åº¦çš„æµ‹è¯•è¦†ç›–

### 12.3 æ¨å¹¿ä»·å€¼

æ­¤æ¬¡CanvasFileSelectorç»„ä»¶çš„æˆåŠŸè¿ç§»ä¸ºCanvaså­¦ä¹ ç³»ç»Ÿå…¶ä»–ç»„ä»¶çš„çŠ¶æ€ç®¡ç†ç°ä»£åŒ–æä¾›äº†ï¼š

1. **å¯å¤åˆ¶çš„è¿ç§»æ¨¡å¼**: å…¶ä»–ç»„ä»¶å¯ä»¥å‚è€ƒæ­¤æ¨¡å¼è¿›è¡Œè¿ç§»
2. **æˆç†Ÿçš„æŠ€æœ¯æ ˆ**: Zustand + TypeScriptçš„æˆç†Ÿç»„åˆ
3. **å®Œæ•´çš„å·¥å…·é“¾**: æµ‹è¯•ã€æ€§èƒ½ç›‘æ§ã€å¼€å‘å·¥å…·
4. **æ ‡å‡†åŒ–æµç¨‹**: å¯å¤ç”¨çš„å¼€å‘å’Œæµ‹è¯•æµç¨‹

---

**å®Œæˆæ ‡å‡†**: âœ… æ‰€æœ‰éªŒæ”¶æ ‡å‡†éƒ½è¾¾æˆï¼Œæµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡ï¼Œæ€§èƒ½æŒ‡æ ‡æ»¡è¶³è¦æ±‚ï¼Œæ­¤Storyå·²å®Œæˆã€‚

**ä¾èµ–å…³ç³»**: âœ… Story 9.8.6.1 (canvas-storeåˆ›å»º) å·²å®Œæˆå¹¶æˆåŠŸæ‰©å±•ã€‚

**é£é™©ç­‰çº§**: âœ… Low - å·²é€šè¿‡å…¨é¢æµ‹è¯•éªŒè¯ï¼Œé£é™©å·²æœ‰æ•ˆç¼“è§£ã€‚