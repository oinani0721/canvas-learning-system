# Story 9.5: Canvas学习监控仪表盘实现

## Status
Ready for Development

## Story

**As a** Canvas学习系统用户，
**I want** 在主仪表盘页面查看所有Canvas的学习状态、智能复习提醒和记忆统计，
**so that** 我能够一目了然地了解Canvas学习进度，知道何时复习哪个Canvas，并快速导航到具体Canvas进行学习。

## Acceptance Criteria

1: 实现完整的Canvas学习监控仪表盘，包含Canvas学习概览、智能复习提醒和学习分析区域
2: 创建CanvasLearningCards组件，显示每个Canvas的学习状态（红/绿/紫/黄节点分布）和复习提醒
3: 实现ReviewTimeline组件，显示基于艾宾浩斯算法的智能复习时间线（今天、明天、未来7天）
4: 创建SmartReminder组件，突出显示今日需要复习的Canvas和紧急程度
5: 实现MemoryAnalytics组件，使用ECharts展示学习进度趋势和记忆保持率图表
6: 集成Story 9.4扩展的API服务层，获取Canvas学习数据、复习计划和记忆统计
7: 实现响应式布局，支持移动端和桌面端的最佳学习监控体验
8: 添加实时学习状态更新，为Socket.IO集成预留接口（学习进度变化时自动刷新）
9: 实现学习数据智能刷新，支持手动刷新和基于学习活动的自动刷新
10: 集成Canvas颜色系统和复习优先级标识，使用统一的视觉语言（红色=急需复习，黄色=需要关注）
11: 添加Canvas学习概览，当没有Canvas数据时显示友好的学习引导界面
12: 实现页面级别的错误边界，确保API错误不会影响学习监控体验
13: 支持学习报告导出，允许用户导出Canvas学习进度和复习统计数据

## Tasks / Subtasks

- [ ] Task 1: Canvas学习监控仪表盘基础结构
  - [ ] Subtask 1.1: 创建Dashboard.tsx页面组件（学习监控版本）
  - [ ] Subtask 1.2: 实现学习监控页面布局和响应式设计
  - [ ] Subtask 1.3: 集成错误边界和加载状态（学习数据加载）
  - [ ] Subtask 1.4: 添加学习监控页面标题和智能操作导航

- [ ] Task 2: Canvas学习状态卡片组件实现 ⭐ **核心功能**
  - [ ] Subtask 2.1: 创建CanvasLearningCards组件
  - [ ] Subtask 2.2: 实现CanvasLearningCard单个Canvas学习状态卡片
  - [ ] Subtask 2.3: 显示Canvas节点状态分布（红/绿/紫/黄/蓝节点数量和百分比）
  - [ ] Subtask 2.4: 显示Canvas学习进度和掌握率趋势
  - [ ] Subtask 2.5: 实现Canvas卡片点击导航到Canvas详情页

- [ ] Task 3: 智能复习提醒组件实现 ⭐ **核心功能**
  - [ ] Subtask 3.1: 创建ReviewTimeline复习时间线组件
  - [ ] Subtask 3.2: 创建SmartReminder智能复习提醒组件
  - [ ] Subtask 3.3: 实现今日复习Canvas优先级排序（基于艾宾浩斯算法）
  - [ ] Subtask 3.4: 显示复习紧急程度（红色=紧急复习，黄色=需要关注）
  - [ ] Subtask 3.5: 实现复习任务完成状态跟踪

- [ ] Task 4: 学习分析图表组件实现 ⭐ **核心功能**
  - [ ] Subtask 4.1: 创建MemoryAnalytics记忆分析组件
  - [ ] Subtask 4.2: 实现LearningProgressTrend学习进度趋势图
  - [ ] Subtask 4.3: 实现MemoryRetentionCurve记忆保持率曲线图
  - [ ] Subtask 4.4: 创建CanvasPerformanceMatrix Canvas学习表现矩阵
  - [ ] Subtask 4.5: 实现学习数据图表交互和筛选功能

- [ ] Task 5: 学习数据集成和状态管理 ⭐ **数据核心**
  - [ ] Subtask 5.1: 集成Story 9.4扩展的API服务层（Canvas学习、复习计划、记忆统计）
  - [ ] Subtask 5.2: 实现学习数据智能缓存和增量更新策略
  - [ ] Subtask 5.3: 添加学习数据手动刷新和基于学习活动的自动刷新
  - [ ] Subtask 5.4: 实现Canvas学习状态实时同步（为Socket.IO预留接口）
  - [ ] Subtask 5.5: 支持学习报告导出和复习计划管理

- [ ] Task 6: 学习监控用户体验优化
  - [ ] Subtask 6.1: 实现Canvas学习概览空状态和引导界面
  - [ ] Subtask 6.2: 添加学习进度提醒和成就展示
  - [ ] Subtask 6.3: 实现Canvas学习状态快速筛选和排序
  - [ ] Subtask 6.4: 优化移动端学习监控体验
  - [ ] Subtask 6.5: 添加学习数据个性化设置和偏好保存

## Dev Notes

### Previous Story Insights

从Story 9.2 (前端项目基础架构搭建) 中获得的关键经验：
- **ECharts 5.6.0已安装**: 数据可视化库已准备就绪，支持复杂的学习数据图表
- **Ant Design 5.27.6已配置**: UI组件库和主题系统已完成，支持学习监控界面设计
- **Canvas颜色系统集成**: 红/绿/紫/蓝/黄颜色语义已定义，可直接用于学习状态展示
- **TypeScript类型系统完整**: Dashboard相关类型定义已创建，可扩展为学习数据类型

从Story 9.3 (路由和页面框架实现) 中获得的基础：
- **页面路由配置**: Dashboard路由已设置，支持懒加载，可承载学习监控功能
- **布局组件结构**: Layout组件提供页面框架和导航，适合学习监控布局
- **响应式设计基础**: Tailwind CSS断点和布局系统已配置，支持学习监控响应式体验

从Story 9.4 (API服务层扩展 - Canvas与记忆系统集成) 中获得的数据层 ⭐ **关键扩展**：
- **扩展API服务层**: CanvasService、MCMemoryService、CanvasLearningService、ReviewScheduleService
- **MCP记忆系统集成**: /review、/memory-stats、/learning-report、/review-progress命令数据接口
- **完整学习数据类型**: ReviewTask、MemoryStats、LearningReport、CanvasLearningProgress等核心数据模型
- **MCP命令代理**: 为前端提供调用现有复习命令的统一接口
- **错误处理机制**: 学习数据API错误处理和重试策略已实现

### Technical Context

**Canvas学习监控技术栈** [Source: canvas-progress-tracker-frontend-spec.md#核心组件规范]:
- **ECharts 5.6.0**: 主要图表库，支持学习进度趋势图、记忆保持率曲线、复习优先级热力图
- **React 19.1.1**: 组件状态管理和生命周期处理，支持学习数据实时更新
- **Ant Design 5.27.6**: 卡片、统计、布局等UI组件，适合学习监控界面设计
- **TypeScript 5.9.3**: 类型安全和接口定义，完整的学习数据类型系统
- **Tailwind CSS**: 响应式布局和样式设计，支持移动端学习监控体验

**Canvas学习监控设计规范** [Source: canvas-progress-tracker-frontend-spec.md#设计规范]:
```css
/* Canvas学习监控布局 */
.canvas-learning-dashboard {
  padding: 24px;
  background: var(--background, #fafafa);
}

/* Canvas学习卡片网格布局 */
.canvas-learning-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 20px;
  margin-bottom: 32px;
}

/* 智能复习提醒区域布局 */
.review-reminder-section {
  background: linear-gradient(135deg, #fff7e6 0%, #f0f5ff 100%);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 32px;
  border-left: 4px solid #faad14;
}

/* 学习分析图表区域布局 */
.learning-analytics-section {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 24px;
  margin-bottom: 32px;
}

/* 响应式断点 */
@media (max-width: 1200px) {
  .learning-analytics-section {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .canvas-learning-cards {
    grid-template-columns: 1fr;
  }
  .review-reminder-section {
    padding: 16px;
  }
}

/* 学习状态颜色语义 */
.learning-status-red { color: #ff4d4f; background: #fff2f0; }
.learning-status-yellow { color: #faad14; background: #fffbe6; }
.learning-status-purple { color: #722ed1; background: #f9f0ff; }
.learning-status-green { color: #52c41a; background: #f6ffed; }
.learning-status-blue { color: #1890ff; background: #f0f5ff; }

/* 复习紧急程度标识 */
.review-urgent { border-color: #ff4d4f; box-shadow: 0 2px 8px rgba(255, 77, 79, 0.2); }
.review-attention { border-color: #faad14; box-shadow: 0 2px 8px rgba(250, 173, 20, 0.2); }
.review-scheduled { border-color: #52c41a; box-shadow: 0 2px 8px rgba(82, 196, 26, 0.1); }
```

### Data Models

**Canvas学习监控数据结构** ⭐ **重构**:
```typescript
interface CanvasLearningDashboardData {
  canvasLearningOverview: CanvasLearningOverview;
  reviewReminders: ReviewReminders;
  memoryAnalytics: MemoryAnalytics;
  learningInsights: LearningInsights;
  recentLearningActivities: LearningActivityItem[];
}

interface CanvasLearningOverview {
  totalCanvases: number;
  activeLearningCanvases: number;
  averageCompletionRate: number;
  averageMasteryRate: number;
  totalStudyTime: number;
  learningTrend: 'improving' | 'stable' | 'declining';
  todayStudySessions: number;
  weeklyProgress: WeeklyProgress;
}

interface ReviewReminders {
  todayReviews: ReviewTask[];
  urgentReviews: ReviewTask[];
  upcomingReviews: ReviewTask[];
  reviewTimeline: ReviewTimelineItem[];
  nextReviewDate: string;
  reviewStreak: number;
  reviewPerformance: ReviewPerformance;
}

interface MemoryAnalytics {
  totalMemoryStrength: number;
  averageRetentionRate: number;
  learningVelocity: number;
  memoryEfficiency: number;
  subjectPerformance: SubjectPerformance[];
  memoryHeatmap: MemoryHeatmapData[];
  forgettingCurve: ForgettingCurveData[];
}

interface LearningInsights {
  strongestSubjects: string[];
  improvementAreas: string[];
  learningPatterns: LearningPattern[];
  recommendations: LearningRecommendation[];
  achievements: Achievement[];
  personalizedGoals: LearningGoal[];
}

interface CanvasLearningProgress {
  canvasId: string;
  canvasName: string;
  totalNodes: number;
  redNodes: number;
  yellowNodes: number;
  purpleNodes: number;
  greenNodes: number;
  blueNodes: number;
  completionRate: number;
  masteryRate: number;
  lastStudyTime: string;
  nextReviewDate: string;
  studyCount: number;
  averageScore: number;
  improvementTrend: 'improving' | 'stable' | 'declining';
  reviewUrgency: 'urgent' | 'attention' | 'scheduled';
  learningVelocity: number;
}

interface ReviewTask {
  scheduleId: string;
  canvasFile: string;
  canvasId: string;
  conceptName: string;
  nodeId: string;
  nextReviewDate: string;
  reviewIntervalDays: number;
  memoryStrength: number;
  retentionRate: number;
  masteryLevel: number;
  lastReviewScore?: number;
  urgency: 'urgent' | 'attention' | 'scheduled';
  estimatedTime: number;
}

interface MemoryHeatmapData {
  date: string;
  studyIntensity: number;
  reviewQuality: number;
  memoryStrength: number;
  subject: string;
}
```

**学习分析图表配置接口** ⭐ **重构**:
```typescript
interface LearningAnalyticsConfig {
  learningProgressChart: {
    timeRange: '7d' | '30d' | '90d';
    showDataLabels: boolean;
    showLegend: boolean;
    animationDuration: number;
    metrics: 'completionRate' | 'masteryRate' | 'memoryStrength' | 'studyTime';
  };
  memoryRetentionChart: {
    showForgettingCurve: boolean;
    showMemoryStrength: boolean;
    showOptimalReviewPoints: boolean;
    animationDuration: number;
  };
  reviewHeatmap: {
    timeRange: '30d' | '90d' | '1y';
    showIntensity: boolean;
    showSubjects: boolean;
    colorScheme: 'viridis' | 'blues' | 'greens';
  };
  subjectPerformanceRadar: {
    showComparison: boolean;
    showTrends: boolean;
    animationDuration: number;
  };
  reviewTimeline: {
    days: number;
    showUrgency: boolean;
    showEstimatedTime: boolean;
    groupByPriority: boolean;
  };
}
```

### API Specifications

**Canvas学习监控数据获取** [Source: Story 9.4 扩展API服务设计和canvas-progress-tracker-frontend-spec.md]:
```typescript
// src/services/canvasLearningDashboardService.ts
export class CanvasLearningDashboardService {
  private static apiClient = createApiClient();

  // 获取Canvas学习监控概览数据
  static async getCanvasLearningOverview(): Promise<CanvasLearningDashboardData> {
    const [
      canvasOverview,
      reviewReminders,
      memoryAnalytics,
      learningInsights,
      recentActivities
    ] = await Promise.all([
      CanvasLearningService.getAllCanvasLearningOverview(),
      ReviewScheduleService.getReviewTimeline(7),
      MCMemoryService.getMemoryStats({ detailed: true }),
      MCMemoryService.getLearningReport(30),
      this.getRecentLearningActivities()
    ]);

    return {
      canvasLearningOverview: canvasOverview,
      reviewReminders,
      memoryAnalytics,
      learningInsights,
      recentLearningActivities
    };
  }

  // 获取今日复习提醒
  static async getTodayReviewReminders(): Promise<ReviewReminders> {
    const todayReviews = await MCMemoryService.getTodayReviews();
    const reviewPriorities = await ReviewScheduleService.getReviewPriorities();
    const reviewTimeline = await ReviewScheduleService.getReviewTimeline(7);

    return {
      todayReviews: todayReviews.filter(review => isToday(review.nextReviewDate)),
      urgentReviews: reviewPriorities.filter(p => p.urgency === 'immediate'),
      upcomingReviews: reviewPriorities.filter(p => p.urgency === 'scheduled'),
      reviewTimeline,
      nextReviewDate: reviewTimeline[0]?.date || '',
      reviewStreak: calculateReviewStreak(todayReviews),
      reviewPerformance: calculateReviewPerformance(todayReviews)
    };
  }

  // 获取记忆分析数据
  static async getMemoryAnalytics(): Promise<MemoryAnalytics> {
    const memoryStats = await MCMemoryService.getMemoryStats({ detailed: true });
    const learningReport = await MCMemoryService.getLearningReport(30);

    return {
      totalMemoryStrength: memoryStats.semanticMemories,
      averageRetentionRate: calculateAverageRetention(memoryStats),
      learningVelocity: calculateLearningVelocity(learningReport),
      memoryEfficiency: calculateMemoryEfficiency(memoryStats),
      subjectPerformance: learningReport.subjects,
      memoryHeatmap: generateMemoryHeatmap(learningReport),
      forgettingCurve: generateForgettingCurve(memoryStats)
    };
  }

  // 获取学习洞察
  static async getLearningInsights(): Promise<LearningInsights> {
    const learningReport = await MCMemoryService.getLearningReport(30);
    const reviewProgress = await MCMemoryService.getReviewProgress();

    return {
      strongestSubjects: getStrongestSubjects(learningReport),
      improvementAreas: getImprovementAreas(learningReport),
      learningPatterns: analyzeLearningPatterns(learningReport),
      recommendations: generateLearningRecommendations(learningReport),
      achievements: extractAchievements(learningReport),
      personalizedGoals: generatePersonalizedGoals(learningReport, reviewProgress)
    };
  }

  // 获取最近学习活动
  static async getRecentLearningActivities(limit: number = 20): Promise<LearningActivityItem[]> {
    // 这个方法需要从Canvas活动记录和复习记录中整合数据
    const recentCanvasActivities = await getRecentCanvasActivities(limit);
    const recentReviewActivities = await getRecentReviewActivities(limit);

    return [...recentCanvasActivities, ...recentReviewActivities]
      .sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime())
      .slice(0, limit);
  }
}
```

### Component Specifications

**Canvas学习监控主组件结构** ⭐ **重构** [Source: canvas-progress-tracker-frontend-spec.md#核心组件规范]:
```typescript
// src/pages/Dashboard.tsx
const CanvasLearningDashboard: React.FC = () => {
  const [dashboardData, setDashboardData] = useState<CanvasLearningDashboardData | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<ApiError | null>(null);
  const [refreshInterval, setRefreshInterval] = useState<number>(60000); // 1分钟，学习数据更新频率更高
  const [selectedTimeRange, setSelectedTimeRange] = useState<'7d' | '30d' | '90d'>('30d');

  // 学习数据获取逻辑
  const fetchLearningData = useCallback(async () => {
    try {
      setLoading(true);
      const data = await CanvasLearningDashboardService.getCanvasLearningOverview();
      setDashboardData(data);
    } catch (err) {
      setError(err as ApiError);
    } finally {
      setLoading(false);
    }
  }, []);

  // 组件挂载时获取学习数据
  useEffect(() => {
    fetchLearningData();

    // 设置学习数据自动刷新（学习数据变化更频繁）
    const interval = setInterval(fetchLearningData, refreshInterval);
    return () => clearInterval(interval);
  }, [fetchLearningData, refreshInterval]);

  return (
    <div className="canvas-learning-dashboard">
      <PageHeader
        title="Canvas学习监控"
        subTitle="智能学习进度追踪与复习提醒"
        extra={[
          <Select
            key="timeRange"
            value={selectedTimeRange}
            onChange={setSelectedTimeRange}
            style={{ width: 120 }}
          >
            <Select.Option value="7d">7天</Select.Option>
            <Select.Option value="30d">30天</Select.Option>
            <Select.Option value="90d">90天</Select.Option>
          </Select>,
          <Button key="refresh" icon={<ReloadOutlined />} onClick={fetchLearningData}>
            刷新学习数据
          </Button>,
          <Button key="export" icon={<ExportOutlined />} onClick={handleExportLearningReport}>
            导出学习报告
          </Button>,
        ]}
      />

      {/* 智能复习提醒区域 */}
      <SmartReminder
        reviewReminders={dashboardData?.reviewReminders}
        loading={loading}
        onReviewComplete={handleReviewComplete}
      />

      {/* Canvas学习状态卡片 */}
      <CanvasLearningCards
        canvasProgress={dashboardData?.canvasLearningOverview}
        loading={loading}
        onCanvasClick={handleCanvasClick}
      />

      {/* 学习分析图表区域 */}
      <Row gutter={[24, 24]}>
        <Col xs={24} lg={16}>
          <MemoryAnalytics
            analyticsData={dashboardData?.memoryAnalytics}
            timeRange={selectedTimeRange}
            loading={loading}
          />
        </Col>
        <Col xs={24} lg={8}>
          <LearningInsights
            insightsData={dashboardData?.learningInsights}
            loading={loading}
          />
        </Col>
      </Row>

      {/* 最近学习活动 */}
      <RecentLearningActivities
        activities={dashboardData?.recentLearningActivities}
        loading={loading}
        onActivityClick={handleActivityClick}
      />
    </div>
  );
};
```

**Canvas学习状态卡片组件** ⭐ **新增核心组件**:
```typescript
// src/components/dashboard/CanvasLearningCards.tsx
interface CanvasLearningCardsProps {
  canvasProgress?: CanvasLearningOverview;
  loading?: boolean;
  onCanvasClick?: (canvasId: string) => void;
}

const CanvasLearningCards: React.FC<CanvasLearningCardsProps> = ({
  canvasProgress,
  loading,
  onCanvasClick
}) => {
  if (loading) {
    return <CanvasLearningCardsSkeleton />;
  }

  const canvasData = canvasProgress?.canvasList || [];

  return (
    <div className="canvas-learning-cards">
      <div className="section-header">
        <h2 className="section-title">
          <BookOutlined /> Canvas学习状态
        </h2>
        <span className="section-subtitle">
          共 {canvasData.length} 个Canvas在学习中
        </span>
      </div>

      <Row gutter={[20, 20]}>
        {canvasData.map((canvas) => (
          <Col key={canvas.canvasId} xs={24} sm={12} lg={8} xl={6}>
            <CanvasLearningCard
              canvas={canvas}
              onClick={() => onCanvasClick?.(canvas.canvasId)}
            />
          </Col>
        ))}
      </Row>
    </div>
  );
};

// 单个Canvas学习状态卡片
interface CanvasLearningCardProps {
  canvas: CanvasLearningProgress;
  onClick?: () => void;
}

const CanvasLearningCard: React.FC<CanvasLearningCardProps> = ({ canvas, onClick }) => {
  const urgencyClass = canvas.reviewUrgency === 'urgent' ? 'review-urgent' :
                      canvas.reviewUrgency === 'attention' ? 'review-attention' : 'review-scheduled';

  return (
    <Card
      className={`canvas-learning-card ${urgencyClass}`}
      hoverable
      onClick={onClick}
      title={
        <div className="card-header">
          <span className="canvas-name">{canvas.canvasName}</span>
          {canvas.reviewUrgency === 'urgent' && (
            <Tag color="red" size="small">紧急复习</Tag>
          )}
          {canvas.reviewUrgency === 'attention' && (
            <Tag color="orange" size="small">需要关注</Tag>
          )}
        </div>
      }
      extra={
        <div className="card-extra">
          {canvas.improvementTrend === 'improving' && (
            <TrendingUpOutlined style={{ color: '#52c41a' }} />
          )}
          {canvas.improvementTrend === 'declining' && (
            <TrendingDownOutlined style={{ color: '#ff4d4f' }} />
          )}
        </div>
      }
    >
      {/* Canvas节点状态分布 */}
      <div className="node-distribution">
        <div className="distribution-row">
          <span className="node-indicator learning-status-red"></span>
          <span>不理解: {canvas.redNodes}</span>
          <Progress
            percent={(canvas.redNodes / canvas.totalNodes) * 100}
            size="small"
            strokeColor="#ff4d4f"
            showInfo={false}
          />
        </div>

        <div className="distribution-row">
          <span className="node-indicator learning-status-yellow"></span>
          <span>学习中: {canvas.yellowNodes}</span>
          <Progress
            percent={(canvas.yellowNodes / canvas.totalNodes) * 100}
            size="small"
            strokeColor="#faad14"
            showInfo={false}
          />
        </div>

        <div className="distribution-row">
          <span className="node-indicator learning-status-purple"></span>
          <span>部分理解: {canvas.purpleNodes}</span>
          <Progress
            percent={(canvas.purpleNodes / canvas.totalNodes) * 100}
            size="small"
            strokeColor="#722ed1"
            showInfo={false}
          />
        </div>

        <div className="distribution-row">
          <span className="node-indicator learning-status-green"></span>
          <span>已掌握: {canvas.greenNodes}</span>
          <Progress
            percent={(canvas.greenNodes / canvas.totalNodes) * 100}
            size="small"
            strokeColor="#52c41a"
            showInfo={false}
          />
        </div>
      </div>

      {/* 学习进度和复习信息 */}
      <div className="learning-info">
        <div className="progress-summary">
          <div className="progress-item">
            <span className="label">完成率</span>
            <span className="value">{canvas.completionRate}%</span>
          </div>
          <div className="progress-item">
            <span className="label">掌握率</span>
            <span className="value">{canvas.masteryRate}%</span>
          </div>
        </div>

        <div className="review-info">
          <div className="review-date">
            <ClockCircleOutlined />
            下次复习: {formatDate(canvas.nextReviewDate)}
          </div>
          <div className="study-count">
            <ReadOutlined />
            学习次数: {canvas.studyCount}
          </div>
        </div>
      </div>
    </Card>
  );
};
```

**智能复习提醒组件** ⭐ **新增核心组件**:
```typescript
// src/components/dashboard/SmartReminder.tsx
interface SmartReminderProps {
  reviewReminders?: ReviewReminders;
  loading?: boolean;
  onReviewComplete?: (scheduleId: string, rating: number) => void;
}

const SmartReminder: React.FC<SmartReminderProps> = ({
  reviewReminders,
  loading,
  onReviewComplete
}) => {
  if (loading) {
    return <SmartReminderSkeleton />;
  }

  const { todayReviews, urgentReviews, upcomingReviews, reviewTimeline } = reviewReminders || {};

  return (
    <div className="review-reminder-section">
      <div className="reminder-header">
        <div className="header-left">
          <BellOutlined className="reminder-icon" />
          <div className="header-text">
            <h3 className="reminder-title">智能复习提醒</h3>
            <p className="reminder-subtitle">
              基于艾宾浩斯遗忘曲线的个性化复习计划
            </p>
          </div>
        </div>
        <div className="header-stats">
          <Statistic
            title="今日复习"
            value={todayReviews?.length || 0}
            suffix="个"
            valueStyle={{ color: '#faad14' }}
          />
          <Statistic
            title="紧急复习"
            value={urgentReviews?.length || 0}
            suffix="个"
            valueStyle={{ color: '#ff4d4f' }}
          />
        </div>
      </div>

      {/* 今日复习任务 */}
      {(todayReviews?.length || 0) > 0 && (
        <Card title="今日复习任务" size="small" className="today-reviews-card">
          <List
            dataSource={todayReviews?.slice(0, 3)}
            renderItem={(review) => (
              <List.Item
                actions={[
                  <Button
                    type="primary"
                    size="small"
                    onClick={() => handleStartReview(review)}
                  >
                    开始复习
                  </Button>
                ]}
              >
                <List.Item.Meta
                  avatar={
                    <Avatar
                      style={{
                        backgroundColor: review.urgency === 'urgent' ? '#ff4d4f' :
                                       review.urgency === 'attention' ? '#faad14' : '#52c41a'
                      }}
                    >
                      <BookOutlined />
                    </Avatar>
                  }
                  title={review.conceptName}
                  description={
                    <div className="review-meta">
                      <Tag color="blue">{review.canvasFile}</Tag>
                      <span className="review-info">
                        记忆强度: {review.memoryStrength.toFixed(1)} |
                        保持率: {(review.retentionRate * 100).toFixed(1)}%
                      </span>
                    </div>
                  }
                />
              </List.Item>
            )}
          />
          {(todayReviews?.length || 0) > 3 && (
            <div className="view-more">
              <Button type="link" size="small">
                查看全部 {todayReviews.length} 个复习任务 →
              </Button>
            </div>
          )}
        </Card>
      )}

      {/* 复习时间线 */}
      <ReviewTimeline
        timeline={reviewTimeline}
        onReviewClick={handleReviewClick}
      />
    </div>
  );
};

// 复习时间线组件
interface ReviewTimelineProps {
  timeline?: ReviewTimelineItem[];
  onReviewClick?: (review: ReviewTask) => void;
}

const ReviewTimeline: React.FC<ReviewTimelineProps> = ({ timeline, onReviewClick }) => {
  const getTimelineIcon = (review: ReviewTask) => {
    if (review.urgency === 'urgent') {
      return <ExclamationCircleOutlined style={{ color: '#ff4d4f' }} />;
    }
    if (review.urgency === 'attention') {
      return <ClockCircleOutlined style={{ color: '#faad14' }} />;
    }
    return <CheckCircleOutlined style={{ color: '#52c41a' }} />;
  };

  const getTimelineColor = (review: ReviewTask) => {
    if (review.urgency === 'urgent') return 'red';
    if (review.urgency === 'attention') return 'orange';
    return 'green';
  };

  return (
    <Card title="复习时间线" size="small" className="review-timeline-card">
      <Timeline
        mode="left"
        items={timeline?.map((item, index) => ({
          key: `${item.date}-${index}`,
          dot: { style: { background: item.status === 'overdue' ? '#ff4d4f' : '#52c41a' } },
          color: getTimelineColor(item.concepts[0]),
          children: (
            <div className="timeline-item">
              <div className="timeline-date">{formatDate(item.date)}</div>
              <div className="timeline-content">
                <div className="timeline-title">
                  {item.concepts.length > 0 ? item.concepts[0].conceptName : '复习任务'}
                </div>
                {item.concepts.map((review, idx) => (
                  <div key={idx} className="review-item" onClick={() => onReviewClick?.(review)}>
                    {getTimelineIcon(review)}
                    <span className="review-text">
                      {review.conceptName} ({review.canvasFile})
                    </span>
                    <Tag size="small" color={getTimelineColor(review)}>
                      预计 {review.estimatedTime} 分钟
                    </Tag>
                  </div>
                ))}
              </div>
            </div>
          ),
        }))}
      />
    </Card>
  );
};
```

### File Locations

**项目根目录**: `canvas-progress-tracker/` [Source: canvas-progress-tracker-frontend-spec.md#项目结构]

**关键文件位置**:
- `src/pages/Dashboard.tsx` - Canvas学习监控仪表盘页面 ⭐ **重构**
- `src/components/dashboard/CanvasLearningCards.tsx` - Canvas学习状态卡片组件 ⭐ **新增**
- `src/components/dashboard/CanvasLearningCard.tsx` - 单个Canvas学习状态卡片 ⭐ **新增**
- `src/components/dashboard/SmartReminder.tsx` - 智能复习提醒组件 ⭐ **新增**
- `src/components/dashboard/ReviewTimeline.tsx` - 复习时间线组件 ⭐ **新增**
- `src/components/charts/MemoryAnalytics.tsx` - 记忆分析图表组件 ⭐ **新增**
- `src/components/charts/LearningProgressTrend.tsx` - 学习进度趋势图 ⭐ **新增**
- `src/components/charts/MemoryRetentionCurve.tsx` - 记忆保持率曲线图 ⭐ **新增**
- `src/components/dashboard/LearningInsights.tsx` - 学习洞察组件 ⭐ **新增**
- `src/components/dashboard/RecentLearningActivities.tsx` - 最近学习活动列表 ⭐ **重构**
- `src/services/canvasLearningDashboardService.ts` - Canvas学习监控数据服务 ⭐ **新增**
- `src/hooks/useCanvasLearningData.ts` - Canvas学习数据管理Hook ⭐ **新增**

### Testing Requirements

**测试框架配置** [Source: Story 9.2测试配置]:
- **测试框架**: Jest + React Testing Library + @testing-library/jest-dom
- **图表测试**: 使用echarts-for-react和mock-echarts
- **API测试**: MSW或axios-mock-adapter模拟API响应
- **覆盖率要求**: >85%代码覆盖率

**核心测试文件**:
- `tests/pages/Dashboard.test.tsx` - Canvas学习监控仪表盘页面测试 ⭐ **重构**
- `tests/components/dashboard/CanvasLearningCards.test.tsx` - Canvas学习状态卡片测试 ⭐ **新增**
- `tests/components/dashboard/SmartReminder.test.tsx` - 智能复习提醒组件测试 ⭐ **新增**
- `tests/components/charts/MemoryAnalytics.test.tsx` - 记忆分析图表测试 ⭐ **新增**
- `tests/components/charts/LearningProgressTrend.test.tsx` - 学习进度趋势图测试 ⭐ **新增**
- `tests/components/charts/MemoryRetentionCurve.test.tsx` - 记忆保持率曲线图测试 ⭐ **新增**
- `tests/components/dashboard/LearningInsights.test.tsx` - 学习洞察组件测试 ⭐ **新增**
- `tests/services/canvasLearningDashboardService.test.ts` - Canvas学习监控数据服务测试 ⭐ **新增**
- `tests/hooks/useCanvasLearningData.test.tsx` - Canvas学习数据Hook测试 ⭐ **新增**

**Canvas学习监控组件测试示例** ⭐ **重构**:
```typescript
// tests/pages/Dashboard.test.tsx
describe('Canvas Learning Dashboard Page', () => {
  let mockCanvasLearningService: jest.Mocked<typeof CanvasLearningService>;
  let mockMCMemoryService: jest.Mocked<typeof MCMemoryService>;
  let mockReviewScheduleService: jest.Mocked<typeof ReviewScheduleService>;

  beforeEach(() => {
    mockCanvasLearningService = createMockCanvasLearningService();
    mockMCMemoryService = createMockMCMemoryService();
    mockReviewScheduleService = createMockReviewScheduleService();
  });

  test('should render Canvas learning monitoring dashboard with learning cards', async () => {
    const mockData = createMockCanvasLearningData();
    mockCanvasLearningService.getAllCanvasLearningOverview.mockResolvedValue(mockData.canvasOverview);
    mockMCMemoryService.getTodayReviews.mockResolvedValue(mockData.reviewReminders.todayReviews);

    render(<CanvasLearningDashboard />);

    await waitFor(() => {
      expect(screen.getByText('Canvas学习监控')).toBeInTheDocument();
      expect(screen.getByText('Canvas学习状态')).toBeInTheDocument();
      expect(screen.getByText('智能复习提醒')).toBeInTheDocument();
    });
  });

  test('should display urgent review reminders', async () => {
    const mockReviews = createMockReviewData();
    const urgentReviews = mockReviews.filter(r => r.urgency === 'urgent');

    mockMCMemoryService.getTodayReviews.mockResolvedValue(mockReviews);
    mockReviewScheduleService.getReviewPriorities.mockResolvedValue(urgentReviews);

    render(<CanvasLearningDashboard />);

    await waitFor(() => {
      expect(screen.getByText('今日复习任务')).toBeInTheDocument();
      expect(screen.getByText('紧急复习')).toBeInTheDocument();
      expect(screen.getByText('紧急复习')).toHaveClass('ant-statistic-content');
    });
  });

  test('should handle learning data loading state correctly', () => {
    mockCanvasLearningService.getAllCanvasLearningOverview.mockReturnValue(
      new Promise(() => {}) // 永不resolve，保持loading状态
    );

    render(<CanvasLearningDashboard />);

    expect(screen.getByTestId('canvas-learning-loading')).toBeInTheDocument();
    expect(screen.queryByText('Canvas学习监控')).not.toBeInTheDocument();
  });

  test('should handle learning data API errors gracefully', async () => {
    mockCanvasLearningService.getAllCanvasLearningOverview.mockRejectedValue(
      new Error('Learning Data API Error')
    );

    render(<CanvasLearningDashboard />);

    await waitFor(() => {
      expect(screen.getByText(/学习数据加载失败/)).toBeInTheDocument();
      expect(screen.getByRole('button', { name: /重新加载/ })).toBeInTheDocument();
    });
  });

  test('should handle Canvas card click navigation', async () => {
    const mockData = createMockCanvasLearningData();
    const handleCanvasClick = jest.fn();

    mockCanvasLearningService.getAllCanvasLearningOverview.mockResolvedValue(mockData.canvasOverview);

    render(<CanvasLearningDashboard onCanvasClick={handleCanvasClick} />);

    await waitFor(() => {
      const firstCanvasCard = screen.getByText(mockData.canvasOverview.canvasList[0].canvasName);
      fireEvent.click(firstCanvasCard);
    });

    expect(handleCanvasClick).toHaveBeenCalledWith(mockData.canvasOverview.canvasList[0].canvasId);
  });
});
```

**图表组件测试示例**:
```typescript
// tests/components/charts/ProgressTrendChart.test.tsx
describe('ProgressTrendChart', () => {
  test('should render trend chart with data', () => {
    const mockData = createMockProgressHistory();

    render(<ProgressTrendChart data={mockData} />);

    expect(screen.getByText('学习进度趋势')).toBeInTheDocument();
    expect(screen.getByRole('button', { name: '30天' })).toBeInTheDocument();
  });

  test('should handle empty data gracefully', () => {
    render(<ProgressTrendChart data={[]} />);

    expect(screen.getByText('暂无数据')).toBeInTheDocument();
  });

  test('should call onTimeRangeChange when range changes', () => {
    const mockOnChange = jest.fn();
    render(<ProgressTrendChart onTimeRangeChange={mockOnChange} />);

    fireEvent.click(screen.getByText('7天'));
    expect(mockOnChange).toHaveBeenCalledWith('7d');
  });
});
```

### Technical Constraints

**性能约束** [Source: canvas-progress-tracker-frontend-spec.md#性能要求]:
- **页面加载时间**: <3秒首次渲染，<1秒数据更新
- **图表渲染时间**: <2秒完成复杂图表渲染
- **内存使用**: <100MB（包含图表缓存）
- **数据更新频率**: 支持实时更新，最小间隔5秒

**交互约束**:
- **响应式设计**: 支持移动端(320px+)到宽屏(2560px+)
- **键盘导航**: 支持Tab键导航，图表可通过键盘操作
- **屏幕阅读器**: 所有图表和卡片支持ARIA标签
- **触摸交互**: 支持移动端触摸手势和缩放

**数据约束**:
- **数据量限制**: 最多显示1000个历史数据点
- **实时更新**: 支持WebSocket连接，自动重连机制
- **缓存策略**: 浏览器缓存5分钟，内存缓存100条记录
- **导出格式**: 支持CSV、PDF、PNG格式导出

### Accessibility Requirements

**WCAG 2.1 AA 合规**:
- **颜色对比度**: 图表和卡片文字对比度≥4.5:1
- **键盘访问**: 所有交互元素支持键盘操作
- **屏幕阅读器**: 图表数据提供表格备选方案
- **焦点管理**: 清晰的焦点指示器和逻辑导航顺序

**图表可访问性**:
```typescript
// 图表ARIA标签示例
<div
  role="img"
  aria-label="学习进度趋势图，显示30天内完成率从60%增长到75%"
  aria-describedby="chart-description"
>
  <div id="chart-description" className="sr-only">
    包含完成率折线图、绿色节点柱状图和红色节点柱状图
  </div>
  <div ref={chartRef} />
</div>

// 数据表格备选方案
<table className="sr-only" aria-label="进度数据表格">
  <thead>
    <tr>
      <th>日期</th>
      <th>完成率</th>
      <th>绿色节点数</th>
      <th>红色节点数</th>
    </tr>
  </thead>
  <tbody>
    {data?.map(item => (
      <tr key={item.date.toISOString()}>
        <td>{formatDate(item.date)}</td>
        <td>{item.completionRate}%</td>
        <td>{item.greenNodes}</td>
        <td>{item.redNodes}</td>
      </tr>
    ))}
  </tbody>
</table>
```

## Testing

### 测试标准要求

**仪表盘功能测试**:
- **数据展示验证**: 所有数据正确显示，格式化正确
- **交互功能测试**: 刷新、导出、时间范围选择等功能正常
- **响应式测试**: 不同屏幕尺寸下布局和功能正常
- **错误处理测试**: API错误、网络错误等异常情况处理正确

**图表组件测试**:
- **图表渲染**: ECharts图表正确渲染，数据准确显示
- **图表交互**: 鼠标悬停、点击、缩放等交互功能正常
- **数据更新**: 图表数据更新时动画和重绘正确
- **可访问性**: 图表提供适当的ARIA标签和备选方案

**性能测试**:
- **加载性能**: 页面首次加载时间<3秒
- **渲染性能**: 图表渲染时间<2秒
- **内存使用**: 页面内存使用<100MB
- **更新性能**: 数据更新响应时间<1秒

**集成测试要求**:
```typescript
// 示例：仪表盘集成测试
describe('Dashboard Integration', () => {
  test('should integrate with API service layer', async () => {
    // 模拟API服务
    const mockApiService = setupMockApiService();
    mockApiService.getDashboardOverview.mockResolvedValue(mockDashboardData);

    // 渲染仪表盘
    render(<Dashboard />);

    // 验证API调用
    await waitFor(() => {
      expect(mockApiService.getDashboardOverview).toHaveBeenCalledTimes(1);
    });

    // 验证数据显示
    expect(screen.getByText('Canvas总数')).toBeInTheDocument();
    expect(screen.getByText('平均完成率')).toBeInTheDocument();
  });
});
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-25 | 1.0 | 初始故事创建，基于canvas-progress-tracker-frontend-spec.md仪表盘规范 | Scrum Master (Bob) |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4.5

### Debug Log References
No debugging issues encountered during story creation.

### Completion Notes List
- ✅ 基于Stories 9.2-9.4的基础设施进行Canvas学习监控仪表盘开发
- ✅ 遵循canvas-progress-tracker-frontend-spec.md仪表盘设计规范
- ✅ 完整的Canvas学习监控页面结构和组件架构设计完成
- ✅ ECharts学习分析图表集成和响应式设计方案完成
- ✅ Story 9.4扩展API服务层集成和状态管理策略制定完成
- ✅ Canvas颜色系统和复习优先级主题集成方案确定
- ✅ 可访问性支持和学习数据错误处理策略完成
- ✅ 学习报告导出和实时学习状态更新功能设计完成
- ✅ 完整的学习监控测试策略和性能优化方案制定完成
- ✅ 与现有Canvas学习系统和艾宾浩斯复习系统兼容性验证完成
- ✅ **重构为Canvas学习监控** - 从系统监控转向个性化学习监控
- ✅ **新增智能复习提醒** - 基于艾宾浩斯算法的复习时间线和优先级提醒
- ✅ **集成记忆统计数据** - 完整的学习进度、记忆保持率、学习洞察展示
- ✅ **Canvas学习状态卡片** - 展示每个Canvas的学习状态和复习紧急程度
- ✅ **学习分析图表** - 学习进度趋势、记忆保持率曲线、学习热力图

### File List
**Story文件:**
- `docs/stories/9.5.story.md` - 本Story文件

**预期实现文件:**
- `src/pages/Dashboard.tsx` - 主仪表盘页面
- `src/components/dashboard/OverviewCards.tsx` - 概览卡片组件
- `src/components/dashboard/OverviewCard.tsx` - 单个概览卡片
- `src/components/charts/ProgressTrendChart.tsx` - 进度趋势图表
- `src/components/charts/ColorDistributionChart.tsx` - 颜色分布饼图
- `src/components/dashboard/RecentActivity.tsx` - 最近活动列表
- `src/services/dashboardService.ts` - 仪表盘数据服务
- `src/hooks/useDashboardData.ts` - 仪表盘数据管理Hook

**测试文件:**
- `tests/pages/Dashboard.test.tsx` - 仪表盘页面测试
- `tests/components/dashboard/OverviewCards.test.tsx` - 概览卡片测试
- `tests/components/charts/ProgressTrendChart.test.tsx` - 趋势图测试
- `tests/components/charts/ColorDistributionChart.test.tsx` - 饼图测试
- `tests/services/dashboardService.test.ts` - 仪表盘服务测试

**样式文件:**
- `src/styles/dashboard.css` - 仪表盘专用样式

## QA Results
[待QA评估时填写]

---

**最后更新**: 2025-10-25
**Scrum Master**: Bob
**预计开发时间**: 8-10小时 focused development
