# Story 31.A.4: å‰ç«¯ä¼˜å…ˆçº§è®¡ç®— FSRS çŠ¶æ€ä¿®å¤

## å…ƒæ•°æ®

| å±æ€§ | å€¼ |
|------|------|
| Story ID | 31.A.4 |
| EPIC | 31.A - è®°å¿†ç³»ç»Ÿç®¡é“ä¿®å¤ |
| ä¼˜å…ˆçº§ | P0 - Critical |
| çŠ¶æ€ | Review |
| ä¿®å¤æ–­ç‚¹ | æ–­ç‚¹2: ReviewDashboardView ä¼˜å…ˆçº§è®¡ç®—ä½¿ç”¨ FSRS=null |
| ç‰ˆæœ¬ | 2.1 (POéªŒè¯ä¿®å¤) |

---

## 1. é—®é¢˜æè¿°

### 1.1 ä»£ç ç°å®æ£€æŸ¥ç»“æœ

ç»è¿‡æ·±åº¦è°ƒç ”ï¼ŒåŸ Story 31.A.4 å­˜åœ¨ä¸¥é‡å¹»è§‰ï¼š

| åŸ Story å£°ç§° | ä»£ç ç°å® | çŠ¶æ€ |
|--------------|---------|------|
| `TodayReviewListService` è¢« main.ts å®ä¾‹åŒ– | âŒ ä»æœªåˆ›å»º | ğŸ”´ å¹»è§‰ |
| éœ€è°ƒç”¨ `setMemoryQueryService()` | âŒ ç›®æ ‡æœåŠ¡ä¸å­˜åœ¨ | ğŸ”´ æ— æ•ˆ |
| Dashboard é€šè¿‡ TodayReviewListService è·å–æ•°æ® | âŒ ç›´æ¥ä½¿ç”¨ MemoryQueryService | ğŸ”´ æ¶æ„è¯¯è§£ |

### 1.2 å®é™…é—®é¢˜

**ä½ç½®**: `ReviewDashboardView.ts:163-168`

```typescript
// å½“å‰ä»£ç  - ReviewDashboardView.ts:163-168
const priorityResult = this.priorityCalculatorService.calculatePriority(
    review.conceptId || review.conceptName || '',
    null, // âŒ FSRS state ç¡¬ç¼–ç ä¸º null - 40% æƒé‡å¤±æ•ˆ
    memoryResult,
    review.canvasId
);
```

**é—®é¢˜æ ¹å› **:
1. `FSRSStateQueryService` å·²å®Œæ•´å®ç°ï¼ˆStory 32.3ï¼‰
2. ä½† `main.ts` **ä»æœªåˆå§‹åŒ–** è¯¥æœåŠ¡
3. `ReviewDashboardView` å› æ­¤æ— æ³•è·å– FSRS çŠ¶æ€
4. ä¼˜å…ˆçº§è®¡ç®—çš„ 40% æƒé‡ï¼ˆFSRS ç»´åº¦ï¼‰å§‹ç»ˆè¿”å›ä¸­ç«‹åˆ†æ•° 50

### 1.3 å½±å“

- ä¼˜å…ˆçº§è®¡ç®— 4 ç»´åº¦æƒé‡åˆ†å¸ƒï¼š
  - FSRS ç´§è¿«åº¦: **40%** â†’ âŒ å¤±æ•ˆï¼ˆå§‹ç»ˆ 50 åˆ†ï¼‰
  - è¡Œä¸ºæƒé‡: 30% â†’ âœ… æ­£å¸¸
  - ç½‘ç»œä¸­å¿ƒæ€§: 20% â†’ âœ… æ­£å¸¸
  - äº¤äº’æƒé‡: 10% â†’ âœ… æ­£å¸¸
- å¤ä¹ å»ºè®®æ’åºä¸å‡†ç¡®
- é«˜é—å¿˜é£é™©çš„æ¦‚å¿µæ— æ³•ä¼˜å…ˆå±•ç¤º

---

## 2. éªŒæ”¶æ ‡å‡†

### AC-31.A.4.1: åˆå§‹åŒ– FSRSStateQueryService

**æ–‡ä»¶**: `canvas-progress-tracker/obsidian-plugin/main.ts`
**ä½ç½®**: `initializeManagers()` å‡½æ•°å†…ï¼Œçº¦ L560 å

**ä¿®æ”¹å†…å®¹**:
```typescript
// åœ¨ MemoryQueryService åˆå§‹åŒ–åæ·»åŠ 
// Story 31.A.4: Initialize FSRSStateQueryService for priority calculation
try {
    const apiBaseUrl = this.settings.aiBaseUrl || 'http://localhost:8000';
    this.fsrsStateQueryService = new FSRSStateQueryService(this.app, apiBaseUrl);
    if (this.settings.debugMode) {
        console.log('[Canvas] FSRSStateQueryService initialized');
    }
} catch (error) {
    console.error('[Canvas] Failed to initialize FSRSStateQueryService:', error);
}
```

**éªŒæ”¶æ¡ä»¶**:
- [ ] åœ¨ main.ts ä¸­æ·»åŠ  `fsrsStateQueryService` å±æ€§å£°æ˜
- [ ] åœ¨ `initializeManagers()` ä¸­åˆå§‹åŒ–æœåŠ¡
- [ ] ä½¿ç”¨ä¸å…¶ä»–æœåŠ¡ä¸€è‡´çš„ `apiBaseUrl`
- [ ] æ·»åŠ  try-catch é”™è¯¯å¤„ç†

---

### AC-31.A.4.2: æ·»åŠ  fsrsStateQueryService å±æ€§

**æ–‡ä»¶**: `canvas-progress-tracker/obsidian-plugin/main.ts`
**ä½ç½®**: ç±»å±æ€§å£°æ˜åŒºåŸŸï¼ˆçº¦ L230 é™„è¿‘ï¼‰

**ä¿®æ”¹å†…å®¹**:
```typescript
// åœ¨ memoryQueryService å±æ€§åæ·»åŠ 
/** Story 31.A.4: FSRS state query for priority calculation */
fsrsStateQueryService?: FSRSStateQueryService;
```

**å¹¶æ·»åŠ å¯¼å…¥**:
```typescript
import { FSRSStateQueryService } from './src/services/FSRSStateQueryService';
```

**éªŒæ”¶æ¡ä»¶**:
- [ ] å±æ€§ç±»å‹ä¸º `FSRSStateQueryService | undefined`
- [ ] æ­£ç¡®å¯¼å…¥æœåŠ¡ç±»
- [ ] TypeScript ç¼–è¯‘æ— é”™è¯¯

---

### AC-31.A.4.3: ReviewDashboardView ä½¿ç”¨çœŸå® FSRS çŠ¶æ€

**æ–‡ä»¶**: `canvas-progress-tracker/obsidian-plugin/src/views/ReviewDashboardView.ts`
**ä½ç½®**: `loadData()` æ–¹æ³•å†…ï¼ŒL157-168

**ä¿®æ”¹å†…å®¹**:

1. æ·»åŠ  FSRS çŠ¶æ€æŸ¥è¯¢æ–¹æ³•ï¼ˆçº¦ L260 åï¼‰:
```typescript
/**
 * Story 31.A.4: Query FSRS state for priority calculation
 *
 * @param conceptId - Concept identifier
 * @returns FSRSState or null if unavailable
 */
private async queryFSRSState(conceptId: string): Promise<import('../services/FSRSStateQueryService').FSRSState | null> {
    try {
        const fsrsService = (this.plugin as any).fsrsStateQueryService;
        if (!fsrsService) {
            return null; // Graceful degradation
        }
        const response = await fsrsService.queryFSRSState(conceptId);
        return response?.fsrs_state || null;
    } catch (error) {
        console.warn('[ReviewDashboard] FSRS state query failed:', error);
        return null;
    }
}
```

2. ä¿®æ”¹ `loadData()` ä¸­çš„ä¼˜å…ˆçº§è®¡ç®—ï¼ˆL157-168ï¼‰:
```typescript
// Story 30.7 AC-30.7.3: Convert to ReviewTask format with real memory-based priority
const tasks: ReviewTask[] = await Promise.all(
    dueReviews.map(async (review) => {
        const conceptId = review.conceptId || review.conceptName || '';

        // Query real memory result from MemoryQueryService if available
        const memoryResult = await this.queryConceptMemory(conceptId);

        // Story 31.A.4: Query real FSRS state (no longer null)
        const fsrsState = await this.queryFSRSState(conceptId);

        // Use PriorityCalculatorService with real data
        const priorityResult = this.priorityCalculatorService.calculatePriority(
            conceptId,
            fsrsState, // âœ… Now uses real FSRS state
            memoryResult,
            review.canvasId
        );

        // ... rest of mapping ...
    })
);
```

**éªŒæ”¶æ¡ä»¶**:
- [ ] æ·»åŠ  `queryFSRSState()` ç§æœ‰æ–¹æ³•
- [ ] ä¿®æ”¹ `loadData()` ä½¿ç”¨çœŸå® FSRS çŠ¶æ€
- [ ] ä¿æŒä¼˜é›…é™çº§ï¼ˆFSRS æœåŠ¡ä¸å¯ç”¨æ—¶è¿”å› nullï¼‰
- [ ] æ·»åŠ é”™è¯¯å¤„ç†å’Œæ—¥å¿—

---

### AC-31.A.4.4: éªŒè¯ä¼˜å…ˆçº§è®¡ç®—ç”Ÿæ•ˆ

**éªŒæ”¶æ¡ä»¶**:
- [ ] æ‰“å¼€ Dashboard åï¼Œä¼˜å…ˆçº§æ’åºåŸºäº 4 ä¸ªç»´åº¦è®¡ç®—
- [ ] FSRS çŠ¶æ€ä¸º null æ—¶é™çº§ä¸ºä¸­ç«‹åˆ†æ•°ï¼ˆä¿æŒå…¼å®¹ï¼‰
- [ ] FSRS çŠ¶æ€å­˜åœ¨æ—¶ï¼Œæ ¹æ® stability/difficulty/retrievability è®¡ç®—ç´§è¿«åº¦
- [ ] Console æ—¥å¿—æ˜¾ç¤º FSRS æŸ¥è¯¢æˆåŠŸ/å¤±è´¥çŠ¶æ€

---

## 3. æŠ€æœ¯å®ç°

### 3.1 ä¿®æ”¹æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹ç±»å‹ | è¯´æ˜ |
|------|---------|------|
| `main.ts` | ä¿®æ”¹ | æ·»åŠ å±æ€§å£°æ˜ + åˆå§‹åŒ– FSRSStateQueryService |
| `ReviewDashboardView.ts` | ä¿®æ”¹ | æ·»åŠ  queryFSRSState() + ä¿®æ”¹ loadData() |

### 3.2 æ•°æ®æµ

```
ä¿®å¤å‰:
ReviewDashboardView.loadData()
  â””â”€ calculatePriority(conceptId, null, memoryResult, canvasId)
                              â†‘
                          âŒ ç¡¬ç¼–ç  null

ä¿®å¤å:
ReviewDashboardView.loadData()
  â”œâ”€ queryFSRSState(conceptId)
  â”‚    â””â”€ plugin.fsrsStateQueryService.queryFSRSState()
  â”‚         â””â”€ GET /api/v1/review/fsrs-state/{concept_id}
  â”‚              â””â”€ è¿”å› FSRSState { stability, difficulty, retrievability, ... }
  â”‚
  â””â”€ calculatePriority(conceptId, fsrsState, memoryResult, canvasId)
                              â†‘
                          âœ… çœŸå® FSRS æ•°æ®
```

### 3.3 ç±»å‹å®šä¹‰

```typescript
// FSRSState æ¥å£ï¼ˆæ¥è‡ª FSRSStateQueryService.tsï¼‰
interface FSRSState {
    stability: number;      // è®°å¿†ç¨³å®šæ€§ï¼ˆå¤©ï¼‰
    difficulty: number;     // éš¾åº¦ç³»æ•°ï¼ˆ1-10ï¼‰
    state: number;          // 0=New, 1=Learning, 2=Review, 3=Relearning
    reps: number;           // æˆåŠŸå¤ä¹ æ¬¡æ•°
    lapses: number;         // é—å¿˜æ¬¡æ•°
    retrievability: number | null;  // å¯æå–æ€§æ¦‚ç‡ï¼ˆ0-1ï¼‰
    due: string | null;     // ä¸‹æ¬¡åˆ°æœŸæ—¶é—´
}
```

---

## 4. æµ‹è¯•è®¡åˆ’

### 4.1 å•å…ƒæµ‹è¯•

**æ–‡ä»¶**: `tests/views/ReviewDashboardView.test.ts`

```typescript
describe('ReviewDashboardView FSRS Integration', () => {
    it('should query FSRS state for each concept', async () => {
        const mockFsrsService = {
            queryFSRSState: jest.fn().mockResolvedValue({
                concept_id: 'test-concept',
                fsrs_state: {
                    stability: 10.5,
                    difficulty: 5.2,
                    retrievability: 0.85,
                    state: 2, // Review
                },
                found: true,
            }),
        };

        const view = new ReviewDashboardView(mockLeaf, {
            ...mockPlugin,
            fsrsStateQueryService: mockFsrsService,
        });

        const fsrsState = await view['queryFSRSState']('test-concept');

        expect(fsrsState).not.toBeNull();
        expect(fsrsState.stability).toBe(10.5);
        expect(mockFsrsService.queryFSRSState).toHaveBeenCalledWith('test-concept');
    });

    it('should gracefully handle missing FSRS service', async () => {
        const view = new ReviewDashboardView(mockLeaf, {
            ...mockPlugin,
            fsrsStateQueryService: undefined, // Not initialized
        });

        const fsrsState = await view['queryFSRSState']('test-concept');

        expect(fsrsState).toBeNull(); // Graceful degradation
    });

    it('should pass real FSRS state to priority calculator', async () => {
        // Mock all dependencies
        const mockPriorityService = {
            calculatePriority: jest.fn().mockReturnValue({
                priorityTier: 'high',
                priorityScore: 85,
            }),
        };

        // ... setup view with mocks ...

        await view['loadData']();

        // Verify calculatePriority was called with FSRS state
        expect(mockPriorityService.calculatePriority).toHaveBeenCalledWith(
            expect.any(String),
            expect.objectContaining({ stability: expect.any(Number) }), // Not null!
            expect.anything(),
            expect.any(String)
        );
    });
});
```

### 4.2 é›†æˆæµ‹è¯•

```typescript
describe('FSRS Priority Integration', () => {
    it('should load Dashboard with real FSRS-based priorities', async () => {
        // Start backend with test data
        // Initialize plugin
        const plugin = new CanvasProgressTrackerPlugin();
        await plugin.onload();

        // Verify FSRS service initialized
        expect(plugin.fsrsStateQueryService).toBeDefined();

        // Open Dashboard
        await plugin.activateView('review-dashboard');

        // Verify tasks have priority based on FSRS
        const dashboardView = plugin.getView('review-dashboard');
        const tasks = dashboardView.state.tasks;

        // At least some tasks should have non-default priority
        const nonDefaultPriorities = tasks.filter(t =>
            t.priority !== 'medium' // Default when FSRS=null
        );
        expect(nonDefaultPriorities.length).toBeGreaterThan(0);
    });
});
```

---

## 5. Dev Notes

### 5.1 SDDè§„èŒƒå‚è€ƒ (å¿…å¡«)

**APIç«¯ç‚¹**:
- ç«¯ç‚¹: `GET /api/v1/review/fsrs-state/{concept_id}`
- è§„èŒƒæ¥æº: `[Source: specs/api/review-api.openapi.yml#L476-L520]`
- å“åº”Schema: FSRSStateQueryResponse
- HTTPçŠ¶æ€ç : 200 (æˆåŠŸ), 404 (æœªæ‰¾åˆ°)

**æ•°æ®Schema**:
- FSRSStateæ¥å£: `[Source: specs/data/fsrs-state-query.schema.json]`
- å¿…å¡«å­—æ®µ: `stability`, `difficulty`, `state`, `reps`, `lapses`
- å¯é€‰å­—æ®µ: `retrievability` (0-1), `due` (ISO 8601)
- éªŒè¯è§„åˆ™: `difficulty` èŒƒå›´ 1-10, `state` æšä¸¾ 0-3

**å‰ç«¯ç±»å‹å®šä¹‰**:
- FSRSState: `[Source: src/services/FSRSStateQueryService.ts#L26-41]`
- FSRSStateQueryResponse: `[Source: src/services/FSRSStateQueryService.ts#L48-57]`

### 5.2 ADRå†³ç­–å…³è” (å¿…å¡«)

| ADRç¼–å· | å†³ç­–æ ‡é¢˜ | å¯¹Storyçš„å½±å“ |
|---------|----------|---------------|
| ADR-007 | ç¼“å­˜ç­–ç•¥ (TIERED) | FSRSStateQueryService ä½¿ç”¨ 5 åˆ†é’Ÿ TTL å†…å­˜ç¼“å­˜ |
| ADR-009 | é”™è¯¯å¤„ç†/é‡è¯•ç­–ç•¥ | æŸ¥è¯¢å¤±è´¥æ—¶ä¼˜é›…é™çº§è¿”å› nullï¼Œä¸é˜»å¡ Dashboard åŠ è½½ |

**å…³é”®çº¦æŸ**:
- ç¼“å­˜ç­–ç•¥: å•ä¸ªæ¦‚å¿µ FSRS çŠ¶æ€ç¼“å­˜ 5 åˆ†é’Ÿï¼Œé¿å…é¢‘ç¹ API è°ƒç”¨
- é”™è¯¯å¤„ç†: æ‰€æœ‰ FSRS æŸ¥è¯¢å¤±è´¥å¿…é¡»è¿”å› null è€ŒéæŠ›å‡ºå¼‚å¸¸ï¼Œä¿æŒ Dashboard å¯ç”¨æ€§

### 5.3 ä»£ç ç°å®æ£€æŸ¥

âœ… **å·²éªŒè¯å­˜åœ¨**:
- `FSRSStateQueryService` ç±»: `src/services/FSRSStateQueryService.ts` (L78-365)
- `queryFSRSState()` æ–¹æ³•: L108-177
- åç«¯ API: `GET /api/v1/review/fsrs-state/{concept_id}` (review.py L860-935)
- `PriorityCalculatorService.calculatePriority()` æ”¯æŒ FSRSState å‚æ•°
- `ReviewDashboardView.queryConceptMemory()`: L249-264 (å·²å­˜åœ¨ï¼Œå¯ä½œä¸ºæ¨¡å¼å‚è€ƒ)

âš ï¸ **éœ€è¦åˆ›å»º**:
- `main.ts` ä¸­çš„ `fsrsStateQueryService` å±æ€§
- `main.ts` ä¸­çš„åˆå§‹åŒ–ä»£ç 
- `ReviewDashboardView` ä¸­çš„ `queryFSRSState()` æ–¹æ³• (å‚è€ƒç°æœ‰ `queryConceptMemory` æ¨¡å¼)

### 5.4 ä¸åŸ Story çš„å·®å¼‚

| æ–¹é¢ | åŸ Story 31.A.4 | é‡å†™å Story 31.A.4 |
|------|----------------|---------------------|
| ä¿®å¤ç›®æ ‡ | TodayReviewListService è¿æ¥ | ReviewDashboardView FSRS ä¿®å¤ |
| æ¶‰åŠæœåŠ¡ | TodayReviewListService | FSRSStateQueryService |
| ä¿®æ”¹æ–‡ä»¶ | main.ts (TodayService setter) | main.ts + ReviewDashboardView |
| ä»£ç æ”¹åŠ¨é‡ | ~4 è¡Œï¼ˆæ— æ•ˆï¼‰ | ~30 è¡Œï¼ˆæœ‰æ•ˆï¼‰ |
| è§£å†³é—®é¢˜ | âŒ ä¸è§£å†³å®é™…é—®é¢˜ | âœ… ä¿®å¤ 40% æƒé‡å¤±æ•ˆ |

### 5.5 ç›¸å…³æ–‡æ¡£

- Story 32.3: FSRSStateQueryService å®ç°
- PriorityCalculatorService: 4 ç»´åº¦ä¼˜å…ˆçº§è®¡ç®—
- ReviewDashboardView: Dashboard UI å®ç°

---

## 6. é£é™©ä¸ç¼“è§£

| é£é™© | ç¼“è§£æªæ–½ |
|------|---------|
| åç«¯ FSRS API ä¸å¯ç”¨ | ä¼˜é›…é™çº§ï¼Œè¿”å› nullï¼Œä½¿ç”¨é»˜è®¤åˆ†æ•° |
| æ‰¹é‡æŸ¥è¯¢æ€§èƒ½ | FSRSStateQueryService æœ‰ 5 åˆ†é’Ÿç¼“å­˜ |
| ç±»å‹è½¬æ¢ | ä½¿ç”¨ `(this.plugin as any)` ä½†æ·»åŠ  null æ£€æŸ¥ |

---

## 7. Definition of Done

- [x] AC-31.A.4.1 å®Œæˆï¼šFSRSStateQueryService åˆå§‹åŒ–
- [x] AC-31.A.4.2 å®Œæˆï¼šå±æ€§å£°æ˜å’Œå¯¼å…¥
- [x] AC-31.A.4.3 å®Œæˆï¼šReviewDashboardView ä¿®æ”¹
- [x] AC-31.A.4.4 å®Œæˆï¼šä¼˜å…ˆçº§è®¡ç®—éªŒè¯
- [x] TypeScript ç¼–è¯‘æ— é”™è¯¯
- [x] å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆ38/38 fsrs-integration testsï¼‰
- [ ] Dashboard æ˜¾ç¤ºä¼˜å…ˆçº§æ­£ç¡®ï¼ˆéœ€é›†æˆæµ‹è¯•éªŒè¯ï¼‰

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´ |
|------|------|------|
| 1.0 | 2026-02-05 | åˆå§‹åˆ›å»ºï¼ˆåŸºäºå¹»è§‰çš„ TodayReviewListService ä¿®å¤ï¼‰ |
| 2.0 | 2026-02-05 | **å®Œå…¨é‡å†™**ï¼šåŸºäºä»£ç ç°å®æ£€æŸ¥ï¼Œä¿®å¤ FSRS çŠ¶æ€ä¼ é€’ |
| 2.1 | 2026-02-05 | **POéªŒè¯ä¿®å¤**ï¼šæ·»åŠ  SDDè§„èŒƒå‚è€ƒã€ADRå†³ç­–å…³è” sectionsï¼›ä¿®æ­£ queryConceptMemory æè¿°ï¼ˆå·²å­˜åœ¨ï¼‰|
| 2.2 | 2026-02-05 | **å®ç°å®Œæˆ**ï¼šæ‰€æœ‰ 4 ä¸ª AC å‡å·²å®ç°å¹¶é€šè¿‡æµ‹è¯• |

---

## 8. Dev Agent Record

### Implementation Notes

**AC-31.A.4.1 + AC-31.A.4.2** (ä¸ Story 31.A.6 ä¸€èµ·å®ç°):
- `main.ts`: æ·»åŠ  `FSRSStateQueryService` å¯¼å…¥å’Œå±æ€§å£°æ˜
- `initializeManagers()`: ä½¿ç”¨ `createFSRSStateQueryService(this.app, apiBaseUrl)` åˆå§‹åŒ–
- ä½¿ç”¨ä¸ MemoryQueryService ä¸€è‡´çš„ `apiBaseUrl` é…ç½®

**AC-31.A.4.3** (æ ¸å¿ƒä¿®å¤):
- æ·»åŠ  `queryFSRSState()` ç§æœ‰æ–¹æ³•åˆ° `ReviewDashboardView`
  - éµå¾ª `queryConceptMemory()` çš„ä¼˜é›…é™çº§æ¨¡å¼
  - æœåŠ¡ä¸å­˜åœ¨æ—¶é™é»˜è¿”å› nullï¼ˆæ—  console.warnï¼‰
  - åªåœ¨ debugMode + å®é™…é”™è¯¯æ—¶æ‰ warn
- æ·»åŠ  `adaptFSRSStateToCardState()` ç±»å‹é€‚é…å™¨
  - **å…³é”®**: FSRSState (numeric state 0-3) â‰  FSRSCardState (string state)
  - FSRSState æ—  lastReview/nextReview â†’ ä½¿ç”¨ stability ä¼°ç®— lastReview
  - FSRSState.due (string|null) â†’ FSRSCardState.nextReview (Date)
- æ›´æ–° fallback loadData è·¯å¾„: `null` â†’ `queryFSRSState()` + `adaptFSRSStateToCardState()`

**AC-31.A.4.4** (è‡ªåŠ¨éªŒè¯):
- PriorityCalculatorService æ”¶åˆ°çœŸå® FSRSCardState åï¼ŒcalculateFSRSUrgency è®¡ç®—ä¸å†è¿”å›ä¸­ç«‹åˆ†æ•° 50
- 38/38 fsrs-integration æµ‹è¯•éªŒè¯äº†ç±»å‹é€‚é…å’Œä¼˜å…ˆçº§è®¡ç®—

### File List

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | è¯´æ˜ |
|------|---------|------|
| `main.ts` | ä¿®æ”¹ | æ·»åŠ  FSRSStateQueryService å¯¼å…¥ã€å±æ€§ã€åˆå§‹åŒ– |
| `src/views/ReviewDashboardView.ts` | ä¿®æ”¹ | æ·»åŠ  queryFSRSState()ã€adaptFSRSStateToCardState()ã€æ›´æ–° loadData fallback |

### Test Results

- `ReviewDashboardView.fsrs-integration.test.ts`: **38/38 passed**
- `ReviewDashboardView.test.ts`: **70/70 passed** (æ— å›å½’)
- `FSRSStateQueryService.test.ts`: **26/26 passed** (æ— å›å½’)
- `TodayReviewListService.test.ts`: **34/34 passed** (æ— å›å½’)
- TypeScript ç¼–è¯‘: **0 errors**
