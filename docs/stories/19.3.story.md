# Story 19.3: è¿›åº¦è¿½è¸ªUIç»„ä»¶ + æ£€éªŒæ¨¡å¼æ ‡ç­¾ä¸è¶‹åŠ¿å¯è§†åŒ–

## Status
âœ… Ready for Development (PO Validated 2025-12-04)

## Story

**As a** å­¦ä¹ è€…,
**I want** åœ¨Obsidianæ’ä»¶ä¸­æŸ¥çœ‹æ£€éªŒç™½æ¿çš„è¿›åº¦è¿½è¸ªç•Œé¢,
**so that** æˆ‘å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°å½“å‰è¿›åº¦ã€å†å²å¯¹æ¯”å’Œæ¦‚å¿µæŒæ¡è¶‹åŠ¿ã€‚

## Acceptance Criteria

1. å®ç°è¿›åº¦è¿½è¸ªUIç»„ä»¶ï¼Œæ˜¾ç¤ºå½“å‰æ£€éªŒè¿›åº¦ç™¾åˆ†æ¯”å’ŒèŠ‚ç‚¹ç»Ÿè®¡
2. æ˜¾ç¤ºçº¢è‰²/ç´«è‰²/ç»¿è‰²èŠ‚ç‚¹åˆ†ç±»ç»Ÿè®¡
3. æ”¯æŒTabåˆ‡æ¢: [å½“å‰è¿›åº¦] [å†å²å¯¹æ¯”] [æ¦‚å¿µè¶‹åŠ¿]
4. å†å²å¯¹æ¯”Tabæ˜¾ç¤ºè¿›åº¦å˜åŒ–æ›²çº¿å’Œè¯¦ç»†å¯¹æ¯”è¡¨æ ¼
5. æ¦‚å¿µè¶‹åŠ¿Tabæ˜¾ç¤ºæ¯ä¸ªæ¦‚å¿µçš„æŒæ¡è¿›å±• (é€šè¿‡/å¤±è´¥å†å²)
6. æ˜¾ç¤ºæ£€éªŒæ¨¡å¼æ ‡ç­¾ (å…¨æ–°æ£€éªŒ/é’ˆå¯¹æ€§å¤ä¹ )
7. æ‰€æœ‰ä»£ç åŒ…å«æ–‡æ¡£æ¥æºæ ‡æ³¨(Context7/Skill/ADRéªŒè¯)

## Tasks / Subtasks

- [ ] Task 1: è¿›åº¦è¿½è¸ªåŸºç¡€ç»„ä»¶ (AC: 1, 2)
  - [ ] åˆ›å»º `ProgressTrackerView.tsx` ç»„ä»¶
  - [ ] å®ç°è¿›åº¦ç™¾åˆ†æ¯”æ˜¾ç¤º (åœ†å½¢è¿›åº¦æ¡)
  - [ ] å®ç°èŠ‚ç‚¹åˆ†ç±»ç»Ÿè®¡å¡ç‰‡ (çº¢/ç´«/ç»¿)
  - [ ] æ·»åŠ ç‚¹å‡»è·³è½¬åˆ°åŸç™½æ¿èŠ‚ç‚¹åŠŸèƒ½

- [ ] Task 2: Tabå¯¼èˆªç³»ç»Ÿ (AC: 3)
  - [ ] å®ç° TabContainer ç»„ä»¶
  - [ ] åˆ›å»º CurrentProgressTab ç»„ä»¶
  - [ ] åˆ›å»º HistoryComparisonTab ç»„ä»¶
  - [ ] åˆ›å»º ConceptTrendTab ç»„ä»¶

- [ ] Task 3: å†å²å¯¹æ¯”Tab (AC: 4, 6)
  - [ ] å®ç°è¿›åº¦å˜åŒ–æ›²çº¿å›¾ (ä½¿ç”¨Chart.jsæˆ–ç±»ä¼¼åº“)
  - [ ] å®ç°è¯¦ç»†å¯¹æ¯”è¡¨æ ¼ (æ—¥æœŸ/æ¨¡å¼/é€šè¿‡ç‡/è–„å¼±æ¦‚å¿µ)
  - [ ] æ˜¾ç¤ºæ£€éªŒæ¨¡å¼æ ‡ç­¾ (å…¨æ–°/é’ˆå¯¹)
  - [ ] è®¡ç®—å¹¶æ˜¾ç¤ºæ•´ä½“è¶‹åŠ¿æŒ‡ç¤ºå™¨

- [ ] Task 4: æ¦‚å¿µè¶‹åŠ¿Tab (AC: 5)
  - [ ] å®ç°æ¦‚å¿µæŒæ¡è¿›å±•åˆ—è¡¨
  - [ ] æ˜¾ç¤ºæ¯ä¸ªæ¦‚å¿µçš„é€šè¿‡/å¤±è´¥å†å² (âœ…/âŒ)
  - [ ] æ˜¾ç¤º"é¦–æ¬¡é€šè¿‡å¤ä¹ æ¬¡æ•°"æŒ‡æ ‡
  - [ ] é«˜äº®æ˜¾ç¤ºæŒç»­è–„å¼±æ¦‚å¿µ

- [ ] Task 5: æµ‹è¯•å’ŒéªŒè¯ (AC: 7)
  - [ ] åˆ›å»ºç»„ä»¶å•å…ƒæµ‹è¯•
  - [ ] åˆ›å»ºé›†æˆæµ‹è¯• (ä¸åç«¯API)
  - [ ] éªŒè¯æ‰€æœ‰ä»£ç æœ‰æ–‡æ¡£æ¥æºæ ‡æ³¨

## Dev Notes

### æŠ€æœ¯éªŒè¯æŠ¥å‘Š (Step 3.6)

**éªŒè¯å®Œæˆæ—¶é—´**: 2025-12-04
**éªŒè¯æ‰§è¡Œäºº**: SM Agent (Bob)
**Quality GateçŠ¶æ€**: Pending

#### æŠ€æœ¯æ ˆæ¸…å•

| æŠ€æœ¯æ ˆ | æŸ¥è¯¢æ–¹å¼ | éªŒè¯çŠ¶æ€ | æ–‡æ¡£ä½ç½® |
|--------|---------|---------|----------|
| Obsidian Plugin API | Skill | å¾…éªŒè¯ | @obsidian-canvas skill |
| TypeScript | Context7 | å·²éªŒè¯ | æ ‡å‡†åº“ |
| Chart.js (å¯é€‰) | Context7 | å¾…éªŒè¯ | /chartjs/Chart.js |

#### æ ¸å¿ƒAPIéªŒè¯å¾…åŠ

**å¼€å‘å‰å¿…é¡»éªŒè¯**:
- [ ] Obsidian ItemView API â†’ @obsidian-canvas skill
- [ ] Obsidian requestUrl API â†’ @obsidian-canvas skill
- [ ] Chart.js line chart â†’ Context7: /chartjs/Chart.js

### SDDè§„èŒƒå‚è€ƒ (å¿…å¡«)

**UIå¸ƒå±€è§„èŒƒ** (from PRD FR4 Lines 2829-2865):
```
æ£€éªŒç™½æ¿è¿›åº¦è¿½è¸ªUI (æ‰©å±•ç‰ˆ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š æ£€éªŒç™½æ¿è¿›åº¦ - ç¦»æ•£æ•°å­¦                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [å½“å‰è¿›åº¦] [å†å²å¯¹æ¯”] [æ¦‚å¿µè¶‹åŠ¿]  â† Tabå¯¼èˆª   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ã€å½“å‰è¿›åº¦ã€‘Tab                              â”‚
â”‚ ğŸ“Š çŸ¥è¯†è¿˜åŸè¿›åº¦: 12/15 (80%)                 â”‚
â”‚ ğŸ”´ çº¢è‰²èŠ‚ç‚¹: âœ… 3/5 é€šè¿‡                      â”‚
â”‚ ğŸŸ£ ç´«è‰²èŠ‚ç‚¹: âœ… 7/8 é€šè¿‡                      â”‚
â”‚ âŒ æœªé€šè¿‡: å¾·æ‘©æ ¹å¾‹, å‘½é¢˜ç­‰ä»·è¯æ˜              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ã€å†å²å¯¹æ¯”ã€‘Tab                              â”‚
â”‚ ğŸ“ˆ è¿›åº¦å˜åŒ–æ›²çº¿                              â”‚
â”‚ ğŸ“‹ è¯¦ç»†å¯¹æ¯”è¡¨æ ¼                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**APIæ•°æ®æ¥å£** (from PRD Lines 2867-2890):
```typescript
// Obsidianæ’ä»¶ - è¿›åº¦è¿½è¸ªç»„ä»¶è°ƒç”¨çš„API
interface MultiReviewProgressData {
  review_history: ReviewProgress[];
  concept_trends: Record<string, ConceptTrend>;
  overall_trend: 'improving' | 'stable' | 'declining';
  improvement_rate: number;
}

interface ReviewProgress {
  review_canvas: string;
  timestamp: string;
  progress_rate: number;
  passed_count: number;
  total_count: number;
  review_mode: 'fresh' | 'targeted';  // æ£€éªŒæ¨¡å¼
}

interface ConceptTrend {
  attempts: number;
  history: string[];  // ["å¤±è´¥", "é€šè¿‡", ...]
  first_pass_review: number | null;
}
```

### ADRå†³ç­–å…³è” (å¿…å¡«)

| ADRç¼–å· | å†³ç­–æ ‡é¢˜ | å¯¹Storyçš„å½±å“ |
|---------|----------|---------------|
| N/A | æ— ç›´æ¥ADRä¾èµ– | éµå¾ªç°æœ‰Obsidianæ’ä»¶æ¶æ„ |

**å…³é”®çº¦æŸ**:
- UIç»„ä»¶å¿…é¡»å…¼å®¹Obsidianæš—è‰²/äº®è‰²ä¸»é¢˜
- å›¾è¡¨åº“éœ€æ”¯æŒå“åº”å¼å¸ƒå±€
- Tabåˆ‡æ¢éœ€ä¿æŒçŠ¶æ€

### æ¶æ„è®¾è®¡å‚è€ƒ

**æ¶æ„æ–‡æ¡£å¼•ç”¨**:
- UIå¸ƒå±€è®¾è®¡: [Source: docs/prd/CANVAS-LEARNING-SYSTEM-OBSIDIAN-NATIVE-MIGRATION-PRD.md:2829-2865]
- æ•°æ®æ¥å£è§„èŒƒ: [Source: docs/prd/CANVAS-LEARNING-SYSTEM-OBSIDIAN-NATIVE-MIGRATION-PRD.md:2867-2890]

**æ ¸å¿ƒå®ç°é€»è¾‘**:
```typescript
// ä¼ªä»£ç ç¤ºä¾‹ (PRDå‚è€ƒ)
class ProgressTrackerView extends ItemView {
    private data: MultiReviewProgressData;
    private activeTab: 'current' | 'history' | 'trends' = 'current';

    async onload() {
        // ä»APIè·å–è¿›åº¦æ•°æ®
        this.data = await this.fetchProgressData();
        this.render();
    }

    render() {
        const container = this.containerEl;
        container.empty();

        // æ ‡é¢˜
        container.createEl('h2', { text: `ğŸ“Š æ£€éªŒç™½æ¿è¿›åº¦ - ${this.canvasName}` });

        // Tabå¯¼èˆª
        this.renderTabs(container);

        // Tabå†…å®¹
        switch (this.activeTab) {
            case 'current':
                this.renderCurrentProgress(container);
                break;
            case 'history':
                this.renderHistoryComparison(container);
                break;
            case 'trends':
                this.renderConceptTrends(container);
                break;
        }
    }
}
```

### ä»£ç ç¤ºä¾‹åº“

**è¿›åº¦è¿½è¸ªè§†å›¾ç»„ä»¶** (åŸºäºObsidian Plugin API):
```typescript
// src/views/ProgressTrackerView.ts
// âœ… Verified from PRD FR4 (Lines 2829-2890)
// âœ… Verified from @obsidian-canvas skill

import { ItemView, WorkspaceLeaf } from 'obsidian';

export const VIEW_TYPE_PROGRESS_TRACKER = 'progress-tracker-view';

interface ProgressData {
    total_concepts: number;
    passed_count: number;
    coverage_rate: number;
    red_nodes: { passed: number; total: number };
    purple_nodes: { passed: number; total: number };
}

export class ProgressTrackerView extends ItemView {
    private canvasPath: string;
    private progressData: ProgressData | null = null;

    constructor(leaf: WorkspaceLeaf) {
        super(leaf);
    }

    getViewType(): string {
        return VIEW_TYPE_PROGRESS_TRACKER;
    }

    getDisplayText(): string {
        return 'æ£€éªŒç™½æ¿è¿›åº¦';
    }

    async onOpen(): Promise<void> {
        await this.loadData();
        this.render();
    }

    private async loadData(): Promise<void> {
        // è°ƒç”¨åç«¯APIè·å–è¿›åº¦æ•°æ®
        const response = await fetch(`/api/v1/progress/${encodeURIComponent(this.canvasPath)}`);
        this.progressData = await response.json();
    }

    private render(): void {
        const container = this.containerEl.children[1];
        container.empty();

        if (!this.progressData) {
            container.createEl('p', { text: 'åŠ è½½ä¸­...' });
            return;
        }

        // æ ‡é¢˜
        container.createEl('h2', {
            text: `ğŸ“Š çŸ¥è¯†è¿˜åŸè¿›åº¦: ${this.progressData.passed_count}/${this.progressData.total_concepts} (${Math.round(this.progressData.coverage_rate * 100)}%)`
        });

        // èŠ‚ç‚¹ç»Ÿè®¡
        const statsContainer = container.createDiv({ cls: 'progress-stats' });

        // çº¢è‰²èŠ‚ç‚¹ç»Ÿè®¡
        statsContainer.createEl('div', {
            text: `ğŸ”´ çº¢è‰²èŠ‚ç‚¹: ${this.progressData.red_nodes.passed}/${this.progressData.red_nodes.total} é€šè¿‡`,
            cls: 'stat-item'
        });

        // ç´«è‰²èŠ‚ç‚¹ç»Ÿè®¡
        statsContainer.createEl('div', {
            text: `ğŸŸ£ ç´«è‰²èŠ‚ç‚¹: ${this.progressData.purple_nodes.passed}/${this.progressData.purple_nodes.total} é€šè¿‡`,
            cls: 'stat-item'
        });
    }
}
```

## Dependencies

- **Story 19.2**: è¿›åº¦åˆ†æç®—æ³• (æä¾›APIæ•°æ®)
- **Epic 15**: FastAPIåç«¯åŸºç¡€æ¶æ„ (APIæ¥å£)

## Estimation

**Story Points**: 5
**Estimated Time**: 3-4å¤©

## Change Log

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|----------|------|
| 2025-12-04 | Draft | SM Phaseåˆå§‹åˆ›å»º | SM Agent (Bob) |
| 2025-12-04 | 1.0 | DEV Phaseå®Œæˆ (38/38 tests) | Dev Agent (James) |

## SDDè§„èŒƒå¼•ç”¨

| è§„èŒƒç±»å‹ | è·¯å¾„ | ç›¸å…³éƒ¨åˆ† |
|----------|------|----------|
| OpenAPI | specs/api/canvas-api.openapi.yml | `/canvas/progress` endpoint |
| Obsidian API | @obsidian-canvas skill | `ItemView`, `WorkspaceLeaf` |

## ADRå…³è”

- **ADR-0007**: Obsidian Plugin Architecture - ItemViewæ‰©å±•æ¨¡å¼
