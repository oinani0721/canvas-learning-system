---
document_type: "Architecture"
version: "1.0.0"
last_modified: "2025-11-19"
status: "approved"
iteration: 1

authors:
  - name: "Architect Agent"
    role: "Solution Architect"

reviewers:
  - name: "PO Agent"
    role: "Product Owner"
    approved: true

compatible_with:
  prd: "v1.0"
  api_spec: "v1.0"

api_spec_hash: "0dc1d3610d28bf99"

changes_from_previous:
  - "Initial Architecture with frontmatter metadata"

git:
  commit_sha: ""
  tag: ""

metadata:
  components_count: 0
  external_services: []
  technology_stack:
    frontend: []
    backend: ["Python 3.11", "asyncio"]
    database: []
    infrastructure: []
---

# Canvaså­¦ä¹ ç³»ç»Ÿ - æŠ€æœ¯æ¶æ„æ–‡æ¡£

**ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-01-14
**æ¶æ„å¸ˆ**: Architect Agent

---

## ğŸ“‹ æ–‡æ¡£å¯¼èˆª

æœ¬æ¶æ„æ–‡æ¡£é‡‡ç”¨æ¨¡å—åŒ–åˆ†ç‰‡ç»“æ„ï¼Œä¾¿äºç»´æŠ¤å’ŒæŒ‰éœ€è¯»å–ã€‚

### æ ¸å¿ƒæ¶æ„æ–‡æ¡£ï¼ˆæ‰€æœ‰Storyéƒ½åº”é˜…è¯»ï¼‰

| æ–‡æ¡£ | æè¿° | ç”¨é€” |
|------|------|------|
| [tech-stack.md](tech-stack.md) | æŠ€æœ¯æ ˆé€‰å‹å’Œç‰ˆæœ¬è¦æ±‚ | äº†è§£é¡¹ç›®ä¾èµ–å’Œç¯å¢ƒé…ç½® |
| [unified-project-structure.md](unified-project-structure.md) | ç»Ÿä¸€é¡¹ç›®ç»“æ„ | äº†è§£æ–‡ä»¶ç»„ç»‡å’Œæ¨¡å—åˆ’åˆ† |
| [coding-standards.md](coding-standards.md) | ç¼–ç è§„èŒƒå’Œæœ€ä½³å®è·µ | éµå¾ªä»£ç é£æ ¼å’Œå‘½åè§„èŒƒ |

### Canvasæ“ä½œæ¶æ„ï¼ˆCanvasç›¸å…³Storyå¿…è¯»ï¼‰

| æ–‡æ¡£ | æè¿° | å…³é”®å†…å®¹ |
|------|------|----------|
| [canvas-3-layer-architecture.md](canvas-3-layer-architecture.md) | 3å±‚Canvasæ“ä½œæ¶æ„ | `CanvasJSONOperator`<br>`CanvasBusinessLogic`<br>`CanvasOrchestrator` |
| [canvas-layout-v1.1.md](canvas-layout-v1.1.md) | v1.1å¸ƒå±€ç®—æ³•å’Œå‚æ•° | èŠ‚ç‚¹ä½ç½®è®¡ç®—å…¬å¼<br>å¸ƒå±€å‚æ•°è¡¨<br>è§†è§‰è§„èŒƒ |

### Sub-agentæ¶æ„ï¼ˆAgentç›¸å…³Storyå¿…è¯»ï¼‰

| æ–‡æ¡£ | æè¿° | å…³é”®å†…å®¹ |
|------|------|----------|
| [sub-agent-templates.md](sub-agent-templates.md) | 13ä¸ªSub-agentå®Œæ•´æ¨¡æ¿ | YAML frontmatter<br>è¾“å…¥/è¾“å‡ºæ ¼å¼<br>System prompt |
| [sub-agent-calling-protocol.md](sub-agent-calling-protocol.md) | Agentè°ƒç”¨åè®®å’Œæœ€ä½³å®è·µ | è‡ªç„¶è¯­è¨€è°ƒç”¨è¯­æ³•<br>é”™è¯¯å¤„ç†<br>è°ƒç”¨é™åˆ¶ |

---

## ğŸ—ï¸ æ•´ä½“æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ç”¨æˆ·ï¼ˆåœ¨Obsidian Canvasä¸­æ“ä½œï¼‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ è‡ªç„¶è¯­è¨€æŒ‡ä»¤
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Canvas-Orchestratorï¼ˆä¸»æ§Agentï¼‰             â”‚
â”‚  - æ„å›¾è¯†åˆ«ï¼ˆæ‹†è§£/è§£é‡Š/è¯„åˆ†/æ£€éªŒï¼‰                          â”‚
â”‚  - Canvasæ–‡ä»¶è¯»å–ä¸ä¸Šä¸‹æ–‡æå–                              â”‚
â”‚  - Sub-agentè°ƒåº¦                                         â”‚
â”‚  - ç»“æœæ•´åˆä¸Canvasæ›´æ–°                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ è‡ªç„¶è¯­è¨€è°ƒç”¨
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼            â–¼            â–¼            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æ‹†è§£  â”‚    â”‚ è§£é‡Š  â”‚    â”‚ è¯„åˆ†  â”‚    â”‚ æ£€éªŒ  â”‚
    â”‚ ç³»åˆ—  â”‚    â”‚ ç³»åˆ—  â”‚    â”‚       â”‚    â”‚       â”‚
    â”‚ 3ä¸ª   â”‚    â”‚ 6ä¸ª   â”‚    â”‚ 1ä¸ª   â”‚    â”‚ 1ä¸ª   â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”€â”¬â”€â”€â”€â”˜
        â”‚            â”‚            â”‚            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ è°ƒç”¨
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   canvas_utils.py          â”‚
        â”‚  ï¼ˆ3å±‚æ¶æ„Pythonåº“ï¼‰        â”‚
        â”‚                            â”‚
        â”‚  Layer 3: CanvasOrchestratorâ”‚
        â”‚  Layer 2: CanvasBusinessLogicâ”‚
        â”‚  Layer 1: CanvasJSONOperatorâ”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ è¯»å†™
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   .canvas æ–‡ä»¶              â”‚
        â”‚  ï¼ˆJSON Canvas 1.0æ ¼å¼ï¼‰    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ¶æ„è®¾è®¡åŸåˆ™

### 1. å…³æ³¨ç‚¹åˆ†ç¦»ï¼ˆSeparation of Concernsï¼‰
- **Layer 1**: çº¯JSONæ“ä½œï¼Œä¸å…³å¿ƒä¸šåŠ¡é€»è¾‘
- **Layer 2**: ä¸šåŠ¡é€»è¾‘å®ç°ï¼Œä¸å…³å¿ƒJSONç»†èŠ‚
- **Layer 3**: é«˜çº§æ¥å£ï¼Œä¸å…³å¿ƒåº•å±‚å®ç°

### 2. å•ä¸€èŒè´£ï¼ˆSingle Responsibilityï¼‰
- æ¯ä¸ªSub-agentåªè´Ÿè´£ä¸€ä¸ªç‰¹å®šä»»åŠ¡
- æ¯ä¸ªå‡½æ•°åªåšä¸€ä»¶äº‹æƒ…

### 3. ä¾èµ–å€’ç½®ï¼ˆDependency Inversionï¼‰
- Sub-agentsä¾èµ–æŠ½è±¡æ¥å£ï¼ˆCanvasOrchestratorï¼‰
- ä¸ç›´æ¥ä¾èµ–å…·ä½“å®ç°ï¼ˆJSONæ“ä½œç»†èŠ‚ï¼‰

### 4. å¼€æ”¾å°é—­åŸåˆ™ï¼ˆOpen-Closedï¼‰
- æ·»åŠ æ–°Agentä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç 
- æ·»åŠ æ–°Canvasæ“ä½œåªéœ€æ‰©å±•Layer 2

---

## ğŸ“Š æŠ€æœ¯å†³ç­–è®°å½•ï¼ˆADRï¼‰

### ADR-001: é€‰æ‹©3å±‚æ¶æ„è€Œéå•å±‚å‡½æ•°åº“
**å†³ç­–**: é‡‡ç”¨3å±‚æ¶æ„ï¼ˆOperator â†’ BusinessLogic â†’ Orchestratorï¼‰

**ç†ç”±**:
- âœ… æ˜“äºæµ‹è¯•ï¼ˆå¯ä»¥mock Layer 1è¿›è¡Œå•å…ƒæµ‹è¯•ï¼‰
- âœ… æ˜“äºç»´æŠ¤ï¼ˆä¿®æ”¹å¸ƒå±€ç®—æ³•åªéœ€æ”¹Layer 2ï¼‰
- âœ… æ˜“äºæ‰©å±•ï¼ˆæ·»åŠ æ–°åŠŸèƒ½ä¸å½±å“åº•å±‚ï¼‰

**æ›¿ä»£æ–¹æ¡ˆ**: å•å±‚å‡½æ•°åº“ï¼ˆè¢«å¦å†³ï¼Œå› ä¸ºæ··åˆäº†JSONæ“ä½œå’Œä¸šåŠ¡é€»è¾‘ï¼‰

### ADR-002: ä½¿ç”¨è‡ªç„¶è¯­è¨€è°ƒç”¨Sub-agent
**å†³ç­–**: ä½¿ç”¨è‡ªç„¶è¯­è¨€å­—ç¬¦ä¸²è°ƒç”¨Sub-agentï¼Œè€Œéä»£ç å‡½æ•°è°ƒç”¨

**ç†ç”±**:
- âœ… ç¬¦åˆClaude Codeçš„å®˜æ–¹è®¾è®¡
- âœ… å¯ä»¥ä¼ é€’å¤æ‚ä¸Šä¸‹æ–‡ï¼ˆè‡ªç„¶è¯­è¨€æè¿°ï¼‰
- âœ… æ˜“äºç†è§£å’Œè°ƒè¯•

**é™åˆ¶**: æœ€å¤šåŒæ—¶è¿è¡Œ10ä¸ªSub-agentä»»åŠ¡

### ADR-003: v1.1å¸ƒå±€ç®—æ³•ï¼ˆé»„è‰²èŠ‚ç‚¹åœ¨é—®é¢˜ä¸‹æ–¹ï¼‰
**å†³ç­–**: é»„è‰²ç†è§£èŠ‚ç‚¹ä½äºé—®é¢˜èŠ‚ç‚¹æ­£ä¸‹æ–¹ï¼ˆå‚ç›´å¯¹é½ï¼‰

**ç†ç”±**:
- âœ… ç”¨æˆ·åå¥½ï¼ˆæ˜ç¡®è¦æ±‚ï¼‰
- âœ… è§†è§‰æ¸…æ™°ï¼ˆä¸€çœ¼çœ‹åˆ°å¯¹åº”å…³ç³»ï¼‰
- âœ… èŠ‚çœæ°´å¹³ç©ºé—´

**æ›¿ä»£æ–¹æ¡ˆ**: v1.0å¸ƒå±€ï¼ˆé»„è‰²åœ¨å³ä¾§ï¼Œè¢«å¦å†³ï¼‰

### ADR-004: 13ä¸ªç‹¬ç«‹Sub-agentè€Œéå•ä¸ªAgent
**å†³ç­–**: åˆ›å»º13ä¸ªä¸“é¡¹Sub-agentï¼Œè€Œéå•ä¸ªå¤šåŠŸèƒ½Agent

**ç†ç”±**:
- âœ… ä¸“æ³¨åº¦æ›´é«˜ï¼ˆæ¯ä¸ªAgentåªåšä¸€ä»¶äº‹ï¼‰
- âœ… Promptæ›´ç®€æ´ï¼ˆé¿å…å·¨å¤§çš„System promptï¼‰
- âœ… æ˜“äºç»´æŠ¤ï¼ˆä¿®æ”¹ä¸€ä¸ªAgentä¸å½±å“å…¶ä»–ï¼‰
- âœ… å¹¶è¡Œæ‰§è¡Œï¼ˆClaude Codeæ”¯æŒæœ€å¤š10ä¸ªå¹¶è¡Œä»»åŠ¡ï¼‰

**æ›¿ä»£æ–¹æ¡ˆ**: å•ä¸ªMonolithic Agentï¼ˆè¢«å¦å†³ï¼Œå› ä¸ºpromptè¿‡é•¿ä¸”éš¾ä»¥ç»´æŠ¤ï¼‰

---

## ğŸ”„ æ¶æ„æ¼”è¿›è·¯çº¿

### v1.0ï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰
- âœ… 13ä¸ªSub-agent
- âœ… 3å±‚Canvasæ“ä½œæ¶æ„
- âœ… v1.1å¸ƒå±€ç®—æ³•
- âœ… åŸºç¡€é¢œè‰²ç³»ç»Ÿï¼ˆçº¢/ç»¿/ç´«/é»„ï¼‰

### v1.1ï¼ˆè®¡åˆ’ä¸­ï¼‰
- [ ] æ”¯æŒèŠ‚ç‚¹åˆ†ç»„ï¼ˆGroupèŠ‚ç‚¹ï¼‰
- [ ] æ”¯æŒèŠ‚ç‚¹åµŒå¥—ï¼ˆçˆ¶å­å…³ç³»ï¼‰
- [ ] æ”¯æŒè¾¹çš„æ ‡ç­¾å’Œæ ·å¼
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆå¤§å‹Canvasæ–‡ä»¶ï¼‰

### v2.0ï¼ˆè¿œæœŸè§„åˆ’ï¼‰
- [ ] æ”¯æŒå¤šCanvasè”åŠ¨
- [ ] æ”¯æŒç‰ˆæœ¬å†å²å’Œå›æ»š
- [ ] æ”¯æŒåä½œç¼–è¾‘
- [ ] æ”¯æŒè‡ªå®šä¹‰Agent

---

## ğŸ“– å¦‚ä½•ä½¿ç”¨æœ¬æ¶æ„æ–‡æ¡£

### å¯¹äºScrum Masterï¼ˆç”ŸæˆStoryæ—¶ï¼‰
1. é˜…è¯» `index.md` äº†è§£æ•´ä½“æ¶æ„
2. æ ¹æ®Storyç±»å‹é€‰æ‹©ç›¸å…³æ–‡æ¡£é˜…è¯»
3. æå–æŠ€æœ¯ç»†èŠ‚å¹¶å†™å…¥Storyçš„`Dev Notes`
4. å¼•ç”¨æ¥æºï¼š`[Source: architecture/{filename}.md#{section}]`

### å¯¹äºDeveloperï¼ˆå®ç°Storyæ—¶ï¼‰
1. é˜…è¯»Storyæ–‡ä»¶ï¼ˆå·²åŒ…å«æ‰€æœ‰å¿…è¦çš„æ¶æ„ç»†èŠ‚ï¼‰
2. å¦‚æœ‰ç–‘é—®ï¼Œå›æº¯åˆ°å¯¹åº”çš„æ¶æ„æ–‡æ¡£ç« èŠ‚
3. éµå¾ª `coding-standards.md` çš„è§„èŒƒ

### å¯¹äºQAï¼ˆæµ‹è¯•Storyæ—¶ï¼‰
1. é˜…è¯» `tech-stack.md` äº†è§£æµ‹è¯•ç¯å¢ƒ
2. é˜…è¯»å¯¹åº”çš„æ¶æ„æ–‡æ¡£äº†è§£é¢„æœŸè¡Œä¸º
3. ç¼–å†™æµ‹è¯•ç”¨ä¾‹

---

## ğŸ“ æ¶æ„é—®é¢˜è”ç³»

å¦‚æœæ¶æ„æ–‡æ¡£æœ‰ä¸æ¸…æ™°æˆ–çŸ›ç›¾çš„åœ°æ–¹ï¼š
1. æ£€æŸ¥ `docs/project-brief.md` çš„åŸå§‹éœ€æ±‚
2. æ£€æŸ¥ `docs/prd/` çš„äº§å“å®šä¹‰
3. å¦‚ä»æœ‰ç–‘é—®ï¼Œè¯·æ›´æ–°æ¶æ„æ–‡æ¡£å¹¶æäº¤PR

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-01-14
**ç»´æŠ¤è€…**: Architect Agent
