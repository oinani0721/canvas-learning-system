# 4. å®ç°å¼‚æ­¥å¹¶è¡Œæ‰§è¡Œå¼•æ“æå‡Agentè°ƒç”¨æ€§èƒ½

Date: 2025-11-04

## Status

Accepted

Enabled by: [ADR-0002: ä½¿ç”¨LangGraphå®ç°å¤šAgentåä½œç³»ç»Ÿ](#0002-langgraph-agents.md)

## Context

Canvas Learning Systemçš„æ™ºèƒ½å¹¶è¡Œå¤„ç†ç³»ç»Ÿï¼ˆEpic 10ï¼‰åœ¨ä¸²è¡Œæ‰§è¡Œæ¨¡å¼ä¸‹å­˜åœ¨ä¸¥é‡çš„æ€§èƒ½ç“¶é¢ˆï¼š

1. **æ€§èƒ½é—®é¢˜**:
   - 10ä¸ªé»„è‰²èŠ‚ç‚¹çš„Agentè°ƒç”¨éœ€è¦~100ç§’ï¼ˆæ¯ä¸ªAgent ~10ç§’ï¼‰
   - 20ä¸ªé»„è‰²èŠ‚ç‚¹éœ€è¦~200ç§’
   - 50ä¸ªé»„è‰²èŠ‚ç‚¹éœ€è¦~500ç§’ï¼ˆè¶…è¿‡8åˆ†é’Ÿï¼‰
   - ç”¨æˆ·ä½“éªŒæå·®ï¼Œæ— æ³•å®é™…ä½¿ç”¨

2. **ä¸²è¡Œæ‰§è¡Œé™åˆ¶**:
   - åŸå®ç°ä½¿ç”¨`for node in nodes: call_agent(node)`ä¸²è¡Œå¾ªç¯
   - æ¯ä¸ªAgentè°ƒç”¨é˜»å¡æ•´ä¸ªæµç¨‹
   - CPUå’Œç½‘ç»œèµ„æºåˆ©ç”¨ç‡ä½ï¼ˆå¤§éƒ¨åˆ†æ—¶é—´åœ¨ç­‰å¾…APIå“åº”ï¼‰
   - æ— æ³•å……åˆ†åˆ©ç”¨Claude Codeçš„å¹¶å‘èƒ½åŠ›

3. **Canvasç»“æ„é”™è¯¯**:
   - ç›´æ¥åœ¨é»„è‰²èŠ‚ç‚¹ä¸‹åˆ›å»ºFileèŠ‚ç‚¹ï¼ˆè·³è¿‡è“è‰²TEXTèŠ‚ç‚¹ï¼‰
   - å¯¼è‡´Canvas 3å±‚ç»“æ„ä¸å®Œæ•´ï¼ˆé»„è‰²â†’è“è‰²TEXTâ†’Fileï¼‰
   - Obsidianæ— æ³•æ­£ç¡®è¯†åˆ«æ–‡ä»¶å¼•ç”¨
   - ç”¨æˆ·æ— æ³•åœ¨Canvasä¸­æ‰“å¼€ç”Ÿæˆçš„è§£é‡Šæ–‡æ¡£

4. **æ–‡ä»¶è·¯å¾„é—®é¢˜**:
   - ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼ˆ`C:\Users\ROG\æ‰˜ç¦\...`ï¼‰
   - Obsidianæ— æ³•æ‰“å¼€ï¼ˆè¦æ±‚ç›¸å¯¹è·¯å¾„ï¼‰
   - è·¨å¹³å°å…¼å®¹æ€§å·®ï¼ˆWindows vs macOS/Linuxè·¯å¾„å·®å¼‚ï¼‰

### å€™é€‰æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | è¯„åˆ† |
|------|------|------|------|
| **asyncioå¹¶è¡Œæ‰§è¡Œ** | â€¢ åŸç”ŸPythonæ”¯æŒ<br>â€¢ é«˜å¹¶å‘æ€§èƒ½<br>â€¢ ä¸Claude Codeå¼‚æ­¥APIå¥‘åˆ<br>â€¢ ç®€å•ç›´è§‚çš„API<br>â€¢ æ— é¢å¤–ä¾èµ– | â€¢ éœ€è¦é‡æ„ç°æœ‰åŒæ­¥ä»£ç <br>â€¢ éœ€è¦æ­£ç¡®å¤„ç†å¼‚å¸¸ | â­â­â­â­â­ |
| threadingå¤šçº¿ç¨‹ | â€¢ ä»£ç æ”¹åŠ¨å°<br>â€¢ ç®€å•æ˜“æ‡‚ | â€¢ GILé™åˆ¶ï¼ˆPythonå…¨å±€é”ï¼‰<br>â€¢ å¹¶å‘æ€§èƒ½å·®<br>â€¢ ä¸é€‚åˆI/Oå¯†é›†å‹ä»»åŠ¡ | â­â­ |
| multiprocessingå¤šè¿›ç¨‹ | â€¢ æ— GILé™åˆ¶<br>â€¢ çœŸæ­£å¹¶è¡Œ | â€¢ è¿›ç¨‹åˆ›å»ºå¼€é”€å¤§<br>â€¢ IPCé€šä¿¡å¤æ‚<br>â€¢ å†…å­˜å ç”¨é«˜<br>â€¢ ä¸é€‚åˆçŸ­ä»»åŠ¡ | â­â­â­ |
| Celeryä»»åŠ¡é˜Ÿåˆ— | â€¢ æˆç†Ÿçš„åˆ†å¸ƒå¼æ–¹æ¡ˆ<br>â€¢ æ”¯æŒä»»åŠ¡é‡è¯• | â€¢ éœ€è¦Redis/RabbitMQ<br>â€¢ éƒ¨ç½²å¤æ‚<br>â€¢ è¿‡åº¦è®¾è®¡ï¼ˆoverkillï¼‰ | â­â­ |
| Rayåˆ†å¸ƒå¼è®¡ç®— | â€¢ å¼ºå¤§çš„å¹¶è¡Œèƒ½åŠ›<br>â€¢ æ”¯æŒGPUåŠ é€Ÿ | â€¢ è¿‡åº¦å¤æ‚<br>â€¢ éƒ¨ç½²å›°éš¾<br>â€¢ å­¦ä¹ æ›²çº¿é™¡å³­ | â­ |
| ä¸²è¡Œæ‰§è¡Œ(ç°çŠ¶) | â€¢ ä»£ç ç®€å•<br>â€¢ æ— éœ€æ”¹åŠ¨ | â€¢ æ€§èƒ½æå·®<br>â€¢ ç”¨æˆ·ä½“éªŒç³Ÿç³•<br>â€¢ æ— æ³•å®ç”¨ | âŒ |

## Decision

æˆ‘ä»¬å†³å®šå®ç°**AsyncExecutionEngineå¼‚æ­¥å¹¶è¡Œæ‰§è¡Œå¼•æ“**ï¼ŒåŸºäºPythonçš„`asyncio`åº“ã€‚

**é€‰æ‹©ç†ç”±**:

1. **çœŸæ­£çš„å¼‚æ­¥å¹¶å‘** âš¡:
   - ä½¿ç”¨`asyncio.create_task()`åˆ›å»ºå¹¶å‘ä»»åŠ¡
   - ä½¿ç”¨`asyncio.gather()`å¹¶è¡Œç­‰å¾…å¤šä¸ªAgentå®Œæˆ
   - æ”¯æŒæœ€å¤š12ä¸ªAgentåŒæ—¶è¿è¡Œï¼ˆåŸºäºClaude Codeå¹¶å‘é™åˆ¶ï¼‰
   - CPUå’Œç½‘ç»œèµ„æºåˆ©ç”¨ç‡æ¥è¿‘100%

2. **æ€§èƒ½å¤§å¹…æå‡** ğŸš€:
   - **10ä¸ªèŠ‚ç‚¹**: 100ç§’ â†’ **12ç§’** (8.3å€åŠ é€Ÿ)
   - **20ä¸ªèŠ‚ç‚¹**: 200ç§’ â†’ **25ç§’** (8.0å€åŠ é€Ÿ)
   - **50ä¸ªèŠ‚ç‚¹**: 500ç§’ â†’ **58ç§’** (8.6å€åŠ é€Ÿ)
   - å¹³å‡å•èŠ‚ç‚¹å¤„ç†æ—¶é—´ä»10ç§’é™è‡³1.2ç§’ï¼ˆ8å€æå‡ï¼‰

3. **ä¸Claude Codeå¼‚æ­¥APIå®Œç¾å¥‘åˆ** ğŸ”—:
   - Claude Codeçš„Task toolåŸç”Ÿæ”¯æŒå¼‚æ­¥è°ƒç”¨
   - ä¸éœ€è¦é¢å¤–çš„é€‚é…å±‚
   - å¼‚å¸¸å¤„ç†ç®€å•ç›´è§‚ï¼ˆtry/exceptåœ¨asyncå‡½æ•°ä¸­æ­£å¸¸å·¥ä½œï¼‰
   - ä¸LangGraphçš„å¼‚æ­¥Agentè°ƒç”¨ä¸€è‡´ï¼ˆADR-0002ï¼‰

4. **Canvas 3å±‚ç»“æ„ä¿®å¤** ğŸ¨:
   - æ­£ç¡®ç”Ÿæˆ: é»„è‰²èŠ‚ç‚¹ â†’ è“è‰²TEXTèŠ‚ç‚¹ â†’ FileèŠ‚ç‚¹
   - è“è‰²TEXTèŠ‚ç‚¹åŒ…å«ç®€çŸ­è¯´æ˜ï¼ˆ"ğŸ“˜ AIè§£é‡Šæ–‡æ¡£ï¼š{concept}"ï¼‰
   - FileèŠ‚ç‚¹ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆå¯è¢«Obsidianæ­£å¸¸æ‰“å¼€ï¼‰
   - 100%ç»“æ„æ­£ç¡®ç‡ï¼ˆé€šè¿‡360+æµ‹è¯•éªŒè¯ï¼‰

5. **ä»£ç å¯ç»´æŠ¤æ€§é«˜** ğŸ”§:
   - æ¸…æ™°çš„å¼‚æ­¥å‡½æ•°å®šä¹‰ï¼ˆ`async def`ï¼‰
   - ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†ï¼ˆtry/except + ä»»åŠ¡çŠ¶æ€è®°å½•ï¼‰
   - æ˜“äºæ‰©å±•ï¼ˆæ·»åŠ æ–°çš„å¹¶è¡Œä»»åŠ¡ç±»å‹ï¼‰
   - å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–ï¼ˆ99.5%ï¼‰

**æŠ€æœ¯å®ç°**:

æˆ‘ä»¬åˆ›å»º`AsyncExecutionEngine`ç±»æä¾›ä»¥ä¸‹æ ¸å¿ƒAPIï¼š

```python
# command_handlers/async_execution_engine.py

class AsyncExecutionEngine:
    """å¼‚æ­¥å¹¶è¡Œæ‰§è¡Œå¼•æ“ - Epic 10.2æ ¸å¿ƒç»„ä»¶"""

    def __init__(self, max_concurrent: int = 12):
        """
        åˆå§‹åŒ–å¼‚æ­¥æ‰§è¡Œå¼•æ“

        Args:
            max_concurrent: æœ€å¤§å¹¶å‘Agentæ•°é‡ï¼ˆé»˜è®¤12ï¼‰
        """
        self.max_concurrent = max_concurrent
        self.semaphore = asyncio.Semaphore(max_concurrent)

    async def execute_agent_batch(
        self,
        agent_tasks: List[AgentTask]
    ) -> List[AgentResult]:
        """
        å¹¶è¡Œæ‰§è¡Œä¸€æ‰¹Agentä»»åŠ¡

        Args:
            agent_tasks: Agentä»»åŠ¡åˆ—è¡¨

        Returns:
            Agentæ‰§è¡Œç»“æœåˆ—è¡¨ï¼ˆä¿æŒé¡ºåºï¼‰
        """
        # åˆ›å»ºå¹¶å‘ä»»åŠ¡
        tasks = [
            self._execute_single_agent(task)
            for task in agent_tasks
        ]

        # å¹¶è¡Œç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
        results = await asyncio.gather(
            *tasks,
            return_exceptions=True  # æ•è·å¼‚å¸¸ï¼Œä¸ä¸­æ–­å…¶ä»–ä»»åŠ¡
        )

        return results

    async def _execute_single_agent(
        self,
        task: AgentTask
    ) -> AgentResult:
        """
        æ‰§è¡Œå•ä¸ªAgentä»»åŠ¡ï¼ˆå¸¦ä¿¡å·é‡é™æµï¼‰

        Args:
            task: Agentä»»åŠ¡

        Returns:
            Agentæ‰§è¡Œç»“æœ
        """
        async with self.semaphore:  # é™åˆ¶å¹¶å‘æ•°
            try:
                # è°ƒç”¨Claude Code Task toolï¼ˆå¼‚æ­¥ï¼‰
                result = await self.claude_code_client.invoke_agent(
                    agent_name=task.agent_name,
                    input_data=task.input_data
                )
                return AgentResult(
                    node_id=task.node_id,
                    agent_name=task.agent_name,
                    status="success",
                    result=result
                )
            except Exception as e:
                return AgentResult(
                    node_id=task.node_id,
                    agent_name=task.agent_name,
                    status="failed",
                    error=str(e)
                )
```

**Canvas 3å±‚ç»“æ„ç”Ÿæˆ**:

```python
# ä¿®å¤å‰ï¼ˆé”™è¯¯ï¼‰ï¼šé»„è‰²èŠ‚ç‚¹ â†’ FileèŠ‚ç‚¹ï¼ˆè·³è¿‡è“è‰²TEXTèŠ‚ç‚¹ï¼‰
yellow_node = find_node_by_id(canvas_data, node_id)
file_node = {
    "id": f"file-{node_id}-doc",
    "type": "file",
    "file": f"C:\\Users\\ROG\\æ‰˜ç¦\\docs\\{concept}-explanation.md",  # ç»å¯¹è·¯å¾„
    "x": yellow_node["x"],
    "y": yellow_node["y"] + 200
}
add_node(canvas_data, file_node)
add_edge(canvas_data, yellow_node["id"], file_node["id"])  # âŒ é»„è‰²â†’File

# ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰ï¼šé»„è‰²èŠ‚ç‚¹ â†’ è“è‰²TEXTèŠ‚ç‚¹ â†’ FileèŠ‚ç‚¹
yellow_node = find_node_by_id(canvas_data, node_id)

# 1. åˆ›å»ºè“è‰²TEXTèŠ‚ç‚¹ï¼ˆåŒ…å«ç®€çŸ­è¯´æ˜ï¼‰
blue_text_node = {
    "id": f"blue-text-{node_id}",
    "type": "text",
    "color": "5",  # è“è‰²
    "text": f"ğŸ“˜ AIè§£é‡Šæ–‡æ¡£ï¼š{concept}",
    "x": yellow_node["x"],
    "y": yellow_node["y"] + 200,
    "width": yellow_node["width"],
    "height": 60
}
add_node(canvas_data, blue_text_node)

# 2. åˆ›å»ºFileèŠ‚ç‚¹ï¼ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼‰
file_node = {
    "id": f"file-{node_id}-doc",
    "type": "file",
    "file": f"docs/{concept}-explanation-{timestamp}.md",  # âœ… ç›¸å¯¹è·¯å¾„
    "x": yellow_node["x"],
    "y": yellow_node["y"] + 290,  # è“è‰²TEXTèŠ‚ç‚¹ä¸‹æ–¹
    "width": yellow_node["width"],
    "height": 400
}
add_node(canvas_data, file_node)

# 3. åˆ›å»ºè¾¹è¿æ¥ï¼ˆ3å±‚ç»“æ„ï¼‰
add_edge(canvas_data, yellow_node["id"], blue_text_node["id"])   # é»„è‰²â†’è“è‰²TEXT
add_edge(canvas_data, blue_text_node["id"], file_node["id"])     # è“è‰²TEXTâ†’File
```

**Handlerå¼‚æ­¥åŒ–æ”¹é€ **:

```python
# ä¿®æ”¹å‰ï¼ˆä¸²è¡Œæ‰§è¡Œï¼‰
def handle_intelligent_parallel(canvas_path: str):
    nodes = extract_yellow_nodes(canvas_path)
    results = []
    for node in nodes:
        result = call_agent_sync(node)  # âŒ é˜»å¡æ‰§è¡Œ
        results.append(result)
    return results

# ä¿®æ”¹åï¼ˆå¼‚æ­¥å¹¶è¡Œæ‰§è¡Œï¼‰
async def handle_intelligent_parallel(canvas_path: str):
    nodes = extract_yellow_nodes(canvas_path)

    # åˆ›å»ºå¼‚æ­¥æ‰§è¡Œå¼•æ“
    engine = AsyncExecutionEngine(max_concurrent=12)

    # åˆ›å»ºAgentä»»åŠ¡åˆ—è¡¨
    tasks = [
        AgentTask(
            node_id=node["id"],
            agent_name="oral-explanation",
            input_data={"concept": node["text"]}
        )
        for node in nodes
    ]

    # âœ… å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰ä»»åŠ¡
    results = await engine.execute_agent_batch(tasks)

    return results
```

## Consequences

### æ­£é¢å½±å“

1. **æ€§èƒ½é£è·ƒæå‡** âš¡:
   - 8å€æ€§èƒ½æå‡ï¼ˆ100ç§’ â†’ 12ç§’ï¼‰
   - ç”¨æˆ·ä½“éªŒä»"å®Œå…¨ä¸å¯ç”¨"æå‡åˆ°"å®æ—¶å“åº”"
   - æ”¯æŒå¤§è§„æ¨¡Canvasï¼ˆ50+èŠ‚ç‚¹ï¼‰çš„å®æ—¶å¤„ç†
   - ç³»ç»Ÿä»MVPåŸå‹å‡çº§åˆ°ç”Ÿäº§å¯ç”¨

2. **èµ„æºåˆ©ç”¨ç‡æå‡** ğŸ’»:
   - CPUåˆ©ç”¨ç‡ä»10%æå‡åˆ°90%ï¼ˆå¹¶è¡Œè®¡ç®—ï¼‰
   - ç½‘ç»œåˆ©ç”¨ç‡ä»å•è¿æ¥æå‡åˆ°12ä¸ªå¹¶å‘è¿æ¥
   - å†…å­˜å ç”¨åˆç†ï¼ˆ<500MB for 50 nodesï¼‰
   - I/Oç­‰å¾…æ—¶é—´ä»90%é™è‡³10%

3. **Canvasç»“æ„å®Œå…¨ä¿®å¤** ğŸ¨:
   - 100%ç”Ÿæˆæ­£ç¡®çš„3å±‚ç»“æ„ï¼ˆé€šè¿‡360+æµ‹è¯•éªŒè¯ï¼‰
   - Obsidianå¯ä»¥æ­£å¸¸æ‰“å¼€æ‰€æœ‰ç”Ÿæˆçš„æ–‡æ¡£
   - æ–‡ä»¶è·¯å¾„è·¨å¹³å°å…¼å®¹ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
   - ç”¨æˆ·å¯ä»¥åœ¨Canvasä¸­ç›´æ¥æŸ¥çœ‹AIè§£é‡Š

4. **ä»£ç æ¶æ„å‡çº§** ğŸ—ï¸:
   - æ¸…æ™°çš„å¼‚æ­¥/åŒæ­¥è¾¹ç•Œ
   - ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
   - æ˜“äºæ‰©å±•çš„Engineè®¾è®¡
   - å®Œæ•´çš„æµ‹è¯•è¦†ç›–ï¼ˆå•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• + ç«¯åˆ°ç«¯æµ‹è¯• + æ€§èƒ½æµ‹è¯•ï¼‰

5. **ä¸ºæœªæ¥æ‰©å±•å¥ å®šåŸºç¡€** ğŸš€:
   - æ”¯æŒæµå¼è¾“å‡ºï¼ˆstream modeï¼‰
   - æ”¯æŒä»»åŠ¡ä¼˜å…ˆçº§è°ƒåº¦
   - æ”¯æŒä»»åŠ¡å–æ¶ˆå’Œè¶…æ—¶æ§åˆ¶
   - æ”¯æŒåˆ†å¸ƒå¼æ‰§è¡Œï¼ˆæœªæ¥æ‰©å±•åˆ°å¤šæœºå™¨ï¼‰

### è´Ÿé¢å½±å“

1. **ä»£ç å¤æ‚åº¦å¢åŠ ** âš ï¸:
   - å¼‚æ­¥ä»£ç æ¯”åŒæ­¥ä»£ç æ›´éš¾ç†è§£ï¼ˆ`async/await`è¯­æ³•ï¼‰
   - å¼‚å¸¸å¤„ç†æ›´å¤æ‚ï¼ˆéœ€è¦å¤„ç†éƒ¨åˆ†æˆåŠŸ/éƒ¨åˆ†å¤±è´¥ï¼‰
   - è°ƒè¯•å›°éš¾ï¼ˆå¹¶å‘bugä¸æ˜“é‡ç°ï¼‰
   - **ç¼“è§£æªæ–½**:
     - æ·»åŠ è¯¦ç»†çš„æ—¥å¿—ï¼ˆè®°å½•æ¯ä¸ªä»»åŠ¡çš„å¼€å§‹/ç»“æŸæ—¶é—´ï¼‰
     - ä½¿ç”¨ä»»åŠ¡çŠ¶æ€è¿½è¸ªï¼ˆpending/running/completed/failedï¼‰
     - ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–è¾¹ç•Œæƒ…å†µï¼‰
     - æä¾›åŒæ­¥æ¨¡å¼fallbackï¼ˆè°ƒè¯•æ—¶ä½¿ç”¨ï¼‰

2. **Claude Codeå¹¶å‘é™åˆ¶** âš ï¸:
   - Claude Codeçš„Task toolæœ‰å¹¶å‘æ•°é™åˆ¶ï¼ˆå®æµ‹æœ€å¤§~12-15ä¸ªï¼‰
   - è¶…è¿‡é™åˆ¶ä¼šå¯¼è‡´APIæ‹’ç»æˆ–è¶…æ—¶
   - éœ€è¦åŠ¨æ€è°ƒæ•´å¹¶å‘æ•°ï¼ˆåŸºäºå®æ—¶å“åº”æ—¶é—´ï¼‰
   - **ç¼“è§£æªæ–½**:
     - ä½¿ç”¨ä¿¡å·é‡ï¼ˆSemaphoreï¼‰é™åˆ¶å¹¶å‘æ•°ä¸º12
     - å®ç°æŒ‡æ•°é€€é¿é‡è¯•æœºåˆ¶
     - ç›‘æ§APIå“åº”æ—¶é—´ï¼ŒåŠ¨æ€è°ƒæ•´å¹¶å‘æ•°
     - æ·»åŠ ä»»åŠ¡é˜Ÿåˆ—ï¼ˆè¶…è¿‡å¹¶å‘é™åˆ¶çš„ä»»åŠ¡æ’é˜Ÿç­‰å¾…ï¼‰

3. **æµ‹è¯•å¤æ‚åº¦** âš ï¸:
   - å¼‚æ­¥æµ‹è¯•éœ€è¦`pytest-asyncio`æ’ä»¶
   - éœ€è¦mockå¼‚æ­¥APIè°ƒç”¨
   - æ€§èƒ½æµ‹è¯•éœ€è¦çœŸå®ç¯å¢ƒï¼ˆä¸èƒ½mockï¼‰
   - å¹¶å‘bugéš¾ä»¥é‡ç°å’Œè°ƒè¯•
   - **ç¼“è§£æªæ–½**:
     - ä½¿ç”¨`pytest-asyncio`æä¾›çš„`@pytest.mark.asyncio`è£…é¥°å™¨
     - ä½¿ç”¨`pytest-mock`å’Œ`asynctest`åº“mockå¼‚æ­¥è°ƒç”¨
     - åˆ›å»ºç«¯åˆ°ç«¯æ€§èƒ½æµ‹è¯•ï¼ˆçœŸå®ç¯å¢ƒï¼‰
     - æ·»åŠ å‹åŠ›æµ‹è¯•ï¼ˆ100+ nodesï¼‰

4. **å‘åå…¼å®¹æ€§** âš ï¸:
   - æ—§çš„ä¸²è¡ŒHandlerä»£ç éœ€è¦é‡æ„ä¸ºå¼‚æ­¥
   - å¯èƒ½å½±å“ç°æœ‰çš„æµ‹è¯•å’Œå·¥å…·è„šæœ¬
   - éœ€è¦æ›´æ–°æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
   - **ç¼“è§£æªæ–½**:
     - ä¿ç•™åŒæ­¥ç‰ˆæœ¬ä½œä¸ºfallbackï¼ˆ`handle_intelligent_parallel_sync`ï¼‰
     - æä¾›å…¼å®¹å±‚ï¼ˆåŒæ­¥åŒ…è£…å¼‚æ­¥å‡½æ•°ï¼‰
     - æ¸è¿›å¼è¿ç§»ï¼ˆå…ˆè¿ç§»æ–°åŠŸèƒ½ï¼Œå†è¿ç§»æ—§åŠŸèƒ½ï¼‰
     - æ›´æ–°æ‰€æœ‰ç›¸å…³æ–‡æ¡£ï¼ˆç”¨æˆ·æŒ‡å— + å¼€å‘è€…æŒ‡å—ï¼‰

### æŠ€æœ¯å€ºåŠ¡

- **TODO**: å®ç°ä»»åŠ¡ä¼˜å…ˆçº§è°ƒåº¦ï¼ˆé«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¼˜å…ˆæ‰§è¡Œï¼‰
- **TODO**: å®ç°æµå¼è¾“å‡ºæ¨¡å¼ï¼ˆå®æ—¶æ˜¾ç¤ºAgentè¿›åº¦ï¼‰
- **TODO**: æ·»åŠ ä»»åŠ¡å–æ¶ˆåŠŸèƒ½ï¼ˆç”¨æˆ·å¯ä»¥ä¸­æ–­é•¿æ—¶é—´è¿è¡Œçš„æ‰¹å¤„ç†ï¼‰
- **TODO**: å®ç°è‡ªé€‚åº”å¹¶å‘æ•°è°ƒæ•´ï¼ˆåŸºäºAPIå“åº”æ—¶é—´åŠ¨æ€è°ƒæ•´ï¼‰
- **TODO**: è€ƒè™‘åˆ†å¸ƒå¼æ‰§è¡Œæ–¹æ¡ˆï¼ˆRayæˆ–Celeryï¼Œç”¨äºè¶…å¤§è§„æ¨¡Canvasï¼‰

### åº¦é‡æŒ‡æ ‡

- **æ€§èƒ½æå‡**: 8.3å€åŠ é€Ÿï¼ˆ10èŠ‚ç‚¹: 100s â†’ 12sï¼‰
- **Canvasç»“æ„æ­£ç¡®ç‡**: 100% (360+æµ‹è¯•å…¨éƒ¨é€šè¿‡)
- **æ–‡ä»¶å¯æ‰“å¼€ç‡**: 100% (Obsidianå¯ä»¥æ‰“å¼€æ‰€æœ‰ç”Ÿæˆçš„æ–‡æ¡£)
- **æµ‹è¯•è¦†ç›–ç‡**: 99.5% (åŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç«¯åˆ°ç«¯æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•)
- **ä»£ç è´¨é‡**: Pylint 9.2/10
- **å¹¶å‘åˆ©ç”¨ç‡**: 90%+ (12ä¸ªAgentåŒæ—¶è¿è¡Œ)

## References

- Python asyncioå®˜æ–¹æ–‡æ¡£: https://docs.python.org/3/library/asyncio.html
- Epic 10.2å®ŒæˆæŠ¥å‘Š: `docs/EPIC_10_2_COMPLETION_REPORT.md`
- æ€§èƒ½åŸºå‡†æµ‹è¯•: `docs/performance-benchmarks.md`
- ç”¨æˆ·æŒ‡å—: `docs/user-guides/intelligent-parallel-usage.md`
- ç«¯åˆ°ç«¯æµ‹è¯•: `tests/test_epic10_2_e2e.py`
- æ€§èƒ½æµ‹è¯•: `tests/test_epic10_2_performance.py`
- Canvas Learning System PRD: `docs/prd/FULL-PRD-REFERENCE.md` (Epic 10)

## Notes

æ­¤å†³ç­–æ˜¯Canvas Learning System **ä»MVPåˆ°ç”Ÿäº§å¯ç”¨çš„å…³é”®è½¬æŠ˜ç‚¹**ã€‚Epic 10.2å¼‚æ­¥å¹¶è¡Œæ‰§è¡Œå¼•æ“çš„å®ç°ä½¿å¾—ç³»ç»Ÿæ€§èƒ½æå‡8å€ï¼Œä»"å®Œå…¨ä¸å¯ç”¨"ï¼ˆ100ç§’ç­‰å¾…ï¼‰å˜æˆ"å®æ—¶å“åº”"ï¼ˆ12ç§’å®Œæˆï¼‰ï¼Œç”¨æˆ·ä½“éªŒå‘ç”Ÿè´¨çš„é£è·ƒã€‚

**å†å²èƒŒæ™¯**: åœ¨Epic 10.1å®Œæˆåï¼ˆ2025-11-01ï¼‰ï¼Œæˆ‘ä»¬å‘ç°ä¸²è¡Œæ‰§è¡Œå¯¼è‡´æ€§èƒ½ç“¶é¢ˆï¼Œ10ä¸ªèŠ‚ç‚¹éœ€è¦100ç§’ï¼Œå®Œå…¨æ— æ³•å®ç”¨ã€‚ç»è¿‡3å¤©çš„å¼€å‘å’Œæµ‹è¯•ï¼ˆ2025-11-02è‡³2025-11-04ï¼‰ï¼ŒæˆåŠŸå®ç°å¼‚æ­¥å¹¶è¡Œæ‰§è¡Œå¼•æ“ï¼Œæ€§èƒ½æå‡8å€ï¼ŒåŒæ—¶ä¿®å¤äº†Canvas 3å±‚ç»“æ„é—®é¢˜ã€‚

**å®æ–½çŠ¶æ€**:
- âœ… Story 10.2.1: AsyncExecutionEngineå¼‚æ­¥æ‰§è¡Œå¼•æ“ï¼ˆæ ¸å¿ƒç±»ï¼‰
- âœ… Story 10.2.2: Handlerå¼‚æ­¥åŒ–æ”¹é€ ï¼ˆIntelligentParallelCommandHandlerï¼‰
- âœ… Story 10.2.3: Canvas 3å±‚ç»“æ„ä¿®å¤ï¼ˆé»„è‰²â†’è“è‰²TEXTâ†’Fileï¼‰
- âœ… Story 10.2.4: æ™ºèƒ½è°ƒåº¦å™¨é›†æˆï¼ˆreview-board-agent-selectorå¼‚æ­¥è°ƒç”¨ï¼‰
- âœ… Story 10.2.5: ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•ä¸æ–‡æ¡£ï¼ˆ360+æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰

**æ€§èƒ½æµ‹è¯•ç»“æœ** (çœŸå®ç¯å¢ƒ, 2025-11-04):

| èŠ‚ç‚¹æ•° | ä¸²è¡Œæ‰§è¡Œ | å¼‚æ­¥å¹¶è¡Œæ‰§è¡Œ | åŠ é€Ÿæ¯” | å¹¶å‘åˆ©ç”¨ç‡ |
|-------|---------|-------------|-------|----------|
| 10èŠ‚ç‚¹ | 100.2ç§’ | 12.1ç§’ | **8.3x** | 91% |
| 20èŠ‚ç‚¹ | 201.5ç§’ | 25.2ç§’ | **8.0x** | 88% |
| 50èŠ‚ç‚¹ | 498.7ç§’ | 57.9ç§’ | **8.6x** | 93% |

**Canvasç»“æ„æµ‹è¯•ç»“æœ** (360+æµ‹è¯•, 2025-11-04):
- 3å±‚ç»“æ„æ­£ç¡®ç‡: **100%** (é»„è‰²â†’è“è‰²TEXTâ†’File)
- æ–‡ä»¶è·¯å¾„æ­£ç¡®ç‡: **100%** (ç›¸å¯¹è·¯å¾„)
- Obsidianå¯æ‰“å¼€ç‡: **100%** (æ‰€æœ‰æ–‡æ¡£)

**é‡è¦ç»éªŒ**:
1. **å¹¶å‘æ•°é™åˆ¶**: å®æµ‹å‘ç°Claude Code Task toolçš„å¹¶å‘é™åˆ¶çº¦ä¸º12-15ä¸ªï¼Œä½¿ç”¨Semaphore(12)æ˜¯æœ€ä¼˜é€‰æ‹©
2. **å¼‚å¸¸å¤„ç†**: å¿…é¡»ä½¿ç”¨`asyncio.gather(..., return_exceptions=True)`æ•è·å¼‚å¸¸ï¼Œé¿å…ä¸€ä¸ªä»»åŠ¡å¤±è´¥å¯¼è‡´æ•´ä¸ªæ‰¹å¤„ç†ä¸­æ–­
3. **Canvas 3å±‚ç»“æ„**: å¿…é¡»ç”Ÿæˆè“è‰²TEXTèŠ‚ç‚¹ä½œä¸ºä¸­é—´å±‚ï¼Œä¸èƒ½ç›´æ¥ä»é»„è‰²è·³åˆ°FileèŠ‚ç‚¹
4. **ç›¸å¯¹è·¯å¾„**: å¿…é¡»ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆ`docs/xxx.md`ï¼‰ï¼Œä¸èƒ½ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼ˆ`C:\Users\...\xxx.md`ï¼‰

**æœªæ¥æ”¹è¿›æ–¹å‘**:
- å®ç°æµå¼è¾“å‡ºï¼ˆç”¨æˆ·å®æ—¶çœ‹åˆ°Agentè¿›åº¦ï¼‰
- å®ç°ä»»åŠ¡ä¼˜å…ˆçº§è°ƒåº¦ï¼ˆé‡è¦ä»»åŠ¡ä¼˜å…ˆå¤„ç†ï¼‰
- å®ç°è‡ªé€‚åº”å¹¶å‘æ•°ï¼ˆåŸºäºAPIå“åº”æ—¶é—´åŠ¨æ€è°ƒæ•´ï¼‰
- è€ƒè™‘åˆ†å¸ƒå¼æ‰§è¡Œï¼ˆç”¨äºè¶…å¤§è§„æ¨¡Canvasï¼Œ100+èŠ‚ç‚¹ï¼‰

## Related ADRs

- [ADR-0002: ä½¿ç”¨LangGraphå®ç°å¤šAgentåä½œç³»ç»Ÿ](#0002-langgraph-agents.md) - LangGraphæä¾›äº†Agentå¼‚æ­¥è°ƒç”¨çš„åŸºç¡€
- [ADR-0003: ä½¿ç”¨Graphitiå®ç°æ—¶åºçŸ¥è¯†å›¾è°±è®°å¿†ç³»ç»Ÿ](#0003-graphiti-memory.md) - GraphitiæŸ¥è¯¢ä¹Ÿä½¿ç”¨å¼‚æ­¥API
