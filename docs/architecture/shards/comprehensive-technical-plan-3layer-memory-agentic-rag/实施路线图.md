# 实施路线图

### 总体时间线: 15.5天 (3周)

```
Week 1: 基础设施搭建 (5.5天)
├─ Day 1-2:   LanceDB POC + 数据迁移
├─ Day 3-4:   LangGraph POC + StateGraph实现
└─ Day 5-5.5: Temporal Memory Schema + FSRS集成

Week 2: Agentic RAG开发 (7天)
├─ Day 6-7:   融合算法集成 (RRF/Weighted/Cascade)
├─ Day 8-9:   Hybrid Reranking (Local + Cohere)
├─ Day 10-11: 质量控制循环
└─ Day 12:    LangSmith可观测性

Week 3: Canvas集成 + 测试 (3天)
├─ Day 13:    Canvas API适配
├─ Day 14:    回归测试 + 性能基准
└─ Day 15:    生产部署 + 监控
```

### 详细路线图 (基于3个ADR)

#### 阶段1: LanceDB迁移 (4.5天)

**来源**: ADR-002实施路径

| 任务 | 工期 | 关键产出 |
|------|------|---------|
| LanceDB POC验证 | 1天 | 多模态检索Demo |
| ChromaDB数据导出 | 0.5天 | chromadb_export.json |
| LanceDB数据导入 | 0.5天 | canvas_multimodal表 |
| 数据一致性验证 | 0.5天 | 一致性测试报告 |
| 双写模式部署 | 1天 | DualWriteAdapter |
| 完全切换 | 0.5天 | ChromaDB下线 |
| 多模态扩展 (可选) | 1天 | ImageBind集成 |

**验收标准**:
- ✅ LanceDB查询延迟 <15ms (P95)
- ✅ 数据一致性 ≥80% (Top-10结果重叠)
- ✅ 回归测试100%通过

---

#### 阶段2: Agentic RAG开发 (9.5天)

**来源**: ADR-003实施路径

| 子阶段 | 工期 | 关键产出 |
|-------|------|---------|
| **2.1 LangGraph POC** | 2天 | |
| StateGraph实现 | 1天 | CanvasRAGState + 并行检索 |
| RRF融合测试 | 0.5天 | RRF算法验证 |
| 端到端测试 | 0.5天 | E2E测试通过 |
| **2.2 融合算法集成** | 2天 | |
| Weighted Fusion | 0.5天 | 加权融合算法 |
| Cascade Retrieval | 0.5天 | 瀑布式检索 |
| 自适应策略选择 | 0.5天 | select_fusion_strategy() |
| A/B测试 | 0.5天 | 准确率验证 |
| **2.3 Hybrid Reranking** | 2天 | |
| Local Cross-Encoder部署 | 0.5天 | BAAI/bge-reranker-base |
| Cohere Rerank集成 | 0.5天 | Cohere API调用 |
| Hybrid自动选择 | 0.5天 | HybridReranker |
| 成本监控 | 0.5天 | CostMonitor |
| **2.4 质量控制循环** | 1.5天 | |
| 质量评分器 | 0.5天 | check_quality() |
| 查询重写器 | 0.5天 | rewrite_query() |
| 质量循环集成 | 0.5天 | 条件边: quality → rewrite |
| **2.5 Canvas集成** | 2天 | |
| Canvas API适配 | 1天 | CanvasAgenticRAGAdapter |
| 回归测试 | 0.5天 | 360/360测试通过 |
| 生产部署 | 0.5天 | 24小时稳定运行 |

**验收标准**:
- ✅ P95延迟 <400ms
- ✅ 检验白板准确率 ≥85%
- ✅ 年度成本 ≤$20

---

#### 阶段3: Temporal Memory集成 (1.5天)

**来源**: Epic 14依赖

| 任务 | 工期 | 关键产出 |
|------|------|---------|
| SQLite Schema设计 | 0.5天 | learning_sessions + concept_cards表 |
| Py-FSRS集成 | 0.5天 | FSRS模型 + 复习调度 |
| 行为监控触发点 | 0.5天 | 检测逾期概念 |

---

#### 里程碑总结

| 里程碑 | 完成日期 | 关键成果 |
|--------|---------|---------|
| M1: LanceDB生产就绪 | Day 4.5 | 多模态检索可用 |
| M2: Agentic RAG核心完成 | Day 10.5 | 并行检索+融合+重排 |
| M3: 质量控制集成 | Day 12 | 质量循环+查询重写 |
| M4: Canvas集成完成 | Day 14 | 检验白板生成升级 |
| M5: 生产部署 | Day 15.5 | **3层记忆系统上线** |

---
