# Epic 25: è·¨Canvasä¸æ•™æä¸Šä¸‹æ–‡é›†æˆ

---
epic_id: EPIC-25
title: "è·¨Canvasä¸æ•™æä¸Šä¸‹æ–‡é›†æˆ"
status: planned
priority: P2
created: 2025-12-11
estimated_stories: 3
related_bugs: [Bug-5]
dependencies: [EPIC-21]
---

## 1. é—®é¢˜æ¦‚è¿°

### 1.1 Bugæè¿°

**Bug 5: è·¨Canvas/æ•™ææŒ‚è½½æœªè€ƒè™‘ä¸Šä¸‹æ–‡**

å½“å‰ç³»ç»Ÿå­˜åœ¨ä¸¥é‡çš„ä¸Šä¸‹æ–‡è„±èŠ‚é—®é¢˜ï¼š
- `TextbookContextService` åœ¨decomposeæµç¨‹ä¸­æœªè¢«è°ƒç”¨
- Cross-Canvaså…³è”æ•°æ®æœªä¼ å…¥Agentä¸Šä¸‹æ–‡
- 12ä¸ªCross-Canvas APIç«¯ç‚¹åœ¨å‰ç«¯æœ‰ApiClientæ–¹æ³•ï¼Œä½†**æ— ä»»ä½•UIå…¥å£**

### 1.2 ç°çŠ¶åˆ†æ

```
åç«¯APIçŠ¶æ€:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /api/v1/cross-canvas/*                 â”‚
â”‚ 12ä¸ªç«¯ç‚¹å·²å®ç° âœ…                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ POST /associations                   â”‚
â”‚ â€¢ GET /associations                    â”‚
â”‚ â€¢ GET /associations/{id}               â”‚
â”‚ â€¢ PUT /associations/{id}               â”‚
â”‚ â€¢ DELETE /associations/{id}            â”‚
â”‚ â€¢ GET /by-canvas                       â”‚
â”‚ â€¢ GET /concepts/search                 â”‚
â”‚ â€¢ GET /knowledge-paths                 â”‚
â”‚ â€¢ POST /knowledge-paths                â”‚
â”‚ â€¢ GET /knowledge-paths/{id}            â”‚
â”‚ â€¢ POST /suggest                        â”‚
â”‚ â€¢ GET /statistics                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å‰ç«¯APIå®¢æˆ·ç«¯:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ApiClient (TypeScript)                 â”‚
â”‚ 12ä¸ªæ–¹æ³•å·²å®ç° âœ…                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å‰ç«¯UIå…¥å£:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UIå…¥å£: 0ä¸ª âŒ                          â”‚
â”‚ 100%åŠŸèƒ½ä¸å¯ç”¨                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ç”¨æˆ·éœ€æ±‚

| éœ€æ±‚ | æè¿° | åœºæ™¯ |
|------|------|------|
| **é¢˜ç›®Canvas â†” è®²åº§Canvas** | åšé¢˜æ—¶å…³è”è®²åº§çŸ¥è¯†ç‚¹ | å¤ä¹ åœºæ™¯ |
| **æ•™æPDFæŒ‚è½½** | PDF/ç¬”è®°å†…å®¹ä½œä¸ºä¸Šä¸‹æ–‡ | å­¦ä¹ åœºæ™¯ |
| **è·¨Canvasæœç´¢** | æœç´¢å…³è”Canvasä¸­çš„æ¦‚å¿µ | æŸ¥æ‰¾åœºæ™¯ |
| **å‰ç½®çŸ¥è¯†æç¤º** | æ˜¾ç¤ºå­¦ä¹ æ­¤æ¦‚å¿µçš„å‰ç½®è¦æ±‚ | å¼•å¯¼åœºæ™¯ |

---

## 2. æŠ€æœ¯æ¶æ„

### 2.1 ä¸Šä¸‹æ–‡æµè½¬æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Agentè¯·æ±‚æµç¨‹                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚ ç”¨æˆ·è¯·æ±‚    â”‚ â†’ æ‹†è§£"é€†å¦å‘½é¢˜"                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚         â”‚                                                           â”‚
â”‚         â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              ContextEnrichmentService                        â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  1. å½“å‰CanvasèŠ‚ç‚¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚   â”‚
â”‚  â”‚                                    â”‚                         â”‚   â”‚
â”‚  â”‚  2. Edgeè¿æ¥çš„ç›¸é‚»èŠ‚ç‚¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ åˆå¹¶ä¸Šä¸‹æ–‡          â”‚   â”‚
â”‚  â”‚                                    â”‚                         â”‚   â”‚
â”‚  â”‚  3. TextbookContextService â”€â”€â”€â”€â”€â”€â”€â”€â”¤    (Epic 21å·²å®ç°)      â”‚   â”‚
â”‚  â”‚     â””â”€ æŒ‚è½½çš„æ•™æ/PDF             â”‚                         â”‚   â”‚
â”‚  â”‚                                    â”‚                         â”‚   â”‚
â”‚  â”‚  4. CrossCanvasService â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â† ğŸ”´ å½“å‰ç¼ºå¤±          â”‚   â”‚
â”‚  â”‚     â””â”€ å…³è”CanvasèŠ‚ç‚¹             â”‚                         â”‚   â”‚
â”‚  â”‚                                    â”‚                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                                           â”‚
â”‚         â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚ AI Agent    â”‚ â†’ åŸºäºå®Œæ•´ä¸Šä¸‹æ–‡ç”Ÿæˆç»“æœ                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å‰ç«¯UIå…¥å£è§„åˆ’

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Obsidian Plugin UIå…¥å£                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å³é”®èœå• (CanvasèŠ‚ç‚¹)                                        â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â€¢ ğŸ”— å…³è”åˆ°å…¶ä»–Canvas                                        â”‚   â”‚
â”‚  â”‚ â€¢ ğŸ“š æŒ‚è½½æ•™æ/PDF                                            â”‚   â”‚
â”‚  â”‚ â€¢ ğŸ” æœç´¢ç›¸å…³æ¦‚å¿µ                                            â”‚   â”‚
â”‚  â”‚ â€¢ ğŸ“‹ æŸ¥çœ‹å‰ç½®çŸ¥è¯†                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ä¾§è¾¹æ é¢æ¿ (Cross-Canvas)                                    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â”Œâ”€ å½“å‰Canvaså…³è” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚ â”‚ ğŸ“„ ç¦»æ•£æ•°å­¦.canvas                                      â”‚  â”‚   â”‚
â”‚  â”‚ â”‚   â”œâ”€ [å‰ç½®] é›†åˆè®º.canvas                              â”‚  â”‚   â”‚
â”‚  â”‚ â”‚   â”œâ”€ [æ‰©å±•] é€»è¾‘è¯æ˜.canvas                            â”‚  â”‚   â”‚
â”‚  â”‚ â”‚   â””â”€ [ç›¸å…³] æ¦‚ç‡è®º.canvas                              â”‚  â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ â”Œâ”€ æŒ‚è½½æ•™æ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚ â”‚ ğŸ“• ç¦»æ•£æ•°å­¦æ•™æ.pdf                                     â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ ğŸ““ è¯¾å ‚ç¬”è®°.md                                          â”‚  â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å‘½ä»¤é¢æ¿ (Ctrl+P)                                           â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â€¢ Canvas: åˆ›å»ºè·¨Canvaså…³è”                                   â”‚   â”‚
â”‚  â”‚ â€¢ Canvas: æŒ‚è½½æ•™æ                                           â”‚   â”‚
â”‚  â”‚ â€¢ Canvas: æŸ¥çœ‹çŸ¥è¯†è·¯å¾„                                       â”‚   â”‚
â”‚  â”‚ â€¢ Canvas: æœç´¢è·¨Canvasæ¦‚å¿µ                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Stories

### Story 25.1: Cross-Canvas UIå…¥å£æš´éœ²

**ä¼˜å…ˆçº§**: P0 (Critical)
**ä¼°è®¡**: 4 Story Points

#### æè¿°

åœ¨Obsidianæ’ä»¶ä¸­æš´éœ²Cross-CanvasåŠŸèƒ½çš„UIå…¥å£ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿå®é™…ä½¿ç”¨å·²å®ç°çš„12ä¸ªAPIç«¯ç‚¹ã€‚

#### å½“å‰çŠ¶æ€

- åç«¯ `/api/v1/cross-canvas/*` 12ä¸ªç«¯ç‚¹ âœ…
- å‰ç«¯ `ApiClient` 12ä¸ªæ–¹æ³• âœ…
- å‰ç«¯ UIå…¥å£ 0ä¸ª âŒ

#### éªŒæ”¶æ ‡å‡† (AC)

- [ ] AC 1: å³é”®èœå•æ·»åŠ "å…³è”åˆ°å…¶ä»–Canvas"é€‰é¡¹
- [ ] AC 2: å³é”®èœå•æ·»åŠ "æŸ¥çœ‹å…³è”Canvas"é€‰é¡¹
- [ ] AC 3: å‘½ä»¤é¢æ¿æ·»åŠ 4ä¸ªCross-Canvaså‘½ä»¤
- [ ] AC 4: ä¾§è¾¹æ æ˜¾ç¤ºå½“å‰Canvasçš„å…³è”åˆ—è¡¨
- [ ] AC 5: æ”¯æŒç‚¹å‡»è·³è½¬åˆ°å…³è”Canvas

#### æŠ€æœ¯ä»»åŠ¡

1. æ‰©å±• `ContextMenuManager.ts` æ·»åŠ Cross-Canvasèœå•é¡¹
2. åˆ›å»º `CrossCanvasModal.ts` å…³è”ç®¡ç†å¼¹çª—
3. åˆ›å»º `CrossCanvasSidebar.ts` ä¾§è¾¹æ é¢æ¿
4. æ³¨å†Œå‘½ä»¤é¢æ¿å‘½ä»¤
5. å®ç°å…³è”Canvasè·³è½¬é€»è¾‘
6. ç¼–å†™UIæµ‹è¯•

#### å…³é”®æ–‡ä»¶

- `canvas-progress-tracker/obsidian-plugin/src/managers/ContextMenuManager.ts`
- æ–°å»º: `canvas-progress-tracker/obsidian-plugin/src/modals/CrossCanvasModal.ts`
- æ–°å»º: `canvas-progress-tracker/obsidian-plugin/src/views/CrossCanvasSidebar.ts`
- `canvas-progress-tracker/obsidian-plugin/main.ts`

#### èœå•å®ç°ç¤ºä¾‹

```typescript
// ContextMenuManager.ts
private addCrossCanvasMenu(menu: Menu, node: CanvasNode) {
    menu.addItem((item) => {
        item
            .setTitle("ğŸ”— å…³è”åˆ°å…¶ä»–Canvas")
            .setIcon("link")
            .onClick(async () => {
                new CrossCanvasModal(this.app, node).open();
            });
    });

    menu.addItem((item) => {
        item
            .setTitle("ğŸ“‹ æŸ¥çœ‹å…³è”Canvas")
            .setIcon("list")
            .onClick(async () => {
                await this.showCanvasAssociations(node);
            });
    });
}
```

---

### Story 25.2: TextbookContextServiceé›†æˆåˆ°Agentæµç¨‹

**ä¼˜å…ˆçº§**: P0 (Critical)
**ä¼°è®¡**: 3 Story Points

#### æè¿°

å°† `TextbookContextService` é›†æˆåˆ°æ‰€æœ‰Agentè°ƒç”¨æµç¨‹ä¸­ï¼Œç¡®ä¿æ•™æä¸Šä¸‹æ–‡è¢«æ­£ç¡®æ³¨å…¥ã€‚

#### å½“å‰çŠ¶æ€

- `TextbookContextService` å·²å®ç° âœ…
- ä»…åœ¨éƒ¨åˆ†Agentä¸­ä½¿ç”¨ âš ï¸
- `decompose_basic`/`decompose_deep` æœªä½¿ç”¨ âŒ

#### éªŒæ”¶æ ‡å‡† (AC)

- [ ] AC 1: æ‰€æœ‰decomposeç«¯ç‚¹ä½¿ç”¨TextbookContextService
- [ ] AC 2: æ‰€æœ‰explainç«¯ç‚¹ä½¿ç”¨TextbookContextService
- [ ] AC 3: æ•™æä¸Šä¸‹æ–‡åŒ…å«åœ¨Agentæç¤ºè¯ä¸­
- [ ] AC 4: æ”¯æŒè¶…æ—¶é™çº§ (æ•™ææŸ¥è¯¢è¶…æ—¶ä¸é˜»å¡Agent)
- [ ] AC 5: æ·»åŠ æ•™æä¸Šä¸‹æ–‡ä½¿ç”¨æ—¥å¿—

#### æŠ€æœ¯ä»»åŠ¡

1. ä¿®æ”¹ `agents.py` ä¸­æ‰€æœ‰ç«¯ç‚¹æ·»åŠ TextbookContext
2. æ‰©å±• `ContextEnrichmentService` é›†æˆæ•™æä¸Šä¸‹æ–‡
3. ä¿®æ”¹Agentæç¤ºè¯æ¨¡æ¿åŒ…å«æ•™æå¼•ç”¨
4. å®ç°è¶…æ—¶é™çº§é€»è¾‘
5. æ·»åŠ ç›‘æ§æ—¥å¿—
6. ç¼–å†™é›†æˆæµ‹è¯•

#### å…³é”®æ–‡ä»¶

- `backend/app/api/v1/endpoints/agents.py`
- `backend/app/services/context_enrichment_service.py`
- `backend/app/services/textbook_context_service.py`

#### é›†æˆç¤ºä¾‹

```python
# agents.py - decompose_basic
@agents_router.post("/decompose/basic")
async def decompose_basic(
    request: DecomposeRequest,
    context_service: ContextEnrichmentService = Depends(get_context_service),
    textbook_service: TextbookContextService = Depends(get_textbook_service),  # æ–°å¢
    agent_service: AgentService = Depends(get_agent_service)
):
    # 1. è·å–Canvasä¸Šä¸‹æ–‡ (Epic 21)
    enriched = await context_service.enrich_context(
        canvas_path=request.canvas_path,
        node_id=request.node_id
    )

    # 2. è·å–æ•™æä¸Šä¸‹æ–‡ (æœ¬Story)
    textbook_context = await textbook_service.get_context_for_concept(
        concept=enriched.target_node.get("text", ""),
        canvas_path=request.canvas_path,
        timeout_ms=3000  # 3ç§’è¶…æ—¶
    )

    # 3. åˆå¹¶ä¸Šä¸‹æ–‡
    full_context = {
        **enriched.to_dict(),
        "textbook_references": textbook_context.contexts,
        "prerequisites": textbook_context.prerequisites
    }

    # 4. è°ƒç”¨Agent
    result = await agent_service.decompose_basic(
        content=enriched.target_node.get("text", ""),
        context=full_context  # ä¼ å…¥å®Œæ•´ä¸Šä¸‹æ–‡
    )
```

---

### Story 25.3: é¢˜ç›®Canvas â†” è®²åº§Canvaså…³è”

**ä¼˜å…ˆçº§**: P1 (High)
**ä¼°è®¡**: 4 Story Points

#### æè¿°

å®ç°é¢˜ç›®Canvasä¸è®²åº§Canvasçš„æ™ºèƒ½å…³è”ï¼Œæ”¯æŒåšé¢˜æ—¶è‡ªåŠ¨å¼•ç”¨è®²åº§çŸ¥è¯†ç‚¹ã€‚

#### ä½¿ç”¨åœºæ™¯

```
ç”¨æˆ·åœºæ™¯:
1. ç”¨æˆ·åœ¨"æœŸæœ«å¤ä¹ -ç¦»æ•£æ•°å­¦é¢˜ç›®.canvas"åšé¢˜
2. é‡åˆ°"é€†å¦å‘½é¢˜"ç›¸å…³é¢˜ç›®
3. ç³»ç»Ÿè‡ªåŠ¨å…³è”åˆ°"ç¦»æ•£æ•°å­¦-ç¬¬3ç« -å‘½é¢˜é€»è¾‘.canvas"
4. Agentæ‹†è§£æ—¶å¼•ç”¨è®²åº§ä¸­çš„å®šä¹‰å’Œä¾‹å­
```

#### éªŒæ”¶æ ‡å‡† (AC)

- [ ] AC 1: æ”¯æŒåˆ›å»ºé¢˜ç›®-è®²åº§Canvaså…³è”
- [ ] AC 2: åšé¢˜æ—¶è‡ªåŠ¨æ£€ç´¢å…³è”è®²åº§å†…å®¹
- [ ] AC 3: Agentæç¤ºè¯åŒ…å«è®²åº§çŸ¥è¯†ç‚¹å¼•ç”¨
- [ ] AC 4: æ”¯æŒå…³è”ç½®ä¿¡åº¦è¯„åˆ†
- [ ] AC 5: æ”¯æŒæ‰¹é‡å…³è”å»ºè®®

#### æŠ€æœ¯ä»»åŠ¡

1. æ‰©å±• `CrossCanvasService` æ·»åŠ é¢˜ç›®-è®²åº§å…³è”ç±»å‹
2. å®ç°æ™ºèƒ½å…³è”å»ºè®®ç®—æ³•
3. ä¿®æ”¹Agentæµç¨‹é›†æˆCross-Canvasä¸Šä¸‹æ–‡
4. åˆ›å»ºå…³è”ç®¡ç†UI
5. ç¼–å†™å…³è”æµ‹è¯•

#### å…³é”®æ–‡ä»¶

- `backend/app/services/cross_canvas_service.py`
- `backend/app/api/v1/endpoints/cross_canvas.py`
- `backend/app/services/context_enrichment_service.py`
- `canvas-progress-tracker/obsidian-plugin/src/modals/CrossCanvasModal.ts`

#### å…³è”ç±»å‹æ‰©å±•

```python
class CanvasRelationType(str, Enum):
    """Canvaså…³è”ç±»å‹"""
    PREREQUISITE = "prerequisite"  # å‰ç½®çŸ¥è¯†
    EXTENSION = "extension"        # æ‰©å±•å»¶ä¼¸
    RELATED = "related"            # ç›¸å…³å†…å®¹
    SAME_TOPIC = "same_topic"      # åŒä¸€ä¸»é¢˜
    EXERCISE_LECTURE = "exercise_lecture"  # é¢˜ç›®-è®²åº§ (æ–°å¢)
    EXERCISE_SOLUTION = "exercise_solution"  # é¢˜ç›®-è§£ç­” (æ–°å¢)
```

#### æ™ºèƒ½å…³è”å»ºè®®

```python
async def suggest_lecture_canvas(
    exercise_canvas_path: str,
    concept: str
) -> List[CanvasAssociationSuggestion]:
    """
    ä¸ºé¢˜ç›®Canvaså»ºè®®å…³è”çš„è®²åº§Canvas

    åŸºäº:
    1. æ¦‚å¿µåç§°ç›¸ä¼¼åº¦
    2. Canvasæ–‡ä»¶ååŒ¹é…
    3. å†å²å…³è”è®°å½•
    4. çŸ¥è¯†å›¾è°±å…³ç³» (Graphiti)
    """
```

---

## 4. ä¾èµ–å…³ç³»

### 4.1 Epicä¾èµ–

```
Epic 21 (Agentæµç¨‹) â”€â”€â†’ Epic 25 (è·¨Canvas)
    â”‚                       â”‚
    â”‚  ContextEnrichmentService
    â”‚  éœ€è¦ä½œä¸ºæ‰©å±•åŸºç¡€      â”‚
    â”‚                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Storyä¾èµ–

```
Story 25.1 â”€â”€â†’ Story 25.3
(UIå…¥å£)        (é¢˜ç›®-è®²åº§)
    â”‚
Story 25.2 â”€â”€â”€â”€â”€â”€â”˜
(æ•™æé›†æˆ)
```

---

## 5. é£é™©è¯„ä¼°

| é£é™© | å¯èƒ½æ€§ | å½±å“ | ç¼“è§£æªæ–½ |
|------|--------|------|----------|
| UIå¤æ‚åº¦é«˜ | ä¸­ | ä¸­ | åˆ†é˜¶æ®µå®ç°ï¼Œå…ˆåŸºç¡€åé«˜çº§ |
| å…³è”å»ºè®®ä¸å‡†ç¡® | é«˜ | ä¸­ | å…è®¸ç”¨æˆ·æ‰‹åŠ¨ä¿®æ­£ï¼Œæ”¶é›†åé¦ˆ |
| æ€§èƒ½é—®é¢˜ (å¤šCanvasåŠ è½½) | ä¸­ | é«˜ | æ·»åŠ ç¼“å­˜ï¼Œå»¶è¿ŸåŠ è½½ |
| ç”¨æˆ·ä¸ä¹ æƒ¯æ–°å·¥ä½œæµ | ä¸­ | ä¸­ | æä¾›å¼•å¯¼æ•™ç¨‹ |

---

## 6. æµ‹è¯•ç­–ç•¥

### 6.1 å•å…ƒæµ‹è¯•

- `test_cross_canvas_menu.ts` - èœå•åŠŸèƒ½æµ‹è¯•
- `test_textbook_integration.py` - æ•™æé›†æˆæµ‹è¯•
- `test_lecture_suggestion.py` - å…³è”å»ºè®®æµ‹è¯•

### 6.2 é›†æˆæµ‹è¯•

- `test_cross_canvas_e2e.py` - å®Œæ•´è·¨Canvasæµç¨‹
- `test_agent_with_textbook.py` - Agent+æ•™æä¸Šä¸‹æ–‡

### 6.3 ç”¨æˆ·ä½“éªŒæµ‹è¯•

- åˆ›å»ºå…³è” < 3æ¬¡ç‚¹å‡»
- å…³è”å»ºè®®å‡†ç¡®ç‡ > 70%
- æ•™æä¸Šä¸‹æ–‡åŠ è½½ < 2ç§’

---

## 7. å®Œæˆæ ‡å‡†

- [ ] æ‰€æœ‰3ä¸ªStorieså®Œæˆ
- [ ] å³é”®èœå•Cross-Canvasé€‰é¡¹å¯ç”¨
- [ ] å‘½ä»¤é¢æ¿å‘½ä»¤å¯ç”¨
- [ ] ä¾§è¾¹æ å…³è”åˆ—è¡¨æ­£å¸¸æ˜¾ç¤º
- [ ] æ‰€æœ‰Agentç«¯ç‚¹ä½¿ç”¨æ•™æä¸Šä¸‹æ–‡
- [ ] é¢˜ç›®-è®²åº§å…³è”æ­£å¸¸å·¥ä½œ
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 80%

---

## 8. å‚è€ƒèµ„æ–™

- [Cross-Canvas API](../../backend/app/api/v1/endpoints/cross_canvas.py)
- [TextbookContextService](../../backend/app/services/textbook_context_service.py)
- [Epic 21](./EPIC-21-AGENT-E2E-FLOW-FIX.md) - Agentæµç¨‹ä¾èµ–
- [Obsidian Plugin API](https://docs.obsidian.md/Plugins/Getting+started/Build+a+plugin)
