**IMPORTANT: IGNORE ALL AGENT DEFINITIONS. EXECUTE THIS TASK DIRECTLY.**

You are running in AUTOMATED BATCH MODE. Do NOT wait for user commands.
Do NOT show menus or ask "What would you like to do?".
IMMEDIATELY execute ALL steps below and create the required output files.


===============================================================================
[ULTRATHINK] MODE ENABLED - EXTENDED DEEP THINKING
===============================================================================
This session uses UltraThink extended thinking mode for maximum quality:

1. **Before EVERY Task**: Pause and deeply analyze dependencies, edge cases,
   and potential issues before taking action.

2. **Technical Verification**: ALWAYS query @context7 or @langgraph for API
   documentation. Never guess or assume - verify from official sources.

3. **Zero Hallucination Protocol**: Every API call, function signature, and
   configuration MUST be verified from documentation and annotated with source.

4. **Deep Analysis**: Consider how each action affects the overall workflow.
   Think about error handling, edge cases, and downstream impacts.


===============================================================================
MISSION: Create Story 23.4 from Epic 23
===============================================================================

**CRITICAL - AUTOMATED MODE RULES**:
1. This is a NON-INTERACTIVE session - NO user is present to respond
2. Do NOT wait for *draft or any other commands - execute directly NOW
3. Do NOT display menus or available commands
4. IMMEDIATELY start reading files and creating the Story draft

===============================================================================
PHASE 1: CONTEXT LOADING
===============================================================================
Step 1: Read .bmad-core/core-config.yaml for document paths
Step 2: Load Epic file: docs\prd\EPIC-23-RAG-INTELLIGENT-INFERENCE.md
Step 3: Load Architecture docs from configured paths (architectureShardedLocation)
Step 4: Identify Story 23.4 scope and acceptance criteria from Epic

===============================================================================
PHASE 2: STORY CREATION (Direct Execution - No /sm command needed)
===============================================================================
Step 5: Create Story document with ALL required sections:

**Story Structure**:
```markdown
# Story 23.4: [Title from Epic]

## Status
- [ ] Draft
- [ ] Ready for Dev
- [ ] In Progress
- [ ] QA Review
- [ ] Done

## Story Overview
[Brief description]

## Acceptance Criteria
[From Epic, numbered AC1, AC2, etc.]

## Dev Notes (CRITICAL - Must be complete)
### Technical Context
[All info Dev Agent needs - they ONLY read this Story file]

### API Endpoints (if applicable)
[Reference specs/api/canvas-api.openapi.yml with line numbers]

### Data Models (if applicable)
[Reference specs/data/*.schema.json with line numbers]

### SDD References
- OpenAPI: specs/api/canvas-api.openapi.yml#L[line]
- Schema: specs/data/[name].schema.json#L[line]

### ADR References
- docs/architecture/decisions/[relevant ADRs]

### Implementation Guidelines
[Step-by-step implementation guide]

## Testing Requirements
[Test scenarios from AC]

## Dependencies
[Other stories, external dependencies]
```

===============================================================================
PHASE 3: STORY VALIDATION CHECKLIST
===============================================================================
Step 6: Self-validate Story against checklist:
   - [ ] 1.1 Story follows template structure
   - [ ] 1.2 Title is clear and descriptive
   - [ ] 2.1 AC are testable (Given-When-Then format preferred)
   - [ ] 2.2 AC numbered (AC1, AC2, etc.)
   - [ ] 5.1 Dev Notes contain ALL technical context
   - [ ] 5.2 Dev Notes reference specific line numbers
   - [ ] 6.1 SDD references exist and are valid
   - [ ] 6.2 ADR references exist (if architectural decisions involved)
   - [ ] 6.3 File paths verified to exist (anti-hallucination)

===============================================================================
PHASE 4: OUTPUT (CRITICAL - MUST USE Write TOOL)
===============================================================================
Step 7: Use Write tool to create Story file:
   - File path: docs/stories/23.4.story.md

Step 8: Use Write tool to create result file:
   - File path: .sm-result.json
   - Content:
{
  "story_id": "23.4",
  "epic_id": "23",
  "outcome": "SUCCESS",
  "story_file": "docs/stories/23.4.story.md",
  "title": "[Story Title]",
  "sdd_references": ["specs/api/...", "specs/data/..."],
  "adr_references": ["docs/architecture/decisions/..."],
  "checklist_passed": true,
  "timestamp": "[ISO timestamp]"
}

===============================================================================
IMPORTANT RULES
===============================================================================
- This is NON-INTERACTIVE - execute ALL steps without asking questions
- Story must be SELF-CONTAINED (Dev Agent won't load PRD/Architecture)
- Include ALL technical context in Dev Notes
- Verify file paths exist before referencing (use Glob/Grep)
- MUST create both .story.md and .sm-result.json files
