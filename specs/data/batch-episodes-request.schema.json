{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "$id": "https://canvas-learning-system.com/schemas/batch-episodes-request.schema.json",
  "x-source-verification": {
    "verified_at": "2026-01-16T18:30:00Z",
    "sources": [
      {"type": "context7", "library_id": "/json-schema-org/json-schema-spec", "topic": "draft-07 schema validation"},
      {"type": "epic", "epic": "Epic 30", "story": "30.3"}
    ],
    "adr_references": ["ADR-003"]
  },
  "title": "Batch Episodes Request",
  "description": "批量学习事件请求数据结构 (Story 30.3, AC-30.3.10)",
  "type": "object",
  "required": ["events"],
  "properties": {
    "events": {
      "type": "array",
      "description": "批量事件列表(最多50个)",
      "maxItems": 50,
      "items": {
        "type": "object",
        "required": ["event_type", "timestamp", "canvas_path", "node_id"],
        "properties": {
          "event_type": {
            "type": "string",
            "description": "事件类型"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "事件时间戳"
          },
          "canvas_path": {
            "type": "string",
            "description": "Canvas文件路径"
          },
          "node_id": {
            "type": "string",
            "description": "节点ID"
          },
          "metadata": {
            "type": "object",
            "description": "事件元数据",
            "properties": {
              "old_color": {
                "type": "string",
                "enum": ["1", "2", "3", "4", "5", "6"],
                "description": "变化前颜色代码"
              },
              "new_color": {
                "type": "string",
                "enum": ["1", "2", "3", "4", "5", "6"],
                "description": "变化后颜色代码"
              },
              "old_level": {
                "type": "string",
                "enum": ["not_understood", "learning", "mastered", "pending_verification"],
                "description": "变化前掌握等级"
              },
              "new_level": {
                "type": "string",
                "enum": ["not_understood", "learning", "mastered", "pending_verification"],
                "description": "变化后掌握等级"
              }
            }
          }
        }
      }
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "events": [
        {
          "event_type": "color_changed",
          "timestamp": "2026-01-16T12:00:00Z",
          "canvas_path": "离散数学/命题逻辑.canvas",
          "node_id": "b33c50660173e5d3",
          "metadata": {
            "old_color": "1",
            "new_color": "2",
            "old_level": "not_understood",
            "new_level": "mastered"
          }
        }
      ]
    }
  ]
}
