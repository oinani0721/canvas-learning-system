{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "$id": "https://canvas-learning-system.com/schemas/canvas-node.schema.json",
  "x-source-verification": {
    "verified_at": "2026-01-20T13:30:00Z",
    "sources": [
      {"type": "context7", "library_id": "/json-schema-org/json-schema-spec", "topic": "draft-07 schema validation"},
      {"type": "official_doc", "url": "https://jsoncanvas.org/spec/1.0/"},
      {"type": "prd", "section": "FR1", "epic": "Epic 13"},
      {"type": "sample_analysis", "files": ["离散数学.canvas", "线性代数.canvas"]},
      {"type": "story", "id": "35.5", "description": "Added customData field for media attachments"}
    ]
  },
  "title": "Canvas Node",
  "description": "Obsidian Canvas节点数据定义 - 支持text, file, group, link四种类型. Verified from JSON Canvas Spec 1.0 (https://jsoncanvas.org/spec/1.0/)",
  "type": "object",
  "required": ["id", "type", "x", "y"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9][-a-zA-Z0-9]*$",
      "description": "节点唯一标识，十六进制字符串格式 (Verified from JSON Canvas Spec 1.0)",
      "examples": ["b33c50660173e5d3", "node-test123"]
    },
    "type": {
      "type": "string",
      "enum": ["text", "file", "group", "link"],
      "description": "节点类型: text(文本节点), file(文件节点), group(分组节点), link(链接节点)"
    },
    "text": {
      "type": "string",
      "description": "文本内容，当type=text时必填",
      "examples": ["这是一个概念节点"]
    },
    "file": {
      "type": "string",
      "description": "文件路径，当type=file时必填，相对路径",
      "examples": ["笔记库/oral-explanation-20251104120000.md"]
    },
    "url": {
      "type": "string",
      "format": "uri",
      "description": "链接URL，当type=link时必填",
      "examples": ["https://example.com"]
    },
    "x": {
      "type": "integer",
      "description": "节点X坐标位置",
      "examples": [100]
    },
    "y": {
      "type": "integer",
      "description": "节点Y坐标位置",
      "examples": [200]
    },
    "width": {
      "type": "integer",
      "default": 250,
      "minimum": 50,
      "description": "节点宽度",
      "examples": [250]
    },
    "height": {
      "type": "integer",
      "default": 60,
      "minimum": 30,
      "description": "节点高度",
      "examples": [60]
    },
    "color": {
      "type": "string",
      "enum": ["1", "2", "3", "4", "5", "6"],
      "description": "节点颜色代码 (Verified from JSON Canvas Spec 1.0: https://jsoncanvas.org/spec/1.0/). 官方色值: 1=红, 2=橙, 3=黄, 4=绿, 5=青, 6=紫. 项目语义映射: 4=不理解(红色语义), 3=似懂非懂(紫色语义), 2=已理解(绿色语义), 6=个人理解(黄色语义)",
      "examples": ["1", "4", "6"]
    },
    "customData": {
      "type": "object",
      "description": "自定义扩展数据字段 (Story 35.5: 支持多模态媒体附件引用)",
      "properties": {
        "mediaCount": {
          "type": "integer",
          "minimum": 0,
          "default": 0,
          "description": "附加的媒体文件数量"
        },
        "mediaIds": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uuid"
          },
          "description": "关联的媒体文件UUID列表",
          "default": []
        }
      },
      "additionalProperties": true
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "type": {
            "const": "text"
          }
        }
      },
      "then": {
        "required": ["text"]
      }
    },
    {
      "if": {
        "properties": {
          "type": {
            "const": "file"
          }
        }
      },
      "then": {
        "required": ["file"]
      }
    },
    {
      "if": {
        "properties": {
          "type": {
            "const": "link"
          }
        }
      },
      "then": {
        "required": ["url"]
      }
    }
  ],
  "examples": [
    {
      "id": "b33c50660173e5d3",
      "type": "text",
      "text": "这是一个概念节点",
      "x": 100,
      "y": 200,
      "width": 250,
      "height": 60,
      "color": "4"
    },
    {
      "id": "fdf724a5bce70b4f",
      "type": "file",
      "file": "笔记库/oral-explanation.md",
      "x": 500,
      "y": 300,
      "width": 300,
      "height": 400
    },
    {
      "id": "node-with-media-001",
      "type": "text",
      "text": "带有媒体附件的概念节点",
      "x": 800,
      "y": 100,
      "width": 280,
      "height": 80,
      "color": "6",
      "customData": {
        "mediaCount": 2,
        "mediaIds": ["550e8400-e29b-41d4-a716-446655440000", "6ba7b810-9dad-11d1-80b4-00c04fd430c8"]
      }
    }
  ],
  "additionalProperties": false
}
