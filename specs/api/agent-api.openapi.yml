openapi: 3.0.3
info:
  title: Canvas Learning System - Agent API
  version: 1.0.0
  description: |
    Agentè°ƒç”¨APIï¼Œæä¾›14ä¸ªä¸“é¡¹Agentsçš„å¼‚æ­¥è°ƒç”¨å’Œä»»åŠ¡ç®¡ç†åŠŸèƒ½ã€‚

    **Agentåˆ†ç±»**:
    - **12ä¸ªå­¦ä¹ å‹Agents**: æ‹†è§£ã€è§£é‡Šã€è¯„åˆ†ã€æ£€éªŒ
    - **2ä¸ªç³»ç»Ÿçº§Agents**: æ™ºèƒ½è°ƒåº¦ã€è®°å¿†ç®¡ç†

    **æ ¸å¿ƒåŠŸèƒ½**:
    - Agentå…ƒæ•°æ®æŸ¥è¯¢
    - Agentå¼‚æ­¥è°ƒç”¨ï¼ˆæ”¯æŒè¶…æ—¶æ§åˆ¶ï¼‰
    - ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢
    - æ‰¹é‡Agentè°ƒç”¨ï¼ˆæ™ºèƒ½å¹¶è¡Œå¤„ç†ï¼‰

    **14ä¸ªAgentsåˆ—è¡¨**:

    **å­¦ä¹ å‹Agents (12ä¸ª)**:
    1. canvas-orchestrator - ä¸»æ§Agent
    2. basic-decomposition - åŸºç¡€æ‹†è§£
    3. deep-decomposition - æ·±åº¦æ‹†è§£
    4. question-decomposition - é—®é¢˜æ‹†è§£
    5. oral-explanation - å£è¯­åŒ–è§£é‡Š
    6. clarification-path - æ¾„æ¸…è·¯å¾„
    7. comparison-table - å¯¹æ¯”è¡¨
    8. memory-anchor - è®°å¿†é”šç‚¹
    9. four-level-explanation - å››å±‚æ¬¡è§£é‡Š
    10. example-teaching - ä¾‹é¢˜æ•™å­¦
    11. scoring-agent - è¯„åˆ†Agent
    12. verification-question-agent - æ£€éªŒé—®é¢˜ç”Ÿæˆ

    **ç³»ç»Ÿçº§Agents (2ä¸ª)**:
    13. review-board-agent-selector - æ™ºèƒ½Agentè°ƒåº¦å™¨
    14. graphiti-memory-agent - GraphitiçŸ¥è¯†å›¾è°±è®°å¿†æœåŠ¡
  x-source-verification:
    verified_at: "2025-11-25T18:25:00Z"
    format_source:
      type: context7
      library_id: "/oai/openapi-specification"
      topic: "info object, paths, components, specification extensions"
    business_source:
      prd_version: "v1.1.9"
      epic: "Epic 11"
      story_refs: ["11.6"]

  contact:
    name: Canvas Learning System
    url: https://github.com/canvas-learning-system
  license:
    name: MIT

servers:
  - url: http://localhost:8001/api/v1
    description: Local development server
  - url: https://api.canvas-learning.com/agents/v1
    description: Production server

tags:
  - name: agents
    description: Agent metadata operations
  - name: invocation
    description: Agent invocation operations
  - name: tasks
    description: Task management operations
  - name: batch
    description: Batch agent operations
  - name: health
    description: Health check operations

paths:
  /agents/health:
    get:
      tags: [health]
      summary: Agent system health check
      description: |
        æ£€æŸ¥Agentç³»ç»Ÿå¥åº·çŠ¶æ€ï¼ŒåŒ…æ‹¬API Keyé…ç½®ã€GeminiClientåˆå§‹åŒ–ã€Promptæ¨¡æ¿å®Œæ•´æ€§ã€‚

        **å¥åº·çŠ¶æ€**:
        - healthy: æ‰€æœ‰æ£€æŸ¥é€šè¿‡
        - degraded: API Keyé…ç½®æ­£å¸¸ä½†éƒ¨åˆ†æ¨¡æ¿ç¼ºå¤±
        - unhealthy: API Keyæœªé…ç½®æˆ–GeminiClientæœªåˆå§‹åŒ–

        **ç¼“å­˜**: ç»“æœç¼“å­˜60ç§’ä»¥å‡å°‘æ€§èƒ½å½±å“

      operationId: checkAgentHealth
      parameters:
        - name: include_api_test
          in: query
          required: false
          description: æ˜¯å¦æ‰§è¡ŒAPIè°ƒç”¨æµ‹è¯•ï¼ˆä¼šæ¶ˆè€—APIé…é¢ï¼‰
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Health check completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentHealthCheckResponse'
              examples:
                healthy:
                  summary: All checks passed
                  value:
                    status: "healthy"
                    checks:
                      api_key_configured: true
                      gemini_client_initialized: true
                      prompt_templates:
                        total: 12
                        available: 12
                        missing: []
                      api_test:
                        enabled: false
                        result: null
                    cached: false
                    timestamp: "2025-12-16T10:30:00Z"
                degraded:
                  summary: Partial functionality
                  value:
                    status: "degraded"
                    checks:
                      api_key_configured: true
                      gemini_client_initialized: true
                      prompt_templates:
                        total: 12
                        available: 10
                        missing: ["comparison-table", "review-board"]
                      api_test:
                        enabled: false
                        result: null
                    cached: false
                    timestamp: "2025-12-16T10:30:00Z"
                unhealthy:
                  summary: System not operational
                  value:
                    status: "unhealthy"
                    checks:
                      api_key_configured: false
                      gemini_client_initialized: false
                      prompt_templates:
                        total: 12
                        available: 0
                        missing: []
                      api_test:
                        enabled: false
                        result: null
                    cached: false
                    timestamp: "2025-12-16T10:30:00Z"

  /agents:
    get:
      tags: [agents]
      summary: List all agents
      description: è·å–æ‰€æœ‰å¯ç”¨Agentsçš„å…ƒæ•°æ®åˆ—è¡¨ï¼ˆ14ä¸ªagentsï¼‰
      operationId: listAgents
      parameters:
        - name: type
          in: query
          required: false
          description: æŒ‰Agentç±»å‹è¿‡æ»¤
          schema:
            type: string
            enum: [learning, system]
      responses:
        '200':
          description: Successfully retrieved agents list
          content:
            application/json:
              schema:
                type: object
                properties:
                  agents:
                    type: array
                    items:
                      $ref: '#/components/schemas/AgentMetadata'
                  total:
                    type: integer
                    example: 14

  /agents/recommend-action:
    post:
      tags: [agents]
      summary: Intelligent action recommendation
      description: |
        Story 31.3: åŸºäºè¯„åˆ†ç»“æœå’Œå†å²å­¦ä¹ æ•°æ®ï¼Œæ™ºèƒ½æ¨èä¸‹ä¸€æ­¥å­¦ä¹ è¡ŒåŠ¨ã€‚

        **æ¨èé€»è¾‘ (AC-31.3.3)**:
        - score < 60: æ¨è decompose (åŸºç¡€æ‹†è§£)
        - score 60-79: æ¨è explain (è§£é‡Šè¡¥å……)
        - score >= 80: æ¨è next (ç»§ç»­å­¦ä¹ )

        **å†å²åˆ†æ (AC-31.3.4)**:
        - æŸ¥è¯¢æœ€è¿‘5æ¬¡è¯„åˆ†å†å²
        - è®¡ç®—åˆ†æ•°è¶‹åŠ¿ (improving/stable/declining)
        - å¯¹äºæŒç»­ä½åˆ†æˆ–ä¸‹é™è¶‹åŠ¿ï¼Œå»ºè®®é¢å¤–å¤ä¹ 

      operationId: recommendAction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecommendActionRequest'
            example:
              score: 45
              node_id: "node-001"
              canvas_name: "discrete-math.canvas"
              include_history: true
              concept: "contrapositive"
      responses:
        '200':
          description: Action recommendation successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecommendActionResponse'
              examples:
                decompose:
                  summary: Low score - recommend decompose
                  value:
                    action: "decompose"
                    agent: "/agents/decompose/basic"
                    reason: "æ¦‚å¿µç†è§£ä¸è¶³ï¼Œå»ºè®®è¿›è¡ŒåŸºç¡€æ‹†è§£"
                    priority: 1
                    review_suggested: false
                explain:
                  summary: Medium score - recommend explain
                  value:
                    action: "explain"
                    agent: "/agents/explain/oral"
                    reason: "éœ€è¦è¡¥å……è§£é‡ŠåŠ æ·±ç†è§£"
                    priority: 2
                    review_suggested: false
                next:
                  summary: High score - recommend next
                  value:
                    action: "next"
                    agent: null
                    reason: "æŒæ¡è‰¯å¥½ï¼Œå¯ä»¥ç»§ç»­ä¸‹ä¸€ä¸ªæ¦‚å¿µ"
                    priority: 3
                    review_suggested: false
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /agents/{agentName}:
    get:
      tags: [agents]
      summary: Get agent metadata
      description: è·å–æŒ‡å®šAgentçš„å…ƒæ•°æ®ï¼ˆæè¿°ã€è¾“å…¥è¦æ±‚ã€è¾“å‡ºæ ¼å¼ç­‰ï¼‰
      operationId: getAgentMetadata
      parameters:
        - $ref: '#/components/parameters/AgentNameParam'
      responses:
        '200':
          description: Successfully retrieved agent metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentMetadata'
        '404':
          description: Agent not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /agents/{agentName}/invoke:
    post:
      tags: [invocation]
      summary: Invoke agent asynchronously
      description: |
        å¼‚æ­¥è°ƒç”¨æŒ‡å®šçš„Agentï¼Œè¿”å›ä»»åŠ¡IDç”¨äºåç»­æŸ¥è¯¢ç»“æœã€‚

        **è°ƒç”¨æµç¨‹**:
        1. POST /agents/{agentName}/invoke - å‘èµ·å¼‚æ­¥è°ƒç”¨ï¼Œè·å¾—taskId
        2. GET /agents/tasks/{taskId} - è½®è¯¢ä»»åŠ¡çŠ¶æ€
        3. ä»»åŠ¡å®Œæˆåï¼Œä»status=completedçš„å“åº”ä¸­è·å–result

        **è¶…æ—¶æ§åˆ¶**:
        - é»˜è®¤è¶…æ—¶: 60ç§’
        - æœ€å¤§è¶…æ—¶: 300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰
        - è¶…æ—¶åä»»åŠ¡çŠ¶æ€å˜ä¸º "timeout"

      operationId: invokeAgent
      parameters:
        - $ref: '#/components/parameters/AgentNameParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgentInvokeRequest'
      responses:
        '202':
          description: Agent invocation accepted, task created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskCreated'
        '400':
          description: Invalid request (missing required input fields)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Agent not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Duplicate request in progress (Story 12.H.5)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DuplicateRequestError'
              example:
                error: "Duplicate request"
                message: "ç›¸åŒè¯·æ±‚æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™"
                canvas_name: "test.canvas"
                node_id: "node-abc123"
                agent_type: "oral"
                is_retryable: false

  /agents/tasks/{taskId}:
    get:
      tags: [tasks]
      summary: Get task status
      description: |
        æŸ¥è¯¢Agentè°ƒç”¨ä»»åŠ¡çš„çŠ¶æ€å’Œç»“æœã€‚

        **ä»»åŠ¡çŠ¶æ€æµè½¬**:
        - pending: ä»»åŠ¡å·²åˆ›å»ºï¼Œç­‰å¾…æ‰§è¡Œ
        - running: ä»»åŠ¡æ­£åœ¨æ‰§è¡Œ
        - completed: ä»»åŠ¡å·²å®Œæˆï¼ˆæˆåŠŸï¼‰
        - failed: ä»»åŠ¡å¤±è´¥
        - timeout: ä»»åŠ¡è¶…æ—¶

      operationId: getTaskStatus
      parameters:
        - $ref: '#/components/parameters/TaskIdParam'
      responses:
        '200':
          description: Successfully retrieved task status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskStatus'
        '404':
          description: Task not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /agents/batch/invoke:
    post:
      tags: [batch]
      summary: Batch invoke multiple agents
      description: |
        æ‰¹é‡è°ƒç”¨å¤šä¸ªAgentsï¼ˆæ™ºèƒ½å¹¶è¡Œå¤„ç†ï¼‰ã€‚

        **å¹¶è¡Œæ‰§è¡Œ**:
        - æœ€å¤šæ”¯æŒ12ä¸ªagentså¹¶å‘
        - ä½¿ç”¨AsyncExecutionEngineå®ç°çœŸæ­£çš„å¼‚æ­¥å¹¶è¡Œ
        - æ€§èƒ½æå‡: 8å€ï¼ˆ100sä¸²è¡Œ â†’ 12så¹¶è¡Œï¼Œ10ä¸ªagentsï¼‰

        **æ™ºèƒ½è°ƒåº¦**:
        - è‡ªåŠ¨è°ƒç”¨ review-board-agent-selector è¿›è¡Œè´¨é‡åˆ†æ
        - æ¨èæœ€åˆé€‚çš„agentsç»„åˆ
        - æ”¯æŒç½®ä¿¡åº¦é˜ˆå€¼è¿‡æ»¤ï¼ˆé»˜è®¤0.7ï¼‰

      operationId: batchInvokeAgents
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatchInvokeRequest'
      responses:
        '202':
          description: Batch invocation accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchTaskCreated'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /agents/batch/tasks/{batchTaskId}:
    get:
      tags: [batch]
      summary: Get batch task status
      description: æŸ¥è¯¢æ‰¹é‡ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€å’Œæ‰€æœ‰å­ä»»åŠ¡çš„ç»“æœ
      operationId: getBatchTaskStatus
      parameters:
        - name: batchTaskId
          in: path
          required: true
          description: æ‰¹é‡ä»»åŠ¡ID
          schema:
            type: string
            example: "batch-20250118-001"
      responses:
        '200':
          description: Successfully retrieved batch task status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchTaskStatus'
        '404':
          description: Batch task not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  parameters:
    AgentNameParam:
      name: agentName
      in: path
      required: true
      description: Agentåç§°ï¼ˆ14ä¸ªagentsä¹‹ä¸€ï¼‰
      schema:
        type: string
        enum:
          # å­¦ä¹ å‹Agents
          - canvas-orchestrator
          - basic-decomposition
          - deep-decomposition
          - question-decomposition
          - oral-explanation
          - clarification-path
          - comparison-table
          - memory-anchor
          - four-level-explanation
          - example-teaching
          - scoring-agent
          - verification-question-agent
          # ç³»ç»Ÿçº§Agents
          - review-board-agent-selector
          - graphiti-memory-agent
        example: "scoring-agent"

    TaskIdParam:
      name: taskId
      in: path
      required: true
      description: ä»»åŠ¡å”¯ä¸€æ ‡è¯†ç¬¦
      schema:
        type: string
        example: "task-20250118-001"

  schemas:
    AgentMetadata:
      type: object
      required: [name, type, description]
      properties:
        name:
          type: string
          description: Agentåç§°
          example: "scoring-agent"
        type:
          type: string
          enum: [learning, system]
          description: Agentç±»å‹
          example: "learning"
        description:
          type: string
          description: AgentåŠŸèƒ½æè¿°
          example: "Evaluates user's understanding using 4-dimension scoring"
        input_schema:
          type: object
          description: è¾“å…¥æ•°æ®çš„JSON Schema
          additionalProperties: true
          example:
            type: "object"
            required: ["concept", "user_understanding"]
            properties:
              concept:
                type: "string"
                description: "æ¦‚å¿µåç§°"
              user_understanding:
                type: "string"
                description: "ç”¨æˆ·çš„ç†è§£æ–‡æœ¬"
        output_schema:
          type: object
          description: è¾“å‡ºæ•°æ®çš„JSON Schema
          additionalProperties: true
          example:
            type: "object"
            properties:
              accuracy:
                type: "integer"
                minimum: 0
                maximum: 25
              imagery:
                type: "integer"
                minimum: 0
                maximum: 25
        timeout:
          type: integer
          description: é»˜è®¤è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
          example: 60
        emoji:
          type: string
          description: Agentçš„emojiæ ‡è¯†ï¼ˆå¦‚æœæœ‰ï¼‰
          example: "ğŸ“Š"

    AgentInvokeRequest:
      type: object
      required: [input]
      properties:
        input:
          type: object
          description: Agentè¾“å…¥æ•°æ®ï¼ˆå…·ä½“å­—æ®µå–å†³äºAgentçš„input_schemaï¼‰
          additionalProperties: true
          example:
            concept: "é€†å¦å‘½é¢˜"
            user_understanding: "é€†å¦å‘½é¢˜æ˜¯å°†åŸå‘½é¢˜çš„æ¡ä»¶å’Œç»“è®ºéƒ½å¦å®šåå†äº¤æ¢ä½ç½®"
        timeout:
          type: integer
          description: è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼Œå¯é€‰ï¼Œä¸æä¾›åˆ™ä½¿ç”¨Agenté»˜è®¤å€¼ï¼‰
          minimum: 10
          maximum: 300
          example: 60
        metadata:
          type: object
          description: é¢å¤–çš„å…ƒæ•°æ®ï¼ˆå¯é€‰ï¼‰
          additionalProperties: true
          example:
            user_id: "user-001"
            session_id: "session-001"

    TaskCreated:
      type: object
      required: [task_id, status, agent_name, created_at]
      properties:
        task_id:
          type: string
          description: ä»»åŠ¡å”¯ä¸€æ ‡è¯†ç¬¦
          example: "task-20250118-001"
        status:
          type: string
          enum: [pending]
          description: ä»»åŠ¡åˆå§‹çŠ¶æ€ï¼ˆæ€»æ˜¯pendingï¼‰
          example: "pending"
        agent_name:
          type: string
          description: è°ƒç”¨çš„Agentåç§°
          example: "scoring-agent"
        created_at:
          type: string
          format: date-time
          description: ä»»åŠ¡åˆ›å»ºæ—¶é—´ï¼ˆISO 8601æ ¼å¼ï¼‰
          example: "2025-01-18T10:30:00Z"
        estimated_completion:
          type: string
          format: date-time
          description: é¢„è®¡å®Œæˆæ—¶é—´ï¼ˆå¯é€‰ï¼‰
          example: "2025-01-18T10:31:00Z"

    TaskStatus:
      type: object
      required: [task_id, status, agent_name, created_at]
      properties:
        task_id:
          type: string
          example: "task-20250118-001"
        status:
          type: string
          enum: [pending, running, completed, failed, timeout]
          example: "completed"
        agent_name:
          type: string
          example: "scoring-agent"
        created_at:
          type: string
          format: date-time
          example: "2025-01-18T10:30:00Z"
        started_at:
          type: string
          format: date-time
          description: ä»»åŠ¡å¼€å§‹æ‰§è¡Œæ—¶é—´ï¼ˆstatus=runningåæ‰æœ‰ï¼‰
          example: "2025-01-18T10:30:05Z"
        completed_at:
          type: string
          format: date-time
          description: ä»»åŠ¡å®Œæˆæ—¶é—´ï¼ˆstatus=completed/failed/timeoutåæ‰æœ‰ï¼‰
          example: "2025-01-18T10:30:45Z"
        result:
          type: object
          description: Agentæ‰§è¡Œç»“æœï¼ˆstatus=completedæ—¶å­˜åœ¨ï¼‰
          additionalProperties: true
          example:
            accuracy: 22
            imagery: 18
            completeness: 20
            originality: 15
            total_score: 75
            color: "3"
            recommendations:
              - "clarification-path"
              - "oral-explanation"
        error:
          type: object
          description: é”™è¯¯ä¿¡æ¯ï¼ˆstatus=failedæ—¶å­˜åœ¨ï¼‰
          properties:
            type:
              type: string
              example: "ValidationError"
            message:
              type: string
              example: "Missing required field: concept"
            details:
              type: object
              additionalProperties: true
        progress:
          type: integer
          description: ä»»åŠ¡è¿›åº¦ï¼ˆ0-100ï¼Œå¯é€‰ï¼‰
          minimum: 0
          maximum: 100
          example: 75

    BatchInvokeRequest:
      type: object
      required: [agents]
      properties:
        agents:
          type: array
          description: è¦è°ƒç”¨çš„agentsåˆ—è¡¨
          minItems: 1
          maxItems: 20
          items:
            type: object
            required: [agent_name, input]
            properties:
              agent_name:
                type: string
                example: "oral-explanation"
              input:
                type: object
                additionalProperties: true
                example:
                  concept: "é€†å¦å‘½é¢˜"
              timeout:
                type: integer
                minimum: 10
                maximum: 300
                example: 60
        enable_smart_scheduling:
          type: boolean
          description: æ˜¯å¦å¯ç”¨æ™ºèƒ½è°ƒåº¦ï¼ˆä½¿ç”¨review-board-agent-selectorï¼‰
          default: true
          example: true
        confidence_threshold:
          type: number
          description: æ™ºèƒ½æ¨èçš„ç½®ä¿¡åº¦é˜ˆå€¼ï¼ˆ0.0-1.0ï¼‰
          minimum: 0.0
          maximum: 1.0
          default: 0.7
          example: 0.7
        metadata:
          type: object
          description: æ‰¹é‡ä»»åŠ¡çš„å…ƒæ•°æ®
          additionalProperties: true
          example:
            user_id: "user-001"
            session_id: "session-001"

    BatchTaskCreated:
      type: object
      required: [batch_task_id, status, total_agents, created_at]
      properties:
        batch_task_id:
          type: string
          description: æ‰¹é‡ä»»åŠ¡ID
          example: "batch-20250118-001"
        status:
          type: string
          enum: [pending]
          example: "pending"
        total_agents:
          type: integer
          description: è¦æ‰§è¡Œçš„agentsæ€»æ•°
          example: 5
        task_ids:
          type: array
          description: æ‰€æœ‰å­ä»»åŠ¡çš„IDåˆ—è¡¨
          items:
            type: string
          example:
            - "task-20250118-001"
            - "task-20250118-002"
            - "task-20250118-003"
        created_at:
          type: string
          format: date-time
          example: "2025-01-18T10:30:00Z"
        estimated_completion:
          type: string
          format: date-time
          description: é¢„è®¡å®Œæˆæ—¶é—´
          example: "2025-01-18T10:30:12Z"

    BatchTaskStatus:
      type: object
      required: [batch_task_id, status, total_agents, created_at]
      properties:
        batch_task_id:
          type: string
          example: "batch-20250118-001"
        status:
          type: string
          enum: [pending, running, completed, partial_failure, failed]
          description: |
            æ‰¹é‡ä»»åŠ¡çŠ¶æ€:
            - pending: ç­‰å¾…æ‰§è¡Œ
            - running: æ­£åœ¨æ‰§è¡Œ
            - completed: å…¨éƒ¨æˆåŠŸ
            - partial_failure: éƒ¨åˆ†å¤±è´¥
            - failed: å…¨éƒ¨å¤±è´¥
          example: "completed"
        total_agents:
          type: integer
          example: 5
        completed_count:
          type: integer
          description: å·²å®Œæˆçš„agentsæ•°é‡
          example: 5
        failed_count:
          type: integer
          description: å¤±è´¥çš„agentsæ•°é‡
          example: 0
        created_at:
          type: string
          format: date-time
          example: "2025-01-18T10:30:00Z"
        completed_at:
          type: string
          format: date-time
          description: æ‰¹é‡ä»»åŠ¡å®Œæˆæ—¶é—´
          example: "2025-01-18T10:30:12Z"
        tasks:
          type: array
          description: æ‰€æœ‰å­ä»»åŠ¡çš„çŠ¶æ€åˆ—è¡¨
          items:
            $ref: '#/components/schemas/TaskStatus'
        performance_metrics:
          type: object
          description: æ€§èƒ½æŒ‡æ ‡ï¼ˆå¯é€‰ï¼‰
          properties:
            total_duration_seconds:
              type: number
              description: æ€»è€—æ—¶ï¼ˆç§’ï¼‰
              example: 12.5
            average_duration_seconds:
              type: number
              description: å¹³å‡æ¯ä¸ªagentè€—æ—¶ï¼ˆç§’ï¼‰
              example: 2.5
            parallel_efficiency:
              type: number
              description: å¹¶è¡Œæ•ˆç‡ï¼ˆç›¸å¯¹ä¸²è¡Œçš„åŠ é€Ÿæ¯”ï¼‰
              example: 8.0

    # Agentå¥åº·æ£€æŸ¥å“åº” (Story 12.G.3)
    AgentHealthCheckResponse:
      type: object
      required: [status, checks, timestamp]
      description: Agentç³»ç»Ÿå¥åº·æ£€æŸ¥å“åº”
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
          description: |
            æ•´ä½“å¥åº·çŠ¶æ€:
            - healthy: æ‰€æœ‰æ£€æŸ¥é€šè¿‡
            - degraded: API Keyé…ç½®æ­£å¸¸ä½†éƒ¨åˆ†æ¨¡æ¿ç¼ºå¤±
            - unhealthy: API Keyæœªé…ç½®æˆ–GeminiClientæœªåˆå§‹åŒ–
          example: "healthy"
        checks:
          type: object
          required: [api_key_configured, gemini_client_initialized, prompt_templates]
          properties:
            api_key_configured:
              type: boolean
              description: API Keyæ˜¯å¦å·²é…ç½®ï¼ˆä¸è¿”å›å®é™…Keyï¼‰
              example: true
            gemini_client_initialized:
              type: boolean
              description: GeminiClientæ˜¯å¦å·²åˆå§‹åŒ–
              example: true
            prompt_templates:
              type: object
              required: [total, available, missing]
              properties:
                total:
                  type: integer
                  minimum: 0
                  description: é¢„æœŸæ¨¡æ¿æ€»æ•°
                  example: 12
                available:
                  type: integer
                  minimum: 0
                  description: å¯ç”¨æ¨¡æ¿æ•°é‡
                  example: 12
                missing:
                  type: array
                  items:
                    type: string
                  description: ç¼ºå¤±çš„æ¨¡æ¿åç§°åˆ—è¡¨
                  example: []
            api_test:
              type: object
              properties:
                enabled:
                  type: boolean
                  description: æ˜¯å¦å¯ç”¨äº†APIè°ƒç”¨æµ‹è¯•
                  example: false
                result:
                  type: string
                  nullable: true
                  description: æµ‹è¯•ç»“æœï¼ˆsuccessæˆ–é”™è¯¯ä¿¡æ¯ï¼‰
                  example: null
        cached:
          type: boolean
          description: æ˜¯å¦ä¸ºç¼“å­˜ç»“æœ
          example: false
        timestamp:
          type: string
          format: date-time
          description: æ£€æŸ¥æ—¶é—´æˆ³ï¼ˆISO 8601æ ¼å¼ï¼‰
          example: "2025-12-16T10:30:00Z"

    # Agenté”™è¯¯ç±»å‹æšä¸¾ (å¯¹é½ADR-009 ErrorCode)
    # Story 12.G.2: å¢å¼ºé”™è¯¯å¤„ç†ä¸å‹å¥½æç¤º
    # Story 12.J.4: æ·»åŠ  ENCODING_ERROR ç±»å‹
    AgentErrorType:
      type: string
      description: Agentè°ƒç”¨é”™è¯¯ç±»å‹æšä¸¾
      enum:
        - CONFIG_MISSING      # 2001 - API Keyæœªé…ç½® (NON_RETRYABLE)
        - LLM_TIMEOUT         # 1002 - APIè°ƒç”¨è¶…æ—¶ (RETRYABLE)
        - LLM_INVALID_RESPONSE # 1004 - å“åº”æ ¼å¼é”™è¯¯ (NON_RETRYABLE)
        - NETWORK_TIMEOUT     # 4001 - ç½‘ç»œé”™è¯¯ (RETRYABLE)
        - FILE_NOT_FOUND      # 3001 - æ¨¡æ¿ç¼ºå¤± (FATAL)
        - LLM_RATE_LIMIT      # 1001 - é€Ÿç‡é™åˆ¶ (RETRYABLE)
        - ENCODING_ERROR      # 5001 - Unicodeç¼–ç é”™è¯¯ (RETRYABLE) - Story 12.J.4
        - UNKNOWN             # 9999 - æœªçŸ¥é”™è¯¯

    # Agenté”™è¯¯å“åº” (æ‰©å±•è‡ªError, ç”¨äºAgentç‰¹å®šé”™è¯¯)
    AgentError:
      type: object
      required: [error_type, message]
      properties:
        error_type:
          $ref: '#/components/schemas/AgentErrorType'
        message:
          type: string
          description: ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
          example: "è¯·åœ¨æ’ä»¶è®¾ç½®ä¸­é…ç½® API Key"
        is_retryable:
          type: boolean
          description: é”™è¯¯æ˜¯å¦å¯é‡è¯•
          example: false
        diagnostic:
          type: string
          description: å®‰å…¨çš„è¯Šæ–­ä¿¡æ¯ï¼ˆASCIIç¼–ç ï¼Œç”¨äºENCODING_ERRORç­‰ï¼‰- Story 12.J.4
          example: "position 42, char U+1F525"
        details:
          type: object
          description: è°ƒè¯•ä¿¡æ¯ï¼ˆä»…debugæ¨¡å¼ï¼‰
          additionalProperties: true
        bug_id:
          type: string
          pattern: "^BUG-[A-Z0-9]{8}$"
          description: Bugè¿½è¸ªID
          example: "BUG-A1B2C3D4"

    # Story 12.H.5: é‡å¤è¯·æ±‚é”™è¯¯å“åº”
    DuplicateRequestError:
      type: object
      required: [error, message, canvas_name, node_id, agent_type]
      description: é‡å¤è¯·æ±‚é”™è¯¯å“åº” (HTTP 409)
      properties:
        error:
          type: string
          description: é”™è¯¯ç±»å‹
          example: "Duplicate request"
        message:
          type: string
          description: ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
          example: "ç›¸åŒè¯·æ±‚æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™"
        canvas_name:
          type: string
          description: Canvas æ–‡ä»¶å
          example: "test.canvas"
        node_id:
          type: string
          description: èŠ‚ç‚¹ ID
          example: "node-abc123"
        agent_type:
          type: string
          description: Agent ç±»å‹
          example: "oral"
        is_retryable:
          type: boolean
          description: æ˜¯å¦å¯é‡è¯•ï¼ˆå§‹ç»ˆä¸º falseï¼‰
          example: false

    # Story 31.3: Recommend Action Schemas
    RecommendActionRequest:
      type: object
      required: [score, node_id, canvas_name]
      description: æ¨èè¡ŒåŠ¨è¯·æ±‚å‚æ•°
      properties:
        score:
          type: integer
          minimum: 0
          maximum: 100
          description: å½“å‰è¯„åˆ† (0-100)
          example: 45
        node_id:
          type: string
          minLength: 1
          description: CanvasèŠ‚ç‚¹ID
          example: "node-abc123"
        canvas_name:
          type: string
          minLength: 1
          description: Canvasæ–‡ä»¶å
          example: "discrete-math.canvas"
        include_history:
          type: boolean
          default: true
          description: æ˜¯å¦åŒ…å«å†å²è¯„åˆ†åˆ†æ
          example: true
        concept:
          type: string
          description: æ¦‚å¿µåç§°ï¼ˆå¯é€‰ï¼Œç”¨äºå†å²æŸ¥è¯¢ï¼‰
          example: "contrapositive"

    RecommendActionResponse:
      type: object
      required: [action, reason]
      description: æ¨èè¡ŒåŠ¨å“åº”
      properties:
        action:
          type: string
          enum: [decompose, explain, next]
          description: |
            æ¨èè¡ŒåŠ¨ç±»å‹:
            - decompose: åŸºç¡€æ‹†è§£ (score < 60)
            - explain: è§£é‡Šè¡¥å…… (score 60-79)
            - next: ç»§ç»­å­¦ä¹  (score >= 80)
          example: "decompose"
        agent:
          type: string
          nullable: true
          description: æ¨èAgentç«¯ç‚¹è·¯å¾„ (action=nextæ—¶ä¸ºnull)
          example: "/agents/decompose/basic"
        reason:
          type: string
          minLength: 1
          description: æ¨èç†ç”±ï¼ˆäººç±»å¯è¯»ï¼‰
          example: "æ¦‚å¿µç†è§£ä¸è¶³ï¼Œå»ºè®®è¿›è¡ŒåŸºç¡€æ‹†è§£"
        priority:
          type: integer
          minimum: 1
          maximum: 5
          default: 3
          description: æ¨èä¼˜å…ˆçº§ (1=æœ€é«˜, 5=æœ€ä½)
          example: 1
        review_suggested:
          type: boolean
          default: false
          description: æ˜¯å¦å»ºè®®é¢å¤–å¤ä¹ ï¼ˆåŸºäºä¸‹é™è¶‹åŠ¿ï¼‰
          example: false
        history_context:
          type: object
          description: å†å²è¯„åˆ†ä¸Šä¸‹æ–‡ï¼ˆinclude_history=trueæ—¶ï¼‰
          properties:
            recent_scores:
              type: array
              description: æœ€è¿‘è¯„åˆ†å†å²ï¼ˆæœ€æ–°åœ¨å‰ï¼Œæœ€å¤š5ä¸ªï¼‰
              items:
                type: integer
                minimum: 0
                maximum: 100
              maxItems: 5
              example: [45, 52, 38, 41, 50]
            average_score:
              type: number
              minimum: 0
              maximum: 100
              description: å¹³å‡åˆ†æ•°
              example: 45.2
            trend:
              type: string
              enum: [improving, stable, declining]
              description: åˆ†æ•°è¶‹åŠ¿
              example: "declining"
            consecutive_low_count:
              type: integer
              minimum: 0
              description: è¿ç»­ä½äº60åˆ†çš„æ¬¡æ•°
              example: 3
        alternative_agents:
          type: array
          description: å¤‡é€‰Agentæ¨èï¼ˆé«˜çº§åœºæ™¯ï¼‰
          maxItems: 3
          items:
            type: object
            required: [agent, reason]
            properties:
              agent:
                type: string
                description: Agentç«¯ç‚¹è·¯å¾„
                example: "/agents/explain/memory"
              reason:
                type: string
                description: å¤‡é€‰ç†ç”±
                example: "å°è¯•è®°å¿†é”šç‚¹å¸®åŠ©å»ºç«‹æ¦‚å¿µå…³è”"

    Error:
      type: object
      required: [error, message]
      properties:
        error:
          type: string
          description: é”™è¯¯ç±»å‹
          example: "AgentNotFoundError"
        message:
          type: string
          description: é”™è¯¯è¯¦ç»†ä¿¡æ¯
          example: "Agent 'invalid-agent' not found. Available agents: [...]"
        details:
          type: object
          description: é¢å¤–çš„é”™è¯¯è¯¦æƒ…ï¼ˆå¯é€‰ï¼‰
          additionalProperties: true
          example:
            available_agents:
              - "scoring-agent"
              - "oral-explanation"
