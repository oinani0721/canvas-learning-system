# Planning Phase Iteration Validation Rules
# ç”¨äºvalidate-iteration.pyè„šæœ¬çš„éªŒè¯è§„åˆ™é…ç½®

version: "1.0"
description: "BMad Planning Phaseè¿­ä»£ä¸€è‡´æ€§éªŒè¯è§„åˆ™"

# å…¨å±€è®¾ç½®
settings:
  strict_mode: true  # ä¸¥æ ¼æ¨¡å¼ï¼šä»»ä½•breaking changeéƒ½ä¼šé˜»æ­¢è¿­ä»£
  auto_snapshot: true  # è‡ªåŠ¨åˆ›å»ºsnapshot
  require_human_gate: true  # Breaking changeséœ€è¦äººå·¥ç¡®è®¤

# PRDéªŒè¯è§„åˆ™
prd_validation:
  version_must_increment: true  # ç‰ˆæœ¬å·å¿…é¡»é€’å¢

  functional_requirements:
    can_delete: false  # ç¦æ­¢åˆ é™¤FR
    can_modify: true   # å…è®¸ä¿®æ”¹FRï¼ˆä½†ä¼šæ ‡è®°ä¸ºwarningï¼‰
    can_add: true      # å…è®¸æ–°å¢FR

  non_functional_requirements:
    can_delete: false  # ç¦æ­¢åˆ é™¤NFR
    can_modify_thresholds: "warning"  # ä¿®æ”¹NFRé˜ˆå€¼ä¼šäº§ç”Ÿwarning
    can_add: true

  epics:
    can_delete: false  # ç¦æ­¢åˆ é™¤Epic
    can_merge: "requires_confirmation"  # Epicåˆå¹¶éœ€è¦äººå·¥ç¡®è®¤
    can_add: true
    must_trace_to_fr: true  # æ‰€æœ‰Epicå¿…é¡»å¯è¿½æº¯åˆ°FR

# ArchitectureéªŒè¯è§„åˆ™
architecture_validation:
  version_must_increment: true

  components:
    can_delete: false  # ç¦æ­¢åˆ é™¤ç»„ä»¶
    can_deprecate: true  # å…è®¸æ ‡è®°ä¸ºdeprecated
    can_modify_interfaces: "warning"  # ä¿®æ”¹ç»„ä»¶æ¥å£ä¼šäº§ç”Ÿwarning
    can_add: true

  dependencies:
    can_delete: "requires_confirmation"  # åˆ é™¤ä¾èµ–å…³ç³»éœ€è¦ç¡®è®¤
    can_add: true
    must_not_create_cycles: true  # ç¦æ­¢å¾ªç¯ä¾èµ–

  technology_stack:
    can_remove: false  # ç¦æ­¢åˆ é™¤æŠ€æœ¯æ ˆç»„ä»¶
    can_add: true
    version_upgrade_requires_review: true

# OpenAPI SpecéªŒè¯è§„åˆ™
openapi_validation:
  version_must_increment: true

  endpoints:
    can_delete: false  # ç¦æ­¢åˆ é™¤endpointï¼ˆbreaking changeï¼‰
    can_deprecate: true  # å…è®¸æ ‡è®°ä¸ºdeprecated
    can_add: true

  request_schemas:
    can_remove_required_field: false  # ç¦æ­¢åˆ é™¤å¿…å¡«å­—æ®µ
    can_add_required_field: false  # ç¦æ­¢æ–°å¢å¿…å¡«å­—æ®µï¼ˆbreaking changeï¼‰
    can_add_optional_field: true
    can_change_data_type: false  # ç¦æ­¢ä¿®æ”¹æ•°æ®ç±»å‹

  response_schemas:
    can_remove_field: "warning"  # åˆ é™¤å“åº”å­—æ®µä¼šäº§ç”Ÿwarning
    can_add_field: true
    can_change_data_type: false

  http_methods:
    can_change: false  # ç¦æ­¢ä¿®æ”¹HTTPæ–¹æ³•ï¼ˆGET â†’ POSTç­‰ï¼‰

# Data SchemaéªŒè¯è§„åˆ™
data_schema_validation:
  can_remove_entity: false  # ç¦æ­¢åˆ é™¤å®ä½“
  can_remove_field: false  # ç¦æ­¢åˆ é™¤å­—æ®µ
  can_add_required_field: "warning"
  can_change_field_type: false

# Behavior Spec (Gherkin)éªŒè¯è§„åˆ™
behavior_validation:
  can_remove_scenario: "warning"  # åˆ é™¤åœºæ™¯ä¼šäº§ç”Ÿwarning
  can_modify_scenario: true
  can_add_scenario: true

# è‡ªå®šä¹‰éªŒè¯è§„åˆ™
custom_rules:
  # æ£€æŸ¥è™šæ‹Ÿæ•°æ®æ›¿ä»£çœŸå®æ•°æ®
  detect_mock_data_introduction:
    enabled: true
    severity: "error"
    patterns:
      - "mock_"
      - "fake_"
      - "dummy_"
      - "test_data_"
    message: "æ£€æµ‹åˆ°å¯èƒ½çš„è™šæ‹Ÿæ•°æ®å¼•å…¥ï¼Œè¯·ç¡®è®¤æ˜¯å¦ä¸ºçœŸå®æ•°æ®"

  # æ£€æŸ¥API endpointå‘½åä¸€è‡´æ€§
  api_naming_consistency:
    enabled: true
    severity: "warning"
    convention: "RESTful"  # RESTful | RPC | GraphQL

  # æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§å£°æ˜
  version_compatibility_check:
    enabled: true
    severity: "error"
    message: "PRDã€Architectureã€Specçš„ç‰ˆæœ¬å…¼å®¹æ€§å£°æ˜å¿…é¡»ä¸€è‡´"

# æŠ¥å‘Šé…ç½®
reporting:
  output_format: "markdown"  # markdown | json | html
  include_diff: true  # åŒ…å«è¯¦ç»†çš„diffä¿¡æ¯
  include_recommendations: true  # åŒ…å«ä¿®å¤å»ºè®®

  severity_levels:
    error: "ğŸ”´"  # å¿…é¡»ä¿®å¤
    warning: "ğŸŸ¡"  # å»ºè®®Review
    info: "ğŸŸ¢"  # ä»…ä¾›å‚è€ƒ

  # è‡ªåŠ¨ç”Ÿæˆçš„æŠ¥å‘Šç« èŠ‚
  report_sections:
    - summary
    - breaking_changes
    - warnings
    - info
    - version_matrix
    - git_diff
    - recommendations

# Exemptionsï¼ˆè±å…è§„åˆ™ï¼‰
exemptions:
  # æŸäº›æ–‡ä»¶å¯ä»¥è±å…éªŒè¯
  exempt_files:
    - "docs/examples/**"
    - "docs/drafts/**"

  # ç‰¹å®šè¿­ä»£å¯ä»¥è±å…æŸäº›è§„åˆ™
  exempt_iterations:
    # Iteration 1é€šå¸¸æ˜¯åˆå§‹åŒ–ï¼Œå¯ä»¥è±å…æ‰€æœ‰è§„åˆ™
    1:
      - "all"

# é€šçŸ¥é…ç½®
notifications:
  on_breaking_change: true
  on_validation_failure: true
  methods:
    - console  # æ§åˆ¶å°è¾“å‡º
    # - email  # æœªæ¥å¯æ‰©å±•
    # - slack  # æœªæ¥å¯æ‰©å±•
