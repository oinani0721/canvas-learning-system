# Parallel Development Configuration
# Version: 1.0.0
# Created: 2025-11-20

parallel_dev:
  version: "1.0.0"
  enabled: true

  # Default settings
  defaults:
    max_concurrent: 8          # Maximum parallel worktrees
    batch_size: 4              # Recommended batch size for resources
    qa_groups: 3               # Number of QA groups for parallel review

  # Worktree configuration
  worktree:
    base_path: ".."            # Parent directory for worktrees
    naming_pattern: "Canvas-{phase}-{story}"  # e.g., Canvas-develop-13.1
    cleanup_on_finalize: true  # Auto-cleanup after sprint complete
    branch_prefix: "story-"    # Branch naming: story-13.1

  # Dependency analysis
  dependencies:
    analyze_before_develop: true   # Run analysis before *init-parallel-develop
    block_on_conflict: false       # If true, abort on conflict; if false, warn only
    allow_manual_resolution: true  # Allow user to decide on conflicts
    story_path: "docs/stories"     # Where to find story files

  # Merge configuration
  merge:
    strategy: "recursive"          # Git merge strategy
    auto_resolve: true             # Attempt auto-resolution of simple conflicts
    fail_on_conflict: false        # If true, abort merge on conflict
    sync_status_after_merge: true  # Update YAML status after merge

  # Status tracking
  status:
    use_independent_files: true    # Each worktree has .worktree-status.yaml
    sync_on_merge: true            # Sync worktree status to main YAML
    status_file: ".worktree-status.yaml"

  # Notifications and logging
  notifications:
    show_progress: true            # Verbose progress output
    warn_on_conflict: true         # Highlight conflicts in output
    generate_reports: true         # Create markdown reports

  # Resource limits
  resources:
    max_memory_per_session: "2GB"  # Approximate per Claude session
    recommended_cpu_cores: 4       # For parallel sessions
    disk_space_per_worktree: "500MB"  # Approximate per worktree

  # Testing requirements
  testing:
    require_tests_pass: true       # Block dev-complete if tests fail
    test_command: "pytest src/tests/ -v"
    min_test_coverage: 80          # Percentage (optional enforcement)

  # Code consistency
  code_consistency:
    method: "devLoadAlwaysFiles"   # Rely on loaded coding standards
    linter_on_merge: false         # Run linter during merge (future)
    enforce_style: false           # Strict style enforcement (future)

  # Contract protection
  contracts:
    read_only_specs: true          # Specs are read-only during parallel dev
    specs_paths:
      - "specs/api/*.yml"
      - "specs/data/*.json"

# Phase-specific overrides
phases:
  draft:
    naming_pattern: "Canvas-draft-{story}"
    auto_cleanup: true

  develop:
    naming_pattern: "Canvas-develop-{story}"
    require_affected_files: true

  qa:
    group_size: 3                  # Stories per QA group
    parallel_groups: true

# Integration with existing tools
integration:
  planning_orchestrator: true      # Coordinate with @planning-orchestrator
  correct_course: true             # Use *correct-course for conflicts
  yaml_status: true                # Update canvas-project-status.yaml

# Daemon configuration (auto QA triggering)
daemon:
  enabled: true                    # Enable daemon mode
  scan_interval: 30                # Seconds between worktree scans
  max_concurrent_qa: 3             # Maximum parallel QA sessions
  debounce_seconds: 2.0            # Prevent rapid re-triggers
  log_file: ".daemon-log.txt"      # Daemon log file
  state_file: ".daemon-state.json" # Daemon state persistence
  auto_start: false                # Auto-start daemon with /parallel

# Automation configuration (parallel-develop-auto.ps1)
automation:
  enabled: true
  prompt_version: "2.0"            # Enhanced prompt with HALT points
  qa_sequence:                     # Full QA command sequence
    - "*trace"
    - "*nfr-assess"
    - "*review"
    - "*gate"
  auto_commit: true                # Auto git commit on QA PASS/WAIVED
  max_fix_attempts: 1              # Max attempts to fix CONCERNS
  result_file: ".worktree-result.json"  # Result output file
  allowed_tools: "Bash,Read,Write,Edit,Grep,Glob,Task,TodoWrite"
  max_turns: 200                   # Max agentic turns per session
