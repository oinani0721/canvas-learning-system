# ══════════════════════════════════════════════════════════════════════════════
# Conflict Resolutions Registry
# ══════════════════════════════════════════════════════════════════════════════
# Purpose: Record all SoT (Source of Truth) conflict resolutions for audit trail
# Usage: Agents record decisions here when resolving conflicts via AskUserQuestion
# Reference: docs/architecture/sot-hierarchy.md
# ══════════════════════════════════════════════════════════════════════════════

version: "1.0.0"
last_updated: "2025-11-25"

# Schema for conflict resolution entries
schema:
  id: "CR-YYYY-MM-DD-NNN"  # Unique identifier (e.g., CR-2025-11-25-001)
  detected_at:
    story: "Story ID where conflict was detected"
    step: "Validation step (e.g., 8d, 8c)"
    agent: "Agent that detected (PO, SM, Dev)"
  conflict:
    document_a:
      path: "Path to document A"
      level: "SoT level (1-6)"
      section: "Specific section"
      value: "Conflicting value/definition"
    document_b:
      path: "Path to document B"
      level: "SoT level (1-6)"
      section: "Specific section"
      value: "Conflicting value/definition"
    description: "Human-readable conflict description"
  resolution:
    option: "A|B|C|D (Accept hierarchy | Override | Modify both | Defer)"
    decision: "Which document wins"
    rationale: "Why this decision was made"
    adr_required: false  # true if Option B selected
    adr_path: null  # Path to ADR if created
  cascade_updates:
    - document: "Path to document that needs update"
      action: "What to change"
      status: "pending|completed"
  metadata:
    resolved_by: "User identifier"
    timestamp: "ISO 8601 timestamp"
    phase: "Phase 2|Phase 4"

# ══════════════════════════════════════════════════════════════════════════════
# Conflict Resolution Registry
# ══════════════════════════════════════════════════════════════════════════════
resolutions: []

# ══════════════════════════════════════════════════════════════════════════════
# Example Entry (for reference, remove in production)
# ══════════════════════════════════════════════════════════════════════════════
# - id: "CR-2025-11-25-001"
#   detected_at:
#     story: "Story-15.1"
#     step: "8d"
#     agent: "PO"
#   conflict:
#     document_a:
#       path: "docs/prd/epics/EPIC-15-FastAPI.md"
#       level: 1
#       section: "Section 3.2 User Model"
#       value: "email field is optional"
#     document_b:
#       path: "specs/data/user.schema.json"
#       level: 3
#       section: "properties.email"
#       value: "email is in required array"
#     description: "PRD says email is optional, but Schema defines it as required"
#   resolution:
#     option: "A"
#     decision: "PRD (Level 1)"
#     rationale: "PRD is authoritative for functional requirements. Schema was created before PRD update."
#     adr_required: false
#     adr_path: null
#   cascade_updates:
#     - document: "specs/data/user.schema.json"
#       action: "Remove 'email' from required array"
#       status: "pending"
#   metadata:
#     resolved_by: "User"
#     timestamp: "2025-11-25T12:30:00+08:00"
#     phase: "Phase 2"

# ══════════════════════════════════════════════════════════════════════════════
# Statistics (auto-updated by validation scripts)
# ══════════════════════════════════════════════════════════════════════════════
statistics:
  total_conflicts: 0
  resolved: 0
  pending: 0
  by_option:
    A_accept_hierarchy: 0
    B_override_with_adr: 0
    C_modify_both: 0
    D_deferred: 0
  by_level_pair:
    PRD_vs_Architecture: 0
    PRD_vs_Schema: 0
    PRD_vs_OpenAPI: 0
    Architecture_vs_Schema: 0
    Architecture_vs_OpenAPI: 0
    Schema_vs_OpenAPI: 0
    Story_vs_Specs: 0
